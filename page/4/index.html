<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-封装CentOS系统几个步骤" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/封装CentOS系统几个步骤/" class="article-date">
  <time datetime="2016-12-13T02:25:44.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/封装CentOS系统几个步骤/">封装CentOS系统几个步骤</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>准备工作<br>1.干净的操作系统镜像,推荐官方下载。<br>2.一台linux主机，需要安装mkisofs</p>
<ol>
<li>kickstarts文件<br>封装光盘<br>1.复制文件<br>cd iso文件所在目录<br>mount -o loop ./CentOS-6.5-x86_64-bin-DVD1.iso /mnt/   ##挂载镜像文件<br>mkdir /var/iso  ##创建新系统的文件目录<br>cd /mnt    ##进入光盘挂载目录<br>cp -a . /var/iso/<br>cd /var/iso<br>2.修改文件<br>在/var/iso/目录里面操作。</li>
</ol>
<p>vi isolinux/isolinux.cfg<br>在label linux 这一行上面添加。</p>
<p>label custom<br>menu label ^custom CentOS 6.5<br>menu default<br>kernel vmlinuz<br>append ks=cdrom:/isolinux/ks.cfg initrd=initrd.img biosdevname=0<br>复制准备好的 ks.cfg 到 isolinux/ 目录</p>
<p>cp /root/ks.cfg isolinux/ks.cfg<br>3.封装光盘<br>mkisofs -o ../CentOS-6.5-x86_64_release1.0.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -R -J -v -T ./</p>
<p>mkisofs -o ../CentOS-6.5-x86_64_release1.0.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -R -J -v -T ./</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/封装CentOS系统几个步骤/" data-id="ciwpmlud1002ds6cy9rxpruus" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-删除指定大小的文件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/删除指定大小的文件/" class="article-date">
  <time datetime="2016-12-13T02:24:14.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/删除指定大小的文件/">删除指定大小的文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用dd命令创建一个实验文件：</p>
<p>dd if=/dev/zero of=test.txt bs=10M count=1</p>
<p>创建大小为10M的test.txt文件。</p>
<p>[root@lamp test]# find . -size 10M -exec ls -lh {} \;</p>
<p>-rw-r–r– 1 root root 10M 11月  3 14:04 ./test.txt<br>[root@lamp test]# find . -size 10M -exec rm {} \;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/删除指定大小的文件/" data-id="ciwpmlucr001zs6cybtjh943m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-7-x-预配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Centos-7-x-预配/" class="article-date">
  <time datetime="2016-12-13T02:12:22.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Centos-7-x-预配/">Centos 7.x 预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>VMware Tools<br>tar -zxvf VMwareTools-*.tar.gz<br>cd vmware-tools-distrib/<br>ls<br>./vmware-install.pl</p>
<p>XenServer Tools<br>mount /dev/cdrom /mnt/<br>mount: /dev/sr0 写保护，将以只读方式挂载<br>cd /mnt/Linux/</p>
<p>[root@CentOS7 ~]# sed -i ‘s#keepcache=0#keepcache=1#g’ /etc/yum.conf<br>[root@CentOS7 ~]# grep keepcache /etc/yum.conf<br>keepcache=1<br>[root@CentOS7 ~]# ls /var/cache/yum/x86_64/7/base/packages/</p>
<p>vim /etc/hostname<br>cat /etc/hostname<br>CentOS7</p>
<p>vim /etc/hosts<br>cat /etc/hosts<br>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br>[root@CentOS7 ~]#</p>
<p>vim /etc/selinux/config<br>[root@CentOS7 ~]# cat /etc/selinux/config</p>
<h1 id="This-file-controls-the-state-of-SELinux-on-the-system"><a href="#This-file-controls-the-state-of-SELinux-on-the-system" class="headerlink" title="This file controls the state of SELinux on the system."></a>This file controls the state of SELinux on the system.</h1><h1 id="SELINUX-can-take-one-of-these-three-values"><a href="#SELINUX-can-take-one-of-these-three-values" class="headerlink" title="SELINUX= can take one of these three values:"></a>SELINUX= can take one of these three values:</h1><h1 id="enforcing-SELinux-security-policy-is-enforced"><a href="#enforcing-SELinux-security-policy-is-enforced" class="headerlink" title="enforcing - SELinux security policy is enforced."></a>enforcing - SELinux security policy is enforced.</h1><h1 id="permissive-SELinux-prints-warnings-instead-of-enforcing"><a href="#permissive-SELinux-prints-warnings-instead-of-enforcing" class="headerlink" title="permissive - SELinux prints warnings instead of enforcing."></a>permissive - SELinux prints warnings instead of enforcing.</h1><h1 id="disabled-No-SELinux-policy-is-loaded"><a href="#disabled-No-SELinux-policy-is-loaded" class="headerlink" title="disabled - No SELinux policy is loaded."></a>disabled - No SELinux policy is loaded.</h1><h1 id="SELINUX-enforcing"><a href="#SELINUX-enforcing" class="headerlink" title="SELINUX=enforcing"></a>SELINUX=enforcing</h1><p>SELINUX=disabled</p>
<h1 id="SELINUXTYPE-can-take-one-of-three-two-values"><a href="#SELINUXTYPE-can-take-one-of-three-two-values" class="headerlink" title="SELINUXTYPE= can take one of three two values:"></a>SELINUXTYPE= can take one of three two values:</h1><h1 id="targeted-Targeted-processes-are-protected"><a href="#targeted-Targeted-processes-are-protected" class="headerlink" title="targeted - Targeted processes are protected,"></a>targeted - Targeted processes are protected,</h1><h1 id="minimum-Modification-of-targeted-policy-Only-selected-processes-are-protected"><a href="#minimum-Modification-of-targeted-policy-Only-selected-processes-are-protected" class="headerlink" title="minimum - Modification of targeted policy. Only selected processes are protected."></a>minimum - Modification of targeted policy. Only selected processes are protected.</h1><h1 id="mls-Multi-Level-Security-protection"><a href="#mls-Multi-Level-Security-protection" class="headerlink" title="mls - Multi Level Security protection."></a>mls - Multi Level Security protection.</h1><p>SELINUXTYPE=targeted</p>
<p>systemctl stop firewalld.service<br>systemctl disable firewalld.service<br>Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.<br>Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.<br>[root@CentOS7 ~]#<br>reboot</p>
<p>getenforce<br>Disabled</p>
<p>查看firewall</p>
<p>快照</p>
<p>rpm -ivh <a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm</a><br>yum clean all<br>yum makecache<br>yum repolist</p>
<p>[202.108.6.95] [202.112.29.82] [110.75.190.198] [115.28.122.198] [182.92.12.11]<br>[120.25.108.11] [110.75.186.249] [110.75.186.248] [110.75.186.247]<br>yum install ntp -y<br>systemctl enable ntpd<br>systemctl status ntpd<br>ntpdate -u 202.108.6.95<br>n1<br>vim /etc/ntp.conf<br>server 202.108.6.95 prefer<br>service ntpd start<br>ntpstat</p>
<p>yum groupinstall “Development tools”</p>
<p>克隆 修改为命令行 </p>
<p>CentOS7修改默认运行级别<br>查看状态<br>systemctl get-default<br>修改为命令行<br>systemctl set-default multi-user.target<br>修改为图形<br>systemctl set-default graphical.target</p>
<p>网络设置<br>vim /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=”eth0”<br>BOOTPROTO=none<br>ONBOOT=”yes”<br>IPADDR=192.168.57.3<br>PREFIX=24<br>GATEWAY=192.168.57.2<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5</p>
<p>[root@Centos7-Zabbix ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0<br>TYPE=”Ethernet”<br>BOOTPROTO=”none”<br>DEFROUTE=”yes”<br>IPV4_FAILURE_FATAL=”no”<br>IPV6INIT=”yes”<br>IPV6_AUTOCONF=”yes”<br>IPV6_DEFROUTE=”yes”<br>IPV6_FAILURE_FATAL=”no”<br>NAME=”eth0”<br>UUID=”e228b577-792e-4188-be8c-af777ce949e0”<br>DEVICE=”eth0”<br>ONBOOT=”yes”<br>IPADDR=”10.6.4.103”<br>PREFIX=”24”<br>GATEWAY=”10.6.4.1”<br>DNS1=”61.177.7.1”<br>DOMAIN=”223.5.5.5”<br>IPV6_PEERDNS=”yes”<br>IPV6_PEERROUTES=”yes”<br>IPV6_PRIVACY=”no”<br>[root@Centos7-Zabbix ~]#</p>
<p>yum install lrzsz -y<br>sz download<br>rz upload</p>
<p>保留RPM包<br>sed -i ‘s#keepcache=0#keepcache=1#g’ /etc/yum.conf<br>grep keepcache /etc/yum.conf<br>keepcache=1<br>ls /var/cache/yum/x86_64/7/base/packages/</p>
<p>快照</p>
<p>rpm -qa | grep java<br>rpm -e –nodeps javapackages-tools-3.4.1-5.el7.noarch<br>rpm -e –nodeps java-1.7.0-openjdk-headless-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps python-javapackages-3.4.1-5.el7.noarch<br>rpm -e –nodeps tzdata-java-2014b-1.el7.noarch<br>rpm -qa | grep java</p>
<p>tar -xvf jdk-8u66-linux-x64.tar.gz<br>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.8.0_66/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export PATH=$PATH:${JAVA_HOME}/bin<br>source /etc/profile<br>java -version</p>
<p>wget <a href="https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz" target="_blank" rel="external">https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz</a><br>wget <a href="https://www.python.org/ftp/python/3.4.3/Python-3.4.3.tar.xz" target="_blank" rel="external">https://www.python.org/ftp/python/3.4.3/Python-3.4.3.tar.xz</a></p>
<p>ll -h<br>tar -Jxvf Python-3.4.3.tar.xz<br>mkdir /usr/local/python3<br>cd Python-3.4.3/<br>yum -y install gcc<br>./configure –prefix=/usr/local/python3<br>make<br>make install<br>cd /usr/bin/<br>mv python python2.7<br>ln -s /usr/local/python3/bin/python3 /usr/bin/python<br>python<br>Python 3.4.3 (default, Jun 17 2016, 13:34:53)<br>[GCC 4.8.5 20150623 (Red Hat 4.8.5-4)] on linux<br>Type “help”, “copyright”, “credits” or “license” for more information.</p>
<blockquote>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>vim /usr/bin/yum</p>
<p>#!/usr/bin/python2.7<br>vim /usr/libexec/urlgrabber-ext-down</p>
<p>#! /usr/bin/python2.7</p>
<p>yum -y install ntp</p>
<p>python -V<br>Python 3.4.3<br>python</p>
<p>vim /etc/profile<br>source /etc/profile</p>
<p>uname -a<br>su jinyan<br>mv eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz /home/jinyan/<br>cd /home/jinyan/<br>chown jinyan:jinyan eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz</p>
<p>rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>wget <a href="http://nginx.org/keys/nginx_signing.key" target="_blank" rel="external">http://nginx.org/keys/nginx_signing.key</a><br>rpmkeys –import nginx_signing.key<br>vim /etc/yum.repos.d/nginx.repo<br>rpmkeys -K nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>yum -y install nginx<br>systemctl start nginx<br>systemctl enable nginx<br>systemctl status httpd.service<br>systemctl status nginx.service<br>vim /etc/nginx/nginx.conf </p>
<p>nano /etc/nginx/nginx.conf<br>vim /etc/nginx/nginx.conf<br>nginx -s reload<br>mkdir -p /data/www<br>getenforce<br>echo “This a test page.” &gt;/data/www/index.html</p>
<p>chmod -R 777 /data/www/<br>tail -f /var/log/nginx/error.log<br>cd /data/www/<br>touch favicon.ico<br>ls<br>tail -f /var/log/nginx/error.log<br>nginx -s reload</p>
<p>yum install perl-DBI -y<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>yum install mysql-community-server -y<br>yum -y install mysql-community-client</p>
<p>systemctl start mysqld<br>systemctl enable mysqld<br>systemctl status mysqld<br>netstat -tunlp | grep :3306<br>mysqladmin -uroot password yanjin<br>mysqladmin -uroot password<br>mysqladmin -u root password<br>mysql -uroot -pyanjin</p>
<h1 id="假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话："><a href="#假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话：" class="headerlink" title="假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话："></a>假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话：</h1><p>[root@study ~]# dd if=centos7.iso of=/dev/sdc</p>
<p>时间设置<br>date后面的数字代表月日时分年<br>date 070415522015<br>时间同步<br>/usr/sbin/ntpdate -u 202.120.2.101<br>ntpdate -u 202.120.2.101</p>
<p>FTP安装配置<br>yum -y install vsftpd<br>vim /etc/vsftpd/vsftpd.conf<br>chkconfig  vsftpd on<br>chmod -R 777 /mycephfs/ftp<br>useradd -g ftp -d /mycephfs/ftp -M ftpuser<br>passwd ftpuser<br>sztzuchi<br>systemctl restart vsftpd</p>
<p>安装配置Samba<br>yum -y install samba samba-client samba-common<br>vim /etc/samba/smb.conf<br>[cephbe]<br>        comment = The cephbe<br>        path = /mycephfs/be<br>        browseable = yes<br>        writable = yes</p>
<p>chmod -R 777 /mycephfs/be<br>useradd smbcephbe<br>smbpasswd -a smbcephbe<br>sztzuchi<br>systemctl restart smb<br>systemctl status smb<br>chkconfig smb on</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Centos-7-x-预配/" data-id="ciwpmluap000cs6cyblik7z5a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-6-x-预配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Centos-6-x-预配/" class="article-date">
  <time datetime="2016-12-13T02:10:25.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Centos-6-x-预配/">Centos 6.x 预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>rpm -ivh <a href="http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm" target="_blank" rel="external">http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</a><br>yum -y install lrzsz<br>时间设置<br>date后面的数字代表月日时分年<br>date 070415522015<br>时间同步<br>/usr/sbin/ntpdate -u 202.108.6.95<br>ntpdate -u 202.108.6.95<br>cn.ntp.org.cn</p>
<p>[202.108.6.95] [202.112.29.82] [110.75.190.198] [115.28.122.198] [182.92.12.11]<br>[120.25.108.11] [110.75.186.249] [110.75.186.248] [110.75.186.247]</p>
<p>yum install ntp -y<br>chkconfig ntpd on<br>chkconfig –list ntpd<br>ntpdate -u 202.120.2.101<br>n10<br>vim /etc/ntp.conf<br>server 202.120.2.101 prefer<br>service ntpd start<br>ntpstat</p>
<p>n2-4<br>vim /etc/ntp.conf<br>server n1<br>ntpdate -u n1<br>service ntpd start</p>
<p>网络设置<br>vim /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=”eth0”<br>BOOTPROTO=none<br>NM_CONTROLLED=”yes”<br>ONBOOT=”yes”<br>TYPE=”Ethernet”<br>UUID=”735675de-800d-47c3-bcbb-f61abbd19cf2”<br>IPADDR=10.6.0.211<br>PREFIX=24<br>GATEWAY=10.6.0.128<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=yes<br>IPV6INIT=no<br>NAME=”System eth0”<br>HWADDR=DE:A9:01:8A:18:34<br>LAST_CONNECT=1438477375</p>
<p>修改主机名<br>vim /etc/sysconfig/network<br>NETWORKING=yes<br>HOSTNAME=n4</p>
<p>vim /etc/hosts<br>10.6.0.211 n1<br>10.6.0.212 n2<br>10.6.0.213 n3<br>10.6.0.214 n4<br>10.6.0.215 n5<br>10.6.0.216 n6</p>
<p>关闭防火墙：<br>service iptables stop （临时关闭）<br>chkconfig iptables off （重启后生效）</p>
<p>关闭SELINUX<br>vim /etc/selinux/config<br>SELINUX=disabled</p>
<p>配置SSH<br>yum -y install openssh-server<br>vim /etc/ssh/sshd_config<br>UseDNS no<br>PermitRootLogin yes<br>service sshd restart<br>yum install openssh-clients -y<br>/etc/init.d/sshd restart</p>
<p>更换软件源<br>wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-6.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/Centos-6.repo</a><br>yum clean all<br>yum makecache</p>
<p>CentOS 6.x 使用安装光盘作为yum源<br>挂载光驱</p>
<p>[root@yanjin ~]#  mount /dev/cdrom /media/</p>
<p>修改yum配置文件</p>
<p>[root@yanjin ~]#  vim /etc/yum.repos.d/CentOS6-Base-163.repo</p>
<p>[c6-media]</p>
<p>name=CentOS-$releasever - Media</p>
<p>baseurl=file:///media/</p>
<p>gpgcheck=1</p>
<p>enabled=0</p>
<p>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</p>
<p>测试</p>
<p>[root@yanjin ~]# yum –disablerepo=* –enablerepo=c6-media search gcc</p>
<p>SSH无密码登录配置<br>ssh-keygen -t rsa<br>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys<br>chmod 600 ~/.ssh/authorized_keys<br>mkdir -p /root/.ssh/<br>scp ~/.ssh/authorized_keys root@n2:~/.ssh/<br>scp ~/.ssh/authorized_keys root@n3:~/.ssh/<br>scp ~/.ssh/authorized_keys root@n4:~/.ssh/</p>
<p>安装桌面环境<br>yum groupinstall ‘X Window System’  -y</p>
<p>安装配置VNC<br>设置密码<br>yum -y install tigervnc-server<br>vncpasswd<br>更改配置<br>vim /etc/sysconfig/vncservers<br>VNCSERVERS=”0:root”<br>VNCSERVERARGS[0]=”-geometry 1024x768”</p>
<p>service vncserver start<br>开机启动<br>chkconfig  vncserver on</p>
<p>卸载内置Java<br>rpm -qa | grep java<br>rpm -e –nodeps java-1.7.0-openjdk-1.7.0.45-2.4.3.3.el6.x86_64<br>rpm -e –nodeps java-1.6.0-openjdk-1.6.0.0-1.66.1.13.0.el6.x86_64<br>rpm -e –nodeps tzdata-java-2013g-1.el6.noarch</p>
<p>MySQL安装配置<br>yum install mysql-server -y<br>chkconfig mysqld on<br>service mysqld start<br>mysqladmin -u root password yanjin<br>mysql -uroot -pyanjin</p>
<p>FTP安装配置<br>yum -y install vsftpd<br>[root@localhost ~]# vim /etc/vsftpd/vsftpd.conf<br>[root@localhost ~]# chkconfig –level 345 vsftpd on<br>[root@localhost ~]#<br>[root@localhost ~]#<br>[root@localhost ~]# useradd -g ftp -d /home -M ftpuser<br>[root@localhost ~]# chmod 777 /home/<br>[root@localhost ~]# passwd ftpuser<br>Changing password for user ftpuser.<br>New password:<br>BAD PASSWORD: it is based on a dictionary word<br>BAD PASSWORD: is too simple<br>Retype new password:<br>passwd: all authentication tokens updated successfully.<br>[root@localhost ~]# service vsftpd restart<br>Shutting down vsftpd: [  OK  ]<br>Starting vsftpd for vsftpd: [  OK  ]<br>service vsftpd restart<br>开机启动chkconfig –level 345 vsftpd on</p>
<p>安装配置Samba<br>yum install samba samba-client samba-swat -y<br>vim /etc/samba/smb.conf<br>[hdfs]<br>        comment = The hdfs<br>        path = /mnt/hdfs/<br>        browseable = yes<br>        writable = yes<br>useradd smbhdfs<br>smbpasswd -a smbhdfs<br>service smbd restart<br>/etc/init.d/smb start<br>/etc/init.d/nmb start<br>service smb status<br>chkconfig –level 35 smb on</p>
<p>xxx is not in the sudoers file. This incident will be reported<br>visudo</p>
<h2 id="Allow-root-to-run-any-commands-anywhere"><a href="#Allow-root-to-run-any-commands-anywhere" class="headerlink" title="Allow root to run any commands anywhere"></a>Allow root to run any commands anywhere</h2><p>root    ALL=(ALL)       ALL<br>hdfs    ALL=(ALL)       ALL</p>
<p>NFS<br>server<br>[root@n0 ~]# yum install nfs-utils -y<br>[root@n0 ~]# vim /etc/exports<br>/home   10.6.0.0/24(rw,no_root_squash)  <em>(ro)<br>[root@n0 ~]# /etc/init.d/rpcbind start<br>[root@n0 ~]# /etc/init.d/nfs start<br>启动 NFS 服务： [确定]<br>关掉 NFS 配额：[确定]<br>启动 NFS mountd：[确定]<br>启动 NFS 守护进程：[确定]<br>正在启动 RPC idmapd：[确定]<br>[root@n0 ~]# /etc/init.d/nfslock start<br>[root@n0 ~]# chkconfig rpcbind on<br>[root@n0 ~]# chkconfig nfs on<br>[root@n0 ~]# chkconfig nfslock on<br>[root@n0 ~]# netstat -tunlp | grep :111<br>tcp        0      0 0.0.0.0:111                 0.0.0.0:</em>                   LISTEN      1012/rpcbind<br>tcp        0      0 :::111                      :::<em>                        LISTEN      1012/rpcbind<br>udp        0      0 0.0.0.0:111                 0.0.0.0:</em>                               1012/rpcbind<br>udp        0      0 :::111                      :::<em>                                    1012/rpcbind<br>[root@n0 ~]#<br>[root@n0 ~]# tail /var/log/messages<br>[root@n0 ~]# rpcinfo -p localhost<br>   program vers proto   port  service<br>    100000    4   tcp    111  portmapper<br>    100000    3   tcp    111  portmapper<br>    100000    2   tcp    111  portmapper<br>    100000    4   udp    111  portmapper<br>    100000    3   udp    111  portmapper<br>    100000    2   udp    111  portmapper<br>    100024    1   udp  47728  status<br>    100024    1   tcp  37084  status<br>    100011    1   udp    875  rquotad<br>    100011    2   udp    875  rquotad<br>    100011    1   tcp    875  rquotad<br>    100011    2   tcp    875  rquotad<br>    100005    1   udp  59870  mountd<br>    100005    1   tcp  42830  mountd<br>    100005    2   udp  57353  mountd<br>    100005    2   tcp  53228  mountd<br>    100005    3   udp  53687  mountd<br>    100005    3   tcp  45899  mountd<br>    100003    2   tcp   2049  nfs<br>    100003    3   tcp   2049  nfs<br>    100003    4   tcp   2049  nfs<br>    100227    2   tcp   2049  nfs_acl<br>    100227    3   tcp   2049  nfs_acl<br>    100003    2   udp   2049  nfs<br>    100003    3   udp   2049  nfs<br>    100003    4   udp   2049  nfs<br>    100227    2   udp   2049  nfs_acl<br>    100227    3   udp   2049  nfs_acl<br>    100021    1   udp  36721  nlockmgr<br>    100021    3   udp  36721  nlockmgr<br>    100021    4   udp  36721  nlockmgr<br>    100021    1   tcp  47260  nlockmgr<br>    100021    3   tcp  47260  nlockmgr<br>    100021    4   tcp  47260  nlockmgr<br>[root@n0 ~]# rpcinfo -t localhost nfs<br>program 100003 version 2 ready and waiting<br>program 100003 version 3 ready and waiting<br>program 100003 version 4 ready and waiting<br>[root@n0 ~]# showmount -e localhost<br>Export list for localhost:<br>/home (everyone)<br>[root@n0 ~]# tail /var/lib/nfs/etab<br>/home   10.6.0.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,no_root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534,sec=sys,rw,no_root_squash,no_all_squash)<br>/home   </em>(ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534,sec=sys,ro,root_squash,no_all_squash)<br>[root@n0 ~]# exportfs -arv<br>exporting 10.6.0.0/24:/home<br>exporting *:/home<br>[root@n0 ~]# cd /home/<br>[root@n0 home]# ls<br>hadoop  lost+found  test<br>[root@n0 home]# ll<br>总用量 24<br>drwx——  31 hadoop hadoop  4096 10月 30 08:50 hadoop<br>drwx——.  2 root   root   16384 10月 17 10:50 lost+found<br>drwxr-xr-x   2 root   root    4096 11月  7 13:35 test</p>
<p>client<br>[root@n1 ~]# /etc/init.d/rpcbind start<br>[root@n1 ~]# /etc/init.d/nfslock start<br>[root@n1 ~]# chkconfig rpcbind on<br>[root@n1 ~]# chkconfig nfslock on<br>[root@n1 ~]# showmount -e 10.6.0.24<br>Export list for 10.6.0.24:<br>/home (everyone)<br>[root@n1 ~]# mkdir -p /home/nfs<br>[root@n1 ~]# mount -t nfs 10.6.0.24:/home/ /home/nfs/<br>[root@n1 ~]# df -h<br>Filesystem        Size  Used Avail Use% Mounted on<br>/dev/sda3         1.8T  1.1T  687G  61% /<br>tmpfs             7.8G  148K  7.8G   1% /dev/shm<br>/dev/sda1         194M   34M  151M  19% /boot<br>fuse_dfs           22T  3.9T   18T  19% /mnt/hdfs<br>cm_processes      7.8G  7.5M  7.8G   1% /opt/cm-5.1.3/run/cloudera-scm-agent/process<br>10.6.0.24:/home/  242G  1.5G  228G   1% /home/nfs<br>[root@n1 ~]# cd /home/nfs/<br>[root@n1 nfs]# touch test<br>[root@n1 nfs]# ll<br>总用量 24<br>drwx—— 31 nobody hadoop  4096 10月 30 08:50 hadoop<br>drwx——  2 root   root   16384 10月 17 10:50 lost+found<br>drwxr-xr-x  2 root   root    4096 11月  7 13:35 test</p>
<p>开机启动<br>vim /etc/rc.d/rc.local<br>mount -t nfs -o nosuid,noexec,nodev,rw,bg,soft,rsize=32768,wsize=32768 10.6.0.24:/home/ /home/nfs/</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Centos-6-x-预配/" data-id="ciwpmluao000bs6cymk57z6jr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/CentOS-6-x-Server/" class="article-date">
  <time datetime="2016-12-13T02:09:26.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/CentOS-6-x-Server/">CentOS 6.x Server</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@www ~]# vim /etc/hosts<br>192.168.0.99    www.centos.jinyan<br>192.168.0.3    JinYan-PC<br>10.0.0.254    www.centos.jinyan<br>10.0.0.1    jinyanxp<br>10.0.0.2    client.centos.jinyan<br>10.0.0.3    server.centos.jinyan</p>
<p>批量建立账号<br>[root@jinyan ~]# mkdir bin<br>[root@jinyan ~]# cd /root/bin<br>[root@jinyan bin]# vim useradd.sh</p>
<p>#!/bin/bash<br>groupadd jinyangroup<br>for username in jinyan renjia sanyuan yuanmu renyuan<br>do<br>  useradd -G jinyangroup $username<br>  echo “yanjin” | passwd –stdin $username<br>done<br>[root@jinyan bin]# sh useradd.sh<br>[root@jinyan bin]# id jinyan</p>
<p>共享目录的权限<br>[root@jinyan ~]# mkdir /home/jinyangroup<br>[root@www bin]# chgrp jinyangroup /home/jinyangroup/<br>[root@jinyan ~]# chmod 2770 /home/jinyangroup/<br>[root@jinyan ~]# ll -d /home/jinyangroup/</p>
<p>磁盘配额<br>[root@jinyan ~]# vim /etc/fstab<br>/dev/mapper/server-myhome /home                   ext4    defaults,usrquota,grpquota        1 2</p>
<p>[root@jinyan ~]# umount /home; mount -a<br>[root@jinyan ~]# mount | grep home<br>/dev/mapper/server-myhome on /home type ext4 (rw,usrquota,grpquota)</p>
<p>[root@jinyan ~]# quotacheck -avug<br>quotacheck: Your kernel probably supports journaled quota but you are not using it. Consider switching to journaled quota to avoid running quotacheck after an unclean shutdown.<br>quotacheck: Scanning /dev/mapper/server-myhome [/home] done</p>
<p>[root@jinyan ~]# quotaon -avug<br>/dev/mapper/server-myhome [/home]: group quotas turned on<br>/dev/mapper/server-myhome [/home]: user quotas turned on</p>
<p>[root@jinyan ~]# edquota -u jinyan<br>  Filesystem                   blocks       soft       hard     inodes     soft     hard<br>  /dev/mapper/server-myhome         20      1800000    2000000        5        0        0</p>
<p>[root@jinyan ~]# edquota -p jinyan renjia<br>[root@jinyan ~]# edquota -p jinyan sanyuan<br>[root@jinyan ~]# edquota -p jinyan yuanmu<br>[root@jinyan ~]# edquota -p jinyan renyuan</p>
<p>[root@jinyan ~]# repquota -au</p>
<p>LVM<br>[root@jinyan ~]# vgdisplay<br>  VG Size               4.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1249<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       0 / 0  </p>
<p>[root@jinyan ~]# fdisk /dev/sda</p>
<p>WARNING: DOS-compatible mode is deprecated. It’s strongly recommended to<br>         switch off the mode (command ‘c’) and change display units to<br>         sectors (command ‘u’).</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux</p>
<p>Command (m for help): n<br>First cylinder (1173-3917, default 1173): 2067<br>Last cylinder, +cylinders or +size{K,M,G} (2067-3917, default 3917): +2G</p>
<p>Command (m for help): t<br>Partition number (1-9): 9<br>Hex code (type L to list codes): 8e<br>Changed system type of partition 9 to 8e (Linux LVM)</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux<br>/dev/sda9            2067        2328     2104515   8e  Linux LVM</p>
<p>Command (m for help): w<br>The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.</p>
<p>[root@jinyan ~]# fdisk -l</p>
<p>[root@jinyan ~]# pvcreate /dev/sda9<br>  Writing physical volume data to disk “/dev/sda9”<br>  Physical volume “/dev/sda9” successfully created<br>[root@jinyan ~]# vgextend server /dev/sda9<br>  Volume group “server” successfully extended</p>
<p>[root@jinyan ~]# vgdisplay<br>  VG Size               6.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1762<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       513 / 2.00 GiB</p>
<p>[root@jinyan ~]# lvdisplay<br>  LV Name                /dev/server/myhome<br>  VG Name                server<br>  LV Size                4.88 GiB</p>
<p>[root@jinyan ~]# lvresize -L 6.88G /dev/server/myhome<br>  Rounding up size to full physical extent 6.88 GiB<br>  Extending logical volume myhome to 6.88 GiB<br>  Logical volume myhome successfully resized</p>
<p>[root@jinyan ~]# resize2fs /dev/server/myhome<br>resize2fs 1.41.12 (17-May-2010)<br>Filesystem at /dev/server/myhome is mounted on /home; on-line resizing required<br>old desc_blocks = 1, new_desc_blocks = 1<br>Performing an on-line resize of /dev/server/myhome to 1804288 (4k) blocks.<br>The filesystem on /dev/server/myhome is now 1804288 blocks long.</p>
<p>[root@jinyan ~]# df -h<br>/dev/mapper/server-myhome<br>                      6.8G  140M  6.4G   3% /home</p>
<p>[root@jinyan ~]# LANG=C chkconfig –list | grep ‘3:on’</p>
<p>[root@localhost ~]# chkconfig autofs off<br>[root@localhost ~]# /etc/init.d/autofs stop</p>
<p>[root@jinyan ~]# netstat -tunlp</p>
<p>[root@localhost ~]# /etc/init.d/avahi-daemon stop<br>[root@localhost ~]# chkconfig avahi-daemon off</p>
<p>[root@localhost ~]# yum -y update</p>
<pre><code># 第一次作会进行非常之久！因为系统真的有些数据要更新嘛！还是得等待的！
</code></pre><p>[root@localhost ~]# vim /etc/crontab<br>15 2 <em> </em> * root /usr/bin/yum -y update</p>
<p>[root@localhost ~]# rpm -qa | grep -i samba<br>    samba-common-3.5.4-68.el6_0.2.x86_64<br>    samba-client-3.5.4-68.el6_0.2.x86_64<br>    samba-winbind-clients-3.5.4-68.el6_0.2.x86_64</p>
<pre><code># 看起来 samba 主程序尚未被安装啊！此时就要这样做：

[root@localhost ~]# yum search samba  &lt;==先查一下有没有相关的软件
[root@localhost ~]# yum -y install samba &lt;==找到之后，那就安装吧！

# 那么如何找出配置文件呢？因为我们总是需要修改配置文件啊！这样做吧：
[root@localhost ~]# rpm -qc samba samba-common
</code></pre><h1 id="先查询一下启动的方式为何："><a href="#先查询一下启动的方式为何：" class="headerlink" title="先查询一下启动的方式为何："></a>先查询一下启动的方式为何：</h1><pre><code>[root@localhost ~]# rpm -ql samba | grep &apos;/etc&apos;
/etc/logrotate.d/samba
/etc/openldap/schema
/etc/openldap/schema/samba.schema
/etc/pam.d/samba
/etc/rc.d/init.d/nmb
/etc/rc.d/init.d/smb  &lt;==所以说是 stand alone 且档名为 smb, nmb 两
</code></pre><p>个！<br>    /etc/samba/smbusers</p>
<h1 id="开始启动他！且设定开机就启动喔！："><a href="#开始启动他！且设定开机就启动喔！：" class="headerlink" title="开始启动他！且设定开机就启动喔！："></a>开始启动他！且设定开机就启动喔！：</h1><p>[root@localhost ~]# /etc/init.d/smb start<br>[root@localhost ~]# /etc/init.d/nmb start</p>
<p>[root@localhost ~]# chkconfig smb on<br>[root@localhost ~]# chkconfig nmb on</p>
<h1 id="接下来，让我们观察一下有没有启动相关的埠口吧！"><a href="#接下来，让我们观察一下有没有启动相关的埠口吧！" class="headerlink" title="接下来，让我们观察一下有没有启动相关的埠口吧！"></a>接下来，让我们观察一下有没有启动相关的埠口吧！</h1><pre><code>[root@localhost ~]# netstat -tlunp | grep &apos;[sn]mbd&apos;
</code></pre><p>ACL<br>[root@jinyan ~]# useradd student<br>[root@jinyan ~]# passwd student<br>[root@jinyan ~]# setfacl -m u:student:rx /home/jinyangroup/<br>[root@jinyan ~]# setfacl -m u:renyuan:- /home/jinyangroup/<br>[root@jinyan ~]# getfacl /home/jinyangroup/<br>getfacl: Removing leading ‘/‘ from absolute path names</p>
<h1 id="file-home-jinyangroup"><a href="#file-home-jinyangroup" class="headerlink" title="file: home/jinyangroup/"></a>file: home/jinyangroup/</h1><h1 id="owner-root"><a href="#owner-root" class="headerlink" title="owner: root"></a>owner: root</h1><h1 id="group-2770"><a href="#group-2770" class="headerlink" title="group: 2770"></a>group: 2770</h1><p>user::rwx<br>user:renyuan:—<br>user:student:r-x<br>group::r-x<br>mask::r-x<br>other::r-x</p>
<p>[root@www ~]# vim /etc/login.defs<br>[root@www ~]# vim /etc/security/limits.conf</p>
<p>[root@jinyan ~]# vim /root/bin/backup.sh</p>
<p>#!/bin/bash<br>backdir=”/etc /home /root /var/spool/mail”<br>basedir=/backup<br>[ ! -d “$basedir” ] &amp;&amp; mkdir $basedir<br>backfile=$basedir/backup.tar.gz<br>tar -zcvf $backfile $backdir</p>
<p>[root@localhost ~]# vim /etc/crontab<br>45 2 <em> </em> * root sh /root/bin/backup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/CentOS-6-x-Server/" data-id="ciwpmluah0007s6cyl50o5fsd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Ubuntu-16-x-预配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Ubuntu-16-x-预配/" class="article-date">
  <time datetime="2016-12-13T02:07:42.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Ubuntu-16-x-预配/">Ubuntu 16.x 预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>java<br>vm tools<br>sudo passwd root<br>Ubuntu软件中心——编辑——更换软件源</p>
<p>root用户登录桌面<br>vim /usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf<br>[SeatDefaults]<br>user-session=ubuntu<br>greeter-show-manual-login=true<br>Ubuntu启用root账户后，登录root账户时报错：读取/root/.profile时发现错误：mesg:ttyname failed:对设备不适当的ioctl操作 作为结果，会话不会被正确配置<br>root@ubuntu:~# cp /home/jinyan/.profile /root/<br>root@ubuntu:~# reboot</p>
<p>cp /etc/apt/sources.list /etc/apt/sources.listbak<br>vim /etc/apt/sources.list<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>apt-get update</p>
<p>用vim打开 /etc/default/locale 文件</p>
<p>原来的配置文件应该是这样的：<br>LANG=”zh_CN.UTF-8”<br>LANGUAGE=”zh_CN:zh:en_US:en”<br>LC_NUMERIC=”zh_CN.UTF-8”<br>LC_TIME=”zh_CN.UTF-8”<br>LC_MONETARY=”zh_CN.UTF-8”<br>LC_PAPER=”zh_CN.UTF-8”<br>LC_IDENTIFICATION=”zh_CN.UTF-8”<br>LC_NAME=”zh_CN.UTF-8”<br>LC_ADDRESS=”zh_CN.UTF-8”<br>LC_TELEPHONE=”zh_CN.UTF-8”<br>LC_MEASUREMENT=”zh_CN.UTF-8”</p>
<p>将原来的配置内容修改为<br>LANG=”en_US.UTF-8″<br>LANGUAGE=”en_US:en”</p>
<p>再在终端下运行：<br>locale-gen -en_US:en<br>注销或重启后，即可恢复为英文的语言环境。</p>
<p>查看防火墙状态<br>root@jinyan-virtual-machine:~# ufw status<br>状态：不活动<br>root@jinyan-virtual-machine:~# getenforce<br>程序“getenforce”尚未安装。 您可以使用以下命令安装：<br>apt-get install selinux-utils</p>
<p>apt-get install vim<br>apt-get install openssh-server<br>vim /etc/ssh/sshd_config<br>找到PermitRootLogin no一行，改为PermitRootLogin yes<br>PermitRootLogin yes</p>
<h1 id="PermitRootLogin-without-password"><a href="#PermitRootLogin-without-password" class="headerlink" title="PermitRootLogin without-password"></a>PermitRootLogin without-password</h1><p>重启系统<br>重启 openssh server<br>/etc/init.d/ssh restart<br>service ssh restart</p>
<p>apt-get install ntp<br>查看ntp同步过程<br>ntpq -p<br>ntpdate -u 202.120.2.101</p>
<p>apt-get install x-window-system-core<br>apt-get install gdm<br>apt-get install ubuntu-desktop<br>apt-get install gnome-core</p>
<p>apt-get install vnc4server<br>vncserver<br>cp ~/.vnc/xstartup  ~/.vnc/xstartup.bak<br>vim ~/.vnc/xstartup</p>
<h1 id="x-window-manager-amp"><a href="#x-window-manager-amp" class="headerlink" title="x-window-manager &amp;"></a>x-window-manager &amp;</h1><h1 id="gnome-session-amp"><a href="#gnome-session-amp" class="headerlink" title="gnome-session &amp;"></a>gnome-session &amp;</h1><p>gnome-panel &amp;<br>gnome-settings-daemon &amp;<br>metacity &amp;<br>nautilus &amp;<br>gnome-terminal &amp;</p>
<p>root@jinyan-virtual-machine:~# vncserver -kill :1<br>Killing Xvnc4 process ID 3767<br>root@jinyan-virtual-machine:~# vncserver :1<br>192.168.50.6:1</p>
<p>apt-get install vsftpd<br>apt-get remove vsftpd</p>
<p>vim /etc/vsftpd.conf<br>local_enable=YES<br>write_enable=YES<br>chroot_local_user=YES<br>chroot_list_enable=YES<br>chroot_list_file=/etc/vsftpd.chroot_list</p>
<p>anonymous_enable=YES</p>
<h1 id="anonymous-enable-NO"><a href="#anonymous-enable-NO" class="headerlink" title="anonymous_enable=NO"></a>anonymous_enable=NO</h1><p>useradd -d /home/ftp -M ftpuser<br>passwd ftpuser</p>
<p>vim /etc/vsftpd.chroot_list<br>ftpuser</p>
<p>vim /etc/ftpusers<br>打开这个文件后，看一看有没有uftp这个用户名，如果没有，就直接退出。如果有就删除uftp,因为这个文件中记录的是不能访问FTP服务器的用户清单。</p>
<p>vim /etc/pam.d/vsftpd</p>
<p>#auth   required        pam_shells.so</p>
<p>mkdir /home/ftp<br>chmod a-w /home/ftp<br>mkdir /home/ftp/data<br>chown -R ftpuser:ftpuser /home/ftp/</p>
<p>service vsftpd restart</p>
<p>mkdir /usr/lib/java<br>tar -zxvf jdk-7u79-linux-x64.tar.gz -C /usr/lib/java/<br>cd /usr/lib/java/jdk1.7.0_79/</p>
<p>vim ~/.bashrc</p>
<p>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.7.0_79/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export CLASS_PATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib<br>export PATH=${JAVA_HOME}/bin:$PATH</p>
<p>root@jinyan-virtual-machine:~# source /etc/profile<br>root@jinyan-virtual-machine:~# java -version<br>java version “1.7.0_79”<br>Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</p>
<p>apt-get install samba<br>apt-get install smbfs</p>
<p>apt-get install samba samba-common system-config-samba python-glade2 gksu<br>在 Unity Dash 中搜索并打开 Samba 配置工具</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Ubuntu-16-x-预配/" data-id="ciwpmlubk000xs6cylr4txb2q" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-差异备份" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Linux-差异备份/" class="article-date">
  <time datetime="2016-12-13T02:05:37.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Linux-差异备份/">Linux 差异备份</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>差异备份简介</p>
<p>差异备份是指在一次全备份后到进行差异备份的这段时间内，对那些增加或者修改文件的备份。在进行恢复时，我们只需对第一次全备份和最后一次差异备份进行恢复。查看完整备份、差异备份、增量备份介绍<br>使用tar进行一次完整备份<br>创建需要备份的测试文件夹<br>[test@localhost test]$ mkdir work<br>[test@localhost test]$ touch work/file1<br>[test@localhost test]$ echo 233 &gt; work/file-233</p>
<p>Screenshot from 2015-07-27 18-16-54<br>完整备份并生成此次备份的参考文件<br>[test@localhost test]$ tar cfz work-full.tar.gz work -g work.bckref<br>进行差异备份<br>对备份后的文件夹进行修改<br>[test@localhost test]$ rm work/file1<br>[test@localhost test]$ touch work/file2<br>[test@localhost test]$ echo 235 &gt; work/file-233<br>差异备份开始<br>[test@localhost test]$ tar cfz work-diff.tar.gz work -g work.bckref<br>恢复<br>所需条件</p>
<p>以上备份包括了一个完整备份、一个差异备份和一个差异参考文件。若我们想要恢复到第一次完整备份的状态，只需要完整备份的备份文件即可。<br>[test@localhost test]$ rm work -fr<br>[test@localhost test]$ tar xvf work-full.tar.gz<br>work/<br>work/file-233<br>work/file1<br>[test@localhost test]$ cat work/file-233<br>233<br>[test@localhost test]$ cat work/file1<br>[test@localhost test]$</p>
<p>可以发现，第一次的完整备份被恢复成功了。若想要恢复到最新的备份状态，还需要使用差异备份文件和差异备份参考文件。<br>[test@localhost test]$ tar xvf work-diff.tar.gz -g work.bckref<br>work/<br>tar: Deleting ‘work/file1’<br>work/file-233<br>work/file2<br>[test@localhost test]$ cat work/file-233<br>235<br>[test@localhost test]$ cat work/file2<br>[test@localhost test]$</p>
<p>可以发现，work下的file1被删除了，而被修改的file-233也被差异备份的数据所覆盖，并且创建了一个新的文件file2.<br>经典备份方案:完整备份+差异备份</p>
<p>在实际使用中，完整备份通常很耗时并且占用磁盘空间较大，而差异备份的占用少，耗时少。但是差异备份由于是比较完整备份一本次备份时的差异，若备份时对目录的修改较大，差异备份就很耗时了。</p>
<p>一种经典的备份方案就是在每周1进行完整备份，而其他时候进行与周1对比的差异备份。这样，差异备份的数据量小恢复也方便。<br>tar对centos系统备份注意事项</p>
<p>毫无疑问，可用tar命令对linux系统进行备份。而在实际操作中，可能会遇到以下几个问题:<br>备份文件恢复时所有者/属性改变。</p>
<p>这是由于没有使用root进行备份和恢复的结果，解决爆发就是使用root运行<br>tar -a</p>
<p>进行备份和恢复。<br>文件acl丢失</p>
<p>tar命令本身不能保存acl权限，而有的tar(如centos7 可添加–acls保存acl权限)可以做到。解决办法就是使用<br>getfacl -R work &gt; work.acl</p>
<p>保存文件的acl权限，而在恢复后使用<br>setfacl –restore=work.acl</p>
<p>恢复文件的acl权限<br>恢复系统后登陆闪退</p>
<p>这是由于selinux的安全上下文丢失产生的结果。在恢复完毕文件后，需要运行<br>touch /.autorelabel &amp;&amp; reboot</p>
<p>对文件的selinux安全上下文进行恢复。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Linux-差异备份/" data-id="ciwpmlub0000ks6cyt7y6cavl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-增量备份" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Linux-增量备份/" class="article-date">
  <time datetime="2016-12-13T02:04:37.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Linux-增量备份/">Linux 增量备份</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>linux系统下tar可以实现对文件的备份与恢复，以下shell是完全+增量方式备份</p>
<p>结合crontab，实现周1到周6每天两次增量备份，周日上午增量，下午为完全备份。</p>
<p>2 6,13 <em> </em> * /root/backupweb.sh</p>
<p>#!/bin/sh</p>
<h1 id="在crontab里设置，每周日完全备份，每天两次增量备份。"><a href="#在crontab里设置，每周日完全备份，每天两次增量备份。" class="headerlink" title="在crontab里设置，每周日完全备份，每天两次增量备份。"></a>在crontab里设置，每周日完全备份，每天两次增量备份。</h1><h1 id="2010-5-26-by-lgq"><a href="#2010-5-26-by-lgq" class="headerlink" title="2010-5-26 by lgq"></a>2010-5-26 by lgq</h1><p>dayofweek=<code>date &quot;+%u%H&quot;</code></p>
<p>today=<code>date &quot;+%Y%m%d%H%M&quot;</code></p>
<p>source=/home/web/</p>
<p>backup=/home/web_bak/webtar/</p>
<p>cd $backup</p>
<p>if [ $dayofweek -eq 018 ]; then<br>                if [ ! -f “full$today.tar.gz” ];then<br>                                rm -rf snapshot<br>                                tar -g snapshot -zcf “full$today.tar.gz” $source<br>                fi<br>else<br>                if [ ! -f “inc$today.tar.gz” ];then<br>                                tar -g snapshot -zcf “inc$today.tar.gz” $source<br>                fi<br>fi</p>
<p>现在我们来展示一个使用tar工具来增量备份的例子。<br>一、增量备份</p>
<p>1、新建backup目录，里面新建file1,file2,file3文件</p>
<pre><code>mkdir backup/
touch backup/{file1,file2,file3}
</code></pre><p>2、进行完整备份</p>
<pre><code>tar -g tarinfo -czf backup-full.tar.gz backup/
</code></pre><p>3、新增文件到backup</p>
<pre><code>touch backup/file4
</code></pre><p>4、进行增量备份</p>
<pre><code>tar -g tarinfo -czf backup-incre1.tar.gz backup/
</code></pre><p>5、查看增量备份文件</p>
<pre><code>tar -ztf backup-incre1.tar.gz
</code></pre><p>二、进行还原</p>
<p>1、删除backup目录</p>
<pre><code>rm -rf backup/
</code></pre><p>2、执行还原操作</p>
<pre><code>tar xzf backup-full.tar.gz
tar xzf backup-incre1.tar.gz
</code></pre><p>现在已经完成tar的还原操作。其它tar的增量备份只需要指定-g参数，tarinfo文件则是用来记录备份的一些信息。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Linux-增量备份/" data-id="ciwpmluay000is6cy6os5yeoy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux-系统恢复" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Linux-系统恢复/" class="article-date">
  <time datetime="2016-12-13T02:02:54.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Linux-系统恢复/">Linux 系统恢复</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>系统快照可能会碰到的问题是它们对于硬盘故障非常的脆弱。如果你的硬盘受到了严重的物理损伤，那么很可能你的系统快照就无法帮助你恢复系统了。为了防止这一点，我们建议在安装与设置好你的Linux系统之后立即做一份系统快照，然后把它单独复制到另外的存储设备中。<br>在Linux中有一些应用程序可以帮助你保存系统快照。大多数应用程序都是针对于新手的，并不需要高级的Linux操作技巧。我们在这里挑选了一些，你可以从中选择适合自己的应用。<br>TimeShift<br>TimeShift提供了一个非常简洁的图形用户界面，你也可以直接在终端输入命令使用它。默认情况下。TimeShift并不会包含用户的个人文件，但你可以通过自定义将特殊的目录添加到快照中去。Ubuntu及其分支的用户可以从开发者的PPA获取TimeShift：<br>sudo apt-add-repository ppa:teejee2008/ppa sudo apt-get update<br>sudo apt-get install timeshift<br>其他版本的用户可以下载安装文件并在命令行终端运行：<br>./timeshift-latest-amd.64.run<br>TimeShift还提供了专门针对BTRFS文件系统的版本，可以支持原生的BTRFS系统快照功能。<br>工作方式<br>TimeShift能够帮助你随时完成快照工作，或者你也可以设置让TimeShift自动创建快照。你可以安排任务计划，每小时、每天、每周或者每个月进行快照，也可以设置清除这些快照的时间。TimeShift有一个特殊的选项叫做重启快照，用来在每次系统重启之后创建一个新的快照文件。<br>TimeShift从快照中进行系统恢复是一项非常简单直接的工作，只要选择快照文件并且告诉它应该存储的位置就可以了。TimeShift提供了将快照恢复到外设的选项，克隆功能能够直接将现有系统状态复制到另一个设备中，这在将你的操作系统迁移到另一台新电脑时非常方便，因为你不再需要从头开始安装各种功能和应用。<br>在恢复快照之前，TimeShift会询问你是不是需要保存现有的应用设置，并且让你选择保存哪一个。请记住TimeShift需要GRUB 2启动进入快照恢复。<br>Cronopete<br>如果你认为TimeShift的操作已经足够简单的话，那么Cronopete甚至更加简单，至少从外观上看来是这样的。Cronopete自称为OS X的时间机器，与TimeShift工作起来稍有不同。Cronopete为Ubuntu，Debian和Fedora提供了包文件，Arch Linux使用者可以在AUR中找到它。<br>工作方式<br>与本文中介绍的其他应用程序不同，Cronopete将备份与快照功能捆绑在一起，并且要求你将快照保存在外部设备上。默认情况下，它会每个小时都检查一遍你的文件变化，但是当然可以在设置中改变这个时间间隔。如果某个文件并没有发生变化，那么Cronopete将对这个文件只进行一个硬链接而并不复制这份文件，这会帮助节省磁盘空间。<br>Cronopete的文件恢复可能是它最酷的功能，好像真的能帮助你“穿越时间”，也就是说，可视化的浏览所有储存版本的文件与文件夹。想要恢复哪一个文件，只需要选上它，然后点击恢复就可以了，这个文件就会从外部的存储设备中复制到你现有的系统中来。当然这里你可能也猜测到了，Cronopete对于全系统恢复并不十分具有意义，但是如果你想要保存单独文件的多个版本，那么它是一个很好的选择。<br>Back In Time<br>Back In Time的用户界面看起来非常友好，能够吸引住Linux新手。它的设置对话框中提供了非常精细的操作控件，用户界面看上去就像是一个文件管理器一样，在这里你可以阅览所有的快照，浏览快照中的文件，以及恢复选定的文件与文件夹。<br>Ubuntu用户可以从PPA中安装Back In Time：<br>sudo add-apt-repository ppa:bit-team/stable<br>sudo apt-get update<br>sudo apt-get install backintime-qt4<br>有些发行版会在自己的资源库中提供Back In Time，如果你的发行版没有的话，也总可以在网上找到源代码并且下载安装。<br>工作方式<br>Back In Time会对那些你选择的目录创建快照，但是只会恢复那些拥有写权限的目录。你可以对快照进行加密并且存储在网络设备、外部硬盘或者是本地的文件系统中。Back In Time只会对那些改变过的文件进行更新。在设置&gt;选项标签中，你可以选择在没有变化发生的时候禁用快照。<br>Back In Time的快照时间根据计划设定，每天、每周、每个月或者是每天的某个或某几个时间段，或者是每次重启之后。你可以在主工具栏的菜单中自己更改计划时间。<br>与Cronopete相似，Back In Time更加适合于基于文件夹或者是基于文件的回滚操作，但是如果你想对整个文件系统进行回滚也是同样可行的。恢复一个快照相当简单，只要选择它，并且选择在哪里进行恢复就可以了，取决于你是只想恢复几个文件夹还是对整个系统进行恢复。<br>Systemback<br>Systemback的界面很小巧，但是功能却非常强大。但不幸的是只有Debian和Ubuntu及其分支的用户可以使用，而没有提供其他Linux发行版的安装文件。Systemback可以通过开发者PPA安装：<br>sudo add-apt-repository ppa:nemh/systemback<br>sudo apt-get update<br>sudo apt-get install systemback<br>工作方式<br>Systemback并不仅仅是另一个快照工具。它可以把你现在的系统转变为一张live CD或DVD，这样就可以直接在另一台电脑上启动了。它可以修复或重装GRUB 2启动器以及修复fstab文件，当然，Systemback的主要用途还是用于系统快照。<br>Systemback将快照的总数量限制在10个以内。用户拥有删除快照的权限。快照的功能可以选择为递增，也就是只复制被改变过的文件，而将其他的文件以硬链接的形式保存。但是在设置对话框中，你可以禁用这个功能。在恢复文件的时候，你可以选择执行全系统恢复，或者只是复制关键的系统文件。个人数据比如照片与文档并不会被包含在快照中，但是你可以在创建&gt;包含用户数据的选项中通过自定义操作将它们转移到live CD中。<br>Systemback允许用户自定义自动快照的计划，但你也将这个选项关闭来手动设置恢复点。需要注意的是Systemback并不支持NTFS文件系统，因此不能对NTFS系统分区进行快照或者是恢复操作。<br>Snapper<br>Snapper和openSUSE的关系非常密切。在其他Linux版本上也许能够安装Snapper，但是并不一定能正常工作了。在openSUSE中安装Snapper的最简单方法是将它安装在BTRFS分区上，这样做Snapper就能够自动安装与配置。你可以使用命令行工具来操作Snapper，或者通过YaST工具，此外还有另一种替代方案snapper-GUI。<br>工作方式<br>Snapper能够创建几种不同类型的快照，比如在安装新的应用程序之前与之后创建快照。通过这种方式你可以将快照进行对比，并且更有效的进行系统恢复。Snapper会为快照自动建立时间计划，你当然也可以把这个功能禁用掉。在Snapper中，快照是存放在与系统相同的分区中，因此它们会不断长大，要记得随时检查自己的硬盘容量。<br>默认情况下，Snapper只对根分区创建快照。如果想要包含其他分区和BTRFS副磁盘卷，你就需要为每一个项目创建一个配置，这必须在命令行终端中完成，你需要以root权限运行下面的命令：<br>snapper -c CONFIGNAME create-config /PATH<br>在这里-c代表着配置“configure”，CONFIGNAME是你为这个配置所取的名称，/PATH则是分区或是副磁盘卷的位置，例如：<br>snapper -c home create-config /home<br>你可以用下面的命令查看当前的配置：<br>snapper list-configs<br>所有的配置文件都保存在/etc/snapper/configs目录。在这里，你可以用一个常用的文本编辑器来修改它们，例如你可以禁用每小时创建快照的功能，启用自动删除快照的功能，手动设置可保存旧快照的数量。<br>在YaST Snapper模式中，你可以创建并对比快照进行系统回滚操作，或者将一个文件或者其他一些被选择的文件恢复到以前的版本。<br>怎样备份与恢复已安装的应用程序<br>了解了怎样对整个操作系统进行恢复之后，你可能想知道怎样恢复那些已经安装的应用软件。这在系统新版升级或重装系统的情况下很常见。幸运的是已经有一些工具提供了应用程序迁移的功能，而且使用起来非常方便。<br>首先我要提到的是Aptik，它是由TimeShift的开发者创建的应用程序备份工具。<br>Aptik只能用于基于Ubuntu的发行版，你可以直接从开发者PPA安装：<br>sudo apt-add-repository ppa:teejee2008/ppa<br>sudo apt-get update<br>sudo apt-get install aptik<br>Aptik能够以列表的形式输出系统现有的已安装的包以及所使用的库以及下载的包文件。此外还有用于导出应用程序设置、桌面主题和图标集的选项。Aptik会根据安装类型对这些包进行分类，例如分为操作系统预装、用户自主安装、自动安装的依赖与从.deb文件安装等等。对于.deb文件你可以将它们拖拽到列表中并且包含在备份文件里。备份可以保存在任何位置，如果想把它们提取到一个新安装的发行版中，只需要先安装Aptik，然后在主窗口中选择备份并进行恢复即可。<br>Linux Mint的用户可以选择Mint备份工具，功能几乎与Aptik一模一样。除了恢复已安装的应用程序之外，这个工具还可以对所选定的文件夹及其权限执行快速备份。<br>Arch Linux的用户可以使用Backpac来备份与恢复应用程序。Backpac可以建立手动安装包的列表文件，也可以按照你的选择单独备份文件。使用Backpac恢复系统状态会重新安装所输出的包，删除掉快照中并不包含的文件，并且会用之前输出的版本覆盖系统文件。<br>当然，你可以不使用任何一个第三方工具来完成这样的操作。在包管理系统中提供了这样的工具。在基于dpkg的系统中，你可以使用下面的操作来输出一个已安装应用的列表文件：<br>dpkg –get-selections &gt; /home/yourusername/apps.txt<br>然后，将这个txt文件与库信息从/etc/apt/sources.d/目录与/etc/apt/sources.list文件复制到新的系统中。使用如下命令行并提供正确的文件路径就可以将备份的应用迁移到新的系统中：<br>dpkg –set-selections &lt; /path/to/apps.txt<br>sudo apt-get update<br>sudo apt-get dselect-upgrade<br>有些图形化的包管理工具例如Synaptic能够提供图形化的用户界面，用来输出与导入已经安装的应用程序的列表，不需要使用终端命令行的形式来操作。<br>高级系统回滚解决方案<br>如果上面建议的这些应用你并不认为合适，那么我们还有其他的解决方案。我在这里将它们称为“高级”并不意味着这些方案非常复杂，而是说它们可能并不是新手用户的第一选择。<br>如果你想在命令行终端使用一种极简而快速的方法进行快照操作，那么可以试一下Rsnapshot。你可以在绝大多数Linux发行版的资源库中找到它。Rsnapshot的所有设置都在/etc/rsnapshot.conf这个文件中。你可以打开这个文件，自定义快照时间表，设置何时删除旧的快照，以及需要包含哪些文件与文件夹。当你设置完毕之后，最好使用下面两个命令来做一下测试：<br>rsnapshot configtest<br>rsnapshot -t hourly<br>这样可以保证你的所有设置都正常启用。请记住修改设置文件时需要在两个功能选项中使用一个tab符进行分割而并不是空格，因此不要用空格键移动这些参数。Rsnapshot没有自动恢复功能，所以你只能从选定的快照中手动复制文件。<br>Obnam<br>Obnam与Rsnapshot非常相似，另外还提供了一些有趣的功能。它可以先创建一个全系统备份，然后逐渐生成包含新的或是改变过的文件的快照。你可以对快照进行加密与自动解密。Obnam在进行系统恢复时的操作也是相似的，提供命令，并且让你选择存储的位置。<br>你可以设置或是修改自定义路径，将快照存放在服务器上或者是其他远程设备上。Obnam提供的官方手册是一项很了不起的工作，清楚的解释了所有的功能操作。<br>LVM Snapshots<br>如果系统中将会存放一些重要的数据，那么一定要事先考虑好备份与恢复的方法。如果你正在安装与设置Linux系统的话，那么值得考虑将LVM(Logical Volume Manager)作为硬盘的管理工具。<br>准确的说，LVM并不算是一个应用程序，它在Linux内核中提供了内置的快照功能，可以将快照安装到任何其他磁盘或分区，合并若干个快照，并还原它们来解决系统问题。或者你可以使用Linux内核模块dattobd支持对运行中的系统进行增量快照，这样无需卸载分区或重新启动计算机。<br>正如你所看到的，有很多种选择可以在Linux中获得系统恢复功能，然而你会发现它们在技术上是非常相似的，那么有没有更好的方法来代替现有的系统恢复功能呢?也许在未来随着这些应用程序的不断发展将会出现更好的方法，或者是对这些现有的工具更有效的进行组合应用，这些都需要使用者们不断进行探索发掘。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Linux-系统恢复/" data-id="ciwpmlub2000ls6cyuybtl7j5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux服务器遭受攻击后的一般处理过程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/13/Linux服务器遭受攻击后的一般处理过程/" class="article-date">
  <time datetime="2016-12-13T01:59:07.000Z" itemprop="datePublished">2016-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/13/Linux服务器遭受攻击后的一般处理过程/">Linux服务器遭受攻击后的一般处理过程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>安全总是相对的，再安全的服务器也有可能遭受到攻击。作为一个安全运维人员，要把握的原则是：尽量做好系统安全防护，修复所有已知的危险行为，同时，在系统遭受攻击后能够迅速有效地处理攻击行为，最大限度地降低攻击对系统产生的影响。<br>一、处理服务器遭受攻击的一般思路<br>系统遭受攻击并不可怕，可怕的是面对攻击束手无策，下面就详细介绍下在服务器遭受攻击后的一般处理思路。<br>1.切断网络<br>所有的攻击都来自于网络，因此，在得知系统正遭受黑客的攻击后，首先要做的就是断开服务器的网络连接，这样除了能切断攻击源之外，也能保护服务器所在网络的其他主机。<br>2.查找攻击源<br>可以通过分析系统日志或登录日志文件，查看可疑信息，同时也要查看系统都打开了哪些端口，运行哪些进程，并通过这些进程分析哪些是可疑的程序。这个过程要根据经验和综合判断能力进行追查和分析。下面的章节会详细介绍这个过程的处理思路。<br>3.分析入侵原因和途径<br>既然系统遭到入侵，那么原因是多方面的，可能是系统漏洞，也可能是程序漏洞，一定要查清楚是哪个原因导致的，并且还要查清楚遭到攻击的途径，找到攻击源，因为只有知道了遭受攻击的原因和途径，才能删除攻击源同时进行漏洞的修复。<br>4.备份用户数据<br>在服务器遭受攻击后，需要立刻备份服务器上的用户数据，同时也要查看这些数据中是否隐藏着攻击源。如果攻击源在用户数据中，一定要彻底删除，然后将用户数据备份到一个安全的地方。<br>5.重新安装系统<br>永远不要认为自己能彻底清除攻击源，因为没有人能比黑客更了解攻击程序，在服务器遭到攻击后，最安全也最简单的方法就是重新安装系统，因为大部分攻击程序都会依附在系统文件或者内核中，所以重新安装系统才能彻底清除攻击源。<br>6.修复程序或系统漏洞<br>在发现系统漏洞或者应用程序漏洞后，首先要做的就是修复系统漏洞或者更改程序bug，因为只有将程序的漏洞修复完毕才能正式在服务器上运行。<br>7.恢复数据和连接网络<br>将备份的数据重新复制到新安装的服务器上，然后开启服务，最后将服务器开启网络连接，对外提供服务。<br>二、检查并锁定可疑用户<br>当发现服务器遭受攻击后，首先要切断网络连接，但是在有些情况下，比如无法马上切断网络连接时，就必须登录系统查看是否有可疑用户，如果有可疑用户登录了系统，那么需要马上将这个用户锁定，然后中断此用户的远程连接。<br>1.登录系统查看可疑用户<br>通过root用户登录，然后执行“w”命令即可列出所有登录过系统的用户。<br>通过这个输出可以检查是否有可疑或者不熟悉的用户登录，同时还可以根据用户名以及用户登录的源地址和它们正在运行的进程来判断他们是否为非法用户。<br>2.锁定可疑用户<br>一旦发现可疑用户，就要马上将其锁定，例如上面执行“w”命令后发现nobody用户应该是个可疑用户（因为nobody默认情况下是没有登录权限的），于是首先锁定此用户，执行如下操作：<br>[root@server ~]# passwd -l nobody<br>锁定之后，有可能此用户还处于登录状态，于是还要将此用户踢下线，根据上面“w”命令的输出，即可获得此用户登录进行的pid值，操作如下：<br>[root@server ~]# ps -ef|grep @pts/3<br>531 6051 6049 0 19:23 ? 00:00:00 sshd: nobody@pts/3<br>[root@server ~]# kill -9 6051<br>这样就将可疑用户nobody从线上踢下去了。如果此用户再次试图登录它已经无法登录了。<br>3.通过last命令查看用户登录事件<br>last命令记录着所有用户登录系统的日志，可以用来查找非授权用户的登录事件，而last命令的输出结果来源于/var/log/wtmp文件，稍有经验的入侵者都会删掉/var/log/wtmp以清除自己行踪，但是还是会露出蛛丝马迹在此文件中的。<br>三、查看系统日志<br>查 看系统日志是查找攻击源最好的方法，可查的系统日志有/var/log/messages、/var/log/secure等，这两个日志文件可以记录软 件的运行状态以及远程用户的登录状态，还可以查看每个用户目录下的.bash_history文件，特别是/root目录下的.bash_history 文件，这个文件中记录着用户执行的所有历史命令。<br>四、检查并关闭系统可疑进程<br>检查可疑进程的命令很多，例如ps、top等，但是有时候只知道进程的名称无法得知路径，此时可以通过如下命令查看：<br>首先通过pidof命令可以查找正在运行的进程PID，例如要查找sshd进程的PID，执行如下命令：<br>1<br>2<br>[root@server ~]# pidof sshd<br>13276 12942 4284<br>然后进入内存目录，查看对应PID目录下exe文件的信息：<br>1<br>2<br>[root@server ~]# ls -al /proc/13276/exe<br>lrwxrwxrwx 1 root root 0 Oct 4 22:09 /proc/13276/exe -&gt; /usr/sbin/sshd<br>这样就找到了进程对应的完整执行路径。如果还有查看文件的句柄，可以查看如下目录：<br>[root@server ~]# ls -al /proc/13276/fd<br>通过这种方式基本可以找到任何进程的完整执行信息，此外还有很多类似的命令可以帮助系统运维人员查找可疑进程。例如，可以通过指定端口或者tcp、udp协议找到进程PID，进而找到相关进程：<br>[root@server ~]# fuser -n tcp 111<br>111/tcp: 1579<br>[root@server ~]# fuser -n tcp 25<br>25/tcp: 2037<br>[root@server ~]# ps -ef|grep 2037<br>root 2037 1 0 Sep23 ? 00:00:05 /usr/libexec/postfix/master<br>postfix 2046 2037 0 Sep23 ? 00:00:01 qmgr -l -t fifo -u<br>postfix 9612 2037 0 20:34 ? 00:00:00 pickup -l -t fifo -u<br>root 14927 12944 0 21:11 pts/1 00:00:00 grep 2037<br>在 有些时候，攻击者的程序隐藏很深，例如rootkits后门程序，在这种情况下ps、top、netstat等命令也可能已经被替换，如果再通过系统自身 的命令去检查可疑进程就变得毫不可信，此时，就需要借助于第三方工具来检查系统可疑程序，例如前面介绍过的chkrootkit、RKHunter等工 具，通过这些工具可以很方便的发现系统被替换或篡改的程序。<br>五、检查文件系统的完好性<br>检查文件属性是否发生变化是验证文件系统完好性最简单、最直接的方法，例如可以检查被入侵服务器上/bin/ls文件的大小是否与正常系统上此文件的大小相同，以验证文件是否被替换，但是这种方法比较低级。此时可以借助于Linux下rpm这个工具来完成验证，操作如下：<br>[root@server ~]# rpm -Va<br>….L… c /etc/pam.d/system-auth<br>S.5….. c /etc/security/limits.conf<br>S.5….T c /etc/sysctl.conf<br>S.5….T /etc/sgml/docbook-simple.cat<br>S.5….T c /etc/login.defs<br>S.5….. c /etc/openldap/ldap.conf<br>S.5….T c /etc/sudoers<br>..5….T c /usr/lib64/security/classpath.security<br>….L… c /etc/pam.d/system-auth<br>S.5….. c /etc/security/limits.conf<br>S.5….. c /etc/ldap.conf<br>S.5….T c /etc/ssh/sshd_config<br>对于输出中每个标记的含义介绍如下：<br>S 表示文件长度发生了变化<br>M 表示文件的访问权限或文件类型发生了变化<br>5 表示MD5校验和发生了变化<br>D 表示设备节点的属性发生了变化<br>L 表示文件的符号链接发生了变化<br>U 表示文件/子目录/设备节点的owner发生了变化<br>G 表示文件/子目录/设备节点的group发生了变化<br>T 表示文件最后一次的修改时间发生了变化<br>如果在输出结果中有“M”标记出现，那么对应的文件可能已经遭到篡改或替换，此时可以通过卸载这个rpm包重新安装来清除受攻击的文件。<br>不过这个命令有个局限性，那就是只能检查通过rpm包方式安装的所有文件，对于通过非rpm包方式安装的文件就无能为力了。同时，如果rpm工具也遭到替换，就不能通过这个方法了，此时可以从正常的系统上复制一个rpm工具进行检测。<br>对文件系统的检查也可以通过chkrootkit、RKHunter这两个工具来完成，关于chkrootkit、RKHunter工具的使用，下次将展开介绍。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/13/Linux服务器遭受攻击后的一般处理过程/" data-id="ciwpmlub5000os6cy7sod9gbb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/5/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/15/CentOS-6-x-Puppet/">CentOS 6.x Puppet</a>
          </li>
        
          <li>
            <a href="/2016/12/15/前言-1/">前言</a>
          </li>
        
          <li>
            <a href="/2016/12/15/前言/">前言</a>
          </li>
        
          <li>
            <a href="/2016/12/15/Ubuntu-12-04-Puppet/">Ubuntu 12.04 Puppet</a>
          </li>
        
          <li>
            <a href="/2016/12/14/CentOS-6-x-GoAccess/">CentOS 6.x GoAccess</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>