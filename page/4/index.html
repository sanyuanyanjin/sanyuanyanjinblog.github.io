<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Ubuntu-14-04-odoo-9-0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Ubuntu-14-04-odoo-9-0/" class="article-date">
  <time datetime="2016-12-15T03:34:44.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Ubuntu-14-04-odoo-9-0/">Ubuntu 14.04 odoo 9.0</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vm12<br>5A02H-AU243-TZJ49-GTC7K-3C61N<br><a href="https://www.odoo.com/documentation/9.0/setup/install.html" target="_blank" rel="external">https://www.odoo.com/documentation/9.0/setup/install.html</a><br>wget <a href="https://github.com/aschenkels-ictstudio/odoo-install-scripts/blob/9.0/ubuntu-14-04/odoo_install.sh" target="_blank" rel="external">https://github.com/aschenkels-ictstudio/odoo-install-scripts/blob/9.0/ubuntu-14-04/odoo_install.sh</a><br>Deb<br>Community<br>To install Odoo 9.0 Community on Debian-based distribution, execute the following commands as root:</p>
<p>apt-get install gcc<br>wget <a href="http://launchpadlibrarian.net/177550518/libxml2-dev_2.9.1+dfsg1-3ubuntu4.3_amd64.deb" target="_blank" rel="external">http://launchpadlibrarian.net/177550518/libxml2-dev_2.9.1+dfsg1-3ubuntu4.3_amd64.deb</a><br>dpkg -i libxml2-dev_2.9.1+dfsg1-3ubuntu4.3_amd64.deb<br>apt-get install python-dev  libxml2-dev libxslt1-dev zlib1g-dev<br>apt-get install python-pip<br>apt-get remove python-pip<br>apt-get autoremove<br>easy_install -U pip<br>which pip<br>cp /usr/local/bin/pip /usr/bin/pip<br>pip</p>
<p>wget <a href="http://launchpadlibrarian.net/178067995/libssl-dev_1.0.1f-1ubuntu2.4_amd64.deb" target="_blank" rel="external">http://launchpadlibrarian.net/178067995/libssl-dev_1.0.1f-1ubuntu2.4_amd64.deb</a><br>dpkg -i libssl-dev_1.0.1f-1ubuntu2.4_amd64.deb<br>apt-get install libssl-doc<br>apt-get install libpq-dev<br>apt-get install postgresql-server-dev-*<br>pip install psycopg2==2.5.4</p>
<p>apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev<br>pip install python-ldap –upgrade<br>pip install python-ldap==2.4.19</p>
<p>wget -O - <a href="https://nightly.odoo.com/odoo.key" target="_blank" rel="external">https://nightly.odoo.com/odoo.key</a> | apt-key add -<br>echo “deb <a href="http://nightly.odoo.com/9.0/nightly/deb/" target="_blank" rel="external">http://nightly.odoo.com/9.0/nightly/deb/</a> ./“ &gt;&gt; /etc/apt/sources.list<br>apt-get update &amp;&amp; apt-get install odoo<br>ls /var/cache/apt/archives/<br>cd /var/cache/apt/archives/<br>rz<br>odoo_9.0c.20160714_all.deb</p>
<p>You can then use the usual apt-get upgrade command to keep your installation up-to-date.</p>
<p>netstat -tunlp | grep 8069</p>
<p>vim /etc/postgresql/9.3/main/pg_hba.conf</p>
<h1 id="host-all-all-127-0-0-1-32-ident"><a href="#host-all-all-127-0-0-1-32-ident" class="headerlink" title="host    all             all             127.0.0.1/32            ident"></a>host    all             all             127.0.0.1/32            ident</h1><p>host    all             all             127.0.0.1/32            md5</p>
<p>su - postgres -c “createuser -s odoo”<br>service odoo restart</p>
<p>root@ubuntu:~#  su - postgres<br>postgres@ubuntu:~$ psql -U postgres<br>psql (9.3.4)<br>Type “help” for help.</p>
<p>postgres=# \du<br>                             List of roles<br> Role name |                   Attributes                   | Member of<br>———–+————————————————+———–<br> postgres  | Superuser, Create role, Create DB, Replication | {}</p>
<p>postgres=# create user odoo with login password ‘yanjin’;<br>CREATE ROLE</p>
<p>postgres=#<br>create database odoo<br>       with owner = odoo<br>       encoding = ‘UTF8’<br>       tablespace = pg_default<br>       lc_collate = ‘en_US.UTF-8’<br>       lc_ctype = ‘en_US.UTF-8’<br>       connection limit = -1;<br>CREATE DATABASE</p>
<p>\password odoo</p>
<p>psql -h 127.0.0.1 -U odoo<br>odoo=&gt; \l<br>                                  List of databases<br>   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges<br>———–+———-+———-+————-+————-+———————–<br> odoo      | odoo     | UTF8     | en_US.UTF-8 | en_US.UTF-8 |<br> postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |<br> template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +<br>           |          |          |             |             | postgres=CTc/postgres<br> template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +<br>           |          |          |             |             | postgres=CTc/postgres<br>(4 rows)</p>
<p>odoo=&gt; </p>
<p>import psycopg2;<br>conn = psycopg2.connect(database=’odoo’,user=’odoo’,password=’yanjin’,host=’127.0.0.1’, port=’5432’);<br>print “connected db”;</p>
<p>def connect(dsn=None,    dsn: ‘dbname=odoo user=odoo password=yanjin host=127.0.0.1 port=5432’<br>        database=None, user=None, password=None, host=None, port=None,    database: ‘odoo’ user: ‘odoo’ password: ‘yanjin’ host: ‘127.0.0.1’ port: ‘5432’<br>        connection_factory=None, async=False, **kwargs): connection_factory: None async: False kwargs: {}<br>    “””</p>
<p>root@ubuntu:~/odoo-9.0# ./odoo.py –config=/etc/odoo/openerp-server.conf</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Ubuntu-14-04-odoo-9-0/" data-id="ciwvcpuj9001soucyhqbu7n7d" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-6-x-DHCP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Centos-6-x-DHCP/" class="article-date">
  <time datetime="2016-12-15T03:33:21.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Centos-6-x-DHCP/">Centos 6.x DHCP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum –y install dhcp   //安装DHCP服务<br>cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.bak    //备份dhcpd.conf文件<br>[root@server ~]# vim /etc/dhcp/dhcpd.conf</p>
<p>#</p>
<h1 id="DHCP-Server-Configuration-file"><a href="#DHCP-Server-Configuration-file" class="headerlink" title="DHCP Server Configuration file."></a>DHCP Server Configuration file.</h1><h1 id="see-usr-share-doc-dhcp-dhcpd-conf-sample"><a href="#see-usr-share-doc-dhcp-dhcpd-conf-sample" class="headerlink" title="see /usr/share/doc/dhcp*/dhcpd.conf.sample"></a>see /usr/share/doc/dhcp*/dhcpd.conf.sample</h1><h1 id="see-‘man-5-dhcpd-conf’"><a href="#see-‘man-5-dhcpd-conf’" class="headerlink" title="see ‘man 5 dhcpd.conf’"></a>see ‘man 5 dhcpd.conf’</h1><p>#<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>        range 192.168.3.100 192.168.3.200;<br>        option subnet-mask 255.255.255.0;<br>        option domain-name-servers 114.114.114.114;<br>        option domain-name-servers 223.5.5.5;<br>        default-lease-time 21600;<br>        max-lease-time 43200;<br>        next-server 192.168.3.3;<br>        filename “/pxelinux.0”;<br>}<br>“/etc/dhcp/dhcpd.conf” 15L, 455C written<br>[root@server ~]# /etc/init.d/dhcpd restart<br>Shutting down dhcpd: [  OK  ]<br>Starting dhcpd: [  OK  ]<br>[root@server ~]# </p>
<p>service dhcpd start  //启动服务<br>chkconfig dhcpd on  //设为开机启动<br>[root@localhost ~]# vim /etc/sysconfig/dhcpd</p>
<h1 id="Command-line-options-here"><a href="#Command-line-options-here" class="headerlink" title="Command line options here"></a>Command line options here</h1><p>DHCPDARGS=eth1</p>
<p>/etc/init.d/dhcpd restart</p>
<p>client<br>注释掉client的静态IP配置，BOOTPROTO更改为dhcp<br>/etc/init.d/network restart<br>[root@localhost ~]# crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]#</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]# cat /root/dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>[root@localhost ~]#</p>
<p>dhcp<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>tail -f /var/lib/dhcpd/dhcpd.leases<br>vim /var/lib/dhcpd/dhcpd.leases<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>DHCP<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>cat /var/lib/dhcpd/dhcpd.leases |awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’<br>awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’ /var/lib/dhcpd/dhcpd.leases</p>
<p>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’<br>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’|sort -n</p>
<p>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>[root@localhost ~]# vim /etc/dhcp/dhcpd.conf</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro"><a href="#host-WudeMacBook-Pro" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187"><a href="#fixed-address-10-6-4-187" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id=""><a href="#" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>“/etc/dhcp/dhcpd.conf” 138L, 3153C                            85,0-1        63%<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-1"><a href="#host-WudeMacBook-Pro-1" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-1"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-1" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-1"><a href="#fixed-address-10-6-4-187-1" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-1"><a href="#-1" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>[root@localhost ~]# cat /etc/dhcp/dhcpd.conf<br>#</p>
<h1 id="DHCP-Server-Configuration-file-1"><a href="#DHCP-Server-Configuration-file-1" class="headerlink" title="DHCP Server Configuration file."></a>DHCP Server Configuration file.</h1><h1 id="see-usr-share-doc-dhcp-dhcpd-conf-sample-1"><a href="#see-usr-share-doc-dhcp-dhcpd-conf-sample-1" class="headerlink" title="see /usr/share/doc/dhcp*/dhcpd.conf.sample"></a>see /usr/share/doc/dhcp*/dhcpd.conf.sample</h1><h1 id="see-‘man-5-dhcpd-conf’-1"><a href="#see-‘man-5-dhcpd-conf’-1" class="headerlink" title="see ‘man 5 dhcpd.conf’"></a>see ‘man 5 dhcpd.conf’</h1><p>#<br>ddns-update-style none;<br>ignore client-updates;<br>authoritative;<br>shared-network network_tag {<br>subnet 10.6.0.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.1.0 netmask 255.255.255.0 {</p>
<pre><code>option routers                  10.6.1.1;
option subnet-mask              255.255.255.0;
option domain-name-servers      61.177.7.1;
option domain-name-servers      114.114.114.114;
range  10.6.1.65 10.6.1.127;
default-lease-time 36000;
max-lease-time 72000;
</code></pre><h1 id="host-WudeMacBook-Pro-2"><a href="#host-WudeMacBook-Pro-2" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-3c-15-c2-df-93-c4"><a href="#hardware-ethernet-3c-15-c2-df-93-c4" class="headerlink" title="hardware ethernet 3c:15:c2:df:93:c4;"></a>hardware ethernet 3c:15:c2:df:93:c4;</h1><h1 id="fixed-address-10-6-1-35"><a href="#fixed-address-10-6-1-35" class="headerlink" title="fixed-address 10.6.1.35;"></a>fixed-address 10.6.1.35;</h1><h1 id="-2"><a href="#-2" class="headerlink" title="}"></a>}</h1><p>host HCP-SZOFFICE{<br>hardware ethernet 24:0a:64:b2:b3:d3;<br>fixed-address 10.6.1.50;<br>}</p>
<p>host c2laboratory03{<br>hardware ethernet 8c:89:a5:cf:90:ce;<br>fixed-address 10.6.1.54;<br>}</p>
<p>host zhuang-3{<br>hardware ethernet 54:ee:75:33:8b:fe;<br>fixed-address 10.6.1.56;<br>}</p>
<p>host zhuang-2{<br>hardware ethernet e8:b1:fc:de:20:e7;<br>fixed-address 10.6.1.60;<br>}</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-3"><a href="#host-WudeMacBook-Pro-3" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-2"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-2" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-2"><a href="#fixed-address-10-6-4-187-2" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-3"><a href="#-3" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>        option routers                  192.168.11.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      114.114.114.114;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.11.50 192.168.11.119;<br>        range  192.168.11.121 192.168.11.250;<br>        default-lease-time 1800;<br>        max-lease-time 3600;<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 192.168.10.0 netmask 255.255.255.0 {<br>        option routers                  192.168.10.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  192.168.10.50 192.168.10.250;<br>        default-lease-time 36000;<br>        max-lease-time 72000;<br>}<br>}</p>
<p>[root@localhost ~]# </p>
<p>[root@localhost ~]# vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/</p>
<p>vim dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Centos-6-x-DHCP/" data-id="ciwvcpuij000youcyfsq638io" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-7-x-Zabbix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Centos-7-x-Zabbix/" class="article-date">
  <time datetime="2016-12-15T03:32:36.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Centos-7-x-Zabbix/">Centos 7.x Zabbix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.zabbix.com/documentation/3.0/manual/web_interface/frontend_sections/administration/authentication" target="_blank" rel="external">https://www.zabbix.com/documentation/3.0/manual/web_interface/frontend_sections/administration/authentication</a><br><a href="https://www.zabbix.com/documentation/3.0/manual/config/notifications/action/operation" target="_blank" rel="external">https://www.zabbix.com/documentation/3.0/manual/config/notifications/action/operation</a><br><a href="http://www.cnblogs.com/hanyifeng/p/5353068.html" target="_blank" rel="external">http://www.cnblogs.com/hanyifeng/p/5353068.html</a><br>10.6.0.86<br>zabbix监控服务器由2部分构成，zabbix server与可选组件zabbix agent。<br>　　zabbix server可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD，Open BSD，OS X等平台上。<br>二.基础环境介绍<br>　　1.系统：Centos 7 3.10.0-327.el7.x86_64<br>　　2.编译环境：“Development tools”<br>　　3.zabbix－Server：ip：10.6.4.103/24　（CentOS 7 x86_64）　　　agent：10.6.0.101/24 （centos 6.5 x86_64）<br>三.Zabbix Server端操作<br>1.安装zabbix－server 及所需的mysql组件、zabbix－agent<br>[root@test ~]# rpm -ivh <a href="http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm" target="_blank" rel="external">http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm</a><br>[root@test ~]# yum install zabbix-server-mysql zabbix-web-mysql -y<br>[root@test ~]# yum install zabbix-agent -y<br>2.由于centos 7 默认的数据库改由mariadb里，甲骨文公司收购了MySQL后，mysql之父便又写了这个数据库。此环境由于需要mysql ，所以下面将下载mysql 源，安装mysql。另外mysql安装完，root没有密码，可以直接登陆，后续如果需要修改密码可登陆数据库修改，或者运行 mysql_secure_installation 初始化工具<br>[root@test ~]# yum install wget -y<br>[root@test ~]# wget <a href="http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm" target="_blank" rel="external">http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</a><br>[root@test ~]# rpm -ivh mysql-community-release-el7-5.noarch.rpm<br>[root@test ~]# yum install mysql-community-server -y<br>[root@test ~]# service mysqld start #或者 systemctl start mysqld.service<br>[root@test ~]# mysql -uroot<br> 创建zabbix 数据库，并授权zabbix用户，以及设置zabbix用户登陆密码为zabbix<br>[root@test ~]# mysql -uroot<br>mysql&gt; create database zabbix character set utf8 collate utf8_bin;<br>mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by ‘zabbix’;<br>mysql&gt; FLUSH PRIVILEGES;<br>mysql&gt; quit;<br>进入zabbix数据库脚本导入的目录，将库数据导入zabbix数据库中。<br>[root@test ~]# cd /usr/share/doc/zabbix-server-mysql-3.0.4/<br>[root@test ~]# zcat create.sql.gz | mysql -uroot -pyanjin zabbix<br>3.修改zabbix－server的配置文件。默认路径在：/etc/zabbix/zabbix_server.conf，修改如下。或者是备份原文件，将下面内容直接替换原有内容，不过后续的修改添加会比较麻烦点。（注意：此处只需修改4处也可以，红色加粗处）<br>复制代码<br>[root@test ~]# grep -v ‘^#’ /etc/zabbix/zabbix_server.conf | grep -v ‘^$’<br>LogFile=/var/log/zabbix/zabbix_server.log<br>LogFileSize=0<br>PidFile=/var/run/zabbix/zabbix_server.pid<br>DBHost=localhost<br>DBName=zabbix<br>DBUser=zabbix<br>DBPassword=zabbix<br>StartPollers=10<br>StartPollersUnreachable=5<br>StartTrappers=5<br>StartPingers=1<br>StartDiscoverers=1<br>SNMPTrapperFile=/var/log/snmptrap/snmptrap.log<br>HousekeepingFrequency=1<br>Timeout=4<br>AlertScriptsPath=/usr/lib/zabbix/alertscripts<br>ExternalScripts=/usr/lib/zabbix/externalscripts<br>LogSlowQueries=3000<br>复制代码<br>3a4</p>
<blockquote>
<p>DBHost=localhost<br>5a7,12<br>DBPassword=zabbix<br>StartPollers=10<br>StartPollersUnreachable=5<br>StartTrappers=5<br>StartPingers=1<br>StartDiscoverers=1<br>6a14<br>HousekeepingFrequency=1</p>
</blockquote>
<p>修改完成后，重启zabbix－server 服务<br>[root@test ~]# systemctl restart zabbix-server<br>问题1:如果出现启动失败，如下所示<br>[root@test ~]# systemctl start zabbix-server<br>Job for zabbix-server.service failed because a fatal signal was delivered to the control process. See “systemctl status zabbix-server.service” and “journalctl -xe” for details.<br>解决方法：先检查selinux是否关闭，关闭后，并安装以下两个软件。再次启动zabbix-server服务便可以启动成功。<br>[root@test ~]# yum install trousers -y<br>[root@test ~]# yum install gnutls -y<br>4.下面修改php 配置文件，修改完成后并重启httpd<br>复制代码<br>[root@test ~]# sed -i “s/; date.timezone =/date.timezone =Asia/Shanghai/g” /etc/php.ini<br>vim /etc/php.ini<br> 878 ;date.timezone =<br> 879 date.timezone = Asia/Shanghai<br>[root@test ~]# vim /etc/httpd/conf.d/zabbix.conf<br>复制代码<br>    <ifmodule mod_php5.c=""><br>        php_value max_execution_time 300<br>        php_value memory_limit 128M<br>        php_value post_max_size 16M<br>        php_value upload_max_filesize 2M<br>        php_value max_input_time 300<br>        php_value always_populate_raw_post_data -1<br>        php_value date.timezone Asia/Shanghai<br>    </ifmodule><br>复制代码<br>[root@test ~]# systemctl restart httpd<br>复制代码<br>5.将服务添加开机启动项<br>复制代码<br>[root@test ~]# systemctl start zabbix-agent　　　　#竟然才发现没有将zabbix－agent服务启动。<br>[root@test ~]# systemctl enable httpd<br>Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.<br>[root@test ~]# systemctl enable zabbix-server<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-server.service to /usr/lib/systemd/system/zabbix-server.service.<br>[root@test ~]# systemctl enable zabbix-agent<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.<br>复制代码<br>6.那无，现在就可以去客户端访问web安装页面了 <a href="http://10.6.0.86/zabbix。（如果访问不了网站，看下server端的防火墙，systemctl" target="_blank" rel="external">http://10.6.0.86/zabbix。（如果访问不了网站，看下server端的防火墙，systemctl</a> stop firewalld）下面的步骤就不用截图了。按照提示一步一步来操作。<br><a href="http://10.6.0.86/zabbix/index.php" target="_blank" rel="external">http://10.6.0.86/zabbix/index.php</a><br>Admin<br>zabbix</p>
<p>监控Linux<br>7.现在进入zabbix-agent监控端的安装与配置，由于6.5没有3.0的yum源，所以，我们从zabbixcn团队的github上去下载。之后本地安装，如下。<br>[root@agent1 ~]# git clone <a href="https://github.com/zabbixcn/zabbix3.0-rpm.git" target="_blank" rel="external">https://github.com/zabbixcn/zabbix3.0-rpm.git</a><br>[root@agent1 ~]# cd zabbix3.0-rpm/RPMS/<br>[root@agent1 RPMS]# yum localinstall zabbix-agent-3.0.0-1.el6.x86_64.rpm -y<br>8.安装完成后，需要修改zabbix-agent的配置文件/etc/zabbix/zabbix_agentd.conf。修改3处。如下。其中Hostname 是表明在server端添加主机时填入的主机名<br>[root@agent1 ~]# sed -i ‘s/Server=127.0.0.1/Server=10.6.0.86/g’ /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# sed -i ‘s/ServerActive=127.0.0.1/ServerActive=10.6.0.86/g’ /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# sed -i “s/Hostname=Zabbix server/Hostname=agent1/g” /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# service zabbix-agent start</p>
<p>监控Windows<br>Zabbix agent 在windows上安装部署<br>1、  下载与解压<br>地址: <a href="http://www.zabbix.com/downloads/2.4.0/zabbix_agents_2.4.0.win.zip" target="_blank" rel="external">http://www.zabbix.com/downloads/2.4.0/zabbix_agents_2.4.0.win.zip</a><br>解压zabbix_agents_2.4.0.win.zip<br>conf目录存放是agent配置文件 bin文件存放windows下32位和64位安装程序<br>2、  配置与安装<br>2.1 配置zabbix agent相关配置。<br>   找到conf下的配置文件 zabbix_agentd.win.conf ，修改LogFile、Server、Hostname这三个参数。具体配置如下：<br>LogFile=C:\zabbix_agents_2.4.0.win\zabbix_agentd.log<br>Server=10.6.0.86<br>Hostname=WIN-0JCCEG5JES1<br>ServerActive=10.6.0.86 #zabbix server地址<br>其中logfile是zabbix日志存放地址。Server 是zabbix服务端ip地址。Hostname是本机机器名。<br>2.2 安装agent<br>在windows控制台下执行以下命令：<br>E:\zabbix\bin\win32\zabbix_agentd.exe  -c E:\zabbix\conf\zabbix_agentd.win.conf –i<br>管理员身份运行CMD<br>C:\zabbix_agents_2.4.4.win\bin\win32&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -i<br>zabbix_agentd.exe [9200]: service [Zabbix Agent] installed successfully<br>zabbix_agentd.exe [9200]: event source [Zabbix Agent] installed successfully<br>2.3 启动agent客户端<br>启动命令如下：<br>E:\zabbix\bin\win32\zabbix_agentd.exe  -c E:\zabbix\conf\zabbix_agentd.win.conf –s<br>C:\zabbix_agents_2.4.4.win\bin\win32&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -s<br>启动的程序将以控制台的形式开启。查看启动的日志：<br>  8732:20140912:162313.203 Starting Zabbix Agent [f523540]. Zabbix 2.4.0 (revision 48940).<br>  8732:20140912:162313.203 using configuration file: E:\zabbix\conf\zabbix_agentd.win.conf<br>  8732:20140912:162315.500 agent #0 started [main process]<br>  8820:20140912:162315.500 agent #1 started [collector]<br>  8392:20140912:162315.500 agent #2 started [listener #1]<br>  5552:20140912:162315.500 agent #3 started [listener #2]<br>  9712:20140912:162315.500 agent #4 started [listener #3]<br>  1096:20140912:162315.500 agent #5 started [active checks #1]<br>  1096:20140912:162316.500 active check configuration update from [127.0.0.1:10051] started to fail (cannot connect to [[127.0.0.1]:10051]: [0x0000274D] 由于目标机器积极拒绝，无法连接。)<br>  9368:20140912:163029.578 Starting Zabbix Agent [f523540]. Zabbix 2.4.0 (revision 48940).<br>  9368:20140912:163029.578 using configuration file: E:\zabbix\conf\zabbix_agentd.win.conf</p>
<p>C:\Users\Administrator&gt;cd C:\zabbix_agents_2.4.4.win\bin\win64</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -i<br>zabbix_agentd.exe [7152]: service [Zabbix Agent] installed successfully<br>zabbix_agentd.exe [7152]: event source [Zabbix Agent] installed successfully</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -s<br>zabbix_agentd.exe [5700]: service [Zabbix Agent] started successfully</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;</p>
<p> zabbix3.0配置邮件报警<br>我们部署一套监控软件，报警这一块自然不可或缺，接下来我们看看zabbix如何实现邮件报警。</p>
<p>1、编写发送邮件的脚本<br>zabbix通脚本发送邮件，遵循的传参格式为：<br>脚本   收件人  标题  邮件内容<br>先来看看脚本（sendmail_zabbix.py）：<br>复制代码<br>[root@Centos7-Zabbix ~]# cd /etc/zabbix/<br>[root@Centos7-Zabbix zabbix]# vim sendmail_zabbix.py</p>
<p>#!/usr/bin/python</p>
<p>#coding:utf-8</p>
<p>import smtplib<br>from email.mime.text import MIMEText<br>import sys</p>
<p>mail_host = ‘smtp.126.com’<br>mail_user = ‘yanjin198620@126.com’<br>mail_pass = ‘YANJINrenjia0626’<br>mail_postfix = ‘126.com’</p>
<p>#以上内容根据你的实际情况进行修改</p>
<p>def send_mail(to_list,subject,content):<br>    me = mail_user+”<a href="&#109;&#x61;&#x69;&#108;&#116;&#x6f;&#x3a;&#x22;&#43;&#109;&#x61;&#105;&#108;&#x5f;&#x75;&#x73;&#x65;&#x72;&#x2b;&#34;&#x40;&#34;&#43;&#x6d;&#97;&#x69;&#x6c;&#x5f;&#112;&#111;&#x73;&#x74;&#x66;&#105;&#120;&#43;&#34;">&#x22;&#43;&#109;&#x61;&#105;&#108;&#x5f;&#x75;&#x73;&#x65;&#x72;&#x2b;&#34;&#x40;&#34;&#43;&#x6d;&#97;&#x69;&#x6c;&#x5f;&#112;&#111;&#x73;&#x74;&#x66;&#105;&#120;&#43;&#34;</a>“<br>    msg = MIMEText(content)<br>    msg[‘Subject’] = subject<br>    msg[‘From’] = me<br>    msg[‘to’] = to_list</p>
<pre><code>try:
    s = smtplib.SMTP()
    s.connect(mail_host)
    s.login(mail_user,mail_pass)
    s.sendmail(me,to_list,msg.as_string())
    s.close()
    return True
except Exception,e:
    print str(e)
    return False
</code></pre><p>if <strong>name</strong> == “<strong>main</strong>“:<br>    send_mail(sys.argv[1], sys.argv[2], sys.argv[3])</p>
<p>复制代码<br>2、在zabbix配置文件中指定的脚本路径<br>修改zabbix_server.conf<br>[root@Centos7-Zabbix zabbix]# vim zabbix_server.conf<br>AlertScriptsPath=/etc/zabbix/sendmail_zabbix.py<br>AlertScriptsPath=/data/zabbix/externalscripts  #我的脚本放在此目录下，不同路径手动修改即可<br>[root@Centos7-Zabbix zabbix]# cp sendmail_zabbix.py /usr/lib/zabbix/alertscripts<br>[root@Centos7-Zabbix zabbix]# ls /usr/lib/zabbix/alertscripts<br>sendmail_zabbix.py<br>[root@Centos7-Zabbix zabbix]# </p>
<p>修改完成后重启zabbix_server服务。<br>[root@Centos7-Zabbix ~]# service zabbix-server restart<br>Redirecting to /bin/systemctl restart  zabbix-server.service<br>[root@Centos7-Zabbix ~]#<br>[root@Centos7-Zabbix zabbix]# chmod +x sendmail_zabbix.py<br>[root@Centos7-Zabbix zabbix]# ./sendmail_zabbix.py</p>
<p>3、关联脚本名称<br>【zabbix主面板-&gt;管理-&gt;报警媒介类型-&gt;创建媒体类型】<br>输入脚本名称，类型选择脚本<br>添加以下3个参数，分别对应sendEmail.sh脚本需要的3个参数：收件人地址、主题、详细内容</p>
<p>{ALERT.SENDTO}<br>{ALERT.SUBJECT}<br>{ALERT.MESSAGE}</p>
<p>[root@Centos7-Zabbix zabbix]# ./sendmail_zabbix.py 455177385@qq.com title content</p>
<p>[root@squid ~]# service zabbix-agent stop<br>Shutting down Zabbix agent: [  OK  ]<br>[root@squid ~]# service zabbix-agent start</p>
<p>监控交换机<br>yum -y install net-snmp-libs net-snmp net-snmp-utils<br>snmpwalk -v 2c -c public 10.6.0.134<br>OID: SNMPv2-SMI::enterprises.6486.800.1.1.2.1.11.1.2<br>snmpget -v 2c -c public -On 10.6.0.134 IF-MIB::ifInOctets.1026<br>.1.3.6.1.2.1.2.2.1.10.1026 = Counter32: 4234573034<br>[root@Centos7-Zabbix ~]# snmpget -v 2c -c public -On 10.6.0.134 IF-MIB::ifInOctets.1006<br>.1.3.6.1.2.1.2.2.1.10.1006 = Counter32: 0<br>[root@Centos7-Zabbix ~]# </p>
<p>IF-MIB::ifNumber.0</p>
<p>ifNumber<br>.1.3.6.1.2.1.2.2.1.10.1006</p>
<p>snmpwalk -v 1 -c public 10.6.0.1<br>snmpget -v 1 -c public -On 10.6.0.1 IF-MIB::ifInOctets.1<br>[root@Centos7-Zabbix ~]# snmpget -v 1 -c public -On 10.6.0.1 IF-MIB::ifInOctets.1<br>.1.3.6.1.2.1.2.2.1.10.1 = Counter32: 2764174284<br>[root@Centos7-Zabbix ~]# </p>
<p>snmpwalk -v 2c -c tzuchi 10.6.0.128<br>snmpget -v 2c -c tzuchi -On 10.6.0.128 IF-MIB::ifInOctets.1001<br>[root@Centos7-Zabbix ~]# snmpget -v 2c -c tzuchi -On 10.6.0.128 IF-MIB::ifInOctets.1001<br>.1.3.6.1.2.1.2.2.1.10.1001 = Counter32: 1636141580<br>[root@Centos7-Zabbix ~]# </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Centos-7-x-Zabbix/" data-id="ciwvcpuil0012oucyebwj6thg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cacti" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Cacti/" class="article-date">
  <time datetime="2016-12-15T03:30:49.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Cacti/">Cacti</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@localhost ~]# php /var/www/html/poller.php<br>[root@localhost ~]# crontab -e</p>
<p><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br><em>/5 </em> <em> </em> * /usr/sbin/ntpdate -u 10.6.0.220 &gt; /dev/null 2&gt;&amp;1</p>
<p>[root@localhost ~]# vi /etc/sysconfig/clock</p>
<h1 id="ZONE-”America-North-Dakota-Center”"><a href="#ZONE-”America-North-Dakota-Center”" class="headerlink" title="ZONE=”America/North_Dakota/Center”"></a>ZONE=”America/North_Dakota/Center”</h1><h1 id="UTC-false"><a href="#UTC-false" class="headerlink" title="UTC=false"></a>UTC=false</h1><h1 id="ARC-false"><a href="#ARC-false" class="headerlink" title="ARC=false"></a>ARC=false</h1><p>ZONE=”Asia/Shanghai”<br>UTC=false<br>ARC=false<br>[root@localhost ~]# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br>cp: overwrite `/etc/localtime’? y<br>[root@localhost ~]# date<br>[root@localhost ~]# /usr/sbin/ntpdate -u 10.6.0.220<br>26 Mar 13:21:52 ntpdate[5851]: step time server 10.6.0.220 offset -2774.426741 sec</p>
<p>cacti backup 10.6.0.77<br>默认设置说明：<br>root密码: CactiEZ<br>登录系统后，请尽快修改root密码。</p>
<p>Cacti登录用户名: admin<br>Cacti登录密码: sz215tzuchi<br>第一次登录Cacti需要修改密码。<br>mysqldump -ucactiuser -p’CactiMadeEZ’ cacti&gt;/root/cacti.sql<br>mysqldump -ucactiuser -p’CactiMadeEZ’ syslog&gt;syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option; </p>
<p>snmp station 10.6.0.77 162 “public” v1 enable</p>
<p>vim backup.sh</p>
<p>#/bin/bash<br>cd /var/www/</p>
<h1 id="Remove-old-backups"><a href="#Remove-old-backups" class="headerlink" title="Remove old backups"></a>Remove old backups</h1><p>find /var/www/backups/* -mtime +5 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Remove-old-RRAs-usually-means-the-datasource-is-deleted"><a href="#Remove-old-RRAs-usually-means-the-datasource-is-deleted" class="headerlink" title="Remove old RRAs (usually means the datasource is deleted)"></a>Remove old RRAs (usually means the datasource is deleted)</h1><p>find /var/www/html/rra/* -mtime +2 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Create-the-filename-for-the-backup"><a href="#Create-the-filename-for-the-backup" class="headerlink" title="Create the filename for the backup"></a>Create the filename for the backup</h1><p>eval <code>date &quot;+day=%d; month=%m; year=%Y&quot;</code><br>INSTFIL=”cacti-backup-$year-$month-$day.tar.gz”</p>
<h1 id="Dump-the-MySQL-Database"><a href="#Dump-the-MySQL-Database" class="headerlink" title="Dump the MySQL Database"></a>Dump the MySQL Database</h1><p>mysqldump -uroot –opt cacti&gt; /var/www/html/cacti-backup.sql<br>mysqldump -uroot –opt syslog&gt; /var/www/html/syslog.sql</p>
<h1 id="Gzip-the-whole-folder"><a href="#Gzip-the-whole-folder" class="headerlink" title="Gzip the whole folder"></a>Gzip the whole folder</h1><p>tar -Pcpzf /var/www/backups/$INSTFIL /var/www/html/*</p>
<h1 id="Remove-the-SQL-Dump"><a href="#Remove-the-SQL-Dump" class="headerlink" title="Remove the SQL Dump"></a>Remove the SQL Dump</h1><p>rm -f /var/www/html/cacti-backup.sql<br>rm -f /var/www/html/syslog.sql</p>
<p>crontab -e<br><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br>还原<br>将备份文件置于/var/www/html目录下<br>使用如下命令进行MySQL还原<br>source /root/cacti.sql<br>source /root/syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Cacti/" data-id="ciwvcpuh90003oucynrff1kzt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-KickStart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-KickStart/" class="article-date">
  <time datetime="2016-12-15T03:30:02.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-KickStart/">CentOS 6.x KickStart</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vim /etc/dhcp/dhcpd.conf<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>        range 192.168.3.100 192.168.3.200;<br>        option subnet-mask 255.255.255.0;<br>option domain-name-servers 114.114.114.114;<br>option domain-name-servers 223.5.5.5;<br>        default-lease-time 21600;<br>        max-lease-time 43200;<br>        next-server 192.168.3.3;<br>        filename “/pxelinux.0”;<br>}</p>
<p>[root@localhost ~]# vim /etc/sysconfig/dhcpd</p>
<h1 id="Command-line-options-here"><a href="#Command-line-options-here" class="headerlink" title="Command line options here"></a>Command line options here</h1><p>DHCPDARGS=eth1</p>
<p>/etc/init.d/dhcpd restart<br>netstat -tunlp|grep dhcp<br>[root@localhost ~]# chkconfig dhcpd on<br>[root@localhost ~]# chkconfig –list | grep dhcpd<br>dhcpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off</p>
<p>yum -y install tftp-server<br>[root@localhost ~]# vim /etc/xinetd.d/tftp</p>
<p>  1 # default: off<br>  2 # description: The tftp server serves files using the trivial file transfer     \<br>  3 #       protocol.  The tftp protocol is often used to boot diskless \<br>  4 #       workstations, download configuration files to network-aware printers    , \<br>  5 #       and to start the installation process for some operating systems.<br>  6 service tftp<br>  7 {<br>  8         socket_type             = dgram<br>  9         protocol                = udp<br> 10         wait                    = yes<br> 11         user                    = root<br> 12         server                  = /usr/sbin/in.tftpd<br> 13         server_args             = -s /var/lib/tftpboot<br> 14         disable                 = no<br> 15         per_source              = 11<br> 16         cps                     = 100 2<br> 17         flags                   = IPv4<br> 18 }<br>~<br>~<br>~<br>“/etc/xinetd.d/tftp” 18L, 517C written<br>[root@localhost ~]#<br>[root@localhost ~]# /etc/init.d/xinetd start<br>Starting xinetd: [  OK  ]<br>[root@localhost ~]# netstat -tunlp|grep 69<br>udp        0      0 0.0.0.0:67                  0.0.0.0:<em>                               1691/dhcpd<br>udp        0      0 0.0.0.0:69                  0.0.0.0:</em>                               2108/xinetd<br>[root@localhost ~]# </p>
<p>Complete!</p>
<p>[root@localhost ~]# yum -y install httpd<br>[root@localhost ~]# sed -i “277i ServerName 127.0.0.1:80” /etc/httpd/conf/httpd.conf<br>[root@localhost ~]# /etc/init.d/httpd start<br>Starting httpd: [  OK  ]<br>[root@localhost ~]#<br>[root@server ~]# chkconfig httpd on<br>[root@server ~]# chkconfig –list |grep httpd<br>httpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off<br>[root@localhost ~]# mkdir /var/www/html/CentOS-6.5</p>
<p>[root@localhost ~]# mount /dev/cdrom /var/www/html/CentOS-6.5<br>mount: block device /dev/sr0 is write-protected, mounting read-only<br>[root@localhost ~]# df -h<br>Filesystem                     Size  Used Avail Use% Mounted on<br>/dev/mapper/VolGroup-LogVol00   28G  3.7G   23G  14% /<br>tmpfs                         1004M   84K 1004M   1% /dev/shm<br>/dev/sda1                      194M   35M  150M  19% /boot<br>/dev/sr0                       4.2G  4.2G     0 100% /media/CentOS_6.5_Final<br>/dev/sr0                       4.2G  4.2G     0 100% /var/www/html/CentOS-6.5<br>[root@localhost ~]# ls /var/www/html/CentOS-6.5<br>CentOS_BuildTag  isolinux                  RPM-GPG-KEY-CentOS-Debug-6<br>EFI              Packages                  RPM-GPG-KEY-CentOS-Security-6<br>EULA             RELEASE-NOTES-en-US.html  RPM-GPG-KEY-CentOS-Testing-6<br>GPL              repodata                  TRANS.TBL<br>images           RPM-GPG-KEY-CentOS-6<br>[root@localhost ~]#<br><a href="http://10.6.4.36/CentOS-6.5/" target="_blank" rel="external">http://10.6.4.36/CentOS-6.5/</a></p>
<p>[root@localhost ~]# yum -y install syslinux<br>[root@localhost ~]# cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/<br>[root@localhost ~]# cp -a /var/www/html/CentOS-6.5/isolinux/* /var/lib/tftpboot/<br>[root@localhost ~]# ls /var/lib/tftpboot/<br>boot.cat  grub.conf   isolinux.bin  memtest     splash.jpg  vesamenu.c32<br>boot.msg  initrd.img  isolinux.cfg  pxelinux.0  TRANS.TBL   vmlinuz<br>[root@localhost ~]# mkdir -p /var/lib/tftpboot/pxelinux.cfg<br>[root@localhost ~]# cp /var/www/html/CentOS-6.5/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# </p>
<p>[root@localhost ~]# grub-crypt<br>Password:<br>Retype password:<br>$6$7xeJ5moFJ1sV2KjE$dpQVjz.hxeTFxydJM2yw7d/EXdoaATJ2Tt5wP1lXwwAicp3L4fFY4PWfOAUYkz1rpKV1lSD7g5zDoX0/W1MT1.<br>[root@localhost ~]# </p>
<p>[root@localhost ~]# mkdir /var/www/html/ks_config<br>[root@localhost ~]# vim /var/www/html/ks_config/CentOS-6.5-ks.cfg</p>
<h1 id="Kickstart-Configurator-for-CentOS-6-5-by-jinyan"><a href="#Kickstart-Configurator-for-CentOS-6-5-by-jinyan" class="headerlink" title="Kickstart Configurator for CentOS 6.5 by jinyan"></a>Kickstart Configurator for CentOS 6.5 by jinyan</h1><p>install<br>url –url=”<a href="http://192.168.3.3/CentOS-6.5/" target="_blank" rel="external">http://192.168.3.3/CentOS-6.5/</a>“<br>text<br>lang en_US.UTF-8<br>keyboard us<br>zerombr<br>bootloader –location=mbr –driveorder=sda –append=”crashkernel=auto rhgb quiet”<br>network –onboot yes –device eth0 –bootproto dhcp –noipv6<br>timezone –utc Asia/Shanghai<br>authconfig –enableshadow –passalgo=sha512<br>rootpw  –iscrypted $6$7xeJ5moFJ1sV2KjE$dpQVjz.hxeTFxydJM2yw7d/EXdoaATJ2Tt5wP1lXwwAicp3L4fFY4PWfOAUYkz1rpKV1lSD7g5zDoX0/W1MT1.<br>clearpart –all –initlabel<br>part /boot –fstype=ext4 –asprimary –size=200<br>part swap –size=2048<br>part / –fstype=ext4 –grow –asprimary –size=200<br>firstboot –disable<br>selinux –disabled<br>firewall –disabled<br>logging –level=info<br>reboot<br>%packages<br>@base<br>@core<br>@debugging<br>@basic-desktop<br>@desktop-debugging<br>@desktop-platform<br>@directory-client<br>@fonts<br>@general-desktop<br>@graphical-admin-tools<br>@input-methods<br>@internet-applications<br>@internet-browser<br>@java-platform<br>@legacy-x<br>@network-file-system-client<br>@office-suite<br>@print-client<br>@remote-desktop-clients<br>@server-platform<br>@server-policy<br>@workstation-policy<br>@x11<br>mtools<br>pax<br>oddjob<br>wodim<br>sgpio<br>genisoimage<br>device-mapper-persistent-data<br>abrt-gui<br>samba-winbind<br>certmonger<br>pam_krb5<br>krb5-workstation<br>libXmu<br>%post<br>wget -O /tmp/optimization.sh <a href="http://192.168.3.3/ks_config/optimization.sh" target="_blank" rel="external">http://192.168.3.3/ks_config/optimization.sh</a> &amp;&gt;/dev/null<br>/bin/sh /tmp/optimization.sh<br>%end</p>
<p>[root@localhost ~]# cp /var/lib/tftpboot/pxelinux.cfg/default /var/lib/tftpboot/pxelinux.cfg/defaultbak<br>[root@localhost ~]# &gt;/var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# chmod 644 /var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# vim /var/lib/tftpboot/pxelinux.cfg/default<br>default ks<br>prompt 0</p>
<p>label ks<br>  kernel vmlinuz<br>  append initrd=initrd.img ks=<a href="http://192.168.3.3/ks_config/CentOS-6.5-ks.cfg" target="_blank" rel="external">http://192.168.3.3/ks_config/CentOS-6.5-ks.cfg</a></p>
<h1 id="append-initrd-initrd-img-ks-http-192-168-3-3-ks-config-CentOS-6-7-ks-cfg-ksdevice-eth0"><a href="#append-initrd-initrd-img-ks-http-192-168-3-3-ks-config-CentOS-6-7-ks-cfg-ksdevice-eth0" class="headerlink" title="append initrd=initrd.img ks=http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg ksdevice=eth0"></a>append initrd=initrd.img ks=<a href="http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg" target="_blank" rel="external">http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg</a> ksdevice=eth0</h1><h1 id="ksdevice-eth0"><a href="#ksdevice-eth0" class="headerlink" title="ksdevice=eth0"></a>ksdevice=eth0</h1><p>[root@localhost ~]# vim /var/www/html/ks_config/optimization.sh</p>
<p>#!/bin/bash</p>
<p>##############################################################</p>
<h1 id="File-Name-var-www-html-ks-config-optimization-sh"><a href="#File-Name-var-www-html-ks-config-optimization-sh" class="headerlink" title="File Name: /var/www/html/ks_config/optimization.sh"></a>File Name: /var/www/html/ks_config/optimization.sh</h1><h1 id="Version-V1-0"><a href="#Version-V1-0" class="headerlink" title="Version: V1.0"></a>Version: V1.0</h1><h1 id="Author-jinyan"><a href="#Author-jinyan" class="headerlink" title="Author: jinyan"></a>Author: jinyan</h1><h1 id="Organization-sanyuanempire"><a href="#Organization-sanyuanempire" class="headerlink" title="Organization: sanyuanempire"></a>Organization: sanyuanempire</h1><h1 id="Created-Time-2016-04-27-12-02-08"><a href="#Created-Time-2016-04-27-12-02-08" class="headerlink" title="Created Time : 2016-04-27 12:02:08"></a>Created Time : 2016-04-27 12:02:08</h1><h1 id="Description-Linux-system-initialization"><a href="#Description-Linux-system-initialization" class="headerlink" title="Description: Linux system initialization"></a>Description: Linux system initialization</h1><p>##############################################################</p>
<p>. /etc/init.d/functions</p>
<h1 id="Defined-result-function"><a href="#Defined-result-function" class="headerlink" title="Defined result function"></a>Defined result function</h1><p>function Msg(){<br>        if [ $? -eq 0 ];then<br>          action “$1” /bin/true<br>        else<br>          action “$1” /bin/false<br>        fi<br>}</p>
<h1 id="Defined-OPEN-FILES-Functions"><a href="#Defined-OPEN-FILES-Functions" class="headerlink" title="Defined OPEN FILES Functions"></a>Defined OPEN FILES Functions</h1><p>function openfiles(){<br>        [ -f “/etc/security/limits.conf” ] &amp;&amp; {<br>        echo ‘*  -  nofile  65535’ &gt;&gt; /etc/security/limits.conf<br>        Msg “open files”<br>        }<br>}</p>
<h1 id="Defined-System-Startup-Services-Functions"><a href="#Defined-System-Startup-Services-Functions" class="headerlink" title="Defined System Startup Services Functions"></a>Defined System Startup Services Functions</h1><p>function boot(){<br>        for jinyan in <code>chkconfig --list|grep &quot;3:on&quot;|awk &#39;{print $1}&#39;|grep -vE &quot;crond|network|rsyslog|sshd|sysstat&quot;</code><br>          do<br>           chkconfig $jinyan off<br>        done<br>        Msg “BOOT config”<br>}</p>
<h1 id="Defined-Time-Synchronization-Functions"><a href="#Defined-Time-Synchronization-Functions" class="headerlink" title="Defined Time Synchronization Functions"></a>Defined Time Synchronization Functions</h1><p>function Time(){<br>        echo “#time sync by jinyan at $(date +%F)” &gt;&gt;/var/spool/cron/root<br>        echo ‘<em>/5 </em> <em> </em> * /usr/sbin/ntpdate -u 192.168.3.3 &amp;&gt;/dev/null’ &gt;&gt;/var/spool/cron/root<br>        Msg “Time Synchronization”<br>}</p>
<h1 id="Defined-main-Functions"><a href="#Defined-main-Functions" class="headerlink" title="Defined main Functions"></a>Defined main Functions</h1><p>function main(){<br>        openfiles<br>       boot<br>        Time<br>}</p>
<p>main</p>
<p>Ip=192.168.3.3<br>Port=80<br>ConfigDir=ks_config</p>
<h1 id="Judge-Http-server-is-ok"><a href="#Judge-Http-server-is-ok" class="headerlink" title="Judge Http server is ok?"></a>Judge Http server is ok?</h1><p>PortNum=<code>nmap $Ip  -p $Port 2&gt;/dev/null|grep open|wc -l</code><br>[ $PortNum -lt 1 ] &amp;&amp; {<br>        echo “Http server is bad!”<br>        exit 1<br>}</p>
<h1 id="Defined-IP-function"><a href="#Defined-IP-function" class="headerlink" title="Defined IP function"></a>Defined IP function</h1><p>function ConfigIP(){<br>        Suffix=<code>ifconfig eth0|awk -F &quot;[ .]+&quot; &#39;NR==2 {print $6}&#39;</code><br>        cat &gt;/etc/sysconfig/network-scripts/ifcfg-eth0 &lt;&lt;-END<br>        DEVICE=eth0<br>        TYPE=Ethernet<br>        ONBOOT=yes<br>        NM_CONTROLLED=yes<br>        BOOTPROTO=none<br>        IPADDR=10.0.0.$Suffix<br>        PREFIX=24<br>        GATEWAY=10.0.0.2<br>        DNS1=10.0.0.2<br>        DEFROUTE=yes<br>        IPV4_FAILURE_FATAL=yes<br>        IPV6INIT=no<br>        NAME=”System eth0”<br>        END<br>        Msg “config eth0”<br>}</p>
<h1 id="Defined-Yum-source-Functions"><a href="#Defined-Yum-source-Functions" class="headerlink" title="Defined Yum source Functions"></a>Defined Yum source Functions</h1><p>function yum(){<br>        YumDir=/etc/yum.repos.d<br>        [ -f “$YumDir/CentOS-Base.repo” ] &amp;&amp; cp $YumDir/CentOS-Base.repo{,.ori}<br>        wget -O $YumDir/CentOS-Base.repo <a href="http://$Ip:$Port/$ConfigDir/CentOS-Base.repo" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/CentOS-Base.repo</a> &amp;&gt;/dev/null &amp;&amp;\<br>        wget -O $YumDir/epel.repo <a href="http://$Ip:$Port/$ConfigDir/epel.repo" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/epel.repo</a> &amp;&gt;/dev/null &amp;&amp;\<br>        Msg “YUM source”<br>}</p>
<h1 id="Defined-Hide-the-system-version-number-Functions"><a href="#Defined-Hide-the-system-version-number-Functions" class="headerlink" title="Defined Hide the system version number Functions"></a>Defined Hide the system version number Functions</h1><p>function HideVersion(){<br>        [ -f “/etc/issue” ] &amp;&amp; &gt;/etc/issue<br>        Msg “Hide issue”<br>        [ -f “/etc/issue.net” ] &amp;&amp; &gt; /etc/issue.net<br>        Msg “Hide issue.net”<br>}</p>
<h1 id="Defined-Kernel-parameters-Functions"><a href="#Defined-Kernel-parameters-Functions" class="headerlink" title="Defined Kernel parameters Functions"></a>Defined Kernel parameters Functions</h1><p>function kernel(){<br>        KernelDir=/etc<br>        [ -f “$KernelDir/sysctl.conf” ] &amp;&amp; /bin/mv $KernelDir/sysctl.conf{,.ori}<br>        wget -O $KernelDir/sysctl.conf <a href="http://$Ip:$Port/$ConfigDir/sysctl.conf" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/sysctl.conf</a> &amp;&gt;/dev/null<br>        Msg “Kernel config”<br>}</p>
<h1 id="Defined-main-Functions-1"><a href="#Defined-main-Functions-1" class="headerlink" title="Defined main Functions"></a>Defined main Functions</h1><p>function main(){<br>        ConfigIP<br>        yum<br>        HideVersion<br>        openfiles<br>        kernel<br>        boot<br>        Time<br>}</p>
<p>main</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-KickStart/" data-id="ciwvcpuhr000foucywfy94tlv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Cobbler" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-Cobbler/" class="article-date">
  <time datetime="2016-12-15T03:28:43.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-Cobbler/">CentOS 6.x Cobbler</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>环境：CentOS6.5 64位</p>
<p>关闭防火墙：<br>service iptables stop （临时关闭）<br>chkconfig iptables off （重启后生效）</p>
<p>关闭SELINUX<br>vim /etc/selinux/config<br>SELINUX=disabled</p>
<p>ssh 登录慢<br>vim /etc/ssh/sshd_config<br>UseDNS no<br>/etc/init.d/sshd restart</p>
<p>修改主机名<br>vim /etc/sysconfig/network<br>NETWORKING=yes<br>HOSTNAME=cobbler</p>
<p>rpm -ivh <a href="http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm" target="_blank" rel="external">http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</a><br>yum clean all<br>yum makecache<br>yum repolist</p>
<p>安装SecureCRT<br>yum -y install lrzsz</p>
<p>安装配置VNC<br>yum -y install tigervnc-server<br>更改配置<br>vim /etc/sysconfig/vncservers<br>VNCSERVERS=”0:root”<br>VNCSERVERARGS[0]=”-geometry 1024x768”<br>设置密码<br>vncpasswd<br>service vncserver start<br>开机启动<br>chkconfig –level 345 vncserver on</p>
<p>NTP<br>yum install ntp -y<br>chkconfig ntpd on<br>chkconfig –list ntpd<br>vim /etc/ntp.conf<br>server 202.120.2.101 prefer<br>service ntpd start<br>ntpstat</p>
<p>双网卡<br>eth0<br>IP地址：10.6.4.3<br>子网掩码：255.255.255.0<br>网关：10.6.4.1<br>[root@cobbler ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=eth0<br>BOOTPROTO=none<br>HWADDR=82:70:08:d9:98:db<br>NM_CONTROLLED=yes<br>ONBOOT=yes<br>TYPE=Ethernet<br>UUID=”11a6993c-4574-45a7-baf4-eccee247503c”<br>IPADDR=10.6.4.3<br>NETMASK=255.255.255.0<br>DNS2=61.177.7.1<br>GATEWAY=10.6.4.1<br>DNS1=223.5.5.5<br>IPV6INIT=no<br>USERCTL=no<br>[root@cobbler ~]#<br>vim /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=”eth0”<br>BOOTPROTO=none<br>NM_CONTROLLED=”yes”<br>ONBOOT=”yes”<br>TYPE=”Ethernet”<br>IPADDR=10.6.4.3<br>PREFIX=24<br>GATEWAY=10.6.4.1<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=yes<br>IPV6INIT=no<br>NAME=”System eth0”<br>HWADDR=82:70:08:d9:98:db</p>
<p>eth1<br>IP地址：192.168.3.3<br>子网掩码：255.255.255.0<br>[root@cobbler ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth1<br>DEVICE=eth1<br>TYPE=Ethernet<br>UUID=99530563-ca29-441b-bfe2-3299357c2170<br>ONBOOT=yes<br>NM_CONTROLLED=yes<br>BOOTPROTO=none<br>IPADDR=192.168.3.3<br>NETMASK=255.255.255.0<br>DNS2=61.177.7.1<br>DNS1=223.5.5.5<br>IPV6INIT=no<br>USERCTL=no<br>HWADDR=3A:E4:4B:3F:BE:9D<br>PREFIX=24<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=yes<br>NAME=”System eth1”<br>[root@cobbler ~]#<br>vim /etc/sysconfig/network-scripts/ifcfg-eth1<br>DEVICE=”eth1”<br>BOOTPROTO=none<br>NM_CONTROLLED=”yes”<br>ONBOOT=”yes”<br>TYPE=”Ethernet”<br>IPADDR=192.168.3.3<br>PREFIX=24<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5<br>DEFROUTE=yes<br>IPV4_FAILURE_FATAL=yes<br>IPV6INIT=no<br>NAME=”System eth1”</p>
<p>安装XenServer Tools<br>快照</p>
<p>安装cobbler<br>yum -y install cobbler<br>yum install -y tftp-server xinetd dhcp httpd rsync pykickstart  debmirror python-ctypes cman<br>service cobblerd start</p>
<p>设置http服务<br>配置httpd配置文件<br>vim /etc/httpd/conf/httpd.conf<br>ServerName 127.0.0.1:80</p>
<p>安装mod_wsgi<br>yum -y install mod_wsgi<br>vim /etc/httpd/conf.d/wsgi.conf<br>LoadModule  wsgi_module modules/mod_wsgi.so</p>
<p>启动http服务<br>service httpd start<br>chkconfig httpd on</p>
<p>设置tftp服务<br>vim /etc/xinetd.d/tftp<br>disable = no</p>
<p>设置rsync服务<br>vim /etc/xinetd.d/rsync<br>disable = no<br>启动rsync<br>service xinetd start</p>
<p>配置cobbler相关参数<br>vim /etc/debmirror.conf<br>  //注释掉下面两句：</p>
<p>#@dists=”sid”;</p>
<p>#@arches=”i386”;</p>
<p>配置cobbler主配置文件<br>在开启cobbler服务之前，需要修改一些配置文件，在修改配置文件之前最好做一些备份<br>cp /etc/cobbler/settings /etc/cobbler/settingsbak<br>vim /etc/cobbler/settings<br>server:192.168.3.3</p>
<p>#server设置的IP为cobbler服务器指定的地址<br>next_server:192.168.3.3</p>
<p>#next_server是DHCP/PXE网络引导文件被下载的TFTP服务器的IP，这里我们和server设置为同一个IP<br>pxe_just_once:1</p>
<p>#为了防止误重装系统，可以做如下修改，PXE安装只允许一次，防止误操作</p>
<p>生成cobbler安装系统的root初始密码<br>openssl passwd -1 -salt ‘random-phrase-here’’yanjin’</p>
<p>#将得到的字符串加到setting的配置文件中”刚才得到的字符串”修改<br>vim /etc/cobbler/settings<br>default_password_crypted: “$1$random-p$RaMolYuxr4D4mKkRWlYC8.”<br>manage_rsync: 1</p>
<p>#对rsync进行管理<br>manage_dhcp: 1</p>
<p>#对dhcp进行管理</p>
<p>对cobbler管理dhcp的模板修改<br>修改模板文件 /etc/cobbler/dhcp.template 此文件是cobbler管理dhcp的模板，确保dhcp分配的地址和cobbler在同一网段，对于此文件，我们做如下部分的修改：<br>cp /etc/cobbler/dhcp.template /etc/cobbler/dhcp.templatebak<br>vim /etc/cobbler/dhcp.template<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>     option routers             192.168.3.3;<br>     option domain-name-servers 223.5.5.5;<br>     option subnet-mask         255.255.255.0;<br>     range dynamic-bootp        192.168.3.6 192.168.3.99;</p>
<pre><code>default-lease-time         21600;
max-lease-time             43200;
next-server                $next_server;
class &quot;pxeclients&quot; {
     match if substring (option vendor-class-identifier, 0, 9) = &quot;PXEClient&quot;;
     if option pxe-system-type = 00:02 {
             filename &quot;ia64/elilo.efi&quot;;
     } else if option pxe-system-type = 00:06 {
             filename &quot;grub/grub-x86.efi&quot;;
     } else if option pxe-system-type = 00:07 {
             filename &quot;grub/grub-x86_64.efi&quot;;
     } else {
             filename &quot;pxelinux.0&quot;;
     }
}
</code></pre><p>}</p>
<p>NAT<br>vim /etc/sysctl.conf</p>
<h1 id="net-ipv4-ip-forward-0"><a href="#net-ipv4-ip-forward-0" class="headerlink" title="net.ipv4.ip_forward = 0"></a>net.ipv4.ip_forward = 0</h1><p>net.ipv4.ip_forward = 1<br>sysctl -p</p>
<p>iptables -F<br>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>iptables -t filter -A FORWARD -i eth0 -o eth1 -j ACCEPT<br>iptables -t filter -A FORWARD -i eth1 -o eth0 -j ACCEPT<br>service iptables save</p>
<p>指定DHCP服务的网络接口<br>vim /etc/sysconfig/dhcpd<br>DHCPDARGS=eth1</p>
<p>加载部分缺失的boot-loaders<br>service cobblerd restart<br>cobbler get-loaders</p>
<p>#如果该步骤无法执行可以将文件下载下来保存到/var/lib/cobbler/loads/中</p>
<p>启动cobbler服务<br>执行dhcpd测试dhcp服务器配置是否正确<br>chkconfig dhcpd on<br>chkconfig cobblerd on<br>service cobblerd restart<br>cobbler sync</p>
<p>#同步配置文件到dhcp服务器中</p>
<p>#如果出现错误时bug，重新启动一遍cobbler即可<br>service dhcpd start</p>
<p>配置cobbler相关服务启动脚本<br>vim /etc/rc.d/init.d/cobbler</p>
<p>#!/bin/sh</p>
<h1 id="chkconfig-80-90"><a href="#chkconfig-80-90" class="headerlink" title="chkconfig: - 80 90"></a>chkconfig: - 80 90</h1><h1 id="description-cobbler"><a href="#description-cobbler" class="headerlink" title="description:cobbler"></a>description:cobbler</h1><p>case $1 in<br>start)<br>/etc/init.d/httpd start<br>/etc/init.d/xinetd start<br>/etc/init.d/dhcpd start<br>/etc/init.d/cobblerd start<br>;;<br>stop)<br>/etc/init.d/httpd stop<br>/etc/init.d/xinetd stop<br>/etc/init.d/dhcpd stop<br>/etc/init.d/cobblerd stop<br>;;<br>restart)<br>/etc/init.d/httpd restart<br>/etc/init.d/xinetd restart<br>/etc/init.d/dhcpd restart<br>/etc/init.d/cobblerd restart<br>;;<br>status)<br>/etc/init.d/httpd status<br>/etc/init.d/xinetd status<br>/etc/init.d/dhcpd status<br>/etc/init.d/cobblerd status<br>;;<br>sync)<br>cobbler sync<br>;;<br>*)<br>echo “Input error,please in put  ‘start|stop|restart|status|sync’!”;<br>exit 2&gt;&amp;1 &gt;/dev/null &amp;<br>;;<br>esac</p>
<p>添加脚本的执行权限<br>chmod +x /etc/rc.d/init.d/cobbler<br>chkconfig cobbler on<br>service cobbler restart<br>cobbler check</p>
<p>挂载镜像<br>mount /dev/cdrom /media/<br>cobbler import –path=/media –name=ubuntu12.04 –breed=ubuntu<br><strong><em> TASK COMPLETE </em></strong><br>cobbler list<br>du -sh /var/www/cobbler/ks_mirror/ubuntu12.04<br>cp /var/lib/cobbler/kickstarts/sample.seed /var/lib/cobbler/kickstarts/sample.seedbak<br>vim /var/lib/cobbler/kickstarts/sample.seed<br>d-i mirror/country string manual<br>d-i mirror/protocol string http<br>d-i mirror/http/hostname string 192.168.3.3<br>d-i mirror/http/directory string /cobbler/ks_mirror/ubuntu12.04<br>d-i mirror/http/proxy string <a href="http://192.168.3.3/" target="_blank" rel="external">http://192.168.3.3/</a></p>
<p>cobbler sync<br>service cobbler restart</p>
<p>cat /var/lib/cobbler/kickstarts/sample.seed</p>
<h1 id="Mostly-based-on-the-Ubuntu-installation-guide"><a href="#Mostly-based-on-the-Ubuntu-installation-guide" class="headerlink" title="Mostly based on the Ubuntu installation guide"></a>Mostly based on the Ubuntu installation guide</h1><h1 id="https-help-ubuntu-com-12-04-installation-guide"><a href="#https-help-ubuntu-com-12-04-installation-guide" class="headerlink" title="https://help.ubuntu.com/12.04/installation-guide/"></a><a href="https://help.ubuntu.com/12.04/installation-guide/" target="_blank" rel="external">https://help.ubuntu.com/12.04/installation-guide/</a></h1><h1 id="Preseeding-only-locale-sets-language-country-and-locale"><a href="#Preseeding-only-locale-sets-language-country-and-locale" class="headerlink" title="Preseeding only locale sets language, country and locale."></a>Preseeding only locale sets language, country and locale.</h1><p>d-i debian-installer/locale string en_US</p>
<h1 id="Keyboard-selection"><a href="#Keyboard-selection" class="headerlink" title="Keyboard selection."></a>Keyboard selection.</h1><h1 id="Disable-automatic-interactive-keymap-detection"><a href="#Disable-automatic-interactive-keymap-detection" class="headerlink" title="Disable automatic (interactive) keymap detection."></a>Disable automatic (interactive) keymap detection.</h1><p>d-i console-setup/ask_detect boolean false<br>d-i keyboard-configuration/layoutcode string us<br>d-i keyboard-configuration/variantcode string</p>
<h1 id="netcfg-will-choose-an-interface-that-has-link-if-possible-This-makes-it"><a href="#netcfg-will-choose-an-interface-that-has-link-if-possible-This-makes-it" class="headerlink" title="netcfg will choose an interface that has link if possible. This makes it"></a>netcfg will choose an interface that has link if possible. This makes it</h1><h1 id="skip-displaying-a-list-if-there-is-more-than-one-interface"><a href="#skip-displaying-a-list-if-there-is-more-than-one-interface" class="headerlink" title="skip displaying a list if there is more than one interface."></a>skip displaying a list if there is more than one interface.</h1><p>#set $myhostname = $getVar(‘hostname’,$getVar(‘name’,’cobbler’)).replace(“_”,”-“)<br>d-i netcfg/choose_interface select auto<br>d-i netcfg/get_hostname string $myhostname</p>
<h1 id="If-non-free-firmware-is-needed-for-the-network-or-other-hardware-you-can"><a href="#If-non-free-firmware-is-needed-for-the-network-or-other-hardware-you-can" class="headerlink" title="If non-free firmware is needed for the network or other hardware, you can"></a>If non-free firmware is needed for the network or other hardware, you can</h1><h1 id="configure-the-installer-to-always-try-to-load-it-without-prompting-Or"><a href="#configure-the-installer-to-always-try-to-load-it-without-prompting-Or" class="headerlink" title="configure the installer to always try to load it, without prompting. Or"></a>configure the installer to always try to load it, without prompting. Or</h1><h1 id="change-to-false-to-disable-asking"><a href="#change-to-false-to-disable-asking" class="headerlink" title="change to false to disable asking."></a>change to false to disable asking.</h1><h1 id="d-i-hw-detect-load-firmware-boolean-true"><a href="#d-i-hw-detect-load-firmware-boolean-true" class="headerlink" title="d-i hw-detect/load_firmware boolean true"></a>d-i hw-detect/load_firmware boolean true</h1><h1 id="NTP-Time-Setup"><a href="#NTP-Time-Setup" class="headerlink" title="NTP/Time Setup"></a>NTP/Time Setup</h1><p>d-i time/zone string US/Eastern<br>d-i clock-setup/utc boolean true<br>d-i clock-setup/ntp boolean true<br>d-i clock-setup/ntp-server  string ntp.ubuntu.com</p>
<h1 id="Setup-the-installation-source"><a href="#Setup-the-installation-source" class="headerlink" title="Setup the installation source"></a>Setup the installation source</h1><p>d-i mirror/country string manual<br>d-i mirror/protocol string http<br>d-i mirror/http/hostname string 192.168.3.3<br>d-i mirror/http/directory string /cobbler/ks_mirror/ubuntu12.04<br>d-i mirror/http/proxy string <a href="http://192.168.3.3/" target="_blank" rel="external">http://192.168.3.3/</a></p>
<h1 id="d-i-mirror-http-hostname-string-http-server"><a href="#d-i-mirror-http-hostname-string-http-server" class="headerlink" title="d-i mirror/http/hostname string $http_server"></a>d-i mirror/http/hostname string $http_server</h1><h1 id="d-i-mirror-http-directory-string-install-source-directory"><a href="#d-i-mirror-http-directory-string-install-source-directory" class="headerlink" title="d-i mirror/http/directory string $install_source_directory"></a>d-i mirror/http/directory string $install_source_directory</h1><h1 id="d-i-mirror-http-proxy-string"><a href="#d-i-mirror-http-proxy-string" class="headerlink" title="d-i mirror/http/proxy string"></a>d-i mirror/http/proxy string</h1><p>#set $os_v = $getVar(‘os_version’,’’)</p>
<p>#if $os_v and $os_v.lower()[0] &gt; ‘p’</p>
<h1 id="Required-at-least-for-12-10"><a href="#Required-at-least-for-12-10" class="headerlink" title="Required at least for 12.10+"></a>Required at least for 12.10+</h1><p>d-i live-installer/net-image string <a href="http://$http_server/cobbler/links/$distro_name/install/filesystem.squashfs" target="_blank" rel="external">http://$http_server/cobbler/links/$distro_name/install/filesystem.squashfs</a></p>
<p>#end if</p>
<h1 id="Suite-to-install"><a href="#Suite-to-install" class="headerlink" title="Suite to install."></a>Suite to install.</h1><h1 id="d-i-mirror-suite-string-precise"><a href="#d-i-mirror-suite-string-precise" class="headerlink" title="d-i mirror/suite string precise"></a>d-i mirror/suite string precise</h1><h1 id="d-i-mirror-udeb-suite-string-precise"><a href="#d-i-mirror-udeb-suite-string-precise" class="headerlink" title="d-i mirror/udeb/suite string precise"></a>d-i mirror/udeb/suite string precise</h1><h1 id="Components-to-use-for-loading-installer-components-optional"><a href="#Components-to-use-for-loading-installer-components-optional" class="headerlink" title="Components to use for loading installer components (optional)."></a>Components to use for loading installer components (optional).</h1><p>#d-i mirror/udeb/components multiselect main, restricted</p>
<h1 id="Disk-Partitioning"><a href="#Disk-Partitioning" class="headerlink" title="Disk Partitioning"></a>Disk Partitioning</h1><h1 id="Use-LVM-and-wipe-out-anything-that-already-exists"><a href="#Use-LVM-and-wipe-out-anything-that-already-exists" class="headerlink" title="Use LVM, and wipe out anything that already exists"></a>Use LVM, and wipe out anything that already exists</h1><p>d-i partman/choose_partition select finish<br>d-i partman/confirm boolean true<br>d-i partman/confirm_nooverwrite boolean true<br>d-i partman-auto/method string lvm<br>d-i partman-lvm/device_remove_lvm boolean true<br>d-i partman-lvm/confirm boolean true<br>d-i partman-lvm/confirm_nooverwrite boolean true<br>d-i partman-md/device_remove_md boolean true<br>d-i partman-partitioning/confirm_write_new_label boolean true</p>
<h1 id="You-can-choose-one-of-the-three-predefined-partitioning-recipes"><a href="#You-can-choose-one-of-the-three-predefined-partitioning-recipes" class="headerlink" title="You can choose one of the three predefined partitioning recipes:"></a>You can choose one of the three predefined partitioning recipes:</h1><h1 id="atomic-all-files-in-one-partition"><a href="#atomic-all-files-in-one-partition" class="headerlink" title="- atomic: all files in one partition"></a>- atomic: all files in one partition</h1><h1 id="home-separate-home-partition"><a href="#home-separate-home-partition" class="headerlink" title="- home:   separate /home partition"></a>- home:   separate /home partition</h1><h1 id="multi-separate-home-usr-var-and-tmp-partitions"><a href="#multi-separate-home-usr-var-and-tmp-partitions" class="headerlink" title="- multi:  separate /home, /usr, /var, and /tmp partitions"></a>- multi:  separate /home, /usr, /var, and /tmp partitions</h1><p>d-i partman-auto/choose_recipe select atomic</p>
<h1 id="If-you-just-want-to-change-the-default-filesystem-from-ext3-to-something"><a href="#If-you-just-want-to-change-the-default-filesystem-from-ext3-to-something" class="headerlink" title="If you just want to change the default filesystem from ext3 to something"></a>If you just want to change the default filesystem from ext3 to something</h1><h1 id="else-you-can-do-that-without-providing-a-full-recipe"><a href="#else-you-can-do-that-without-providing-a-full-recipe" class="headerlink" title="else, you can do that without providing a full recipe."></a>else, you can do that without providing a full recipe.</h1><h1 id="d-i-partman-default-filesystem-string-ext4"><a href="#d-i-partman-default-filesystem-string-ext4" class="headerlink" title="d-i partman/default_filesystem string ext4"></a>d-i partman/default_filesystem string ext4</h1><h1 id="root-account-and-password"><a href="#root-account-and-password" class="headerlink" title="root account and password"></a>root account and password</h1><p>d-i passwd/root-login boolean true<br>d-i passwd/root-password-crypted password $default_password_crypted</p>
<h1 id="skip-creation-of-a-normal-user-account"><a href="#skip-creation-of-a-normal-user-account" class="headerlink" title="skip creation of a normal user account."></a>skip creation of a normal user account.</h1><p>d-i passwd/make-user boolean false</p>
<h1 id="You-can-choose-to-install-restricted-and-universe-software-or-to-install"><a href="#You-can-choose-to-install-restricted-and-universe-software-or-to-install" class="headerlink" title="You can choose to install restricted and universe software, or to install"></a>You can choose to install restricted and universe software, or to install</h1><h1 id="software-from-the-backports-repository"><a href="#software-from-the-backports-repository" class="headerlink" title="software from the backports repository."></a>software from the backports repository.</h1><h1 id="d-i-apt-setup-restricted-boolean-true"><a href="#d-i-apt-setup-restricted-boolean-true" class="headerlink" title="d-i apt-setup/restricted boolean true"></a>d-i apt-setup/restricted boolean true</h1><h1 id="d-i-apt-setup-universe-boolean-true"><a href="#d-i-apt-setup-universe-boolean-true" class="headerlink" title="d-i apt-setup/universe boolean true"></a>d-i apt-setup/universe boolean true</h1><h1 id="d-i-apt-setup-backports-boolean-true"><a href="#d-i-apt-setup-backports-boolean-true" class="headerlink" title="d-i apt-setup/backports boolean true"></a>d-i apt-setup/backports boolean true</h1><h1 id="Uncomment-this-if-you-don’t-want-to-use-a-network-mirror"><a href="#Uncomment-this-if-you-don’t-want-to-use-a-network-mirror" class="headerlink" title="Uncomment this if you don’t want to use a network mirror."></a>Uncomment this if you don’t want to use a network mirror.</h1><h1 id="d-i-apt-setup-use-mirror-boolean-false"><a href="#d-i-apt-setup-use-mirror-boolean-false" class="headerlink" title="d-i apt-setup/use_mirror boolean false"></a>d-i apt-setup/use_mirror boolean false</h1><h1 id="Select-which-update-services-to-use-define-the-mirrors-to-be-used"><a href="#Select-which-update-services-to-use-define-the-mirrors-to-be-used" class="headerlink" title="Select which update services to use; define the mirrors to be used."></a>Select which update services to use; define the mirrors to be used.</h1><h1 id="Values-shown-below-are-the-normal-defaults"><a href="#Values-shown-below-are-the-normal-defaults" class="headerlink" title="Values shown below are the normal defaults."></a>Values shown below are the normal defaults.</h1><h1 id="d-i-apt-setup-services-select-multiselect-security"><a href="#d-i-apt-setup-services-select-multiselect-security" class="headerlink" title="d-i apt-setup/services-select multiselect security"></a>d-i apt-setup/services-select multiselect security</h1><h1 id="d-i-apt-setup-security-host-string-security-ubuntu-com"><a href="#d-i-apt-setup-security-host-string-security-ubuntu-com" class="headerlink" title="d-i apt-setup/security_host string security.ubuntu.com"></a>d-i apt-setup/security_host string security.ubuntu.com</h1><h1 id="d-i-apt-setup-security-path-string-ubuntu"><a href="#d-i-apt-setup-security-path-string-ubuntu" class="headerlink" title="d-i apt-setup/security_path string /ubuntu"></a>d-i apt-setup/security_path string /ubuntu</h1><p>$SNIPPET(‘preseed_apt_repo_config’)</p>
<h1 id="Enable-deb-src-lines"><a href="#Enable-deb-src-lines" class="headerlink" title="Enable deb-src lines"></a>Enable deb-src lines</h1><h1 id="d-i-apt-setup-local0-source-boolean-true"><a href="#d-i-apt-setup-local0-source-boolean-true" class="headerlink" title="d-i apt-setup/local0/source boolean true"></a>d-i apt-setup/local0/source boolean true</h1><h1 id="URL-to-the-public-key-of-the-local-repository-you-must-provide-a-key-or"><a href="#URL-to-the-public-key-of-the-local-repository-you-must-provide-a-key-or" class="headerlink" title="URL to the public key of the local repository; you must provide a key or"></a>URL to the public key of the local repository; you must provide a key or</h1><h1 id="apt-will-complain-about-the-unauthenticated-repository-and-so-the"><a href="#apt-will-complain-about-the-unauthenticated-repository-and-so-the" class="headerlink" title="apt will complain about the unauthenticated repository and so the"></a>apt will complain about the unauthenticated repository and so the</h1><h1 id="sources-list-line-will-be-left-commented-out"><a href="#sources-list-line-will-be-left-commented-out" class="headerlink" title="sources.list line will be left commented out"></a>sources.list line will be left commented out</h1><h1 id="d-i-apt-setup-local0-key-string-http-local-server-key"><a href="#d-i-apt-setup-local0-key-string-http-local-server-key" class="headerlink" title="d-i apt-setup/local0/key string http://local.server/key"></a>d-i apt-setup/local0/key string <a href="http://local.server/key" target="_blank" rel="external">http://local.server/key</a></h1><h1 id="By-default-the-installer-requires-that-repositories-be-authenticated"><a href="#By-default-the-installer-requires-that-repositories-be-authenticated" class="headerlink" title="By default the installer requires that repositories be authenticated"></a>By default the installer requires that repositories be authenticated</h1><h1 id="using-a-known-gpg-key-This-setting-can-be-used-to-disable-that"><a href="#using-a-known-gpg-key-This-setting-can-be-used-to-disable-that" class="headerlink" title="using a known gpg key. This setting can be used to disable that"></a>using a known gpg key. This setting can be used to disable that</h1><h1 id="authentication-Warning-Insecure-not-recommended"><a href="#authentication-Warning-Insecure-not-recommended" class="headerlink" title="authentication. Warning: Insecure, not recommended."></a>authentication. Warning: Insecure, not recommended.</h1><h1 id="d-i-debian-installer-allow-unauthenticated-boolean-true"><a href="#d-i-debian-installer-allow-unauthenticated-boolean-true" class="headerlink" title="d-i debian-installer/allow_unauthenticated boolean true"></a>d-i debian-installer/allow_unauthenticated boolean true</h1><h1 id="Individual-additional-packages-to-install"><a href="#Individual-additional-packages-to-install" class="headerlink" title="Individual additional packages to install"></a>Individual additional packages to install</h1><h1 id="wget-is-REQUIRED-otherwise-quite-a-few-things-won’t-work"><a href="#wget-is-REQUIRED-otherwise-quite-a-few-things-won’t-work" class="headerlink" title="wget is REQUIRED otherwise quite a few things won’t work"></a>wget is REQUIRED otherwise quite a few things won’t work</h1><h1 id="later-in-the-build-like-late-command-scripts"><a href="#later-in-the-build-like-late-command-scripts" class="headerlink" title="later in the build (like late-command scripts)"></a>later in the build (like late-command scripts)</h1><p>d-i pkgsel/include string ntp ssh wget</p>
<h1 id="Use-the-following-option-to-add-additional-boot-parameters-for-the"><a href="#Use-the-following-option-to-add-additional-boot-parameters-for-the" class="headerlink" title="Use the following option to add additional boot parameters for the"></a>Use the following option to add additional boot parameters for the</h1><h1 id="installed-system-if-supported-by-the-bootloader-installer"><a href="#installed-system-if-supported-by-the-bootloader-installer" class="headerlink" title="installed system (if supported by the bootloader installer)."></a>installed system (if supported by the bootloader installer).</h1><h1 id="Note-options-passed-to-the-installer-will-be-added-automatically"><a href="#Note-options-passed-to-the-installer-will-be-added-automatically" class="headerlink" title="Note: options passed to the installer will be added automatically."></a>Note: options passed to the installer will be added automatically.</h1><p>d-i debian-installer/add-kernel-opts string $kernel_options_post</p>
<h1 id="Avoid-that-last-message-about-the-install-being-complete"><a href="#Avoid-that-last-message-about-the-install-being-complete" class="headerlink" title="Avoid that last message about the install being complete."></a>Avoid that last message about the install being complete.</h1><p>d-i finish-install/reboot_in_progress note</p>
<h2 id="Figure-out-if-we’re-kickstarting-a-system-or-a-profile"><a href="#Figure-out-if-we’re-kickstarting-a-system-or-a-profile" class="headerlink" title="Figure out if we’re kickstarting a system or a profile"></a>Figure out if we’re kickstarting a system or a profile</h2><p>#if $getVar(‘system_name’,’’) != ‘’</p>
<p>#set $what = “system”</p>
<p>#else</p>
<p>#set $what = “profile”</p>
<p>#end if</p>
<h1 id="This-first-command-is-run-as-early-as-possible-just-after-preseeding-is-read"><a href="#This-first-command-is-run-as-early-as-possible-just-after-preseeding-is-read" class="headerlink" title="This first command is run as early as possible, just after preseeding is read."></a>This first command is run as early as possible, just after preseeding is read.</h1><h1 id="d-i-preseed-early-command-string-command"><a href="#d-i-preseed-early-command-string-command" class="headerlink" title="d-i preseed/early_command string [command]"></a>d-i preseed/early_command string [command]</h1><p>d-i preseed/early_command string wget -O- \<br>   <a href="http://$http_server/cblr/svc/op/script/$what/$name/?script=preseed_early_default" target="_blank" rel="external">http://$http_server/cblr/svc/op/script/$what/$name/?script=preseed_early_default</a> | \<br>   /bin/sh -s</p>
<h1 id="This-command-is-run-immediately-before-the-partitioner-starts-It-may-be"><a href="#This-command-is-run-immediately-before-the-partitioner-starts-It-may-be" class="headerlink" title="This command is run immediately before the partitioner starts. It may be"></a>This command is run immediately before the partitioner starts. It may be</h1><h1 id="useful-to-apply-dynamic-partitioner-preseeding-that-depends-on-the-state"><a href="#useful-to-apply-dynamic-partitioner-preseeding-that-depends-on-the-state" class="headerlink" title="useful to apply dynamic partitioner preseeding that depends on the state"></a>useful to apply dynamic partitioner preseeding that depends on the state</h1><h1 id="of-the-disks-which-may-not-be-visible-when-preseed-early-command-runs"><a href="#of-the-disks-which-may-not-be-visible-when-preseed-early-command-runs" class="headerlink" title="of the disks (which may not be visible when preseed/early_command runs)."></a>of the disks (which may not be visible when preseed/early_command runs).</h1><h1 id="d-i-partman-early-command"><a href="#d-i-partman-early-command" class="headerlink" title="d-i partman/early_command \"></a>d-i partman/early_command \</h1><h1 id="string-debconf-set-partman-auto-disk-“-list-devices-disk-head-n1-”"><a href="#string-debconf-set-partman-auto-disk-“-list-devices-disk-head-n1-”" class="headerlink" title="string debconf-set partman-auto/disk “\$(list-devices disk | head -n1)”"></a>string debconf-set partman-auto/disk “\$(list-devices disk | head -n1)”</h1><h1 id="This-command-is-run-just-before-the-install-finishes-but-when-there-is"><a href="#This-command-is-run-just-before-the-install-finishes-but-when-there-is" class="headerlink" title="This command is run just before the install finishes, but when there is"></a>This command is run just before the install finishes, but when there is</h1><h1 id="still-a-usable-target-directory-You-can-chroot-to-target-and-use-it"><a href="#still-a-usable-target-directory-You-can-chroot-to-target-and-use-it" class="headerlink" title="still a usable /target directory. You can chroot to /target and use it"></a>still a usable /target directory. You can chroot to /target and use it</h1><h1 id="directly-or-use-the-apt-install-and-in-target-commands-to-easily-install"><a href="#directly-or-use-the-apt-install-and-in-target-commands-to-easily-install" class="headerlink" title="directly, or use the apt-install and in-target commands to easily install"></a>directly, or use the apt-install and in-target commands to easily install</h1><h1 id="packages-and-run-commands-in-the-target-system"><a href="#packages-and-run-commands-in-the-target-system" class="headerlink" title="packages and run commands in the target system."></a>packages and run commands in the target system.</h1><h1 id="d-i-preseed-late-command-string-command"><a href="#d-i-preseed-late-command-string-command" class="headerlink" title="d-i preseed/late_command string [command]"></a>d-i preseed/late_command string [command]</h1><p>d-i preseed/late_command string wget -O- \<br>   <a href="http://$http_server/cblr/svc/op/script/$what/$name/?script=preseed_late_default" target="_blank" rel="external">http://$http_server/cblr/svc/op/script/$what/$name/?script=preseed_late_default</a> | \<br>   chroot /target /bin/sh -s<br>[root@cobbler ~]# </p>
<p>[root@cobbler ~]# mount /dev/cdrom /var/www/html/os/CentOS_6.5-86_64<br>mount: block device /dev/xvdd is write-protected, mounting read-only<br>[root@cobbler ~]# ls /var/www/html/os/CentOS_6.5-86_64<br>CentOS_BuildTag  isolinux                  RPM-GPG-KEY-CentOS-Debug-6<br>EFI              Packages                  RPM-GPG-KEY-CentOS-Security-6<br>EULA             RELEASE-NOTES-en-US.html  RPM-GPG-KEY-CentOS-Testing-6<br>GPL              repodata                  TRANS.TBL<br>images           RPM-GPG-KEY-CentOS-6<br>[root@cobbler ~]#<br>导入系统镜像到cobbler中<br>执行以下语句将镜像挂载到cobbler中<br>[root@cobbler ~]# cobbler import –path=/var/www/html/os/CentOS_6.5-86_64 –name=CentOS_6.5-86_64 –arch=x86_64<br>task started: 2016-06-06_150723_import<br>task started (id=Media import, time=Mon Jun  6 15:07:23 2016)<br>Found a candidate signature: breed=redhat, version=rhel6<br>Found a matching signature: breed=redhat, version=rhel6<br>Adding distros from path /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64:<br>creating new distro: CentOS_6.5-86_64-x86_64<br>trying symlink: /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64 -&gt; /var/www/cobbler/links/CentOS_6.5-86_64-x86_64<br>creating new profile: CentOS_6.5-86_64-x86_64<br>associating repos<br>checking for rsync repo(s)<br>checking for rhn repo(s)<br>checking for yum repo(s)<br>starting descent into /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64 for CentOS_6.5-86_64-x86_64<br>processing repo at : /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64<br>need to process repo/comps: /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64<br>looking for /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64/repodata/<em>comps</em>.xml<br>Keeping repodata as-is :/var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64/repodata<br><strong><em> TASK COMPLETE </em></strong><br>[root@cobbler ~]# </p>
<p>#其中安装源的name即为安装时显示的名称，arch目前支持x86|x86_64|ia64这三种完成后会出现以下提示：associating  kickstarts<strong><em> TASK COMPLETE </em></strong><br>比较大小<br>最后可以通过比较两个文件的大小来判断导入是否正常：<br>[root@cobbler ~]# du -sh /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64<br>4.2G    /var/www/cobbler/ks_mirror/CentOS_6.5-86_64-x86_64<br>[root@cobbler ~]# du -sh /var/www/html/os/CentOS_6.5-86_64<br>4.2G    /var/www/html/os/CentOS_6.5-86_64<br>[root@cobbler ~]</p>
<p>重新导入<br>重新导入之前需要将原来的删除，执行以下命令：<br>cobbler remove -name=[CentOS_6.5-86_64]</p>
<p>cobbler WEB服务<br>yum -y install cobbler-web<br>vim /etc/cobbler/modules.conf<br>module = authn_configfile</p>
<p>#修改认证方式为密码文件类型<br>htdigest /etc/cobbler/users.digest “Cobbler” cobbler</p>
<p>#添加cobbler用户，提示输入2遍密码确认</p>
<p>cobbler sync</p>
<p>#/输出<strong><em> TASK COMPLETE </em></strong> 表示配置无错误<br>/etc/init.d/httpd restart<br>service cobbler restart<br>cobbler check<br><a href="http://10.6.4.3/cobbler_web" target="_blank" rel="external">http://10.6.4.3/cobbler_web</a><br><a href="http://192.168.3.3/cobbler_web" target="_blank" rel="external">http://192.168.3.3/cobbler_web</a></p>
<p>[root@cobbler ~]# vim /var/lib/cobbler/kickstarts/default.ks</p>
<h1 id="kickstart-template-for-Fedora-8-and-later"><a href="#kickstart-template-for-Fedora-8-and-later" class="headerlink" title="kickstart template for Fedora 8 and later."></a>kickstart template for Fedora 8 and later.</h1><h1 id="includes-end-blocks"><a href="#includes-end-blocks" class="headerlink" title="(includes %end blocks)"></a>(includes %end blocks)</h1><h1 id="do-not-use-with-earlier-distros"><a href="#do-not-use-with-earlier-distros" class="headerlink" title="do not use with earlier distros"></a>do not use with earlier distros</h1><p>#platform=x86, AMD64, or Intel EM64T</p>
<h1 id="System-authorization-information"><a href="#System-authorization-information" class="headerlink" title="System authorization information"></a>System authorization information</h1><p>auth  –useshadow  –enablemd5</p>
<h1 id="System-bootloader-configuration"><a href="#System-bootloader-configuration" class="headerlink" title="System bootloader configuration"></a>System bootloader configuration</h1><p>bootloader –location=mbr</p>
<h1 id="Partition-clearing-information"><a href="#Partition-clearing-information" class="headerlink" title="Partition clearing information"></a>Partition clearing information</h1><p>clearpart –all –initlabel<br>part /boot –fstype=ext4 –asprimary –size=200<br>part swap –size=2048<br>part / –fstype=ext4 –grow –asprimary –size=200</p>
<h1 id="Use-text-mode-install"><a href="#Use-text-mode-install" class="headerlink" title="Use text mode install"></a>Use text mode install</h1><p>text</p>
<h1 id="Firewall-configuration"><a href="#Firewall-configuration" class="headerlink" title="Firewall configuration"></a>Firewall configuration</h1><p>firewall –disabled</p>
<h1 id="Run-the-Setup-Agent-on-first-boot"><a href="#Run-the-Setup-Agent-on-first-boot" class="headerlink" title="Run the Setup Agent on first boot"></a>Run the Setup Agent on first boot</h1><p>firstboot –disable</p>
<h1 id="System-keyboard"><a href="#System-keyboard" class="headerlink" title="System keyboard"></a>System keyboard</h1><p>keyboard us</p>
<h1 id="System-language"><a href="#System-language" class="headerlink" title="System language"></a>System language</h1><p>lang en_US</p>
<h1 id="Use-network-installation"><a href="#Use-network-installation" class="headerlink" title="Use network installation"></a>Use network installation</h1><p>url –url=$tree</p>
<h1 id="If-any-cobbler-repo-definitions-were-referenced-in-the-kickstart-profile-include-them-here"><a href="#If-any-cobbler-repo-definitions-were-referenced-in-the-kickstart-profile-include-them-here" class="headerlink" title="If any cobbler repo definitions were referenced in the kickstart profile, include them here."></a>If any cobbler repo definitions were referenced in the kickstart profile, include them here.</h1><p>$yum_repo_stanza</p>
<h1 id="Network-information"><a href="#Network-information" class="headerlink" title="Network information"></a>Network information</h1><p>$SNIPPET(‘network_config’)</p>
<h1 id="Reboot-after-installation"><a href="#Reboot-after-installation" class="headerlink" title="Reboot after installation"></a>Reboot after installation</h1><p>reboot</p>
<p>#Root password<br>rootpw –iscrypted $default_password_crypted</p>
<h1 id="SELinux-configuration"><a href="#SELinux-configuration" class="headerlink" title="SELinux configuration"></a>SELinux configuration</h1><p>selinux –disabled</p>
<h1 id="Do-not-configure-the-X-Window-System"><a href="#Do-not-configure-the-X-Window-System" class="headerlink" title="Do not configure the X Window System"></a>Do not configure the X Window System</h1><p>skipx</p>
<h1 id="System-timezone"><a href="#System-timezone" class="headerlink" title="System timezone"></a>System timezone</h1><p>timezone  Asia/Shanghai</p>
<h1 id="Install-OS-instead-of-upgrade"><a href="#Install-OS-instead-of-upgrade" class="headerlink" title="Install OS instead of upgrade"></a>Install OS instead of upgrade</h1><p>install</p>
<h1 id="Clear-the-Master-Boot-Record"><a href="#Clear-the-Master-Boot-Record" class="headerlink" title="Clear the Master Boot Record"></a>Clear the Master Boot Record</h1><p>zerombr</p>
<h1 id="Allow-anaconda-to-partition-the-system-as-needed"><a href="#Allow-anaconda-to-partition-the-system-as-needed" class="headerlink" title="Allow anaconda to partition the system as needed"></a>Allow anaconda to partition the system as needed</h1><h1 id="autopart"><a href="#autopart" class="headerlink" title="autopart"></a>autopart</h1><p>%pre<br>$SNIPPET(‘log_ks_pre’)<br>$SNIPPET(‘kickstart_start’)<br>$SNIPPET(‘pre_install_network_config’)</p>
<h1 id="Enable-installation-monitoring"><a href="#Enable-installation-monitoring" class="headerlink" title="Enable installation monitoring"></a>Enable installation monitoring</h1><p>$SNIPPET(‘pre_anamon’)<br>%end</p>
<p>%packages<br>@base<br>@core<br>@debugging<br>@basic-desktop<br>@desktop-debugging<br>@desktop-platform<br>@directory-client<br>@fonts<br>@general-desktop<br>@graphical-admin-tools<br>@input-methods<br>@internet-applications<br>@internet-browser<br>@java-platform<br>@legacy-x<br>@network-file-system-client<br>@office-suite<br>@print-client<br>@remote-desktop-clients<br>@server-platform<br>@server-policy<br>@workstation-policy<br>@x11<br>$SNIPPET(‘func_install_if_enabled’)<br>%end</p>
<p>%post –nochroot<br>$SNIPPET(‘log_ks_post_nochroot’)<br>%end</p>
<p>%post<br>$SNIPPET(‘log_ks_post’)</p>
<h1 id="Start-yum-configuration"><a href="#Start-yum-configuration" class="headerlink" title="Start yum configuration"></a>Start yum configuration</h1><p>$yum_config_stanza</p>
<h1 id="End-yum-configuration"><a href="#End-yum-configuration" class="headerlink" title="End yum configuration"></a>End yum configuration</h1><p>$SNIPPET(‘post_install_kernel_options’)<br>$SNIPPET(‘post_install_network_config’)<br>$SNIPPET(‘func_register_if_enabled’)<br>$SNIPPET(‘download_config_files’)<br>$SNIPPET(‘koan_environment’)<br>$SNIPPET(‘redhat_register’)<br>$SNIPPET(‘cobbler_register’)</p>
<h1 id="Enable-post-install-boot-notification"><a href="#Enable-post-install-boot-notification" class="headerlink" title="Enable post-install boot notification"></a>Enable post-install boot notification</h1><p>$SNIPPET(‘post_anamon’)</p>
<h1 id="Start-final-steps"><a href="#Start-final-steps" class="headerlink" title="Start final steps"></a>Start final steps</h1><p>$SNIPPET(‘kickstart_done’)</p>
<h1 id="End-final-steps"><a href="#End-final-steps" class="headerlink" title="End final steps"></a>End final steps</h1><p>%end</p>
<p>service cobbler restart<br>cobbler sync<br>cobbler check</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-Cobbler/" data-id="ciwvcpuhk0008oucyvdnr8mzj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Inotify-Rsync" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-Inotify-Rsync/" class="article-date">
  <time datetime="2016-12-15T03:27:36.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-Inotify-Rsync/">CentOS 6.x Inotify+Rsync</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum -y install lrzsz</p>
<p>[root@rsync ~]#<br>mount -t nfs 10.6.100.75:/volume1/pacebackup /home/nfs/<br>[root@rsync ~]#<br>[root@rsync ~]#<br>[root@rsync ~]# df -h<br>文件系统              容量  已用  可用 已用%% 挂载点<br>/dev/xvda3            195G  5.8G  180G   4% /<br>tmpfs                 497M  228K  496M   1% /dev/shm<br>/dev/xvda1            194M   29M  156M  16% /boot<br>10.6.100.75:/volume1/pacebackup<br>                      5.5T  4.8T  638G  89% /home/nfs</p>
<p>[root@rsync ~]# vim /etc/sysctl.conf<br>fs.inotify.max_user_watches=99999999</p>
<p>CentOS使用inotify+rsync实时同步<br>inotify是Linux下的一个文件系统事件监控机制（简单说就是用于监控某个文件夹的改动），作为dnotify的有效替代。inotify是一种强大的、细粒度的、异步的机制，它满足各种各样的文件监控需要。在单独使用rsync同步时，每次同步它会把全部的文件读取一遍，而inotify+rsync同步是触发式同步。假设被镜像端IP为10.6.0.106，镜像端IP为10.6.0.220。<br>一、被镜像（同步）端<br>linux内核2.6.13之后就支持inotify了，确认方法：<br>ls /proc/sys/fs/inotify<br>如果有以下三项就支持：<br>max_queued_events max_user_instances max_user_watches<br>安装rsync：<br>yum install rsync -y<br>安装inotify：<br>官网：<a href="https://github.com/rvoicilas/inotify-tools" target="_blank" rel="external">https://github.com/rvoicilas/inotify-tools</a><br>cd /tmp<br>wget –no-check-certificate <a href="http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz" target="_blank" rel="external">http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz</a><br>tar -zxvf inotify-tools-3.14.tar.gz<br>cd inotify-tools-3.14<br>./configure<br>make<br>make install<br>默认安装到/usr/local/bin目录。<br>建立rsync密码文件：<br>vim /root/rsync.pass<br>输入密码：<br>123456<br>设置权限为600：<br>chmod 600 /root/rsync.pass<br>创建同步脚本：<br>src=/home/data</p>
<p>vim /root/rsync.sh<br>输入：</p>
<p>#!/bin/bash<br>src=/home/nfs/fir_fs_06/000/000/000<br>src=/home/nfs/fir_fs_06/000/000/016<br>src=/home/nfs/fir_fs_06/000/000/017<br>des=backup@10.6.0.220::rsync<br>/usr/local/bin/inotifywait -mrq –timefmt ‘%d/%m/%y %H:%M’ –format ‘%T %w%f’ \<br>-e modify,delete,create,attrib ${src} \<br>| while read x<br>    do<br>        /usr/bin/rsync -avz –delete –progress $src $des –password-file=/root/rsync.pass &amp;&amp;<br>        echo “$x was rsynced” &gt;&gt; /var/log/rsync.log<br>    done<br>注释：<br>inotifywait<br>-m：保持监听事件。<br>-r：递归查看目录。<br>-q：打印出事件。<br>-e modify,delete,create,attrib：监听写入，删除，创建，属性改变事件。<br>rsync<br>-a：存档模式，相当于使用-rlptgoD。<br>-v：详细模式输出。<br>-z：传输过程中压缩文件。<br>为脚本加执行权限：<br>chmod +x /root/rsync.sh<br>在rc.local加入自启动：<br>echo “/root/rsync.sh” &gt;&gt; /etc/rc.local</p>
<p>ps aux | grep rsync | grep -v grep<br>kill -9<br>[root@rsync ~]# kill -9 7694<br>[root@rsync ~]# ps aux | grep rsync | grep -v grep</p>
<p>/root/rsync.sh &amp;</p>
<p>[root@rsync ~]# cd /home/nfs/fir_fs_06/000/000/016<br>[root@rsync 016]# touch a<br>[root@rsync 016]#</p>
<p>二、镜像（同步）端<br>安装rsync：<br>yum install rsync -y<br>编辑配置文件：<br>vim /etc/rsyncd.conf<br>输入：<br>uid = rsync<br>gid = rsync<br>use chroot = no<br>max connections = 10<br>pid file = /var/run/rsyncd.pid<br>lock file = /var/run/rsync.lock<br>log file = /var/log/rsyncd.log<br>hosts allow = *<br>[rsync]<br>path = /root/pacsrsync/<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass<br>建立密码文件：<br>vim /root/rsync.pass<br>输入：<br>backup:123456<br>格式为“用户名:密码”。<br>设置权限为600：<br>chmod 600 /root/rsync.pass<br>建立保存同步文档的目录：<br>mkdir /home/tzuchi/<br>chown nobody:nobody /home/tzuchi/</p>
<p>chown -R rsync:rsync /root/pacsrsync/<br>后台启动rsync：<br>/usr/bin/rsync –daemon –config=/etc/rsyncd.conf<br>在被镜像端上运行同步脚本：<br>/root/rsync.sh &amp;</p>
<p>日志</p>
<blockquote>
<p>/var/log/rsyncd.log<br>tail -f /var/log/rsyncd.log</p>
</blockquote>
<p>[root@n10 ~]# cd /root/pacsrsync/<br>[root@n10 pacsrsync]# mkdir 016<br>[root@n10 pacsrsync]# chown rsync.rsync 016<br>[root@n10 pacsrsync]# ll<br>总用量 44<br>drwx—— 634 rsync rsync 12288 6月  14 2016 000<br>drwxr-xr-x   2 rsync rsync  4096 6月  13 14:55 001<br>drwx—— 913 rsync rsync 20480 6月  14 2016 016<br>drwx——  16 rsync rsync  4096 6月  13 14:27 262<br>drwxrwxrwx   8 rsync rsync  4096 6月  13 13:26 data<br>[root@n10 pacsrsync]#<br>[root@n10 pacsrsync]# mkdir 017<br>[root@n10 pacsrsync]# chown rsync.rsync 017<br>[root@n10 pacsrsync]# ll<br>总用量 48<br>drwx—— 634 rsync rsync 12288 6月  14 2016 000<br>drwxr-xr-x   2 rsync rsync  4096 6月  13 14:55 001<br>drwx—— 913 rsync rsync 20480 6月  14 2016 016<br>drwxr-xr-x   2 rsync rsync  4096 6月  14 07:24 017<br>drwx——  16 rsync rsync  4096 6月  13 14:27 262<br>drwxrwxrwx   8 rsync rsync  4096 6月  13 13:26 data<br>[root@n10 pacsrsync]#</p>
<p>ps aux | grep rsync | grep -v grep<br>kill -9<br>ps aux | grep rsync | grep -v grep<br>/usr/bin/rsync –daemon –config=/etc/rsyncd.conf</p>
<p>vim /root/rsync.sh</p>
<p>#!/bin/bash<br>inotify_rsync_fun ()<br>{<br>    dir=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $1}&#39;</code><br>    ip=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $2}&#39;</code><br>    des=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $3}&#39;</code><br>    user=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $4}&#39;</code><br>    /usr/local/bin/inotifywait -mrq –timefmt ‘%d/%m/%y %H:%M’ –format ‘%T %w%f’ -e modify,delete,create,attrib ${dir} |while read DATE TIME DIR FILE<br>        do<br>                FILECHAGE=${DIR}${FILE}<br>                /usr/bin/rsync -avz –delete –progress  –password-file=/root/rsync.pass ${dir} ${user}@${ip}::${des} &amp;&amp; echo “At ${TIME} on ${DATE}, file $FILECHAGE was backed up via rsync” &gt;&gt; /var/log/rsync.log<br>        done<br>}<br>count=3</p>
<h1 id="localdir-host-rsync-module-user-of-rsync-module"><a href="#localdir-host-rsync-module-user-of-rsync-module" class="headerlink" title="localdir,host,rsync_module,user of rsync_module,"></a>localdir,host,rsync_module,user of rsync_module,</h1><p>sync1=”/home/nfs/fir_fs_06/000/000/000,10.6.0.220,dir1,backup”<br>sync2=”/home/nfs/fir_fs_06/000/000/016,10.6.0.220,dir2,backup”<br>sync3=”/home/nfs/fir_fs_06/000/000/017,10.6.0.220,dir3,backup”</p>
<p>#############################################################</p>
<p>#main<br>i=0<br>while [ ${i} -lt ${count} ]<br>do<br>    i=<code>expr ${i} + 1</code><br>    tmp=”sync”$i<br>    eval “sync=\$$tmp”<br>    inotify_rsync_fun “$sync” &amp;<br>done</p>
<p>vim /etc/rsyncd.conf<br>uid = rsync<br>gid = rsync<br>use chroot = no<br>max connections = 0<br>pid file = /var/run/rsyncd.pid<br>lock file = /var/run/rsync.lock<br>log file = /var/log/rsyncd.log<br>hosts allow = *</p>
<p>[dir1]<br>path = /root/pacsrsync/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>
<p>[dir2]<br>path = /root/pacsrsync/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>
<p>[dir3]<br>path = /root/pacsrsync/017/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-Inotify-Rsync/" data-id="ciwvcpuhq000eoucystca1gfl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-OpenLDAP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-OpenLDAP/" class="article-date">
  <time datetime="2016-12-15T03:26:25.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-OpenLDAP/">CentOS 6.x OpenLDAP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum -y install openldap<em>  db4</em><br>slappasswd<br>cp /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf</p>
<p>vim /etc/openldap/slapd.conf<br>access to *<br>    by dn.exact=”gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth” read</p>
<h1 id="by-dn-exact-”cn-Manager-dc-my-domain-dc-com”-read"><a href="#by-dn-exact-”cn-Manager-dc-my-domain-dc-com”-read" class="headerlink" title="by dn.exact=”cn=Manager,dc=my-domain,dc=com” read"></a>by dn.exact=”cn=Manager,dc=my-domain,dc=com” read</h1><pre><code>by dn.exact=&quot;cn=admin,dc=example,dc=com&quot; read
    by * none
</code></pre><p>database    bdb</p>
<h1 id="suffix-“dc-my-domain-dc-com”"><a href="#suffix-“dc-my-domain-dc-com”" class="headerlink" title="suffix        “dc=my-domain,dc=com”"></a>suffix        “dc=my-domain,dc=com”</h1><p>suffix          “dc=example,dc=com”<br>checkpoint    1024 15<br>rootdn          “cn=admin,dc=example,dc=com”</p>
<h1 id="rootdn-“cn-Manager-dc-my-domain-dc-com”"><a href="#rootdn-“cn-Manager-dc-my-domain-dc-com”" class="headerlink" title="rootdn        “cn=Manager,dc=my-domain,dc=com”"></a>rootdn        “cn=Manager,dc=my-domain,dc=com”</h1><h1 id="Cleartext-passwords-especially-for-the-rootdn-should"><a href="#Cleartext-passwords-especially-for-the-rootdn-should" class="headerlink" title="Cleartext passwords, especially for the rootdn, should"></a>Cleartext passwords, especially for the rootdn, should</h1><h1 id="be-avoided-See-slappasswd-8-and-slapd-conf-5-for-details"><a href="#be-avoided-See-slappasswd-8-and-slapd-conf-5-for-details" class="headerlink" title="be avoided.  See slappasswd(8) and slapd.conf(5) for details."></a>be avoided.  See slappasswd(8) and slapd.conf(5) for details.</h1><h1 id="Use-of-strong-authentication-encouraged"><a href="#Use-of-strong-authentication-encouraged" class="headerlink" title="Use of strong authentication encouraged."></a>Use of strong authentication encouraged.</h1><h1 id="rootpw-secret"><a href="#rootpw-secret" class="headerlink" title="rootpw        secret"></a>rootpw        secret</h1><h1 id="rootpw-crypt-ijFYNcSNctBYg"><a href="#rootpw-crypt-ijFYNcSNctBYg" class="headerlink" title="rootpw        {crypt}ijFYNcSNctBYg"></a>rootpw        {crypt}ijFYNcSNctBYg</h1><p>rootpw        yanjin</p>
<p>cp /usr/share/openldap-servers/DB_CONFIG.example  /var/lib/ldap/DB_CONFIG<br>rm -rf /etc/openldap/slapd.d/*<br>service slapd restart<br>chkconfig slapd on<br>chown -R ldap:ldap /var/lib/ldap<br>chown -R ldap:ldap /etc/openldap/<br>slaptest  -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d<br>chown -R ldap:ldap /etc/openldap/slapd.d<br>service slapd restart<br>useradd ldapuser1<br>passwd ldapuser1<br>yum install migrationtools -y<br>[root@localhost ~]# cd /usr/share/migrationtools/<br>[root@localhost migrationtools]# vim  migrate_common.ph<br>70 行</p>
<h1 id="DEFAULT-MAIL-DOMAIN-“padl-com”"><a href="#DEFAULT-MAIL-DOMAIN-“padl-com”" class="headerlink" title="$DEFAULT_MAIL_DOMAIN = “padl.com”;"></a>$DEFAULT_MAIL_DOMAIN = “padl.com”;</h1><p>$DEFAULT_MAIL_DOMAIN = “example.com”;</p>
<h1 id="Default-base"><a href="#Default-base" class="headerlink" title="Default base"></a>Default base</h1><h1 id="DEFAULT-BASE-“dc-padl-dc-com”"><a href="#DEFAULT-BASE-“dc-padl-dc-com”" class="headerlink" title="$DEFAULT_BASE = “dc=padl,dc=com”;"></a>$DEFAULT_BASE = “dc=padl,dc=com”;</h1><p>$DEFAULT_BASE = “dc=example,dc=com”;</p>
<p>[root@localhost migrationtools]# ./migrate_base.pl &gt; /tmp/base.ldif<br>[root@localhost migrationtools]# ./migrate_passwd.pl  /etc/passwd &gt; /tmp/passwd.ldif<br>[root@localhost migrationtools]# ./migrate_group.pl  /etc/group &gt; /tmp/group.ldif<br>[root@localhost migrationtools]#</p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/base.ldif</p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/passwd.ldif</p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/group.ldif<br>service slapd restart</p>
<p>导入导出<br>LdapAdmin.exe</p>
<p>10.6.0.19<br>389<br>dc=example,dc=com<br>cn=admin,dc=example,dc=com<br>sztzuchi</p>
<p>dc=example,dc=com<br>cn=admin,dc=example,dc=com<br>yanjin</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-OpenLDAP/" data-id="ciwvcpuht000houcy5kou1zik" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Squid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-Squid/" class="article-date">
  <time datetime="2016-12-15T03:23:48.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-Squid/">CentOS 6.x Squid</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>环境：CentOS6.5 64位</p>
<p>关闭防火墙：<br>service iptables stop （临时关闭）<br>chkconfig iptables off （重启后生效）</p>
<p>关闭SELINUX<br>vim /etc/selinux/config<br>SELINUX=disabled</p>
<p>ssh 登录慢<br>vim /etc/ssh/sshd_config<br>122 UseDNS no<br>/etc/init.d/sshd restart</p>
<p>修改主机名<br>vim /etc/sysconfig/network<br>NETWORKING=yes<br>HOSTNAME=squid</p>
<p>rpm -ivh <a href="http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm" target="_blank" rel="external">http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</a></p>
<p>cd /etc/yum.repos.d/<br>mv cobbler-config.repo cobbler-config.repobak<br>yum clean all<br>yum makecache<br>yum repolist</p>
<p>安装SecureCRT<br>yum -y install lrzsz</p>
<p>安装配置VNC<br>yum -y install tigervnc-server<br>更改配置<br>vim /etc/sysconfig/vncservers<br>VNCSERVERS=”0:root”<br>VNCSERVERARGS[0]=”-geometry 1024x768”<br>设置密码<br>vncpasswd<br>service vncserver start<br>开机启动<br>chkconfig –level 345 vncserver on</p>
<p>NTP<br>yum install ntp -y<br>chkconfig ntpd on<br>vim /etc/ntp.conf<br>server 202.120.2.101 prefer<br>service ntpd start<br>ntpstat</p>
<p>双网卡<br>eth0<br>IP地址：10.6.0.101<br>子网掩码：255.255.255.0<br>网关：10.6.0.128<br>cat /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=eth0<br>BOOTPROTO=none<br>HWADDR=9a:58:98:fb:64:93<br>IPV6INIT=yes<br>MTU=1500<br>NM_CONTROLLED=yes<br>ONBOOT=yes<br>TYPE=Ethernet<br>UUID=”8a6cf2c6-50d5-4118-b343-477b0fe0850c”<br>IPADDR=10.6.0.101<br>NETMASK=255.255.255.0<br>DNS2=114.114.114.114<br>GATEWAY=10.6.0.128<br>DNS1=223.5.5.5<br>USERCTL=no</p>
<p>eth1<br>IP地址：192.168.3.3<br>子网掩码：255.255.255.0<br>ifconfig eth1 192.168.3.3 netmask 255.255.255.0<br>cat /etc/sysconfig/network-scripts/ifcfg-eth1<br>DEVICE=eth0<br>BOOTPROTO=none<br>HWADDR=4E:F7:71:1F:2B:77<br>IPV6INIT=yes<br>MTU=1500<br>NM_CONTROLLED=yes<br>ONBOOT=yes<br>TYPE=Ethernet<br>IPADDR=192.168.3.3<br>NETMASK=255.255.255.0<br>DNS2=114.114.114.114<br>DNS1=223.5.5.5<br>USERCTL=no</p>
<p>安装XenServer Tools<br>mount /dev/cdrom /media/<br>cd /media/Linux/<br>./install.sh<br>You should now reboot this Virtual Machine.<br>快照</p>
<p>普通代理 http_port 3128<br>透明代理 http_port 3128 transparent<br>反向代理 http_port 3128 accel vhost vport</p>
<p>去除显示grep进程<br>ps -ef |grep ‘sbin/squid’ | grep -v grep |wc -l</p>
<p>加载系统函数库<br>. /etc/init.d/functions</p>
<p>日期<br>access_$(date +%F).log</p>
<p>使用yum 方式安装<br>yum -y install squid<br>设置开机自启动<br>chkconfig –level 35 squid on<br>在3、5级别上自动运行squid服务</p>
<p>squid服务器的配置文件说明<br>去#号及去空行<br>egrep -v “#|^$” /etc/squid/squid.conf<br>acl manager proto cache_object<br>acl localhost src 127.0.0.1/32 ::1<br>acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1<br>acl SSL_ports port 443<br>acl CONNECT method CONNECT<br>http_access allow manager localhost<br>http_access deny manager<br>http_access deny !Safe_ports<br>http_access deny CONNECT !SSL_ports<br>http_access allow localnet<br>http_access allow localhost<br>http_access deny all<br>http_port 3128<br>coredump_dir /var/spool/squid<br>refresh_pattern ^ftp:           1440    20%     10080<br>refresh_pattern ^gopher:        1440    0%      1440<br>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0<br>refresh_pattern .               0       20%     4320</p>
<p>cp /etc/squid/squid.conf /etc/squid/squid.confbak<br>squid 的主配置文件是 /etc/squid/squid.conf，所有squid的设定都是在这个文件里配置，下面是一些常用的配置选项。<br>vim /etc/squid/squid.conf<br>http_port　3128<br>设置监听的IP与端口号<br>cache_mem 64 MB<br>额外提供给squid使用的内存，squid的内存总占用为 X <em> 10+15+“cache_mem”，其中X为squid的cache占用的容量（以GB为单位）<br>比如下面的cache大小是100M，即0.1GB，则内存总占用为0.1</em>10+15+64=80M，推荐大小为物理内存的1/3-1/2或更多。<br>maximum_object_size 4 MB<br>设置squid磁盘缓存最大文件，超过4M的文件不保存到硬盘<br>minimum_object_size 0 KB<br>设置squid磁盘缓存最小文件<br>maximum_object_size_in_memory 4096 KB<br>设置squid内存缓存最大文件，超过4M的文件不保存到内存<br>cache_dir ufs /var/spool/squid 100 16 256<br>定义squid的cache存放路径 、cache目录容量（单位M）、一级缓存目录数量、二级缓存目录数量<br>logformat combined %&gt;a %ui %un [%tl] “%rm %ru HTTP/%rv” %Hs %h” “%{User-Agent}&gt;h” %Ss:%Sh<br>emulate_httpd_log on<br>log文件日志格式<br>access_log /var/log/squid/access.log combined<br>log文件存放路径和日志格式<br>cache_log /var/log/squid/cache.log<br>设置缓存日志<br>logfile_rotate 60<br>log轮循 60天<br>cache_swap_high 95<br>cache目录使用量大于95%时，开始清理旧的<br>cachecache_swap_low 90<br>cache目录清理到90%时停止。<br>acl localnet src 10.6.0.0/16<br>定义本地网段<br>http_access allow localnet<br>允许本地网段使用<br>http_access deny all<br>拒绝所有<br>visible_hostname squid.sanyuan.tk<br>主机名<br>cache_mgr example@test.com<br>管理员邮箱</p>
<p>普通代理<br>编辑squid 主配置文件/etc/squid/squid.conf<br>vim /etc/squid/squid.conf</p>
<p>acl manager proto cache_object<br>acl localhost src 127.0.0.1/32 ::1<br>acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1<br>acl CONNECT method CONNECT<br>acl localnet src 10.6.0.0/16<br>http_access allow manager localhost<br>http_access deny manager<br>http_access allow localnet<br>http_access allow localhost<br>http_access deny all<br>http_port 3128<br>coredump_dir /var/spool/squid<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>minimum_object_size 0 KB<br>maximum_object_size_in_memory 4096 KB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>cache_log /var/log/squid/cache.log<br>emulate_httpd_log on<br>logfile_rotate 60<br>cache_swap_high 95<br>cache_swap_low 90<br>visible_hostname squid.sanyuan.tk<br>cache_mgr yanjin198620@126.com<br>refresh_pattern ^ftp:           1440    20%     10080<br>refresh_pattern ^gopher:        1440    0%      1440<br>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0<br>refresh_pattern .               0       20%     4320</p>
<p>mv /etc/squid/squid.conf /etc/squid/squid.confnormal<br>cp /etc/squid/squid.confnormal /etc/squid/squid.conf</p>
<p>example：<br>http_port 3128<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>acl localnet src 10.6.0.0/16<br>http_access allow localnet<br>http_access deny all<br>visible_hostname squid.sanyuan.tk<br>cache_mgr mchina_tang@qq.com</p>
<p>检查语法<br>squid -k parse</p>
<p>初始化<br>squid -z</p>
<p>启动Squid<br>/etc/init.d/squid start<br>chkconfig squid on</p>
<p>ps -ef |grep ‘squid’ | grep -v grep</p>
<p>lsof -i :3128</p>
<p>tail -f /var/log/squid/access.log</p>
<p>透明代理<br>vim /etc/squid/squid.conf</p>
<p>acl manager proto cache_object<br>acl localhost src 127.0.0.1/32 ::1<br>acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1<br>acl CONNECT method CONNECT<br>acl localnet src 10.6.0.0/16<br>http_access allow manager localhost<br>http_access deny manager<br>http_access allow localnet<br>http_access allow localhost<br>http_access allow all<br>http_port 3128 transparent<br>coredump_dir /var/spool/squid<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>minimum_object_size 0 KB<br>maximum_object_size_in_memory 4096 KB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>cache_log /var/log/squid/cache.log<br>emulate_httpd_log on<br>logfile_rotate 60<br>cache_swap_high 95<br>cache_swap_low 90<br>visible_hostname squid.sanyuan.tk<br>cache_mgr yanjin198620@126.com<br>refresh_pattern ^ftp:           1440    20%     10080<br>refresh_pattern ^gopher:        1440    0%      1440<br>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0<br>refresh_pattern .               0       20%     4320</p>
<p>mv /etc/squid/squid.conf /etc/squid/squid.conftransparent</p>
<p>example：<br>http_port 3128 transparent<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>acl localnet src 10.6.0.0/16<br>http_access allow localnet<br>http_access deny all<br>visible_hostname squid.sanyuan.tk<br>cache_mgr mchina_tang@qq.com<br>在http_port 3128 后添加transparent 关键字。</p>
<p>reload<br>reload 让上面的配置生效。<br>/etc/init.d/squid reload</p>
<p>检查语法<br>squid -k parse</p>
<p>ps -ef |grep ‘squid’ | grep -v grep</p>
<p>lsof -i :3128</p>
<p>yum -y install dhcp<br>安装DHCP服务<br>cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.bak<br>备份dhcpd.conf文件<br>vim /etc/dhcp/dhcpd.conf<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>     option routers             192.168.3.3;<br>     option domain-name-servers 223.5.5.5;<br>     option subnet-mask         255.255.255.0;<br>     range dynamic-bootp        192.168.3.6 192.168.3.99;<br>     default-lease-time         21600;<br>     max-lease-time             43200;<br>     next-server                192.168.3.3;<br>}</p>
<p>指定DHCP服务的网络接口<br>vim /etc/sysconfig/dhcpd<br>DHCPDARGS=eth1</p>
<p>service dhcpd start<br>chkconfig dhcpd on</p>
<p>NAT<br>vim /etc/sysctl.conf<br>7 # net.ipv4.ip_forward = 0<br>net.ipv4.ip_forward = 1<br>sysctl -p</p>
<p>添加iptables规则，把内部的http请求重定向到3128端口<br>清除现有iptables filter 表规则<br>iptables -F<br>保存iptables 设置<br>/etc/init.d/iptables save<br>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>iptables -t filter -A FORWARD -i eth0 -o eth1 -j ACCEPT<br>iptables -t filter -A FORWARD -i eth1 -o eth0 -j ACCEPT<br>iptables -t nat -I PREROUTING -i eth1 -s 192.168.3.0/24 -p tcp –dport 80 -j REDIRECT –to-port 3128<br>保存<br>/etc/init.d/iptables save</p>
<p>反向代理</p>
<p>vim /etc/squid/squid.conf</p>
<p>acl manager proto cache_object<br>acl localhost src 127.0.0.1/32 ::1<br>http_access allow manager localhost<br>http_access deny manager<br>http_access allow all<br>http_port 80 accel vhost<br>cache_peer 192.168.3.6 parent 80 0 originserver round-robin weight=1<br>cache_peer 10.6.6.200 parent 80 0 originserver round-robin weight=1<br>coredump_dir /var/spool/squid<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>minimum_object_size 0 KB<br>maximum_object_size_in_memory 4096 KB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>cache_log /var/log/squid/cache.log<br>emulate_httpd_log on<br>logfile_rotate 60<br>cache_swap_high 95<br>cache_swap_low 90<br>visible_hostname squid.sanyuan.tk<br>cache_mgr yanjin198620@126.com<br>refresh_pattern ^ftp:           1440    20%     10080<br>refresh_pattern ^gopher:        1440    0%      1440<br>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0<br>refresh_pattern .               0       20%     4320</p>
<p>mv /etc/squid/squid.conf /etc/squid/squid.confreverse</p>
<p>example：<br>http_port 80 accel vhost<br>http_access allow all<br>cache_peer 192.168.3.6 parent 80 0 originserver round-robin weight=1<br>cache_peer 192.168.3.9 parent 80 0 originserver round-robin weight=1<br>visible_hostname squid.sanyuan.tk</p>
<p>/etc/init.d/squid restart<br>squid 采用了round-robin，所以客户端的访问将轮询两台web服务器，采用 “Ctrl + F5” 来深度刷新测试。</p>
<p>检查语法<br>squid -k parse</p>
<p>ps -ef |grep ‘squid’ | grep -v grep</p>
<p>lsof -i :80</p>
<p>启用验证</p>
<p>yum -y install mysql*</p>
<p>[root@squid mysql_auth-0.8]# vim Makefile</p>
<p>CC = gcc<br>CFLAGS = -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm<br>LDFLAGS = -lmysqlclient<br>SRC = src<br>OBJS = $(SRC)/mysql_auth.o $(SRC)/confparser.o $(SRC)/mypasswd.o<br>INSTALL = /usr/bin/install<br>CONF = $(SRC)/mysql_auth.conf</p>
<p>all : mysql_auth mypasswd</p>
<p>clean:<br>        rm -rf src/<em>.o </em>.o mysql_auth mypasswd</p>
<p>mysql_auth: $(OBJS)<br>        $(CC) -o $@ $(SRC)/mysql_auth.c $(SRC)/confparser.c $(LDFLAGS) $(CFLAGS)</p>
<p>mypasswd: $(OBJS)<br>        $(CC) -o $@ $(SRC)/mypasswd.c $(SRC)/confparser.c $(LDFLAGS) $(CFLAGS)</p>
<p>install:<br>        $(INSTALL) -o nobody -g nogroup -m 755 mysql_auth /etc/squid/mysql_auth<br>        $(INSTALL) -o root -g root -m 700 mypasswd /usr/local/bin/mypasswd<br>        $(INSTALL) -o nobody -g nogroup -m 600 $(CONF) /etc/squid/mysql_auth.conf<br>        $(INSTALL) -o nobody -g nogroup -m 600 $(CONF) /etc/squid/mysql_auth.conf.default</p>
<p>linux-yanjin:~/mysql_auth-0.8/src # vim define.h</p>
<p>#define CONFIG_FILE “/etc/squid/mysql_auth.conf”</p>
<p>#define VAR_MYSQLD_SOCKET “mysql_socket”</p>
<p>#define DEF_MYSQLD_SOCKET “/var/lib/mysql/mysql.sock”</p>
<p>linux-yanjin:~/mysql_auth-0.8/src # vim mysql_auth.conf<br>mysql_socket   /var/lib/mysql/mysql.sock</p>
<p>[root@squid mysql_auth-0.8]# make<br>gcc -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm   -c -o src/mysql_auth.o src/mysql_auth.c<br>gcc -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm   -c -o src/confparser.o src/confparser.c<br>gcc -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm   -c -o src/mypasswd.o src/mypasswd.c<br>gcc -o mysql_auth src/mysql_auth.c src/confparser.c -lmysqlclient -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm<br>gcc -o mypasswd src/mypasswd.c src/confparser.c -lmysqlclient -I /usr/include/mysql -L /usr/lib64/mysql -lz -lm<br>[root@squid mysql_auth-0.8]# make install<br>/usr/bin/install -o nobody -g nogroup -m 755 mysql_auth /etc/squid/mysql_auth<br>/usr/bin/install -o root -g root -m 700 mypasswd /usr/local/bin/mypasswd<br>/usr/bin/install -o nobody -g nogroup -m 600 src/mysql_auth.conf /etc/squid/mysql_auth.conf<br>/usr/bin/install -o nobody -g nogroup -m 600 src/mysql_auth.conf /etc/squid/mysql_auth.conf.default<br>[root@squid mysql_auth-0.8]# cd scripts/<br>[root@squid scripts]# mysql -u root -pyanjin &lt; create_script<br>[root@squid scripts]# mypasswd yanjin 123<br>Password record ADDED succesfully.<br>[root@squid scripts]#</p>
<p>查看mysql_auth table<br>linux-yanjin:~ # mysql -uroot -pyanjin<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 13<br>Server version: 5.0.95-Max SUSE MySQL RPM</p>
<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>
<p>mysql&gt; use mysql_auth;<br>Database changed<br>mysql&gt; select * from data;<br>+——–+———-+<br>| user   | password |<br>+——–+———-+<br>| yanjin | 123      |<br>+——–+———-+<br>1 row in set (0.00 sec)</p>
<p>查看用戶<br>mysql&gt; select user,host,password from mysql.user;<br>+——–+————–+——————————————-+<br>| user   | host         | password                                  |<br>+——–+————–+——————————————-+<br>| root   | localhost    | <em>4327D690FDFB060004FF99724B03EB7303EFEA76 |<br>| root   | linux-yanjin |                                           |<br>| root   | 127.0.0.1    |                                           |<br>|        | localhost    |                                           |<br>|        | linux-yanjin |                                           |<br>| renjia | localhost    | </em>4327D690FDFB060004FF99724B03EB7303EFEA76 |<br>| squid  | localhost    | *AFD42D37182BDB40880BEF624CC64B0F4A1E35B4 |<br>+——–+————–+——————————————-+<br>7 rows in set (0.00 sec)</p>
<p>允许远程访问<br>mysql&gt; use mysql_auth;<br>Database changed<br>mysql&gt; GRANT ALL ON <em>.</em> TO squid@’%’ IDENTIFIED BY ‘squid’ WITH GRANT OPTION;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.03 sec)</p>
<p>mysql&gt;</p>
<p>設置mysql_auth文件權限<br>chmod 777 /etc/squid/mysql_auth.conf</p>
<p>四、配置SQUID.conf<br>[root@squid ~]# vim /etc/squid/squid.conf<br>auth_param basic program /etc/squid/mysql_auth<br>auth_param basic children 5<br>auth_param basic realm squid Proxy web server<br>auth_param basic credentialsttl 2 hours<br>acl manager proto cache_object<br>acl localhost src 127.0.0.1/32 ::1<br>acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1<br>acl CONNECT method CONNECT<br>acl localnet src 10.6.0.0/16<br>acl password proxy_auth REQUIRED<br>http_access allow password<br>http_access allow manager localhost<br>http_access deny manager<br>http_access allow localnet<br>http_access allow localhost<br>http_access deny all<br>http_port 3128<br>coredump_dir /var/spool/squid<br>cache_mem 64 MB<br>maximum_object_size 4 MB<br>minimum_object_size 0 KB<br>maximum_object_size_in_memory 4096 KB<br>cache_dir ufs /var/spool/squid 100 16 256<br>access_log /var/log/squid/access.log<br>cache_log /var/log/squid/cache.log<br>emulate_httpd_log on<br>logfile_rotate 60<br>cache_swap_high 95<br>cache_swap_low 90<br>visible_hostname squid.sanyuan.tk<br>cache_mgr yanjin198620@126.com<br>refresh_pattern ^ftp:           1440    20%     10080<br>refresh_pattern ^gopher:        1440    0%      1440<br>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0<br>refresh_pattern .               0       20%     4320<br>[root@squid ~]#</p>
<p>建立cache文件<br>mkdir -p /var/cache/squida<br>mkdir -p /var/cache/squidb<br>mkdir -p /var/cache/squidc<br>chown -R squid:root /var/cache/squida<br>chown -R squid:root /var/cache/squidb<br>chown -R squid:root /var/cache/squidc<br>chmod 777 /var/cache/squida<br>chmod 777 /var/cache/squidb<br>chmod 777 /var/cache/squidc</p>
<p>[root@squid ~]# vim /etc/squid/squid.conf<br>1、MysQL_auth驗證模塊<br>auth_param basic program /etc/squid/mysql_auth<br>auth_param basic children 5<br>auth_param basic realm squid Proxy web server<br>auth_param basic credentialsttl 2 hours</p>
<p>2、訪問控制列表<br>acl password proxy_auth REQUIRED<br>http_access allow password<br>http_access deny all<br>http_access allow manager localhost<br>http_access deny manager<br>http_access deny !Safe_ports<br>http_access deny CONNECT !SSL_ports<br>http_access allow localnet<br>http_access allow localhost</p>
<p>3、驗證有效期<br>authenticate_ttl 2 hour<br>authenticate_ip_ttl 2 hours</p>
<p>4、squid可以使用的記憶體大小<br>cache_mem 256 MB<br>squid磁片替換策略<br>cache_replacement_policy lru<br>squid記憶體替換策略<br>memory_replacement_policy lru</p>
<p>5、緩存容量閥值<br>cache_swap_low 70<br>cache_swap_high 85</p>
<p>6、squid磁片緩存最大檔<br>maximum_object_size 32768 KB<br>squid記憶體緩存最大檔<br>maximum_object_size_in_memory 4096 KB</p>
<p>7、緩存目錄<br>cache_dir ufs /var/cache/squida 7168 16 256<br>cache_dir ufs /var/cache/squidb 7168 16 256<br>cache_dir ufs /var/cache/squidc 7168 16 256</p>
<p>8、HOSTS<br>hosts_file /etc/hosts</p>
<p>9、主機名<br>visible_hostname squid</p>
<p>10、日誌 2124行<br>cache_access_log /var/log/squid/access.log</p>
<p>11、日誌輪詢<br>logfile_rotate 10</p>
<p>12、日誌輸出方式<br>emulate_httpd_log on</p>
<p>[root@squid ~]# /etc/init.d/squid restart<br>Stopping squid: …………….[  OK  ]<br>Starting squid: .[  OK  ]<br>[root@squid ~]#</p>
<p>tail -f /var/log/squid/access.log</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-Squid/" data-id="ciwvcpui6000poucyix2g1as3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-SendMail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-SendMail/" class="article-date">
  <time datetime="2016-12-15T03:22:18.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-SendMail/">CentOS 6.x SendMail</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>sendmail是Linux下优秀的邮件系统。今天某个网站需要有发邮件的需求，而服务器安装时没有安装这个，那就开始吧。<br>1、安装</p>
<pre><code>#yum install -y sendmail
#yum install -y sendmail-cf
如果需要SMTP验证就安装并启动saslauthd服务：
# service saslauthd start 
</code></pre><p>2、配置        </p>
<p>(1) 配置Senmail的SMTP认证</p>
<h1 id="vi-etc-mail-sendmail-mc"><a href="#vi-etc-mail-sendmail-mc" class="headerlink" title="vi /etc/mail/sendmail.mc"></a>vi /etc/mail/sendmail.mc</h1><p>dnl TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN’)dnl </p>
<p>dnl define(<code>confAUTH_MECHANISMS’,</code>EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN’)dnl </p>
<p>将上面两行的dnl去掉。在sendmail文件中，dnl表示该行为注释行，是无效的，因此通过去除行首的dnl字符串可以开启相应的设置行。</p>
<p>(2) 设置Sendmail服务的网络访问权限（因为我是直接本机调用所以我没有操作这个步骤）</p>
<p>vi /etc/mail/sendmail.mc</p>
<pre><code>DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA‘)dnl 
</code></pre><p>将127.0.0.1改为0.0.0.0，意思是任何主机都可以访问Sendmail服务。如果仅让某一个网段能够访问到Sendmail服务，将127.0.0.1改为形如192.168.1.0/24的一个特定网段地址。<br>3、生成配置文件</p>
<p>Sendmail的配置文件由m4来生成，m4工具在sendmail-cf包中。如果系统无法识别m4命令，说明sendmail-cf软件包没有安装。</p>
<p>#m4 /etc/mail/sendmail.mc &gt; /etc/mail/sendmail.cf<br>4、启动服务</p>
<p>service sendmail start</p>
<p>service sendmail restart</p>
<p>[root@rsync py]#<br>ps aux | grep sendmail | grep -v grep<br>smmsp     9311  0.0  0.2  78136  2140 ?        Ss   14:27   0:00 sendmail: Queue runner@01:00:00 for /var/spool/clientmqueue<br>root      9324  0.0  0.0 103252   852 pts/0    S+   14:29   0:00 grep sendmail<br>[root@rsync py]# </p>
<p>检查服务是否加入自启行列</p>
<p>[root@rsync py]# chkconfig sendmail on<br>[root@rsync py]# chkconfig –list |grep sendmail<br>sendmail        0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭<br>[root@rsync py]# </p>
<p>[root@rsync py]#<br>mail -s xxx 455177385@qq.com<br>xxx<br>EOT<br>你可以把当前shell当成编辑器来用，编辑完内容后Ctrl-D结束</p>
<p>echo “mail content”|mail -s test 455177385@qq.com</p>
<p>mail -s test 455177385@qq.com &lt; file #第三种方法，以file的内容为邮件内容发信</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-SendMail/" data-id="ciwvcpui0000loucy41u3od13" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/5/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/19/书单/">书单</a>
          </li>
        
          <li>
            <a href="/2016/12/15/NGINX日志切割/">NGINX日志切割</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-6-x-安装SVN/">CentOS 6.x 安装SVN</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-7-x-git/">CentOS 7.x git</a>
          </li>
        
          <li>
            <a href="/2016/12/15/开源资源/">开源资源</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>