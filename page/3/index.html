<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Centos-7-x-预配-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Centos-7-x-预配-1/" class="article-date">
  <time datetime="2016-12-19T01:04:53.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Centos-7-x-预配-1/">Centos 7.x 预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>VMware Tools<br>tar -zxvf VMwareTools-*.tar.gz<br>cd vmware-tools-distrib/<br>ls<br>./vmware-install.pl</p>
<p>XenServer Tools<br>mount /dev/cdrom /mnt/<br>mount: /dev/sr0 写保护，将以只读方式挂载<br>cd /mnt/Linux/</p>
<p>[root@CentOS7 ~]# sed -i ‘s#keepcache=0#keepcache=1#g’ /etc/yum.conf<br>[root@CentOS7 ~]# grep keepcache /etc/yum.conf<br>keepcache=1<br>[root@CentOS7 ~]# ls /var/cache/yum/x86_64/7/base/packages/</p>
<p>vim /etc/hostname<br>cat /etc/hostname<br>CentOS7</p>
<p>vim /etc/hosts<br>cat /etc/hosts<br>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br>[root@CentOS7 ~]#</p>
<p>vim /etc/selinux/config<br>[root@CentOS7 ~]# cat /etc/selinux/config</p>
<h1 id="This-file-controls-the-state-of-SELinux-on-the-system"><a href="#This-file-controls-the-state-of-SELinux-on-the-system" class="headerlink" title="This file controls the state of SELinux on the system."></a>This file controls the state of SELinux on the system.</h1><h1 id="SELINUX-can-take-one-of-these-three-values"><a href="#SELINUX-can-take-one-of-these-three-values" class="headerlink" title="SELINUX= can take one of these three values:"></a>SELINUX= can take one of these three values:</h1><h1 id="enforcing-SELinux-security-policy-is-enforced"><a href="#enforcing-SELinux-security-policy-is-enforced" class="headerlink" title="enforcing - SELinux security policy is enforced."></a>enforcing - SELinux security policy is enforced.</h1><h1 id="permissive-SELinux-prints-warnings-instead-of-enforcing"><a href="#permissive-SELinux-prints-warnings-instead-of-enforcing" class="headerlink" title="permissive - SELinux prints warnings instead of enforcing."></a>permissive - SELinux prints warnings instead of enforcing.</h1><h1 id="disabled-No-SELinux-policy-is-loaded"><a href="#disabled-No-SELinux-policy-is-loaded" class="headerlink" title="disabled - No SELinux policy is loaded."></a>disabled - No SELinux policy is loaded.</h1><h1 id="SELINUX-enforcing"><a href="#SELINUX-enforcing" class="headerlink" title="SELINUX=enforcing"></a>SELINUX=enforcing</h1><p>SELINUX=disabled</p>
<h1 id="SELINUXTYPE-can-take-one-of-three-two-values"><a href="#SELINUXTYPE-can-take-one-of-three-two-values" class="headerlink" title="SELINUXTYPE= can take one of three two values:"></a>SELINUXTYPE= can take one of three two values:</h1><h1 id="targeted-Targeted-processes-are-protected"><a href="#targeted-Targeted-processes-are-protected" class="headerlink" title="targeted - Targeted processes are protected,"></a>targeted - Targeted processes are protected,</h1><h1 id="minimum-Modification-of-targeted-policy-Only-selected-processes-are-protected"><a href="#minimum-Modification-of-targeted-policy-Only-selected-processes-are-protected" class="headerlink" title="minimum - Modification of targeted policy. Only selected processes are protected."></a>minimum - Modification of targeted policy. Only selected processes are protected.</h1><h1 id="mls-Multi-Level-Security-protection"><a href="#mls-Multi-Level-Security-protection" class="headerlink" title="mls - Multi Level Security protection."></a>mls - Multi Level Security protection.</h1><p>SELINUXTYPE=targeted</p>
<p>systemctl stop firewalld.service<br>systemctl disable firewalld.service<br>Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.<br>Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.<br>[root@CentOS7 ~]#<br>reboot</p>
<p>getenforce<br>Disabled</p>
<p>查看firewall</p>
<p>快照</p>
<p>rpm -ivh <a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-7.noarch.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-7.noarch.rpm</a><br>yum clean all<br>yum makecache<br>yum repolist</p>
<p>yum install ntp -y<br>systemctl enable ntpd<br>systemctl status ntpd<br>ntpdate -u 202.120.2.101<br>n1<br>vim /etc/ntp.conf<br>server 202.120.2.101 prefer<br>service ntpd start<br>ntpstat</p>
<p>yum groupinstall “Development tools”</p>
<p>克隆 修改为命令行 </p>
<p>CentOS7修改默认运行级别<br>查看状态<br>systemctl get-default<br>修改为命令行<br>systemctl set-default multi-user.target<br>修改为图形<br>systemctl set-default graphical.target</p>
<p>网络设置<br>vim /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=”eth0”<br>BOOTPROTO=none<br>ONBOOT=”yes”<br>IPADDR=192.168.57.3<br>PREFIX=24<br>GATEWAY=192.168.57.2<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5</p>
<p>[root@Centos7-Zabbix ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0<br>TYPE=”Ethernet”<br>BOOTPROTO=”none”<br>DEFROUTE=”yes”<br>IPV4_FAILURE_FATAL=”no”<br>IPV6INIT=”yes”<br>IPV6_AUTOCONF=”yes”<br>IPV6_DEFROUTE=”yes”<br>IPV6_FAILURE_FATAL=”no”<br>NAME=”eth0”<br>UUID=”e228b577-792e-4188-be8c-af777ce949e0”<br>DEVICE=”eth0”<br>ONBOOT=”yes”<br>IPADDR=”10.6.4.103”<br>PREFIX=”24”<br>GATEWAY=”10.6.4.1”<br>DNS1=”61.177.7.1”<br>DOMAIN=”223.5.5.5”<br>IPV6_PEERDNS=”yes”<br>IPV6_PEERROUTES=”yes”<br>IPV6_PRIVACY=”no”<br>[root@Centos7-Zabbix ~]#</p>
<p>yum install lrzsz -y<br>sz download<br>rz upload</p>
<p>保留RPM包<br>sed -i ‘s#keepcache=0#keepcache=1#g’ /etc/yum.conf<br>grep keepcache /etc/yum.conf<br>keepcache=1<br>ls /var/cache/yum/x86_64/7/base/packages/</p>
<p>快照</p>
<p>rpm -qa | grep java<br>rpm -e –nodeps javapackages-tools-3.4.1-5.el7.noarch<br>rpm -e –nodeps java-1.7.0-openjdk-headless-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps python-javapackages-3.4.1-5.el7.noarch<br>rpm -e –nodeps tzdata-java-2014b-1.el7.noarch<br>rpm -qa | grep java</p>
<p>tar -xvf jdk-8u66-linux-x64.tar.gz<br>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.8.0_66/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export PATH=$PATH:${JAVA_HOME}/bin<br>source /etc/profile<br>java -version</p>
<p>wget <a href="https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz" target="_blank" rel="external">https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz</a><br>wget <a href="https://www.python.org/ftp/python/3.4.3/Python-3.4.3.tar.xz" target="_blank" rel="external">https://www.python.org/ftp/python/3.4.3/Python-3.4.3.tar.xz</a></p>
<p>ll -h<br>tar -Jxvf Python-3.4.3.tar.xz<br>mkdir /usr/local/python3<br>cd Python-3.4.3/<br>yum -y install gcc<br>./configure –prefix=/usr/local/python3<br>make<br>make install<br>cd /usr/bin/<br>mv python python2.7<br>ln -s /usr/local/python3/bin/python3 /usr/bin/python<br>python<br>Python 3.4.3 (default, Jun 17 2016, 13:34:53)<br>[GCC 4.8.5 20150623 (Red Hat 4.8.5-4)] on linux<br>Type “help”, “copyright”, “credits” or “license” for more information.</p>
<blockquote>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>vim /usr/bin/yum</p>
<p>#!/usr/bin/python2.7<br>vim /usr/libexec/urlgrabber-ext-down</p>
<p>#! /usr/bin/python2.7</p>
<p>yum -y install ntp</p>
<p>python -V<br>Python 3.4.3<br>python</p>
<p>vim /etc/profile<br>source /etc/profile</p>
<p>uname -a<br>su jinyan<br>mv eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz /home/jinyan/<br>cd /home/jinyan/<br>chown jinyan:jinyan eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz</p>
<p>rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>wget <a href="http://nginx.org/keys/nginx_signing.key" target="_blank" rel="external">http://nginx.org/keys/nginx_signing.key</a><br>rpmkeys –import nginx_signing.key<br>vim /etc/yum.repos.d/nginx.repo<br>rpmkeys -K nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>yum -y install nginx<br>systemctl start nginx<br>systemctl enable nginx<br>systemctl status httpd.service<br>systemctl status nginx.service<br>vim /etc/nginx/nginx.conf </p>
<p>nano /etc/nginx/nginx.conf<br>vim /etc/nginx/nginx.conf<br>nginx -s reload<br>mkdir -p /data/www<br>getenforce<br>echo “This a test page.” &gt;/data/www/index.html</p>
<p>chmod -R 777 /data/www/<br>tail -f /var/log/nginx/error.log<br>cd /data/www/<br>touch favicon.ico<br>ls<br>tail -f /var/log/nginx/error.log<br>nginx -s reload</p>
<p>yum install perl-DBI -y<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>yum install mysql-community-server -y<br>yum -y install mysql-community-client</p>
<p>systemctl start mysqld<br>systemctl enable mysqld<br>systemctl status mysqld<br>netstat -tunlp | grep :3306<br>mysqladmin -uroot password yanjin<br>mysqladmin -uroot password<br>mysqladmin -u root password<br>mysql -uroot -pyanjin</p>
<h1 id="假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话："><a href="#假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话：" class="headerlink" title="假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话："></a>假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话：</h1><p>[root@study ~]# dd if=centos7.iso of=/dev/sdc</p>
<p>时间设置<br>date后面的数字代表月日时分年<br>date 070415522015<br>时间同步<br>/usr/sbin/ntpdate -u 202.120.2.101<br>ntpdate -u 202.120.2.101</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Centos-7-x-预配-1/" data-id="ciwvhh0mf001nr1cyzt04edoi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-安装OpenLDAP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-x-安装OpenLDAP/" class="article-date">
  <time datetime="2016-12-19T01:04:07.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-x-安装OpenLDAP/">CentOS 6.x 安装OpenLDAP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum -y install openldap<em>  db4</em><br>slappasswd<br>cp /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf</p>
<p>vim /etc/openldap/slapd.conf<br>access to *<br>    by dn.exact=”gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth” read</p>
<h1 id="by-dn-exact-”cn-Manager-dc-my-domain-dc-com”-read"><a href="#by-dn-exact-”cn-Manager-dc-my-domain-dc-com”-read" class="headerlink" title="by dn.exact=”cn=Manager,dc=my-domain,dc=com” read"></a>by dn.exact=”cn=Manager,dc=my-domain,dc=com” read</h1><pre><code>by dn.exact=&quot;cn=admin,dc=example,dc=com&quot; read
    by * none
</code></pre><p>database    bdb</p>
<h1 id="suffix-“dc-my-domain-dc-com”"><a href="#suffix-“dc-my-domain-dc-com”" class="headerlink" title="suffix        “dc=my-domain,dc=com”"></a>suffix        “dc=my-domain,dc=com”</h1><p>suffix          “dc=example,dc=com”<br>checkpoint    1024 15<br>rootdn          “cn=admin,dc=example,dc=com”</p>
<h1 id="rootdn-“cn-Manager-dc-my-domain-dc-com”"><a href="#rootdn-“cn-Manager-dc-my-domain-dc-com”" class="headerlink" title="rootdn        “cn=Manager,dc=my-domain,dc=com”"></a>rootdn        “cn=Manager,dc=my-domain,dc=com”</h1><h1 id="Cleartext-passwords-especially-for-the-rootdn-should"><a href="#Cleartext-passwords-especially-for-the-rootdn-should" class="headerlink" title="Cleartext passwords, especially for the rootdn, should"></a>Cleartext passwords, especially for the rootdn, should</h1><h1 id="be-avoided-See-slappasswd-8-and-slapd-conf-5-for-details"><a href="#be-avoided-See-slappasswd-8-and-slapd-conf-5-for-details" class="headerlink" title="be avoided.  See slappasswd(8) and slapd.conf(5) for details."></a>be avoided.  See slappasswd(8) and slapd.conf(5) for details.</h1><h1 id="Use-of-strong-authentication-encouraged"><a href="#Use-of-strong-authentication-encouraged" class="headerlink" title="Use of strong authentication encouraged."></a>Use of strong authentication encouraged.</h1><h1 id="rootpw-secret"><a href="#rootpw-secret" class="headerlink" title="rootpw        secret"></a>rootpw        secret</h1><h1 id="rootpw-crypt-ijFYNcSNctBYg"><a href="#rootpw-crypt-ijFYNcSNctBYg" class="headerlink" title="rootpw        {crypt}ijFYNcSNctBYg"></a>rootpw        {crypt}ijFYNcSNctBYg</h1><p>rootpw        yanjin</p>
<p>cp /usr/share/openldap-servers/DB_CONFIG.example  /var/lib/ldap/DB_CONFIG<br>rm -rf /etc/openldap/slapd.d/*<br>service slapd restart<br>chkconfig slapd on<br>chown -R ldap:ldap /var/lib/ldap<br>chown -R ldap:ldap /etc/openldap/<br>slaptest  -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d<br>chown -R ldap:ldap /etc/openldap/slapd.d<br>service slapd restart<br>useradd ldapuser1<br>passwd ldapuser1<br>yum install migrationtools -y<br>[root@localhost ~]# cd /usr/share/migrationtools/<br>[root@localhost migrationtools]# vim  migrate_common.ph<br>70 行</p>
<h1 id="DEFAULT-MAIL-DOMAIN-“padl-com”"><a href="#DEFAULT-MAIL-DOMAIN-“padl-com”" class="headerlink" title="$DEFAULT_MAIL_DOMAIN = “padl.com”;"></a>$DEFAULT_MAIL_DOMAIN = “padl.com”;</h1><p>$DEFAULT_MAIL_DOMAIN = “example.com”;</p>
<h1 id="Default-base"><a href="#Default-base" class="headerlink" title="Default base"></a>Default base</h1><h1 id="DEFAULT-BASE-“dc-padl-dc-com”"><a href="#DEFAULT-BASE-“dc-padl-dc-com”" class="headerlink" title="$DEFAULT_BASE = “dc=padl,dc=com”;"></a>$DEFAULT_BASE = “dc=padl,dc=com”;</h1><p>$DEFAULT_BASE = “dc=example,dc=com”;</p>
<p>[root@localhost migrationtools]# ./migrate_base.pl &gt; /tmp/base.ldif<br>[root@localhost migrationtools]# ./migrate_passwd.pl  /etc/passwd &gt; /tmp/passwd.ldif<br>[root@localhost migrationtools]# ./migrate_group.pl  /etc/group &gt; /tmp/group.ldif<br>[root@localhost migrationtools]# </p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/base.ldif</p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/passwd.ldif</p>
<p>ldapadd -x -D “cn=admin,dc=example,dc=com” -W -f /tmp/group.ldif<br>service slapd restart</p>
<p>导入导出<br>LdapAdmin.exe</p>
<p>10.6.0.19<br>389<br>dc=example,dc=com<br>cn=admin,dc=example,dc=com<br>sztzuchi</p>
<p>dc=example,dc=com<br>cn=admin,dc=example,dc=com<br>yanjin</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-x-安装OpenLDAP/" data-id="ciwvhh0lw0010r1cy8icib8wr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-7-x-安装zabbix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Centos-7-x-安装zabbix/" class="article-date">
  <time datetime="2016-12-19T01:03:30.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Centos-7-x-安装zabbix/">Centos 7.x 安装zabbix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.zabbix.com/documentation/3.0/manual/web_interface/frontend_sections/administration/authentication" target="_blank" rel="external">https://www.zabbix.com/documentation/3.0/manual/web_interface/frontend_sections/administration/authentication</a><br><a href="https://www.zabbix.com/documentation/3.0/manual/config/notifications/action/operation" target="_blank" rel="external">https://www.zabbix.com/documentation/3.0/manual/config/notifications/action/operation</a><br><a href="http://www.cnblogs.com/hanyifeng/p/5353068.html" target="_blank" rel="external">http://www.cnblogs.com/hanyifeng/p/5353068.html</a><br>zabbix监控服务器由2部分构成，zabbix server与可选组件zabbix agent。<br>　　zabbix server可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD，Open BSD，OS X等平台上。<br>二.基础环境介绍<br>　　1.系统：Centos 7 3.10.0-327.el7.x86_64<br>　　2.编译环境：“Development tools”<br>　　3.zabbix－Server：ip：10.6.4.103/24　（CentOS 7 x86_64）　　　agent：10.6.0.101/24 （centos 6.5 x86_64）<br>三.Zabbix Server端操作<br>1.安装zabbix－server 及所需的mysql组件、zabbix－agent<br>[root@test ~]# rpm -ivh <a href="http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm" target="_blank" rel="external">http://repo.zabbix.com/zabbix/3.0/rhel/7/x86_64/zabbix-release-3.0-1.el7.noarch.rpm</a><br>[root@test ~]# yum install zabbix-server-mysql zabbix-web-mysql -y<br>[root@test ~]# yum install zabbix-agent -y<br>2.由于centos 7 默认的数据库改由mariadb里，甲骨文公司收购了MySQL后，mysql之父便又写了这个数据库。此环境由于需要mysql ，所以下面将下载mysql 源，安装mysql。另外mysql安装完，root没有密码，可以直接登陆，后续如果需要修改密码可登陆数据库修改，或者运行 mysql_secure_installation 初始化工具<br>[root@test ~]# yum install wget -y<br>[root@test ~]# wget <a href="http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm" target="_blank" rel="external">http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</a><br>[root@test ~]# rpm -ivh mysql-community-release-el7-5.noarch.rpm<br>[root@test ~]# yum install mysql-community-server -y<br>[root@test ~]# service mysqld start #或者 systemctl start mysqld.service<br>[root@test ~]# mysql -uroot<br> 创建zabbix 数据库，并授权zabbix用户，以及设置zabbix用户登陆密码为zabbix<br>[root@test ~]# mysql -uroot<br>mysql&gt; create database zabbix character set utf8 collate utf8_bin;<br>mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by ‘zabbix’;<br>mysql&gt; FLUSH PRIVILEGES;<br>mysql&gt; quit;<br>进入zabbix数据库脚本导入的目录，将库数据导入zabbix数据库中。<br>[root@test ~]# cd /usr/share/doc/zabbix-server-mysql-3.0.3/<br>[root@test ~]# zcat create.sql.gz | mysql -uroot -pyanjin zabbix<br>3.修改zabbix－server的配置文件。默认路径在：/etc/zabbix/zabbix_server.conf，修改如下。或者是备份原文件，将下面内容直接替换原有内容，不过后续的修改添加会比较麻烦点。（注意：此处只需修改4处也可以，红色加粗处）<br>复制代码<br>[root@test ~]# grep -v ‘^#’ /etc/zabbix/zabbix_server.conf | grep -v ‘^$’<br>LogFile=/var/log/zabbix/zabbix_server.log<br>LogFileSize=0<br>PidFile=/var/run/zabbix/zabbix_server.pid<br>DBHost=localhost<br>DBName=zabbix<br>DBUser=zabbix<br>DBPassword=zabbix<br>StartPollers=10<br>StartPollersUnreachable=5<br>StartTrappers=5<br>StartPingers=1<br>StartDiscoverers=1<br>SNMPTrapperFile=/var/log/snmptrap/snmptrap.log<br>HousekeepingFrequency=1<br>Timeout=4<br>AlertScriptsPath=/usr/lib/zabbix/alertscripts<br>ExternalScripts=/usr/lib/zabbix/externalscripts<br>LogSlowQueries=3000<br>复制代码<br>3a4</p>
<blockquote>
<p>DBHost=localhost<br>5a7,12<br>DBPassword=zabbix<br>StartPollers=10<br>StartPollersUnreachable=5<br>StartTrappers=5<br>StartPingers=1<br>StartDiscoverers=1<br>6a14<br>HousekeepingFrequency=1</p>
</blockquote>
<p>修改完成后，重启zabbix－server 服务<br>[root@test ~]# systemctl restart zabbix-server<br>问题1:如果出现启动失败，如下所示<br>[root@test ~]# systemctl start zabbix-server<br>Job for zabbix-server.service failed because a fatal signal was delivered to the control process. See “systemctl status zabbix-server.service” and “journalctl -xe” for details.<br>解决方法：先检查selinux是否关闭，关闭后，并安装以下两个软件。再次启动zabbix-server服务便可以启动成功。<br>[root@test ~]# yum install trousers -y<br>[root@test ~]# yum install gnutls -y<br>4.下面修改php 配置文件，修改完成后并重启httpd<br>复制代码<br>[root@test ~]# sed -i “s/; date.timezone =/date.timezone =Asia/Shanghai/g” /etc/php.ini<br>vim /etc/php.ini<br> 878 ;date.timezone =<br> 879 date.timezone = Asia/Shanghai<br>[root@test ~]# vim /etc/httpd/conf.d/zabbix.conf<br>复制代码<br>    <ifmodule mod_php5.c=""><br>        php_value max_execution_time 300<br>        php_value memory_limit 128M<br>        php_value post_max_size 16M<br>        php_value upload_max_filesize 2M<br>        php_value max_input_time 300<br>        php_value always_populate_raw_post_data -1<br>        php_value date.timezone Asia/Shang<br>    </ifmodule><br>复制代码<br>[root@test ~]# systemctl restart httpd<br>复制代码<br>5.将服务添加开机启动项<br>复制代码<br>[root@test ~]# systemctl start zabbix-agent　　　　#竟然才发现没有将zabbix－agent服务启动。<br>[root@test ~]# systemctl enable httpd<br>Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.<br>[root@test ~]# systemctl enable zabbix-server<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-server.service to /usr/lib/systemd/system/zabbix-server.service.<br>[root@test ~]# systemctl enable zabbix-agent<br>Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.<br>复制代码<br>6.那无，现在就可以去客户端访问web安装页面了，<a href="http://10.6.4.103/zabbix。（如果访问不了网站，看下server端的防火墙，systemctl" target="_blank" rel="external">http://10.6.4.103/zabbix。（如果访问不了网站，看下server端的防火墙，systemctl</a> stop firewalld）下面的步骤就不用截图了。按照提示一步一步来操作。</p>
<p>监控Linux<br>7.现在进入zabbix-agent监控端的安装与配置，由于6.5没有3.0的yum源，所以，我们从zabbixcn团队的github上去下载。之后本地安装，如下。<br>[root@agent1 ~]# git clone <a href="https://github.com/zabbixcn/zabbix3.0-rpm.git" target="_blank" rel="external">https://github.com/zabbixcn/zabbix3.0-rpm.git</a><br>[root@agent1 ~]# cd zabbix3.0-rpm/RPMS/<br>[root@agent1 RPMS]# yum localinstall zabbix-agent-3.0.0-1.el6.x86_64.rpm -y<br>8.安装完成后，需要修改zabbix-agent的配置文件/etc/zabbix/zabbix_agentd.conf。修改3处。如下。其中Hostname 是表明在server端添加主机时填入的主机名<br>[root@agent1 ~]# sed -i ‘s/Server=127.0.0.1/Server=10.6.4.103/g’ /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# sed -i ‘s/ServerActive=127.0.0.1/ServerActive=10.6.4.103/g’ /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# sed -i “s/Hostname=Zabbix server/Hostname=agent1/g” /etc/zabbix/zabbix_agentd.conf<br>[root@agent1 ~]# service zabbix-agent start</p>
<p>监控Windows<br>Zabbix agent 在windows上安装部署<br>1、  下载与解压<br>地址: <a href="http://www.zabbix.com/downloads/2.4.0/zabbix_agents_2.4.0.win.zip" target="_blank" rel="external">http://www.zabbix.com/downloads/2.4.0/zabbix_agents_2.4.0.win.zip</a><br>解压zabbix_agents_2.4.0.win.zip<br>conf目录存放是agent配置文件 bin文件存放windows下32位和64位安装程序<br>2、  配置与安装<br>2.1 配置zabbix agent相关配置。<br>   找到conf下的配置文件 zabbix_agentd.win.conf ，修改LogFile、Server、Hostname这三个参数。具体配置如下：<br>LogFile=c:\zabbix_agentd.log<br>Server=10.6.4.103<br>Hostname=Bob-PC<br>ServerActive=10.6.4.103 #zabbix server地址<br>其中logfile是zabbix日志存放地址。Server 是zabbix服务端ip地址。Hostname是本机机器名。<br>2.2 安装agent<br>在windows控制台下执行以下命令：<br>E:\zabbix\bin\win32\zabbix_agentd.exe  -c E:\zabbix\conf\zabbix_agentd.win.conf –i<br>管理员身份运行CMD<br>C:\zabbix_agents_2.4.4.win\bin\win32&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -i<br>zabbix_agentd.exe [9200]: service [Zabbix Agent] installed successfully<br>zabbix_agentd.exe [9200]: event source [Zabbix Agent] installed successfully<br>2.3 启动agent客户端<br>启动命令如下：<br>E:\zabbix\bin\win32\zabbix_agentd.exe  -c E:\zabbix\conf\zabbix_agentd.win.conf –s<br>C:\zabbix_agents_2.4.4.win\bin\win32&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -s<br>启动的程序将以控制台的形式开启。查看启动的日志：<br>  8732:20140912:162313.203 Starting Zabbix Agent [f523540]. Zabbix 2.4.0 (revision 48940).<br>  8732:20140912:162313.203 using configuration file: E:\zabbix\conf\zabbix_agentd.win.conf<br>  8732:20140912:162315.500 agent #0 started [main process]<br>  8820:20140912:162315.500 agent #1 started [collector]<br>  8392:20140912:162315.500 agent #2 started [listener #1]<br>  5552:20140912:162315.500 agent #3 started [listener #2]<br>  9712:20140912:162315.500 agent #4 started [listener #3]<br>  1096:20140912:162315.500 agent #5 started [active checks #1]<br>  1096:20140912:162316.500 active check configuration update from [127.0.0.1:10051] started to fail (cannot connect to [[127.0.0.1]:10051]: [0x0000274D] 由于目标机器积极拒绝，无法连接。)<br>  9368:20140912:163029.578 Starting Zabbix Agent [f523540]. Zabbix 2.4.0 (revision 48940).<br>  9368:20140912:163029.578 using configuration file: E:\zabbix\conf\zabbix_agentd.win.conf</p>
<p>C:\Users\Administrator&gt;cd C:\zabbix_agents_2.4.4.win\bin\win64</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -i<br>zabbix_agentd.exe [7152]: service [Zabbix Agent] installed successfully<br>zabbix_agentd.exe [7152]: event source [Zabbix Agent] installed successfully</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;zabbix_agentd.exe -c C:\zabbix_agents_2.4.4.win\conf\zabbix_agentd.win.conf -s<br>zabbix_agentd.exe [5700]: service [Zabbix Agent] started successfully</p>
<p>C:\zabbix_agents_2.4.4.win\bin\win64&gt;</p>
<p> zabbix3.0配置邮件报警<br>我们部署一套监控软件，报警这一块自然不可或缺，接下来我们看看zabbix如何实现邮件报警。</p>
<p>1、编写发送邮件的脚本<br>zabbix通脚本发送邮件，遵循的传参格式为：<br>脚本   收件人  标题  邮件内容<br>先来看看脚本（sendmail_zabbix.py）：<br>复制代码<br>[root@Centos7-Zabbix ~]# cd /etc/zabbix/<br>[root@Centos7-Zabbix zabbix]# vim sendmail_zabbix.py</p>
<p>#!/usr/bin/python</p>
<p>#coding:utf-8</p>
<p>import smtplib<br>from email.mime.text import MIMEText<br>import sys</p>
<p>mail_host = ‘smtp.126.com’<br>mail_user = ‘yanjin198620@126.com’<br>mail_pass = ‘YANJINrenjia0626’<br>mail_postfix = ‘126.com’</p>
<p>#以上内容根据你的实际情况进行修改</p>
<p>def send_mail(to_list,subject,content):<br>    me = mail_user+”<a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#x22;&#x2b;&#109;&#97;&#x69;&#x6c;&#x5f;&#117;&#115;&#x65;&#114;&#43;&#34;&#x40;&#34;&#43;&#x6d;&#97;&#x69;&#108;&#x5f;&#x70;&#x6f;&#x73;&#116;&#x66;&#105;&#120;&#43;&#x22;">&#x22;&#x2b;&#109;&#97;&#x69;&#x6c;&#x5f;&#117;&#115;&#x65;&#114;&#43;&#34;&#x40;&#34;&#43;&#x6d;&#97;&#x69;&#108;&#x5f;&#x70;&#x6f;&#x73;&#116;&#x66;&#105;&#120;&#43;&#x22;</a>“<br>    msg = MIMEText(content)<br>    msg[‘Subject’] = subject<br>    msg[‘From’] = me<br>    msg[‘to’] = to_list</p>
<pre><code>try:
    s = smtplib.SMTP()
    s.connect(mail_host)
    s.login(mail_user,mail_pass)
    s.sendmail(me,to_list,msg.as_string())
    s.close()
    return True
except Exception,e:
    print str(e)
    return False
</code></pre><p>if <strong>name</strong> == “<strong>main</strong>“:<br>    send_mail(sys.argv[1], sys.argv[2], sys.argv[3])</p>
<p>复制代码<br>2、在zabbix配置文件中指定的脚本路径<br>修改zabbix_server.conf<br>[root@Centos7-Zabbix zabbix]# vim zabbix_server.conf<br>AlertScriptsPath=/etc/zabbix/sendmail_zabbix.py<br>AlertScriptsPath=/data/zabbix/externalscripts  #我的脚本放在此目录下，不同路径手动修改即可<br>[root@Centos7-Zabbix zabbix]# cp sendmail_zabbix.py /usr/lib/zabbix/alertscripts<br>[root@Centos7-Zabbix zabbix]# ls /usr/lib/zabbix/alertscripts<br>sendmail_zabbix.py<br>[root@Centos7-Zabbix zabbix]# </p>
<p>修改完成后重启zabbix_server服务。<br>[root@Centos7-Zabbix ~]# service zabbix-server restart<br>Redirecting to /bin/systemctl restart  zabbix-server.service<br>[root@Centos7-Zabbix ~]#<br>[root@Centos7-Zabbix zabbix]# chmod +x sendmail_zabbix.py<br>[root@Centos7-Zabbix zabbix]# ./sendmail_zabbix.py</p>
<p>3、关联脚本名称<br>【zabbix主面板-&gt;管理-&gt;报警媒介类型-&gt;创建媒体类型】<br>输入脚本名称，类型选择脚本<br>添加以下3个参数，分别对应sendEmail.sh脚本需要的3个参数：收件人地址、主题、详细内容</p>
<p>{ALERT.SENDTO}<br>{ALERT.SUBJECT}<br>{ALERT.MESSAGE}</p>
<p>[root@Centos7-Zabbix zabbix]# ./sendmail_zabbix.py 455177385@qq.com title content</p>
<p>[root@squid ~]# service zabbix-agent stop<br>Shutting down Zabbix agent: [  OK  ]<br>[root@squid ~]# service zabbix-agent start</p>
<p>监控交换机<br>yum -y install net-snmp-libs net-snmp net-snmp-utils<br>snmpwalk -v 2c -c public 10.6.0.134<br>OID: SNMPv2-SMI::enterprises.6486.800.1.1.2.1.11.1.2<br>snmpget -v 2c -c public -On 10.6.0.134 IF-MIB::ifInOctets.1026<br>.1.3.6.1.2.1.2.2.1.10.1026 = Counter32: 4234573034<br>[root@Centos7-Zabbix ~]# snmpget -v 2c -c public -On 10.6.0.134 IF-MIB::ifInOctets.1006<br>.1.3.6.1.2.1.2.2.1.10.1006 = Counter32: 0<br>[root@Centos7-Zabbix ~]# </p>
<p>IF-MIB::ifNumber.0</p>
<p>ifNumber<br>.1.3.6.1.2.1.2.2.1.10.1006</p>
<p>snmpwalk -v 1 -c public 10.6.0.1<br>snmpget -v 1 -c public -On 10.6.0.1 IF-MIB::ifInOctets.1<br>[root@Centos7-Zabbix ~]# snmpget -v 1 -c public -On 10.6.0.1 IF-MIB::ifInOctets.1<br>.1.3.6.1.2.1.2.2.1.10.1 = Counter32: 2764174284<br>[root@Centos7-Zabbix ~]# </p>
<p>snmpwalk -v 2c -c tzuchi 10.6.0.128<br>snmpget -v 2c -c tzuchi -On 10.6.0.128 IF-MIB::ifInOctets.1001<br>[root@Centos7-Zabbix ~]# snmpget -v 2c -c tzuchi -On 10.6.0.128 IF-MIB::ifInOctets.1001<br>.1.3.6.1.2.1.2.2.1.10.1001 = Counter32: 1636141580<br>[root@Centos7-Zabbix ~]# </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Centos-7-x-安装zabbix/" data-id="ciwvhh0me001mr1cy3u3oouum" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-安装sendmail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-x-安装sendmail/" class="article-date">
  <time datetime="2016-12-19T01:02:49.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-x-安装sendmail/">CentOS 6.x 安装sendmail</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>sendmail是Linux下优秀的邮件系统。今天某个网站需要有发邮件的需求，而服务器安装时没有安装这个，那就开始吧。<br>1、安装</p>
<pre><code>#yum install -y sendmail
#yum install -y sendmail-cf
如果需要SMTP验证就安装并启动saslauthd服务：
# service saslauthd start 
</code></pre><p>2、配置        </p>
<p>(1) 配置Senmail的SMTP认证</p>
<h1 id="vi-etc-mail-sendmail-mc"><a href="#vi-etc-mail-sendmail-mc" class="headerlink" title="vi /etc/mail/sendmail.mc"></a>vi /etc/mail/sendmail.mc</h1><p>dnl TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN’)dnl </p>
<p>dnl define(<code>confAUTH_MECHANISMS’,</code>EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN PLAIN’)dnl </p>
<p>将上面两行的dnl去掉。在sendmail文件中，dnl表示该行为注释行，是无效的，因此通过去除行首的dnl字符串可以开启相应的设置行。</p>
<p>(2) 设置Sendmail服务的网络访问权限（因为我是直接本机调用所以我没有操作这个步骤）</p>
<p>vi /etc/mail/sendmail.mc</p>
<pre><code>DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA‘)dnl 
</code></pre><p>将127.0.0.1改为0.0.0.0，意思是任何主机都可以访问Sendmail服务。如果仅让某一个网段能够访问到Sendmail服务，将127.0.0.1改为形如192.168.1.0/24的一个特定网段地址。<br>3、生成配置文件</p>
<p>Sendmail的配置文件由m4来生成，m4工具在sendmail-cf包中。如果系统无法识别m4命令，说明sendmail-cf软件包没有安装。</p>
<p>#m4 /etc/mail/sendmail.mc &gt; /etc/mail/sendmail.cf<br>4、启动服务</p>
<p>service sendmail start</p>
<p>service sendmail restart</p>
<p>[root@rsync py]#<br>ps aux | grep sendmail | grep -v grep<br>smmsp     9311  0.0  0.2  78136  2140 ?        Ss   14:27   0:00 sendmail: Queue runner@01:00:00 for /var/spool/clientmqueue<br>root      9324  0.0  0.0 103252   852 pts/0    S+   14:29   0:00 grep sendmail<br>[root@rsync py]# </p>
<p>检查服务是否加入自启行列</p>
<p>[root@rsync py]# chkconfig sendmail on<br>[root@rsync py]# chkconfig –list |grep sendmail<br>sendmail        0:关闭  1:关闭  2:启用  3:启用  4:启用  5:启用  6:关闭<br>[root@rsync py]# </p>
<p>[root@rsync py]#<br>mail -s xxx 455177385@qq.com<br>xxx<br>EOT<br>你可以把当前shell当成编辑器来用，编辑完内容后Ctrl-D结束</p>
<p>echo “mail content”|mail -s test 455177385@qq.com</p>
<p>mail -s test 455177385@qq.com &lt; file #第三种方法，以file的内容为邮件内容发信</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-x-安装sendmail/" data-id="ciwvhh0ly0014r1cykg2p30vr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-安装inotify-rsync" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-x-安装inotify-rsync/" class="article-date">
  <time datetime="2016-12-19T01:01:56.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-x-安装inotify-rsync/">CentOS 6.x 安装inotify+rsync</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>替换空行，勾选使用正则表达式<br>^[\s\t]*\n<br>空白</p>
<p>yum -y install lrzsz</p>
<p>[root@rsync ~]#<br>mount -t nfs 10.6.100.75:/volume1/pacebackup /home/nfs/<br>[root@rsync ~]#<br>[root@rsync ~]#<br>[root@rsync ~]# df -h<br>文件系统              容量  已用  可用 已用%% 挂载点<br>/dev/xvda3            195G  5.8G  180G   4% /<br>tmpfs                 497M  228K  496M   1% /dev/shm<br>/dev/xvda1            194M   29M  156M  16% /boot<br>10.6.100.75:/volume1/pacebackup<br>                      5.5T  4.8T  638G  89% /home/nfs</p>
<p>[root@rsync ~]# vim /etc/sysctl.conf<br>fs.inotify.max_user_watches=99999999</p>
<p>CentOS使用inotify+rsync实时同步<br>inotify是Linux下的一个文件系统事件监控机制（简单说就是用于监控某个文件夹的改动），作为dnotify的有效替代。inotify是一种强大的、细粒度的、异步的机制，它满足各种各样的文件监控需要。在单独使用rsync同步时，每次同步它会把全部的文件读取一遍，而inotify+rsync同步是触发式同步。假设被镜像端IP为10.6.0.106，镜像端IP为10.6.0.220。<br>一、被镜像（同步）端<br>linux内核2.6.13之后就支持inotify了，确认方法：<br>ls /proc/sys/fs/inotify<br>如果有以下三项就支持：<br>max_queued_events max_user_instances max_user_watches<br>安装rsync：<br>yum install rsync -y<br>安装inotify：<br>官网：<a href="https://github.com/rvoicilas/inotify-tools" target="_blank" rel="external">https://github.com/rvoicilas/inotify-tools</a><br>cd /tmp<br>wget –no-check-certificate <a href="http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz" target="_blank" rel="external">http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz</a><br>tar -zxvf inotify-tools-3.14.tar.gz<br>cd inotify-tools-3.14<br>./configure<br>make<br>make install<br>默认安装到/usr/local/bin目录。<br>建立rsync密码文件：<br>vim /root/rsync.pass<br>输入密码：<br>123456<br>设置权限为600：<br>chmod 600 /root/rsync.pass<br>创建同步脚本：<br>src=/home/data</p>
<p>vim /root/rsync.sh<br>输入：</p>
<p>#!/bin/bash<br>src=/home/nfs/fir_fs_06/000/000/000<br>src=/home/nfs/fir_fs_06/000/000/016<br>src=/home/nfs/fir_fs_06/000/000/017<br>des=backup@10.6.0.220::rsync<br>/usr/local/bin/inotifywait -mrq –timefmt ‘%d/%m/%y %H:%M’ –format ‘%T %w%f’ \<br>-e modify,delete,create,attrib ${src} \<br>| while read x<br>    do<br>        /usr/bin/rsync -avz –delete –progress $src $des –password-file=/root/rsync.pass &amp;&amp;<br>        echo “$x was rsynced” &gt;&gt; /var/log/rsync.log<br>    done<br>注释：<br>inotifywait<br>-m：保持监听事件。<br>-r：递归查看目录。<br>-q：打印出事件。<br>-e modify,delete,create,attrib：监听写入，删除，创建，属性改变事件。<br>rsync<br>-a：存档模式，相当于使用-rlptgoD。<br>-v：详细模式输出。<br>-z：传输过程中压缩文件。<br>为脚本加执行权限：<br>chmod +x /root/rsync.sh<br>在rc.local加入自启动：<br>echo “/root/rsync.sh” &gt;&gt; /etc/rc.local</p>
<p>ps aux | grep rsync | grep -v grep<br>kill -9<br>[root@rsync ~]# kill -9 7694<br>[root@rsync ~]# ps aux | grep rsync | grep -v grep</p>
<p>/root/rsync.sh &amp;</p>
<p>[root@rsync ~]# cd /home/nfs/fir_fs_06/000/000/016<br>[root@rsync 016]# touch a<br>[root@rsync 016]#</p>
<p>二、镜像（同步）端<br>安装rsync：<br>yum install rsync -y<br>编辑配置文件：<br>vim /etc/rsyncd.conf<br>输入：<br>uid = rsync<br>gid = rsync<br>use chroot = no<br>max connections = 10<br>pid file = /var/run/rsyncd.pid<br>lock file = /var/run/rsync.lock<br>log file = /var/log/rsyncd.log<br>hosts allow = *<br>[rsync]<br>path = /root/pacsrsync/<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass<br>建立密码文件：<br>vim /root/rsync.pass<br>输入：<br>backup:123456<br>格式为“用户名:密码”。<br>设置权限为600：<br>chmod 600 /root/rsync.pass<br>建立保存同步文档的目录：<br>mkdir /home/tzuchi/<br>chown nobody:nobody /home/tzuchi/</p>
<p>chown -R rsync:rsync /root/pacsrsync/<br>后台启动rsync：<br>/usr/bin/rsync –daemon –config=/etc/rsyncd.conf<br>在被镜像端上运行同步脚本：<br>/root/rsync.sh &amp;</p>
<p>日志</p>
<blockquote>
<p>/var/log/rsyncd.log<br>tail -f /var/log/rsyncd.log</p>
</blockquote>
<p>[root@n10 ~]# cd /root/pacsrsync/<br>[root@n10 pacsrsync]# mkdir 016<br>[root@n10 pacsrsync]# chown rsync.rsync 016<br>[root@n10 pacsrsync]# ll<br>总用量 44<br>drwx—— 634 rsync rsync 12288 6月  14 2016 000<br>drwxr-xr-x   2 rsync rsync  4096 6月  13 14:55 001<br>drwx—— 913 rsync rsync 20480 6月  14 2016 016<br>drwx——  16 rsync rsync  4096 6月  13 14:27 262<br>drwxrwxrwx   8 rsync rsync  4096 6月  13 13:26 data<br>[root@n10 pacsrsync]#<br>[root@n10 pacsrsync]# mkdir 017<br>[root@n10 pacsrsync]# chown rsync.rsync 017<br>[root@n10 pacsrsync]# ll<br>总用量 48<br>drwx—— 634 rsync rsync 12288 6月  14 2016 000<br>drwxr-xr-x   2 rsync rsync  4096 6月  13 14:55 001<br>drwx—— 913 rsync rsync 20480 6月  14 2016 016<br>drwxr-xr-x   2 rsync rsync  4096 6月  14 07:24 017<br>drwx——  16 rsync rsync  4096 6月  13 14:27 262<br>drwxrwxrwx   8 rsync rsync  4096 6月  13 13:26 data<br>[root@n10 pacsrsync]# </p>
<p>ps aux | grep rsync | grep -v grep<br>kill -9<br>ps aux | grep rsync | grep -v grep<br>/usr/bin/rsync –daemon –config=/etc/rsyncd.conf</p>
<p>vim /root/rsync.sh</p>
<p>#!/bin/bash<br>inotify_rsync_fun ()<br>{<br>    dir=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $1}&#39;</code><br>    ip=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $2}&#39;</code><br>    des=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $3}&#39;</code><br>    user=<code>echo $1 | awk -F&quot;,&quot; &#39;{print $4}&#39;</code><br>    /usr/local/bin/inotifywait -mrq –timefmt ‘%d/%m/%y %H:%M’ –format ‘%T %w%f’ -e modify,delete,create,attrib ${dir} |while read DATE TIME DIR FILE<br>        do<br>                FILECHAGE=${DIR}${FILE}<br>                /usr/bin/rsync -avz –delete –progress  –password-file=/root/rsync.pass ${dir} ${user}@${ip}::${des} &amp;&amp; echo “At ${TIME} on ${DATE}, file $FILECHAGE was backed up via rsync” &gt;&gt; /var/log/rsync.log<br>        done<br>}<br>count=3</p>
<h1 id="localdir-host-rsync-module-user-of-rsync-module"><a href="#localdir-host-rsync-module-user-of-rsync-module" class="headerlink" title="localdir,host,rsync_module,user of rsync_module,"></a>localdir,host,rsync_module,user of rsync_module,</h1><p>sync1=”/home/nfs/fir_fs_06/000/000/000,10.6.0.220,dir1,backup”<br>sync2=”/home/nfs/fir_fs_06/000/000/016,10.6.0.220,dir2,backup”<br>sync3=”/home/nfs/fir_fs_06/000/000/017,10.6.0.220,dir3,backup”</p>
<p>#############################################################</p>
<p>#main<br>i=0<br>while [ ${i} -lt ${count} ]<br>do<br>    i=<code>expr ${i} + 1</code><br>    tmp=”sync”$i<br>    eval “sync=\$$tmp”<br>    inotify_rsync_fun “$sync” &amp;<br>done</p>
<p>vim /etc/rsyncd.conf<br>uid = rsync<br>gid = rsync<br>use chroot = no<br>max connections = 0<br>pid file = /var/run/rsyncd.pid<br>lock file = /var/run/rsync.lock<br>log file = /var/log/rsyncd.log<br>hosts allow = *</p>
<p>[dir1]<br>path = /root/pacsrsync/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>
<p>[dir2]<br>path = /root/pacsrsync/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>
<p>[dir3]<br>path = /root/pacsrsync/017/<br>comment = rsync from everyone<br>read only = no<br>list = no<br>auth users = backup<br>secrets file = /root/rsync.pass</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-x-安装inotify-rsync/" data-id="ciwvhh0ly0013r1cy32qr1ryd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-moodle在CentOS-6-x-下的迁移" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/moodle在CentOS-6-x-下的迁移/" class="article-date">
  <time datetime="2016-12-19T01:00:14.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/moodle在CentOS-6-x-下的迁移/">moodle在CentOS 6.x 下的迁移</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>10.6.0.76<br>[root@sztzuchi opt]# tar -zxvf moodle-latest-28.tgz<br>[root@sztzuchi opt]# mv moodle /opt/lampp/htdocs/<br>[root@tzuchi opt]# chmod -R 777 /opt/lampp/<br>sz^215Tzuchi</p>
<p>[root@tzuchi ~]# vim /opt/lampp/htdocs/moodle/config.php<br>// $CFG-&gt;wwwroot   = ‘<a href="http://tzuchi.elearning/moodle" target="_blank" rel="external">http://tzuchi.elearning/moodle</a>‘;<br>$CFG-&gt;wwwroot   = ‘<a href="http://10.6.0.20/moodle" target="_blank" rel="external">http://10.6.0.20/moodle</a>‘;<br>$CFG-&gt;dataroot  = ‘/opt/lampp/moodledata’;<br>$CFG-&gt;admin     = ‘admin’;</p>
<p>$CFG-&gt;directorypermissions = 0777;</p>
<p>scp -r  root@10.6.0.75:/backup/backup/moodle /opt<br>scp -r  root@10.6.0.75:/backup/backup/moodledata /opt<br>scp -r  root@10.6.0.75:/backup/backup/moodle.sql /opt</p>
<p>[root@sztzuchi opt]# cd /opt/lampp/htdocs/<br>[root@sztzuchi htdocs]# ls<br>applications.html  dashboard    img        moodle     xampp<br>bitnami.css        favicon.ico  index.php  webalizer<br>[root@sztzuchi htdocs]# mkdir /backup<br>[root@sztzuchi htdocs]# mv moodle/ /backup/<br>[root@sztzuchi htdocs]# ls /backup/<br>moodle<br>[root@sztzuchi htdocs]# cd ..<br>[root@sztzuchi lampp]# ls<br>apache2       etc      lib                    modules     properties.ini  var<br>bin           htdocs   libexec                moodledata  RELEASENOTES    xampp<br>build         icons    licenses               mysql       sbin<br>cgi-bin       img      logs                   pear        share<br>ctlscript.sh  include  man                    php         temp<br>docs          info     manager-linux-x64.run  phpmyadmin  uninstall<br>error         lampp    manual                 proftpd     uninstall.dat<br>[root@sztzuchi lampp]# mv moodledata/ /backup/<br>[root@sztzuchi lampp]# cd htdocs/<br>[root@sztzuchi htdocs]# mv /opt/moodle .<br>[root@sztzuchi htdocs]# cd ..<br>[root@sztzuchi lampp]# mv /opt/moodledata/ .<br>[root@sztzuchi lampp]# vim /opt/lampp/htdocs/moodle/config.php<br>$CFG-&gt;dbuser    = ‘root’;<br>$CFG-&gt;dbpass    = ‘sztzuchi’;<br>$CFG-&gt;wwwroot   = ‘<a href="http://10.6.0.20/moodle" target="_blank" rel="external">http://10.6.0.20/moodle</a>‘;</p>
<p>[root@sztzuchi opt]# vim moodle.sql<br>:1,$s/10.6.0.76/10.6.0.20/g</p>
<p>/opt/lampp/bin/mysql -uroot -psztzuchi<br>drop database moodle;:<br>create  database  moodle;<br>SHOW DATABASES;    /<em>这可以查看到所有的数据库名称</em>/<br>exit</p>
<p>/opt/lampp/bin/mysql -uroot -p moodle &lt; /opt/moodle.sql</p>
<p>[root@sztzuchi opt]# chmod 777 -R /opt/lampp/<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/backup/moodle.sql 2&gt;/dev/null</p>
<p>10.6.0.75<br>[root@tzuchi ~]# /opt/lampp/bin/mysqladmin -u root password yanjin</p>
<p>[root@tzuchi ~]# vim /opt/lampp/htdocs/moodle/config.php<br>$CFG-&gt;dbuser    = ‘root’;<br>$CFG-&gt;dbpass    = ‘yanjin’;<br>$CFG-&gt;prefix    = ‘mdl_’;</p>
<p>crontab -e<br><em>/5 </em> <em> </em> * /opt/lampp/bin/php /opt/lampp/htdocs/moodle/admin/cli/cron.php &gt;/dev/null</p>
<p>[root@tzuchi backup]# cat copy.sh </p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /backup/backup<br>cp -r /opt/lampp/moodledata /backup/backup<br>/opt/lampp/bin/mysqldump -uroot -p’yanjin’ moodle&gt;/backup/backup/moodle.sql 2&gt;/dev/null</p>
<p>vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /home/backup<br>cp -r /opt/lampp/moodledata/ /home/backup<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/home/backup/moodle.sql 2&gt;/dev/null</p>
<p>[root@tzuchi backup]# vim elearningbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_Elearning”<br>tar -cjPf $basedir/elearning.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=elearning.$(date +%Y-%m-%d).tar.bz2<br>rmfile=elearning.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>[root@tzuchi backup]# </p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/elearningbackup.sh</p>
<p>[root@sztzuchi ~]# vim /opt/lampp/phpmyadmin/config.inc.php<br>$cfg[‘Servers’][$i][‘auth_type’] = ‘cookie’;<br>$cfg[‘Servers’][$i][‘user’] = ‘root’;<br>$cfg[‘Servers’][$i][‘password’] = ‘yanjin’;</p>
<p>[root@sztzuchi ~]# vim /opt/lampp/phpmyadmin/libraries/config.default.php<br>$cfg[‘CheckConfigurationPermissions’] = true;<br>$cfg[‘CheckConfigurationPermissions’] = false;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/moodle在CentOS-6-x-下的迁移/" data-id="ciwvhh0ng0038r1cyps0hcztu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Centos-6-x-DHCP-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Centos-6-x-DHCP-1/" class="article-date">
  <time datetime="2016-12-19T00:59:24.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Centos-6-x-DHCP-1/">Centos 6.x DHCP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum –y install dhcp   //安装DHCP服务<br>cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.bak    //备份dhcpd.conf文件<br>[root@server ~]# vim /etc/dhcp/dhcpd.conf</p>
<p>#</p>
<h1 id="DHCP-Server-Configuration-file"><a href="#DHCP-Server-Configuration-file" class="headerlink" title="DHCP Server Configuration file."></a>DHCP Server Configuration file.</h1><h1 id="see-usr-share-doc-dhcp-dhcpd-conf-sample"><a href="#see-usr-share-doc-dhcp-dhcpd-conf-sample" class="headerlink" title="see /usr/share/doc/dhcp*/dhcpd.conf.sample"></a>see /usr/share/doc/dhcp*/dhcpd.conf.sample</h1><h1 id="see-‘man-5-dhcpd-conf’"><a href="#see-‘man-5-dhcpd-conf’" class="headerlink" title="see ‘man 5 dhcpd.conf’"></a>see ‘man 5 dhcpd.conf’</h1><p>#<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>        range 192.168.3.100 192.168.3.200;<br>        option subnet-mask 255.255.255.0;<br>        option domain-name-servers 114.114.114.114;<br>        option domain-name-servers 223.5.5.5;<br>        default-lease-time 21600;<br>        max-lease-time 43200;<br>        next-server 192.168.3.3;<br>        filename “/pxelinux.0”;<br>}<br>“/etc/dhcp/dhcpd.conf” 15L, 455C written<br>[root@server ~]# /etc/init.d/dhcpd restart<br>Shutting down dhcpd: [  OK  ]<br>Starting dhcpd: [  OK  ]<br>[root@server ~]# </p>
<p>service dhcpd start  //启动服务<br>chkconfig dhcpd on  //设为开机启动<br>[root@localhost ~]# vim /etc/sysconfig/dhcpd</p>
<h1 id="Command-line-options-here"><a href="#Command-line-options-here" class="headerlink" title="Command line options here"></a>Command line options here</h1><p>DHCPDARGS=eth1</p>
<p>/etc/init.d/dhcpd restart</p>
<p>client<br>注释掉client的静态IP配置，BOOTPROTO更改为dhcp<br>/etc/init.d/network restart<br>[root@localhost ~]# crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]#</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]# cat /root/dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>[root@localhost ~]#</p>
<p>dhcp<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>tail -f /var/lib/dhcpd/dhcpd.leases<br>vim /var/lib/dhcpd/dhcpd.leases<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>DHCP<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>cat /var/lib/dhcpd/dhcpd.leases |awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’<br>awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’ /var/lib/dhcpd/dhcpd.leases</p>
<p>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’<br>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’|sort -n</p>
<p>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>[root@localhost ~]# vim /etc/dhcp/dhcpd.conf</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro"><a href="#host-WudeMacBook-Pro" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187"><a href="#fixed-address-10-6-4-187" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id=""><a href="#" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>“/etc/dhcp/dhcpd.conf” 138L, 3153C                            85,0-1        63%<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-1"><a href="#host-WudeMacBook-Pro-1" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-1"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-1" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-1"><a href="#fixed-address-10-6-4-187-1" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-1"><a href="#-1" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>[root@localhost ~]# cat /etc/dhcp/dhcpd.conf<br>#</p>
<h1 id="DHCP-Server-Configuration-file-1"><a href="#DHCP-Server-Configuration-file-1" class="headerlink" title="DHCP Server Configuration file."></a>DHCP Server Configuration file.</h1><h1 id="see-usr-share-doc-dhcp-dhcpd-conf-sample-1"><a href="#see-usr-share-doc-dhcp-dhcpd-conf-sample-1" class="headerlink" title="see /usr/share/doc/dhcp*/dhcpd.conf.sample"></a>see /usr/share/doc/dhcp*/dhcpd.conf.sample</h1><h1 id="see-‘man-5-dhcpd-conf’-1"><a href="#see-‘man-5-dhcpd-conf’-1" class="headerlink" title="see ‘man 5 dhcpd.conf’"></a>see ‘man 5 dhcpd.conf’</h1><p>#<br>ddns-update-style none;<br>ignore client-updates;<br>authoritative;<br>shared-network network_tag {<br>subnet 10.6.0.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.1.0 netmask 255.255.255.0 {</p>
<pre><code>option routers                  10.6.1.1;
option subnet-mask              255.255.255.0;
option domain-name-servers      61.177.7.1;
option domain-name-servers      114.114.114.114;
range  10.6.1.65 10.6.1.127;
default-lease-time 36000;
max-lease-time 72000;
</code></pre><h1 id="host-WudeMacBook-Pro-2"><a href="#host-WudeMacBook-Pro-2" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-3c-15-c2-df-93-c4"><a href="#hardware-ethernet-3c-15-c2-df-93-c4" class="headerlink" title="hardware ethernet 3c:15:c2:df:93:c4;"></a>hardware ethernet 3c:15:c2:df:93:c4;</h1><h1 id="fixed-address-10-6-1-35"><a href="#fixed-address-10-6-1-35" class="headerlink" title="fixed-address 10.6.1.35;"></a>fixed-address 10.6.1.35;</h1><h1 id="-2"><a href="#-2" class="headerlink" title="}"></a>}</h1><p>host HCP-SZOFFICE{<br>hardware ethernet 24:0a:64:b2:b3:d3;<br>fixed-address 10.6.1.50;<br>}</p>
<p>host c2laboratory03{<br>hardware ethernet 8c:89:a5:cf:90:ce;<br>fixed-address 10.6.1.54;<br>}</p>
<p>host zhuang-3{<br>hardware ethernet 54:ee:75:33:8b:fe;<br>fixed-address 10.6.1.56;<br>}</p>
<p>host zhuang-2{<br>hardware ethernet e8:b1:fc:de:20:e7;<br>fixed-address 10.6.1.60;<br>}</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-3"><a href="#host-WudeMacBook-Pro-3" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-2"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-2" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-2"><a href="#fixed-address-10-6-4-187-2" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-3"><a href="#-3" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>        option routers                  192.168.11.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      114.114.114.114;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.11.50 192.168.11.119;<br>        range  192.168.11.121 192.168.11.250;<br>        default-lease-time 1800;<br>        max-lease-time 3600;<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 192.168.10.0 netmask 255.255.255.0 {<br>        option routers                  192.168.10.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  192.168.10.50 192.168.10.250;<br>        default-lease-time 36000;<br>        max-lease-time 72000;<br>}<br>}</p>
<p>[root@localhost ~]# </p>
<p>[root@localhost ~]# vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/</p>
<p>vim dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Centos-6-x-DHCP-1/" data-id="ciwvhh0m9001fr1cyxf7wby7o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Server-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-x-Server-1/" class="article-date">
  <time datetime="2016-12-19T00:58:37.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-x-Server-1/">CentOS 6.x Server</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@www ~]# vim /etc/hosts<br>192.168.0.99    www.centos.jinyan<br>192.168.0.3    JinYan-PC<br>10.0.0.254    www.centos.jinyan<br>10.0.0.1    jinyanxp<br>10.0.0.2    client.centos.jinyan<br>10.0.0.3    server.centos.jinyan</p>
<p>批量建立账号<br>[root@jinyan ~]# mkdir bin<br>[root@jinyan ~]# cd /root/bin<br>[root@jinyan bin]# vim useradd.sh</p>
<p>#!/bin/bash<br>groupadd jinyangroup<br>for username in jinyan renjia sanyuan yuanmu renyuan<br>do<br>  useradd -G jinyangroup $username<br>  echo “yanjin” | passwd –stdin $username<br>done<br>[root@jinyan bin]# sh useradd.sh<br>[root@jinyan bin]# id jinyan</p>
<p>共享目录的权限<br>[root@jinyan ~]# mkdir /home/jinyangroup<br>[root@www bin]# chgrp jinyangroup /home/jinyangroup/<br>[root@jinyan ~]# chmod 2770 /home/jinyangroup/<br>[root@jinyan ~]# ll -d /home/jinyangroup/</p>
<p>磁盘配额<br>[root@jinyan ~]# vim /etc/fstab<br>/dev/mapper/server-myhome /home                   ext4    defaults,usrquota,grpquota        1 2</p>
<p>[root@jinyan ~]# umount /home; mount -a<br>[root@jinyan ~]# mount | grep home<br>/dev/mapper/server-myhome on /home type ext4 (rw,usrquota,grpquota)</p>
<p>[root@jinyan ~]# quotacheck -avug<br>quotacheck: Your kernel probably supports journaled quota but you are not using it. Consider switching to journaled quota to avoid running quotacheck after an unclean shutdown.<br>quotacheck: Scanning /dev/mapper/server-myhome [/home] done</p>
<p>[root@jinyan ~]# quotaon -avug<br>/dev/mapper/server-myhome [/home]: group quotas turned on<br>/dev/mapper/server-myhome [/home]: user quotas turned on</p>
<p>[root@jinyan ~]# edquota -u jinyan<br>  Filesystem                   blocks       soft       hard     inodes     soft     hard<br>  /dev/mapper/server-myhome         20      1800000    2000000        5        0        0</p>
<p>[root@jinyan ~]# edquota -p jinyan renjia<br>[root@jinyan ~]# edquota -p jinyan sanyuan<br>[root@jinyan ~]# edquota -p jinyan yuanmu<br>[root@jinyan ~]# edquota -p jinyan renyuan</p>
<p>[root@jinyan ~]# repquota -au</p>
<p>LVM<br>[root@jinyan ~]# vgdisplay<br>  VG Size               4.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1249<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       0 / 0  </p>
<p>[root@jinyan ~]# fdisk /dev/sda</p>
<p>WARNING: DOS-compatible mode is deprecated. It’s strongly recommended to<br>         switch off the mode (command ‘c’) and change display units to<br>         sectors (command ‘u’).</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux</p>
<p>Command (m for help): n<br>First cylinder (1173-3917, default 1173): 2067<br>Last cylinder, +cylinders or +size{K,M,G} (2067-3917, default 3917): +2G</p>
<p>Command (m for help): t<br>Partition number (1-9): 9<br>Hex code (type L to list codes): 8e<br>Changed system type of partition 9 to 8e (Linux LVM)</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux<br>/dev/sda9            2067        2328     2104515   8e  Linux LVM</p>
<p>Command (m for help): w<br>The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.</p>
<p>[root@jinyan ~]# fdisk -l</p>
<p>[root@jinyan ~]# pvcreate /dev/sda9<br>  Writing physical volume data to disk “/dev/sda9”<br>  Physical volume “/dev/sda9” successfully created<br>[root@jinyan ~]# vgextend server /dev/sda9<br>  Volume group “server” successfully extended</p>
<p>[root@jinyan ~]# vgdisplay<br>  VG Size               6.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1762<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       513 / 2.00 GiB</p>
<p>[root@jinyan ~]# lvdisplay<br>  LV Name                /dev/server/myhome<br>  VG Name                server<br>  LV Size                4.88 GiB</p>
<p>[root@jinyan ~]# lvresize -L 6.88G /dev/server/myhome<br>  Rounding up size to full physical extent 6.88 GiB<br>  Extending logical volume myhome to 6.88 GiB<br>  Logical volume myhome successfully resized</p>
<p>[root@jinyan ~]# resize2fs /dev/server/myhome<br>resize2fs 1.41.12 (17-May-2010)<br>Filesystem at /dev/server/myhome is mounted on /home; on-line resizing required<br>old desc_blocks = 1, new_desc_blocks = 1<br>Performing an on-line resize of /dev/server/myhome to 1804288 (4k) blocks.<br>The filesystem on /dev/server/myhome is now 1804288 blocks long.</p>
<p>[root@jinyan ~]# df -h<br>/dev/mapper/server-myhome<br>                      6.8G  140M  6.4G   3% /home</p>
<p>[root@jinyan ~]# LANG=C chkconfig –list | grep ‘3:on’</p>
<p>[root@localhost ~]# chkconfig autofs off<br>[root@localhost ~]# /etc/init.d/autofs stop</p>
<p>[root@jinyan ~]# netstat -tunlp</p>
<p>[root@localhost ~]# /etc/init.d/avahi-daemon stop<br>[root@localhost ~]# chkconfig avahi-daemon off</p>
<p>[root@localhost ~]# yum -y update</p>
<pre><code># 第一次作会进行非常之久！因为系统真的有些数据要更新嘛！还是得等待的！
</code></pre><p>[root@localhost ~]# vim /etc/crontab<br>15 2 <em> </em> * root /usr/bin/yum -y update</p>
<p>[root@localhost ~]# rpm -qa | grep -i samba<br>    samba-common-3.5.4-68.el6_0.2.x86_64<br>    samba-client-3.5.4-68.el6_0.2.x86_64<br>    samba-winbind-clients-3.5.4-68.el6_0.2.x86_64</p>
<pre><code># 看起来 samba 主程序尚未被安装啊！此时就要这样做：

[root@localhost ~]# yum search samba  &lt;==先查一下有没有相关的软件
[root@localhost ~]# yum -y install samba &lt;==找到之后，那就安装吧！

# 那么如何找出配置文件呢？因为我们总是需要修改配置文件啊！这样做吧：
[root@localhost ~]# rpm -qc samba samba-common
</code></pre><h1 id="先查询一下启动的方式为何："><a href="#先查询一下启动的方式为何：" class="headerlink" title="先查询一下启动的方式为何："></a>先查询一下启动的方式为何：</h1><pre><code>[root@localhost ~]# rpm -ql samba | grep &apos;/etc&apos;
/etc/logrotate.d/samba
/etc/openldap/schema
/etc/openldap/schema/samba.schema
/etc/pam.d/samba
/etc/rc.d/init.d/nmb
/etc/rc.d/init.d/smb  &lt;==所以说是 stand alone 且档名为 smb, nmb 两
</code></pre><p>个！<br>    /etc/samba/smbusers</p>
<h1 id="开始启动他！且设定开机就启动喔！："><a href="#开始启动他！且设定开机就启动喔！：" class="headerlink" title="开始启动他！且设定开机就启动喔！："></a>开始启动他！且设定开机就启动喔！：</h1><p>[root@localhost ~]# /etc/init.d/smb start<br>[root@localhost ~]# /etc/init.d/nmb start</p>
<p>[root@localhost ~]# chkconfig smb on<br>[root@localhost ~]# chkconfig nmb on</p>
<h1 id="接下来，让我们观察一下有没有启动相关的埠口吧！"><a href="#接下来，让我们观察一下有没有启动相关的埠口吧！" class="headerlink" title="接下来，让我们观察一下有没有启动相关的埠口吧！"></a>接下来，让我们观察一下有没有启动相关的埠口吧！</h1><pre><code>[root@localhost ~]# netstat -tlunp | grep &apos;[sn]mbd&apos;
</code></pre><p>ACL<br>[root@jinyan ~]# useradd student<br>[root@jinyan ~]# passwd student<br>[root@jinyan ~]# setfacl -m u:student:rx /home/jinyangroup/<br>[root@jinyan ~]# setfacl -m u:renyuan:- /home/jinyangroup/<br>[root@jinyan ~]# getfacl /home/jinyangroup/<br>getfacl: Removing leading ‘/‘ from absolute path names</p>
<h1 id="file-home-jinyangroup"><a href="#file-home-jinyangroup" class="headerlink" title="file: home/jinyangroup/"></a>file: home/jinyangroup/</h1><h1 id="owner-root"><a href="#owner-root" class="headerlink" title="owner: root"></a>owner: root</h1><h1 id="group-2770"><a href="#group-2770" class="headerlink" title="group: 2770"></a>group: 2770</h1><p>user::rwx<br>user:renyuan:—<br>user:student:r-x<br>group::r-x<br>mask::r-x<br>other::r-x</p>
<p>[root@www ~]# vim /etc/login.defs<br>[root@www ~]# vim /etc/security/limits.conf</p>
<p>[root@jinyan ~]# vim /root/bin/backup.sh</p>
<p>#!/bin/bash<br>backdir=”/etc /home /root /var/spool/mail”<br>basedir=/backup<br>[ ! -d “$basedir” ] &amp;&amp; mkdir $basedir<br>backfile=$basedir/backup.tar.gz<br>tar -zcvf $backfile $backdir</p>
<p>[root@localhost ~]# vim /etc/crontab<br>45 2 <em> </em> * root sh /root/bin/backup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-x-Server-1/" data-id="ciwvhh0lp000ur1cyh701cblc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CactiEZ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CactiEZ/" class="article-date">
  <time datetime="2016-12-19T00:57:59.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CactiEZ/">CactiEZ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@localhost ~]# php /var/www/html/poller.php<br>[root@localhost ~]# crontab -e</p>
<p><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br><em>/5 </em> <em> </em> * /usr/sbin/ntpdate -u 10.6.0.220 &gt; /dev/null 2&gt;&amp;1</p>
<p>[root@localhost ~]# vi /etc/sysconfig/clock</p>
<h1 id="ZONE-”America-North-Dakota-Center”"><a href="#ZONE-”America-North-Dakota-Center”" class="headerlink" title="ZONE=”America/North_Dakota/Center”"></a>ZONE=”America/North_Dakota/Center”</h1><h1 id="UTC-false"><a href="#UTC-false" class="headerlink" title="UTC=false"></a>UTC=false</h1><h1 id="ARC-false"><a href="#ARC-false" class="headerlink" title="ARC=false"></a>ARC=false</h1><p>ZONE=”Asia/Shanghai”<br>UTC=false<br>ARC=false<br>[root@localhost ~]# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br>cp: overwrite `/etc/localtime’? y<br>[root@localhost ~]# date<br>[root@localhost ~]# /usr/sbin/ntpdate -u 10.6.0.220<br>26 Mar 13:21:52 ntpdate[5851]: step time server 10.6.0.220 offset -2774.426741 sec</p>
<p>cacti backup 10.6.0.77<br>默认设置说明：<br>root密码: CactiEZ<br>登录系统后，请尽快修改root密码。</p>
<p>Cacti登录用户名: admin<br>Cacti登录密码: sz215tzuchi<br>第一次登录Cacti需要修改密码。<br>mysqldump -ucactiuser -p’CactiMadeEZ’ cacti&gt;/root/cacti.sql<br>mysqldump -ucactiuser -p’CactiMadeEZ’ syslog&gt;syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option; </p>
<p>snmp station 10.6.0.77 162 “public” v1 enable</p>
<p>vim backup.sh</p>
<p>#/bin/bash<br>cd /var/www/</p>
<h1 id="Remove-old-backups"><a href="#Remove-old-backups" class="headerlink" title="Remove old backups"></a>Remove old backups</h1><p>find /var/www/backups/* -mtime +5 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Remove-old-RRAs-usually-means-the-datasource-is-deleted"><a href="#Remove-old-RRAs-usually-means-the-datasource-is-deleted" class="headerlink" title="Remove old RRAs (usually means the datasource is deleted)"></a>Remove old RRAs (usually means the datasource is deleted)</h1><p>find /var/www/html/rra/* -mtime +2 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Create-the-filename-for-the-backup"><a href="#Create-the-filename-for-the-backup" class="headerlink" title="Create the filename for the backup"></a>Create the filename for the backup</h1><p>eval <code>date &quot;+day=%d; month=%m; year=%Y&quot;</code><br>INSTFIL=”cacti-backup-$year-$month-$day.tar.gz”</p>
<h1 id="Dump-the-MySQL-Database"><a href="#Dump-the-MySQL-Database" class="headerlink" title="Dump the MySQL Database"></a>Dump the MySQL Database</h1><p>mysqldump -uroot –opt cacti&gt; /var/www/html/cacti-backup.sql<br>mysqldump -uroot –opt syslog&gt; /var/www/html/syslog.sql</p>
<h1 id="Gzip-the-whole-folder"><a href="#Gzip-the-whole-folder" class="headerlink" title="Gzip the whole folder"></a>Gzip the whole folder</h1><p>tar -Pcpzf /var/www/backups/$INSTFIL /var/www/html/*</p>
<h1 id="Remove-the-SQL-Dump"><a href="#Remove-the-SQL-Dump" class="headerlink" title="Remove the SQL Dump"></a>Remove the SQL Dump</h1><p>rm -f /var/www/html/cacti-backup.sql<br>rm -f /var/www/html/syslog.sql</p>
<p>crontab -e<br><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br>还原<br>将备份文件置于/var/www/html目录下<br>使用如下命令进行MySQL还原<br>source /root/cacti.sql<br>source /root/syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CactiEZ/" data-id="ciwvhh0kn0005r1cyddfttq5h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Nagios" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Nagios/" class="article-date">
  <time datetime="2016-12-19T00:57:21.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Nagios/">Nagios</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@cluster3 ~]# crontab -e<br><em>/5 </em> <em> </em> <em> ntpdate 202.120.2.101 &gt; /dev/null 2&gt;&amp;1<br>00 03 </em> <em> </em> sh /root/copy.sh<br>00 06 <em> </em> * sh /root/nagiosbackup.sh<br>~<br>[root@cluster3 ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/httpd/ /home/backup/<br>cp -r /usr/local/ /home/backup/<br>[root@cluster3 ~]#<br>[root@cluster3 ~]# cat /root/nagiosbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_nagios”<br>tar -cjPf $basedir/nagios.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=nagios.$(date +%Y-%m-%d).tar.bz2<br>rmfile=nagios.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>[root@cluster3 ~]#</p>
<p>[root@localhost ~]# vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/httpd/ /home/backup/<br>cp -r /usr/local/ /home/backup/</p>
<p>vim nagiosbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_nagios”<br>tar -cjPf $basedir/nagios.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=nagios.$(date +%Y-%m-%d).tar.bz2<br>rmfile=nagios.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/nagiosbackup.sh</p>
<p>[root@cluster3 ~]# /usr/local/nagios/libexec/check_nrpe -H 10.6.100.35<br>I (0,4,1,73 2012-12-17) seem to be doing fine…<br>[root@cluster3 ~]# /etc/rc.d/init.d/nagios restart<br>Running configuration check…done.<br>Stopping nagios: .done.<br>Starting nagios: done.<br>[root@cluster3 ~]#</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Nagios/" data-id="ciwvhh0mw0029r1cynczu3xuj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/19/moodle在CentOS下的迁移/">moodle在CentOS下的迁移</a>
          </li>
        
          <li>
            <a href="/2016/12/19/TzuChi-技术/">TzuChi 技术</a>
          </li>
        
          <li>
            <a href="/2016/12/19/Centos-6-x-预配-2/">Centos 6.x 预配</a>
          </li>
        
          <li>
            <a href="/2016/12/19/Centos-7-x-预配-2/">Centos 7.x 预配</a>
          </li>
        
          <li>
            <a href="/2016/12/19/Centos-6-5-x64-Hadoop-2-3-0-1/">Centos 6.5 x64 Hadoop-2.3.0</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>