<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Ubuntu-64-位预配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Ubuntu-64-位预配/" class="article-date">
  <time datetime="2016-12-15T05:22:07.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Ubuntu-64-位预配/">Ubuntu 64 位预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>java<br>vm tools<br>sudo passwd root<br>Ubuntu软件中心——编辑——更换软件源</p>
<p>root用户登录桌面<br>vim /usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf<br>[SeatDefaults]<br>user-session=ubuntu<br>greeter-show-manual-login=true<br>Ubuntu启用root账户后，登录root账户时报错：读取/root/.profile时发现错误：mesg:ttyname failed:对设备不适当的ioctl操作 作为结果，会话不会被正确配置<br>root@ubuntu:~# cp /home/jinyan/.profile /root/<br>root@ubuntu:~# reboot</p>
<p>cp /etc/apt/sources.list /etc/apt/sources.listbak<br>vim /etc/apt/sources.list<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>apt-get update</p>
<p>用vim打开 /etc/default/locale 文件</p>
<p>原来的配置文件应该是这样的：<br>LANG=”zh_CN.UTF-8”<br>LANGUAGE=”zh_CN:zh:en_US:en”<br>LC_NUMERIC=”zh_CN.UTF-8”<br>LC_TIME=”zh_CN.UTF-8”<br>LC_MONETARY=”zh_CN.UTF-8”<br>LC_PAPER=”zh_CN.UTF-8”<br>LC_IDENTIFICATION=”zh_CN.UTF-8”<br>LC_NAME=”zh_CN.UTF-8”<br>LC_ADDRESS=”zh_CN.UTF-8”<br>LC_TELEPHONE=”zh_CN.UTF-8”<br>LC_MEASUREMENT=”zh_CN.UTF-8”</p>
<p>将原来的配置内容修改为<br>LANG=”en_US.UTF-8″<br>LANGUAGE=”en_US:en”</p>
<p>再在终端下运行：<br>locale-gen -en_US:en<br>注销或重启后，即可恢复为英文的语言环境。</p>
<p>查看防火墙状态<br>root@jinyan-virtual-machine:~# ufw status<br>状态：不活动<br>root@jinyan-virtual-machine:~# getenforce<br>程序“getenforce”尚未安装。 您可以使用以下命令安装：<br>apt-get install selinux-utils</p>
<p>apt-get install vim<br>apt-get install openssh-server<br>vim /etc/ssh/sshd_config<br>找到PermitRootLogin no一行，改为PermitRootLogin yes<br>PermitRootLogin yes</p>
<h1 id="PermitRootLogin-without-password"><a href="#PermitRootLogin-without-password" class="headerlink" title="PermitRootLogin without-password"></a>PermitRootLogin without-password</h1><p>重启系统<br>重启 openssh server<br>/etc/init.d/ssh restart<br>service ssh restart</p>
<p>apt-get install ntp<br>查看ntp同步过程<br>ntpq -p<br>ntpdate -u 202.120.2.101</p>
<p>apt-get install x-window-system-core<br>apt-get install gdm<br>apt-get install ubuntu-desktop<br>apt-get install gnome-core</p>
<p>apt-get install vnc4server<br>vncserver<br>cp ~/.vnc/xstartup  ~/.vnc/xstartup.bak<br>vim ~/.vnc/xstartup</p>
<h1 id="x-window-manager-amp"><a href="#x-window-manager-amp" class="headerlink" title="x-window-manager &amp;"></a>x-window-manager &amp;</h1><h1 id="gnome-session-amp"><a href="#gnome-session-amp" class="headerlink" title="gnome-session &amp;"></a>gnome-session &amp;</h1><p>gnome-panel &amp;<br>gnome-settings-daemon &amp;<br>metacity &amp;<br>nautilus &amp;<br>gnome-terminal &amp;</p>
<p>root@jinyan-virtual-machine:~# vncserver -kill :1<br>Killing Xvnc4 process ID 3767<br>root@jinyan-virtual-machine:~# vncserver :1<br>192.168.50.6:1</p>
<p>apt-get install vsftpd<br>apt-get remove vsftpd</p>
<p>vim /etc/vsftpd.conf<br>local_enable=YES<br>write_enable=YES<br>chroot_local_user=YES<br>chroot_list_enable=YES<br>chroot_list_file=/etc/vsftpd.chroot_list</p>
<p>anonymous_enable=YES</p>
<h1 id="anonymous-enable-NO"><a href="#anonymous-enable-NO" class="headerlink" title="anonymous_enable=NO"></a>anonymous_enable=NO</h1><p>useradd -d /home/ftp -M ftpuser<br>passwd ftpuser</p>
<p>vim /etc/vsftpd.chroot_list<br>ftpuser</p>
<p>vim /etc/ftpusers<br>打开这个文件后，看一看有没有uftp这个用户名，如果没有，就直接退出。如果有就删除uftp,因为这个文件中记录的是不能访问FTP服务器的用户清单。</p>
<p>vim /etc/pam.d/vsftpd</p>
<p>#auth   required        pam_shells.so</p>
<p>mkdir /home/ftp<br>chmod a-w /home/ftp<br>mkdir /home/ftp/data<br>chown -R ftpuser:ftpuser /home/ftp/</p>
<p>service vsftpd restart</p>
<p>mkdir /usr/lib/java<br>tar -zxvf jdk-7u79-linux-x64.tar.gz -C /usr/lib/java/<br>cd /usr/lib/java/jdk1.7.0_79/</p>
<p>vim ~/.bashrc</p>
<p>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.7.0_79/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export CLASS_PATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib<br>export PATH=${JAVA_HOME}/bin:$PATH</p>
<p>root@jinyan-virtual-machine:~# source /etc/profile<br>root@jinyan-virtual-machine:~# java -version<br>java version “1.7.0_79”<br>Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</p>
<p>apt-get install samba<br>apt-get install smbfs</p>
<p>apt-get install samba samba-common system-config-samba python-glade2 gksu<br>在 Unity Dash 中搜索并打开 Samba 配置工具</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Ubuntu-64-位预配/" data-id="ciwvctjzu001wu1cy4dfylqur" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Postfix-Amavisd-new-Spamassassin-ClamAV整合安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/" class="article-date">
  <time datetime="2016-12-15T05:21:30.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/">Postfix+Amavisd-new+Spamassassin+ClamAV整合安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>安装软件和依赖包<br>apt-get install postfix amavisd-new spamassassin clamav-daemon mysql-client mysql-server<br>apt-get install libnet-dns-perl pyzor razor<br>apt-get install arj bzip2 cabextract cpio file gzip lha nomarch pax rar unrar unzip zip</p>
</li>
<li><p>修改用户权限<br>usermod -a -G clamav amavis<br>usermod -a -G amavis clamav</p>
</li>
<li><p>修改spamassassin配置文件/etc/default/spamassassin<br>ENABLED=0 ====&gt; ENABLED=1<br>CRON=0    ====&gt; CRON=1</p>
</li>
</ol>
<p>4.启动spamassassin<br>/etc/init.d/spamassassin start</p>
<ol>
<li><p>修改amavis配置文件/etc/amavis/conf.d/15-content_filter_mode<br> 1) 去掉里面的注释（目的：check病毒和垃圾邮件）<br> 2) 重启amavis<br>/etc/init.d/amavis restart</p>
</li>
<li><p>修改postfix配置文件/etc/postfix/main.cf,添加如下内容<br> 注释掉mydestination<br>添加：<br>relay_domains = test.com<br>transport_maps = hash:/etc/postfix/transport<br>relay_recipient_maps = hash:/etc/postfix/relay_recipients<br>content_filter = smtp-amavis:[127.0.0.1]:10024</p>
</li>
<li><p>编辑文件/etc/postfix/master.cf,在文件最后添加如下内容<br>smtp-amavis     unix    -       -       -       -       2       smtp</p>
<pre><code>-o smtp_data_done_timeout=1200
-o smtp_send_xforward_command=yes
-o disable_dns_lookups=yes
-o max_use=20
</code></pre></li>
</ol>
<p>127.0.0.1:10025 inet    n       -       -       -       -       smtpd<br>        -o content_filter=<br>        -o local_recipient_maps=<br>        -o relay_recipient_maps=<br>        -o smtpd_restriction_classes=<br>        -o smtpd_delay_reject=no<br>        -o smtpd_client_restrictions=permit_mynetworks,reject<br>        -o smtpd_helo_restrictions=<br>        -o smtpd_sender_restrictions=<br>        -o smtpd_recipient_restrictions=permit_mynetworks,reject<br>        -o smtpd_data_restrictions=reject_unauth_pipelining<br>        -o smtpd_end_of_data_restrictions=<br>        -o mynetworks=127.0.0.0/8<br>        -o smtpd_error_sleep_time=0<br>        -o smtpd_soft_error_limit=1001<br>        -o smtpd_hard_error_limit=1000<br>        -o smtpd_client_connection_count_limit=0<br>        -o smtpd_client_connection_rate_limit=0<br>        -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks</p>
<ol>
<li><p>在文件/etc/postfix/master.cf中的pickup行添加如下内容<br>   -o content_filter=<br>   -o receive_override_options=no_header_body_checks</p>
</li>
<li><p>重启postfix<br>/etc/init.d/postfix reload</p>
</li>
<li><p>修改/etc/amavis/conf.d/20-debian_defaults<br>$final_spam_destiny = D_BOUNCE  ===&gt; $final_spam_destiny = D_DISCARD</p>
</li>
</ol>
<p>$QUARANTINEDIR = “/data/virusmails”;</p>
<ol>
<li><p>修改/etc/amavis/conf.d/05-node_id<br>$myhostname = “mail.example.com”;</p>
</li>
<li><p>修改/etc/amavis/conf.d/50-user,添加如下内容：<br>$spam_quarantine_to = “spam-quarantine”;<br>$virus_quarantine_to = “spam-quarantine”;</p>
</li>
</ol>
<p>@whitelist_sender_maps = read_hash(“/etc/amavis/whitelist”);<br>@blacklist_sender_maps = read_hash(“/etc/amavis/blacklist”);</p>
<ol>
<li><p>在目录/etc/amavis下创建文件blacklist和whitelist<br>touch /etc/amavis/whitelist<br>touch /etc/amavis/blacklist</p>
</li>
<li><p>垃圾及病毒邮件的保存目录<br>/data/virusmails</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/" data-id="ciwvctjzg001lu1cy2i88fghj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Ubuntu-16-04-LTS-一键安装VNC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Ubuntu-16-04-LTS-一键安装VNC/" class="article-date">
  <time datetime="2016-12-15T05:14:59.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Ubuntu-16-04-LTS-一键安装VNC/">Ubuntu 16.04 LTS 一键安装VNC</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Ubuntu 16.04 LTS是最近出的LTS版本系统，估计未来也会有长期的使用频率，配置好远程桌面，会极大方便工作和生活。很多人也会采用SSH远程管理，鉴于SSH安装和使用是很简单的事情，就不赘述了。</p>
<p>VNC有很多选择，VNC4server，tigervncserver等等，都不推荐，难装又难用。经过多次实验和测试，最后只采用 x11vnc  作为VNC服务器端。</p>
<p>具体配置步骤如下：</p>
<h1 id="步骤-1-安装-X11VNC"><a href="#步骤-1-安装-X11VNC" class="headerlink" title="步骤 1 - 安装 X11VNC"></a>步骤 1 - 安装 X11VNC</h1><h1 id=""><a href="#" class="headerlink" title="#"></a>#</h1><p>sudo apt install x11vnc -y</p>
<h1 id="步骤-2-配置访问密码"><a href="#步骤-2-配置访问密码" class="headerlink" title="步骤 2 - 配置访问密码"></a>步骤 2 - 配置访问密码</h1><h1 id="-1"><a href="#-1" class="headerlink" title="#"></a>#</h1><p>sudo x11vnc -storepasswd /etc/x11vnc.pass </p>
<h1 id="步骤-3-创建服务"><a href="#步骤-3-创建服务" class="headerlink" title="步骤 3 - 创建服务"></a>步骤 3 - 创建服务</h1><h1 id="-2"><a href="#-2" class="headerlink" title="#"></a>#</h1><p>vi  /lib/systemd/system/x11vnc.service</p>
<p>#粘贴如下代码，最后 :wq 保存，请使用root用户，否则没有权限。<br>[Unit]<br>Description=Start x11vnc at startup.<br>After=multi-user.target<br>[Service]<br>Type=simple<br>ExecStart=/usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /etc/x11vnc.pass -rfbport 5900 -shared<br>[Install]<br>WantedBy=multi-user.target</p>
<h1 id="步骤-4-配置防火墙，配置和启动服务"><a href="#步骤-4-配置防火墙，配置和启动服务" class="headerlink" title="步骤 4 - 配置防火墙，配置和启动服务"></a>步骤 4 - 配置防火墙，配置和启动服务</h1><h1 id="-3"><a href="#-3" class="headerlink" title="#"></a>#</h1><p>sudo ufw allow 5900<br>sudo systemctl enable x11vnc.service<br>sudo systemctl daemon-reload</p>
<p>最后重启。</p>
<p>估计很多人看到这个会头大吧，还得输入代码呀。。。。</p>
<p>那好吧，我写个脚本，请拿去，运行完脚本会自动重启的。</p>
<p>su root</p>
<p>wget <a href="https://github.com/longhr/ubuntu1604hub/raw/master/ubuntu1604VNC.sh" target="_blank" rel="external">https://github.com/longhr/ubuntu1604hub/raw/master/ubuntu1604VNC.sh</a></p>
<p>root@jinyan:~# vim ubuntu1604VNC.sh</p>
<h1 id="-4"><a href="#-4" class="headerlink" title="#"></a>#</h1><h1 id="脚本名称-ubuntu1604VNC"><a href="#脚本名称-ubuntu1604VNC" class="headerlink" title="脚本名称 : ubuntu1604VNC"></a>脚本名称 : ubuntu1604VNC</h1><h1 id="脚本描述-自动安装配置和自动启动X11Vnc"><a href="#脚本描述-自动安装配置和自动启动X11Vnc" class="headerlink" title="脚本描述 : 自动安装配置和自动启动X11Vnc"></a>脚本描述 : 自动安装配置和自动启动X11Vnc</h1><h1 id="编写日期-2016-6-13"><a href="#编写日期-2016-6-13" class="headerlink" title="编写日期 : 2016.6.13"></a>编写日期 : 2016.6.13</h1><h1 id="作-者-longhr"><a href="#作-者-longhr" class="headerlink" title="作    者 : longhr"></a>作    者 : longhr</h1><h1 id="作者网站-blog-csdn-net-longhr"><a href="#作者网站-blog-csdn-net-longhr" class="headerlink" title="作者网站 : blog.csdn.net/longhr"></a>作者网站 : blog.csdn.net/longhr</h1><h1 id="软件版本-0-1"><a href="#软件版本-0-1" class="headerlink" title="软件版本 : 0.1"></a>软件版本 : 0.1</h1><h1 id="注意事项：-运行完5秒内会重启"><a href="#注意事项：-运行完5秒内会重启" class="headerlink" title="注意事项： 运行完5秒内会重启"></a>注意事项： 运行完5秒内会重启</h1><h1 id="免责声明-使用自由，后果自付"><a href="#免责声明-使用自由，后果自付" class="headerlink" title="免责声明 : 使用自由，后果自付"></a>免责声明 : 使用自由，后果自付</h1><h1 id="-5"><a href="#-5" class="headerlink" title="#"></a>#</h1><h1 id="步骤-1-安装-X11VNC-1"><a href="#步骤-1-安装-X11VNC-1" class="headerlink" title="步骤 1 - 安装 X11VNC"></a>步骤 1 - 安装 X11VNC</h1><h1 id="-6"><a href="#-6" class="headerlink" title="#"></a>#</h1><p>sudo apt-get install x11vnc -y</p>
<h1 id="步骤-2-配置访问密码-1"><a href="#步骤-2-配置访问密码-1" class="headerlink" title="步骤 2 - 配置访问密码"></a>步骤 2 - 配置访问密码</h1><h1 id="-7"><a href="#-7" class="headerlink" title="#"></a>#</h1><p>sudo x11vnc -storepasswd /etc/x11vnc.pass</p>
<h1 id="步骤-3-创建服务-1"><a href="#步骤-3-创建服务-1" class="headerlink" title="步骤 3 - 创建服务"></a>步骤 3 - 创建服务</h1><h1 id="-8"><a href="#-8" class="headerlink" title="#"></a>#</h1><p>cat &gt; /lib/systemd/system/x11vnc.service &lt;&lt; EOF<br>[Unit]<br>Description=Start x11vnc at startup.<br>After=multi-user.target</p>
<p>[Service]<br>Type=simple<br>ExecStart=/usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /etc/x11vnc.pass -rfbport 5900 -shared</p>
<p>[Install]<br>WantedBy=multi-user.target<br>EOF</p>
<h1 id="步骤-4-配配置防火墙端口，配置和启动服务"><a href="#步骤-4-配配置防火墙端口，配置和启动服务" class="headerlink" title="步骤 4 - 配配置防火墙端口，配置和启动服务"></a>步骤 4 - 配配置防火墙端口，配置和启动服务</h1><h1 id="-9"><a href="#-9" class="headerlink" title="#"></a>#</h1><p>echo “Configure firewall”<br>sudo ufw allow 5900<br>echo “Configure Services”<br>sudo systemctl enable x11vnc.service<br>sudo systemctl daemon-reload</p>
<h1 id="步骤-5-重启"><a href="#步骤-5-重启" class="headerlink" title="步骤 5 - 重启"></a>步骤 5 - 重启</h1><h1 id="-10"><a href="#-10" class="headerlink" title="#"></a>#</h1><p>sleep  5s<br>sudo shutdown -r now</p>
<p>root@jinyan:~#<br>chmod u+x ubuntu1604VNC.sh</p>
<p>./ubuntu1604VNC.sh</p>
<p>即可完成。</p>
<p>注意：</p>
<p>/lib/systemd/system/x11vnc.service 必须用root权限才能写入</p>
<p>如果root密码不知道，可以重置root密码</p>
<p>sudo passwd root</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Ubuntu-16-04-LTS-一键安装VNC/" data-id="ciwvctjzr001uu1cyhfuzmm7j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-计算机存储单位" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/计算机存储单位/" class="article-date">
  <time datetime="2016-12-15T05:13:51.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/计算机存储单位/">计算机存储单位</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>计算机的记忆/存储单位换算<br>1Byte=8bit<br>1KB=1024B<br>1MB=1024KB<br>1GB=1024MB<br>1TB=1024GB<br>计算机存储单位一般用B，KB，MB，GB，TB，PB，EB，ZB，YB，BB来表示，<br>换算关系<br>　　位 bit (比特)(Binary Digits)：存放一位二进制数，即 0 或 1，最小的存储单位。<br>　　字节 byte：8个二进制位为一个字节(B)，最常用的单位。<br>　　1KB (Kilobyte 千字节)=1024B，<br>　　1MB (Megabyte 兆字节 简称“兆”)=1024KB，<br>　　1GB (Gigabyte 吉字节 又称“千兆”)=1024MB，<br>　　1TB(Trillionbyte 万亿字节 太字节)=1024GB，其中1024=2^10 ( 2 的10次方)，<br>　　1PB（Petabyte 千万亿字节 拍字节）=1024TB，<br>　　1EB（Exabyte 百亿亿字节 艾字节）=1024PB，<br>　　1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB,<br>　　1YB (Yottabyte 一亿亿亿字节 尧字节)= 1024 ZB,<br>　　1BB (Brontobyte 一千亿亿亿字节)= 1024 YB.<br>　　注：“兆”为百万级数量单位。<br>　　附：进制单位全称及译音<br>　　yotta, [尧]它, Y. 10^21,<br>　　zetta, [泽]它, Z. 10^18,<br>　　exa, [艾]可萨, E. 10^15,<br>　　peta, [拍]它, P. 10^12,<br>　　tera, [太]拉, T. 10^9,<br>　　giga, [级]咖, G. 10^6,<br>　　mega, [兆]，M. 10^3</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/计算机存储单位/" data-id="ciwvctk1n004fu1cy84r8g681" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-FTP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/FTP/" class="article-date">
  <time datetime="2016-12-15T03:41:38.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/FTP/">FTP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vsftpd.conf</p>
<h1 id="Example-config-file-etc-vsftpd-vsftpd-conf"><a href="#Example-config-file-etc-vsftpd-vsftpd-conf" class="headerlink" title="Example config file /etc/vsftpd/vsftpd.conf"></a>Example config file /etc/vsftpd/vsftpd.conf</h1><p>#</p>
<h1 id="The-default-compiled-in-settings-are-fairly-paranoid-This-sample-file"><a href="#The-default-compiled-in-settings-are-fairly-paranoid-This-sample-file" class="headerlink" title="The default compiled in settings are fairly paranoid. This sample file"></a>The default compiled in settings are fairly paranoid. This sample file</h1><h1 id="loosens-things-up-a-bit-to-make-the-ftp-daemon-more-usable"><a href="#loosens-things-up-a-bit-to-make-the-ftp-daemon-more-usable" class="headerlink" title="loosens things up a bit, to make the ftp daemon more usable."></a>loosens things up a bit, to make the ftp daemon more usable.</h1><h1 id="Please-see-vsftpd-conf-5-for-all-compiled-in-defaults"><a href="#Please-see-vsftpd-conf-5-for-all-compiled-in-defaults" class="headerlink" title="Please see vsftpd.conf.5 for all compiled in defaults."></a>Please see vsftpd.conf.5 for all compiled in defaults.</h1><p>#</p>
<h1 id="READ-THIS-This-example-file-is-NOT-an-exhaustive-list-of-vsftpd-options"><a href="#READ-THIS-This-example-file-is-NOT-an-exhaustive-list-of-vsftpd-options" class="headerlink" title="READ THIS: This example file is NOT an exhaustive list of vsftpd options."></a>READ THIS: This example file is NOT an exhaustive list of vsftpd options.</h1><h1 id="Please-read-the-vsftpd-conf-5-manual-page-to-get-a-full-idea-of-vsftpd’s"><a href="#Please-read-the-vsftpd-conf-5-manual-page-to-get-a-full-idea-of-vsftpd’s" class="headerlink" title="Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd’s"></a>Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd’s</h1><h1 id="capabilities"><a href="#capabilities" class="headerlink" title="capabilities."></a>capabilities.</h1><p>#</p>
<h1 id="Allow-anonymous-FTP-Beware-allowed-by-default-if-you-comment-this-out"><a href="#Allow-anonymous-FTP-Beware-allowed-by-default-if-you-comment-this-out" class="headerlink" title="Allow anonymous FTP? (Beware - allowed by default if you comment this out)."></a>Allow anonymous FTP? (Beware - allowed by default if you comment this out).</h1><p>anonymous_enable=YES<br>no_anon_password=YES<br>#</p>
<h1 id="Uncomment-this-to-allow-local-users-to-log-in"><a href="#Uncomment-this-to-allow-local-users-to-log-in" class="headerlink" title="Uncomment this to allow local users to log in."></a>Uncomment this to allow local users to log in.</h1><p>local_enable=YES<br>#</p>
<h1 id="Uncomment-this-to-enable-any-form-of-FTP-write-command"><a href="#Uncomment-this-to-enable-any-form-of-FTP-write-command" class="headerlink" title="Uncomment this to enable any form of FTP write command."></a>Uncomment this to enable any form of FTP write command.</h1><p>write_enable=YES<br>#</p>
<h1 id="Default-umask-for-local-users-is-077-You-may-wish-to-change-this-to-022"><a href="#Default-umask-for-local-users-is-077-You-may-wish-to-change-this-to-022" class="headerlink" title="Default umask for local users is 077. You may wish to change this to 022,"></a>Default umask for local users is 077. You may wish to change this to 022,</h1><h1 id="if-your-users-expect-that-022-is-used-by-most-other-ftpd’s"><a href="#if-your-users-expect-that-022-is-used-by-most-other-ftpd’s" class="headerlink" title="if your users expect that (022 is used by most other ftpd’s)"></a>if your users expect that (022 is used by most other ftpd’s)</h1><p>local_umask=022<br>#</p>
<h1 id="Uncomment-this-to-allow-the-anonymous-FTP-user-to-upload-files-This-only"><a href="#Uncomment-this-to-allow-the-anonymous-FTP-user-to-upload-files-This-only" class="headerlink" title="Uncomment this to allow the anonymous FTP user to upload files. This only"></a>Uncomment this to allow the anonymous FTP user to upload files. This only</h1><h1 id="has-an-effect-if-the-above-global-write-enable-is-activated-Also-you-will"><a href="#has-an-effect-if-the-above-global-write-enable-is-activated-Also-you-will" class="headerlink" title="has an effect if the above global write enable is activated. Also, you will"></a>has an effect if the above global write enable is activated. Also, you will</h1><h1 id="obviously-need-to-create-a-directory-writable-by-the-FTP-user"><a href="#obviously-need-to-create-a-directory-writable-by-the-FTP-user" class="headerlink" title="obviously need to create a directory writable by the FTP user."></a>obviously need to create a directory writable by the FTP user.</h1><p>anon_upload_enable=YES<br>#</p>
<h1 id="Uncomment-this-if-you-want-the-anonymous-FTP-user-to-be-able-to-create"><a href="#Uncomment-this-if-you-want-the-anonymous-FTP-user-to-be-able-to-create" class="headerlink" title="Uncomment this if you want the anonymous FTP user to be able to create"></a>Uncomment this if you want the anonymous FTP user to be able to create</h1><h1 id="new-directories"><a href="#new-directories" class="headerlink" title="new directories."></a>new directories.</h1><p>anon_mkdir_write_enable=YES<br>#</p>
<h1 id="Activate-directory-messages-messages-given-to-remote-users-when-they"><a href="#Activate-directory-messages-messages-given-to-remote-users-when-they" class="headerlink" title="Activate directory messages - messages given to remote users when they"></a>Activate directory messages - messages given to remote users when they</h1><h1 id="go-into-a-certain-directory"><a href="#go-into-a-certain-directory" class="headerlink" title="go into a certain directory."></a>go into a certain directory.</h1><p>dirmessage_enable=YES<br>#</p>
<h1 id="The-target-log-file-can-be-vsftpd-log-file-or-xferlog-file"><a href="#The-target-log-file-can-be-vsftpd-log-file-or-xferlog-file" class="headerlink" title="The target log file can be vsftpd_log_file or xferlog_file."></a>The target log file can be vsftpd_log_file or xferlog_file.</h1><h1 id="This-depends-on-setting-xferlog-std-format-parameter"><a href="#This-depends-on-setting-xferlog-std-format-parameter" class="headerlink" title="This depends on setting xferlog_std_format parameter"></a>This depends on setting xferlog_std_format parameter</h1><p>xferlog_enable=YES<br>#</p>
<h1 id="Make-sure-PORT-transfer-connections-originate-from-port-20-ftp-data"><a href="#Make-sure-PORT-transfer-connections-originate-from-port-20-ftp-data" class="headerlink" title="Make sure PORT transfer connections originate from port 20 (ftp-data)."></a>Make sure PORT transfer connections originate from port 20 (ftp-data).</h1><p>connect_from_port_20=YES<br>#</p>
<h1 id="If-you-want-you-can-arrange-for-uploaded-anonymous-files-to-be-owned-by"><a href="#If-you-want-you-can-arrange-for-uploaded-anonymous-files-to-be-owned-by" class="headerlink" title="If you want, you can arrange for uploaded anonymous files to be owned by"></a>If you want, you can arrange for uploaded anonymous files to be owned by</h1><h1 id="a-different-user-Note-Using-“root”-for-uploaded-files-is-not"><a href="#a-different-user-Note-Using-“root”-for-uploaded-files-is-not" class="headerlink" title="a different user. Note! Using “root” for uploaded files is not"></a>a different user. Note! Using “root” for uploaded files is not</h1><h1 id="recommended"><a href="#recommended" class="headerlink" title="recommended!"></a>recommended!</h1><p>chown_uploads=YES<br>chown_username=daemon</p>
<p>#chown_username=whoever<br>#</p>
<h1 id="The-name-of-log-file-when-xferlog-enable-YES-and-xferlog-std-format-YES"><a href="#The-name-of-log-file-when-xferlog-enable-YES-and-xferlog-std-format-YES" class="headerlink" title="The name of log file when xferlog_enable=YES and xferlog_std_format=YES"></a>The name of log file when xferlog_enable=YES and xferlog_std_format=YES</h1><h1 id="WARNING-changing-this-filename-affects-etc-logrotate-d-vsftpd-log"><a href="#WARNING-changing-this-filename-affects-etc-logrotate-d-vsftpd-log" class="headerlink" title="WARNING - changing this filename affects /etc/logrotate.d/vsftpd.log"></a>WARNING - changing this filename affects /etc/logrotate.d/vsftpd.log</h1><p>xferlog_file=/var/log/xferlog<br>#</p>
<h1 id="Switches-between-logging-into-vsftpd-log-file-and-xferlog-file-files"><a href="#Switches-between-logging-into-vsftpd-log-file-and-xferlog-file-files" class="headerlink" title="Switches between logging into vsftpd_log_file and xferlog_file files."></a>Switches between logging into vsftpd_log_file and xferlog_file files.</h1><h1 id="NO-writes-to-vsftpd-log-file-YES-to-xferlog-file"><a href="#NO-writes-to-vsftpd-log-file-YES-to-xferlog-file" class="headerlink" title="NO writes to vsftpd_log_file, YES to xferlog_file"></a>NO writes to vsftpd_log_file, YES to xferlog_file</h1><p>xferlog_std_format=YES<br>#</p>
<h1 id="You-may-change-the-default-value-for-timing-out-an-idle-session"><a href="#You-may-change-the-default-value-for-timing-out-an-idle-session" class="headerlink" title="You may change the default value for timing out an idle session."></a>You may change the default value for timing out an idle session.</h1><p>#idle_session_timeout=600<br>#</p>
<h1 id="You-may-change-the-default-value-for-timing-out-a-data-connection"><a href="#You-may-change-the-default-value-for-timing-out-a-data-connection" class="headerlink" title="You may change the default value for timing out a data connection."></a>You may change the default value for timing out a data connection.</h1><p>#data_connection_timeout=120<br>#</p>
<h1 id="It-is-recommended-that-you-define-on-your-system-a-unique-user-which-the"><a href="#It-is-recommended-that-you-define-on-your-system-a-unique-user-which-the" class="headerlink" title="It is recommended that you define on your system a unique user which the"></a>It is recommended that you define on your system a unique user which the</h1><h1 id="ftp-server-can-use-as-a-totally-isolated-and-unprivileged-user"><a href="#ftp-server-can-use-as-a-totally-isolated-and-unprivileged-user" class="headerlink" title="ftp server can use as a totally isolated and unprivileged user."></a>ftp server can use as a totally isolated and unprivileged user.</h1><p>#nopriv_user=ftpsecure<br>#</p>
<h1 id="Enable-this-and-the-server-will-recognise-asynchronous-ABOR-requests-Not"><a href="#Enable-this-and-the-server-will-recognise-asynchronous-ABOR-requests-Not" class="headerlink" title="Enable this and the server will recognise asynchronous ABOR requests. Not"></a>Enable this and the server will recognise asynchronous ABOR requests. Not</h1><h1 id="recommended-for-security-the-code-is-non-trivial-Not-enabling-it"><a href="#recommended-for-security-the-code-is-non-trivial-Not-enabling-it" class="headerlink" title="recommended for security (the code is non-trivial). Not enabling it,"></a>recommended for security (the code is non-trivial). Not enabling it,</h1><h1 id="however-may-confuse-older-FTP-clients"><a href="#however-may-confuse-older-FTP-clients" class="headerlink" title="however, may confuse older FTP clients."></a>however, may confuse older FTP clients.</h1><p>#async_abor_enable=YES<br>#</p>
<h1 id="By-default-the-server-will-pretend-to-allow-ASCII-mode-but-in-fact-ignore"><a href="#By-default-the-server-will-pretend-to-allow-ASCII-mode-but-in-fact-ignore" class="headerlink" title="By default the server will pretend to allow ASCII mode but in fact ignore"></a>By default the server will pretend to allow ASCII mode but in fact ignore</h1><h1 id="the-request-Turn-on-the-below-options-to-have-the-server-actually-do-ASCII"><a href="#the-request-Turn-on-the-below-options-to-have-the-server-actually-do-ASCII" class="headerlink" title="the request. Turn on the below options to have the server actually do ASCII"></a>the request. Turn on the below options to have the server actually do ASCII</h1><h1 id="mangling-on-files-when-in-ASCII-mode"><a href="#mangling-on-files-when-in-ASCII-mode" class="headerlink" title="mangling on files when in ASCII mode."></a>mangling on files when in ASCII mode.</h1><h1 id="Beware-that-on-some-FTP-servers-ASCII-support-allows-a-denial-of-service"><a href="#Beware-that-on-some-FTP-servers-ASCII-support-allows-a-denial-of-service" class="headerlink" title="Beware that on some FTP servers, ASCII support allows a denial of service"></a>Beware that on some FTP servers, ASCII support allows a denial of service</h1><h1 id="attack-DoS-via-the-command-“SIZE-big-file”-in-ASCII-mode-vsftpd"><a href="#attack-DoS-via-the-command-“SIZE-big-file”-in-ASCII-mode-vsftpd" class="headerlink" title="attack (DoS) via the command “SIZE /big/file” in ASCII mode. vsftpd"></a>attack (DoS) via the command “SIZE /big/file” in ASCII mode. vsftpd</h1><h1 id="predicted-this-attack-and-has-always-been-safe-reporting-the-size-of-the"><a href="#predicted-this-attack-and-has-always-been-safe-reporting-the-size-of-the" class="headerlink" title="predicted this attack and has always been safe, reporting the size of the"></a>predicted this attack and has always been safe, reporting the size of the</h1><h1 id="raw-file"><a href="#raw-file" class="headerlink" title="raw file."></a>raw file.</h1><h1 id="ASCII-mangling-is-a-horrible-feature-of-the-protocol"><a href="#ASCII-mangling-is-a-horrible-feature-of-the-protocol" class="headerlink" title="ASCII mangling is a horrible feature of the protocol."></a>ASCII mangling is a horrible feature of the protocol.</h1><p>#ascii_upload_enable=YES</p>
<p>#ascii_download_enable=YES<br>#</p>
<h1 id="You-may-fully-customise-the-login-banner-string"><a href="#You-may-fully-customise-the-login-banner-string" class="headerlink" title="You may fully customise the login banner string:"></a>You may fully customise the login banner string:</h1><p>#ftpd_banner=Welcome to blah FTP service.<br>#</p>
<h1 id="You-may-specify-a-file-of-disallowed-anonymous-e-mail-addresses-Apparently"><a href="#You-may-specify-a-file-of-disallowed-anonymous-e-mail-addresses-Apparently" class="headerlink" title="You may specify a file of disallowed anonymous e-mail addresses. Apparently"></a>You may specify a file of disallowed anonymous e-mail addresses. Apparently</h1><h1 id="useful-for-combatting-certain-DoS-attacks"><a href="#useful-for-combatting-certain-DoS-attacks" class="headerlink" title="useful for combatting certain DoS attacks."></a>useful for combatting certain DoS attacks.</h1><p>#deny_email_enable=YES</p>
<h1 id="default-follows"><a href="#default-follows" class="headerlink" title="(default follows)"></a>(default follows)</h1><p>#banned_email_file=/etc/vsftpd/banned_emails<br>#</p>
<h1 id="You-may-specify-an-explicit-list-of-local-users-to-chroot-to-their-home"><a href="#You-may-specify-an-explicit-list-of-local-users-to-chroot-to-their-home" class="headerlink" title="You may specify an explicit list of local users to chroot() to their home"></a>You may specify an explicit list of local users to chroot() to their home</h1><h1 id="directory-If-chroot-local-user-is-YES-then-this-list-becomes-a-list-of"><a href="#directory-If-chroot-local-user-is-YES-then-this-list-becomes-a-list-of" class="headerlink" title="directory. If chroot_local_user is YES, then this list becomes a list of"></a>directory. If chroot_local_user is YES, then this list becomes a list of</h1><h1 id="users-to-NOT-chroot"><a href="#users-to-NOT-chroot" class="headerlink" title="users to NOT chroot()."></a>users to NOT chroot().</h1><p>chroot_local_user=YES<br>chroot_list_enable=YES</p>
<h1 id="default-follows-1"><a href="#default-follows-1" class="headerlink" title="(default follows)"></a>(default follows)</h1><p>chroot_list_file=/etc/vsftpd/chroot_list<br>#</p>
<h1 id="You-may-activate-the-“-R”-option-to-the-builtin-ls-This-is-disabled-by"><a href="#You-may-activate-the-“-R”-option-to-the-builtin-ls-This-is-disabled-by" class="headerlink" title="You may activate the “-R” option to the builtin ls. This is disabled by"></a>You may activate the “-R” option to the builtin ls. This is disabled by</h1><h1 id="default-to-avoid-remote-users-being-able-to-cause-excessive-I-O-on-large"><a href="#default-to-avoid-remote-users-being-able-to-cause-excessive-I-O-on-large" class="headerlink" title="default to avoid remote users being able to cause excessive I/O on large"></a>default to avoid remote users being able to cause excessive I/O on large</h1><h1 id="sites-However-some-broken-FTP-clients-such-as-“ncftp”-and-“mirror”-assume"><a href="#sites-However-some-broken-FTP-clients-such-as-“ncftp”-and-“mirror”-assume" class="headerlink" title="sites. However, some broken FTP clients such as “ncftp” and “mirror” assume"></a>sites. However, some broken FTP clients such as “ncftp” and “mirror” assume</h1><h1 id="the-presence-of-the-“-R”-option-so-there-is-a-strong-case-for-enabling-it"><a href="#the-presence-of-the-“-R”-option-so-there-is-a-strong-case-for-enabling-it" class="headerlink" title="the presence of the “-R” option, so there is a strong case for enabling it."></a>the presence of the “-R” option, so there is a strong case for enabling it.</h1><p>#ls_recurse_enable=YES<br>#</p>
<h1 id="When-“listen”-directive-is-enabled-vsftpd-runs-in-standalone-mode-and"><a href="#When-“listen”-directive-is-enabled-vsftpd-runs-in-standalone-mode-and" class="headerlink" title="When “listen” directive is enabled, vsftpd runs in standalone mode and"></a>When “listen” directive is enabled, vsftpd runs in standalone mode and</h1><h1 id="listens-on-IPv4-sockets-This-directive-cannot-be-used-in-conjunction"><a href="#listens-on-IPv4-sockets-This-directive-cannot-be-used-in-conjunction" class="headerlink" title="listens on IPv4 sockets. This directive cannot be used in conjunction"></a>listens on IPv4 sockets. This directive cannot be used in conjunction</h1><h1 id="with-the-listen-ipv6-directive"><a href="#with-the-listen-ipv6-directive" class="headerlink" title="with the listen_ipv6 directive."></a>with the listen_ipv6 directive.</h1><p>listen=YES<br>#</p>
<h1 id="This-directive-enables-listening-on-IPv6-sockets-To-listen-on-IPv4-and-IPv6"><a href="#This-directive-enables-listening-on-IPv6-sockets-To-listen-on-IPv4-and-IPv6" class="headerlink" title="This directive enables listening on IPv6 sockets. To listen on IPv4 and IPv6"></a>This directive enables listening on IPv6 sockets. To listen on IPv4 and IPv6</h1><h1 id="sockets-you-must-run-two-copies-of-vsftpd-with-two-configuration-files"><a href="#sockets-you-must-run-two-copies-of-vsftpd-with-two-configuration-files" class="headerlink" title="sockets, you must run two copies of vsftpd with two configuration files."></a>sockets, you must run two copies of vsftpd with two configuration files.</h1><h1 id="Make-sure-that-one-of-the-listen-options-is-commented"><a href="#Make-sure-that-one-of-the-listen-options-is-commented" class="headerlink" title="Make sure, that one of the listen options is commented !!"></a>Make sure, that one of the listen options is commented !!</h1><p>#listen_ipv6=YES</p>
<p>pam_service_name=vsftpd<br>userlist_enable=YES<br>userlist_deny=YES<br>userlist_file=/etc/vsftpd/user_list<br>tcp_wrappers=YES<br>use_localtime=YES<br>banner_file=/etc/vsftpd/welcome.txt</p>
<p>pasv_min_port=65400<br>pasv_max_port=65410</p>
<p>ssl_enable=YES<br>allow_anon_ssl=NO<br>force_local_data_ssl=YES<br>force_local_logins_ssl=YES<br>ssl_tlsv1=YES<br>ssl_sslv2=NO<br>ssl_sslv3=NO<br>rsa_cert_file=/etc/vsftpd/vsftpd.pem</p>
<p>backup.sh</p>
<p>#!/bin/bash<br>backdir=”/etc /home /root /var/spool/mail”<br>basedir=/backup<br>[ ! -d “$basedir” ] &amp;&amp; mkdir $basedir<br>backfile=$basedir/backup.tar.gz<br>tar -zcvf $backfile $backdir</p>
<p>useradd.sh</p>
<p>#!/bin/bash<br>groupadd jinyangroup<br>for username in jinyan renjia sanyuan yuanmu renyuan<br>do<br>  useradd -G jinyangroup $username<br>  echo “yanjin” | passwd –stdin $username<br>done</p>
<p>chroot_list<br>jinyan<br>renjia<br>root</p>
<p>ftpusers</p>
<h1 id="Users-that-are-not-allowed-to-login-via-ftp"><a href="#Users-that-are-not-allowed-to-login-via-ftp" class="headerlink" title="Users that are not allowed to login via ftp"></a>Users that are not allowed to login via ftp</h1><h1 id="root"><a href="#root" class="headerlink" title="root"></a>root</h1><p>bin<br>daemon<br>adm<br>lp<br>sync<br>shutdown<br>halt<br>mail<br>news<br>uucp<br>operator<br>games<br>nobody</p>
<p>user_list</p>
<h1 id="vsftpd-userlist"><a href="#vsftpd-userlist" class="headerlink" title="vsftpd userlist"></a>vsftpd userlist</h1><h1 id="If-userlist-deny-NO-only-allow-users-in-this-file"><a href="#If-userlist-deny-NO-only-allow-users-in-this-file" class="headerlink" title="If userlist_deny=NO, only allow users in this file"></a>If userlist_deny=NO, only allow users in this file</h1><h1 id="If-userlist-deny-YES-default-never-allow-users-in-this-file-and"><a href="#If-userlist-deny-YES-default-never-allow-users-in-this-file-and" class="headerlink" title="If userlist_deny=YES (default), never allow users in this file, and"></a>If userlist_deny=YES (default), never allow users in this file, and</h1><h1 id="do-not-even-prompt-for-a-password"><a href="#do-not-even-prompt-for-a-password" class="headerlink" title="do not even prompt for a password."></a>do not even prompt for a password.</h1><h1 id="Note-that-the-default-vsftpd-pam-config-also-checks-etc-vsftpd-ftpusers"><a href="#Note-that-the-default-vsftpd-pam-config-also-checks-etc-vsftpd-ftpusers" class="headerlink" title="Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers"></a>Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers</h1><h1 id="for-users-that-are-denied"><a href="#for-users-that-are-denied" class="headerlink" title="for users that are denied."></a>for users that are denied.</h1><h1 id="root-1"><a href="#root-1" class="headerlink" title="root"></a>root</h1><p>bin<br>daemon<br>adm<br>lp<br>sync<br>shutdown<br>halt<br>mail<br>news<br>uucp<br>operator<br>games<br>nobody</p>
<p>[root@jinyan ~]# yum -y install vsftpd</p>
<p>[root@jinyan ~]# cat /etc/pam.d/vsftpd<br>auth       required     pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</p>
<p>[root@jinyan ~]# cat /etc/vsftpd/ftpusers</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd start<br>为 vsftpd 启动 vsftpd：[确定]<br>[root@jinyan ~]# netstat -tulnp| grep 21<br>tcp        0      0 0.0.0.0:21                  0.0.0.0:*                   LISTEN      1830/vsftpd</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf</p>
<h1 id="listen-YES"><a href="#listen-YES" class="headerlink" title="listen=YES"></a>listen=YES</h1><p>listen=NO</p>
<p>[root@jinyan ~]# yum -y install xinetd<br>[root@jinyan ~]# vim /etc/xinetd.d/vsftpd<br>service ftp<br>{<br>        socket_type             = stream<br>        wait                    = no<br>        user                    = root<br>        server                  = /usr/sbin/vsftpd<br>        log_on_success          += DURATION USERID<br>        log_on_failure          += USERID<br>        nice                    = 10<br>        disable                 = no<br>}</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd stop<br>关闭 vsftpd：[确定]<br>[root@jinyan ~]# /etc/init.d/xinetd restart<br>[root@jinyan ~]# netstat -tulnp| grep 21<br>tcp        0      0 :::21                       :::*                        LISTEN      2389/xinetd</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>listen=YES</p>
<p>[root@jinyan ~]# /etc/init.d/xinetd stop</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd start</p>
<p>[root@jinyan ~]# /etc/init.d/xinetd restart</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# netstat -tulnp| grep “:21”</p>
<p>tcp        0      0 0.0.0.0:21                  0.0.0.0:*                   LISTEN      2483/vsftpd</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>anonymous_enable=YES<br>local_enable=YES<br>write_enable=YES<br>local_umask=022<br>dirmessage_enable=YES<br>xferlog_enable=YES<br>connect_from_port_20=YES<br>xferlog_std_format=YES<br>listen=YES<br>pam_service_name=vsftpd<br>userlist_enable=YES<br>tcp_wrappers=YES</p>
<p>use_localtime=YES</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart<br>[root@jinyan ~]# chkconfig vsftpd on</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>anonymous_enable=NO<br>local_enable=YES<br>write_enable=YES<br>local_umask=002<br>userlist_enable=YES<br>userlist_deny=YES<br>userlist_file=/etc/vsftpd/user_list<br>use_localtime=YES</p>
<p>dirmessage_enable=YES<br>xferlog_enable=YES<br>connect_from_port_20=YES<br>xferlog_std_format=YES<br>listen=YES<br>pam_service_name=vsftpd<br>tcp_wrappers=YES<br>banner_file=/etc/vsftpd/welcome.txt</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/welcome.txt<br>欢迎光临本小站，本站提供 FTP 的相关服务！<br>主要的服务是针对本机实体用户提供的，<br>若有任何问题，请与仁佳联络！</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/user_list<br>root<br>bin</p>
<p>[root@jinyan ~]# yum  -y install ftp<br>[root@jinyan ~]# ftp localhost</p>
<p>[root@jinyan ~]# getsebool -a | grep ftp<br>allow_ftpd_anon_write –&gt; off<br>allow_ftpd_full_access –&gt; off<br>allow_ftpd_use_cifs –&gt; off<br>allow_ftpd_use_nfs –&gt; off<br>ftp_home_dir –&gt; off<br>ftpd_connect_db –&gt; off<br>httpd_enable_ftp_server –&gt; off<br>tftp_anon_write –&gt; off</p>
<p>[root@jinyan ~]# setsebool -P ftp_home_dir=1</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>chroot_local_user=YES<br>chroot_list_enable=YES<br>chroot_list_file=/etc/vsftpd/chroot_list</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/chroot_list</p>
<p>jinyan<br>renjia</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>local_max_rate=1000000  &lt;==记住喔，单位是 bytes/second</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>max_clients=10<br>max_per_ip=1<br>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>userlist_enable=YES<br>userlist_deny=NO<br>userlist_file=/etc/vsftpd/user_list<br>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>由于系统账号无法使用 FTP 是因为 PAM 模块与 vsftpd 的内建功能所<br>致，亦即是 /etc/vsftpd/ftpusers 及 /etc/vsftpd/user_list 这两个档案<br>的影响。所以你只要进入这两个档案，并且将 root 那一行批注掉，那 root 就<br>可以使用 vsftpd这个 FTP 服务了。不过，不建议如此作喔！</p>
<p>[root@jinyan ~]# mkdir /var/ftp/linux<br>[root@jinyan ~]# mkdir /var/ftp/gnu</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>anonymous_enable=YES<br>no_anon_password=YES</p>
<p>anon_max_rate=1000000<br>data_connection_timeout=60<br>idle_session_timeout=600<br>max_clients=50<br>max_per_ip=5<br>local_enable=NO</p>
<p>use_localtime=YES<br>dirmessage_enable=YES<br>xferlog_enable=YES<br>connect_from_port_20=YES<br>xferlog_std_format=YES<br>listen=YES<br>pam_service_name=vsftpd<br>tcp_wrappers=YES</p>
<p>banner_file=/etc/vsftpd/anon_welcome.txt</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/anon_welcome.txt<br>欢迎光临本站所提供的 FTP 服务！<br>本站主要提供 Linux 操作系统相关档案以及 GNU 自由软件喔！<br>有问题请与站长联络！谢谢大家！<br>主要的目录为：<br>linux   提供 Linux 操作系统相关软件<br>gnu     提供 GNU 的自由软件<br>uploads 提供匿名的您上传数据</p>
<p>[root@jinyan ~]# ftp localhost<br>Name (localhost:root): anonymous</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>write_enable=YES<br>anon_other_write_enable=YES<br>anon_mkdir_write_enable=YES<br>anon_upload_enable=YES</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# mkdir /var/ftp/uploads<br>[root@jinyan ~]# chown ftp /var/ftp/uploads<br>[root@jinyan ~]# setsebool -P allow_ftpd_anon_write=1<br>[root@jinyan ~]# setsebool -P allow_ftpd_full_access=1</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>write_enable=YES<br>anon_mkdir_write_enable=YES<br>anon_upload_enable=YES<br>chown_uploads=YES<br>chown_username=daemon</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>pasv_min_port=65400<br>pasv_max_port=65410</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>[root@www ~]# vim /etc/sysconfig/iptables-config</p>
<p>IPTABLES_MODULES=”ip_nat_ftp ip_conntrack_ftp”</p>
<p>[root@www ~]# /etc/init.d/iptables restart</p>
<p>[root@www ~]# vim /usr/local/virus/iptables/iptables.rule<br>iptables -A INPUT -p TCP -i $EXTIF –dport  21  –sport 1024:65534 -j ACCEPT<br>iptables -A INPUT -p TCP -i $EXTIF –dport 65400:65410 –sport 1024:65534 -j ACCEPT</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>xferlog_enable=YES<br>xferlog_file=/var/log/xferlog<br>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>ftp://192.168.0.99/<br>ftp://jinyan@192.168.0.99/<br>ftp://jinyan:yanjin@192.168.0.99/</p>
<p>[root@jinyan ~]# ldd $(which vsftpd) | grep ssl<br>        libssl.so.10 =&gt; /usr/lib64/libssl.so.10 (0x00007f59d2c3e000)<br>[root@jinyan ~]# cd /etc/pki/tls/certs<br>[root@jinyan certs]# make vsftpd.pem<br>Country Name (2 letter code) [XX]:CN<br>State or Province Name (full name) []:Jiangsu<br>Locality Name (eg, city) [Default City]:Changzhou<br>Organization Name (eg, company) [Default Company Ltd]:sanyuamempire<br>Organizational Unit Name (eg, section) []:IT<br>Common Name (eg, your name or your server’s hostname) []:centos.jinyan<br>Email Address []:jinyan@centos.jinyan</p>
<p>[root@jinyan certs]# cp -a vsftpd.pem /etc/vsftpd/<br>[root@jinyan certs]# ll /etc/vsftpd/vsftpd.pem<br>-rw——-. 1 root root 3128 8月   9 10:25 /etc/vsftpd/vsftpd.pem</p>
<p>[root@jinyan ~]# vim /etc/vsftpd/vsftpd.conf<br>local_enable=YES<br>write_enable=YES<br>local_umask=002<br>chroot_local_user=YES<br>chroot_list_enable=YES<br>chroot_list_file=/etc/vsftpd/chroot_list<br>local_max_rate=10000000</p>
<p>anonymous_enable=YES<br>no_anon_password=YES<br>anon_max_rate=1000000<br>data_connection_timeout=60<br>idle_session_timeout=600</p>
<p>ssl_enable=YES<br>allow_anon_ssl=NO<br>force_local_data_ssl=YES<br>force_local_logins_ssl=YES<br>ssl_tlsv1=YES<br>ssl_sslv2=NO<br>ssl_sslv3=NO<br>rsa_cert_file=/etc/vsftpd/vsftpd.pem</p>
<p>max_clients=50<br>max_per_ip=5<br>use_localtime=YES<br>dirmessage_enable=YES<br>xferlog_enable=YES<br>connect_from_port_20=YES<br>xferlog_std_format=YES<br>listen=YES<br>pam_service_name=vsftpd<br>tcp_wrappers=YES<br>banner_file=/etc/vsftpd/welcome.txt<br>dual_log_enable=YES<br>vsftpd_log_file=/var/log/vsftpd.log<br>pasv_min_port=65400<br>pasv_max_port=65410</p>
<p>[root@jinyan ~]# /etc/init.d/vsftpd restart</p>
<p>欢迎光临本小站，本站提供 FTP 的相关服务！<br>主要的服务是针对本机实体用户提供的，<br>若有任何问题，请与仁佳联络！</p>
<p>欢迎光临本站所提供的 FTP 服务！<br>本站主要提供 Linux 操作系统相关档案以及 GNU 自由软件喔！<br>有问题请与站长联络！谢谢大家！<br>主要的目录为：<br>linux   提供 Linux 操作系统相关软件<br>gnu     提供 GNU 的自由软件<br>uploads 提供匿名的您上传数据</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/FTP/" data-id="ciwvctjyz0015u1cy3nq5hhnn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-NFS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/NFS/" class="article-date">
  <time datetime="2016-12-15T03:40:43.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/NFS/">NFS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>exports<br>/tmp    <em>(rw,no_root_squash)<br>/home/public  10.0.0.0/24(rw)    </em>(ro)<br>/home/test    10.0.0.2(rw)<br>/home/linux   *.centos.jinyan(rw,all_squash,anonuid=45,anongid=45)<br>/rhome          10.0.0.0/24(rw,no_root_squash)<br>/cluster        10.0.0.0/24(rw,no_root_squash)</p>
<p>14.NFS服务器 p346<br>14.1 本章的行前准备工作 p347</p>
<p>14.2 NFS的由来与功能 p347</p>
<p>14.2.1 什么是NFS(Network File System) p347<br>File Server<br>RPC Remote Procedure Call</p>
<p>14.2.2 什么是RPC p348<br>RPC Server</p>
<p>14.2.3 运行NFS需要启动的RPC daemons p349<br>1.rpc.nfsd<br>2.rpc.mountd /etc/exports<br>3.rpc.lockd<br>4.rpc.statd</p>
<p>14.2.4 NFS的文件存取权限 p350<br>1.NFS Server/NFS Client刚好有相同的账号与组</p>
<p>2.NFS Server/NFS Client两侧UID相同但用户名不同</p>
<p>3.NFS Server并没客户端的UID<br>nobody nfsnobody</p>
<p>4.如果用户身份是root p351</p>
<p>14.3 NFS Server端的设置 p352</p>
<p>14.3.1 所需要的软件 p352<br>以 CentOS 6.x 为例的话，要设定好 NFS 服务器我们必须要有两个软件才行，分别是：</p>
<p>RPC 主程序：rpcbind</p>
<p>就如同刚刚提的到，我们的 NFS 其实可以被视为一个 RPC 服务，而要启动任何一个 RPC 服务之前，我们都需要做好 port 的对应 (mapping) 的工作才行，这个工作其实就是『 rpcbind 』这个服务所负责的！也就是说， 在启动任何一个 RPC 服务之前，我们都需要启动 rpcbind 才行！ (在 CentOS 5.x 以前这个软件称为 portmap，在 CentOS 6.x 之后才称为 rpcbind 的！)</p>
<p>NFS 主程序：nfs-utils</p>
<p>就是提供 rpc.nfsd 及 rpc.mountd 这两个 NFS daemons 与其他相关 documents 与说明文件、执行文件等的软件！这个就是 NFS 服务所需要的主要软件啦！一定要有喔！<br>好了，知道我们需要这两个软件之后，现在干嘛？赶快去你的系统先用 RPM 看一下有没有这两个软件啦！ 没有的话赶快用 RPM 或 yum 去安装喔！不然就玩不下去了！</p>
<p>例题：<br>请问我的主机是以 RPM 为套件管理的 Linux distribution ，例如 Red Hat, CentOS 与 SuSE 等版本，那么我要如何知道我的主机里面是否已经安装了 rpcbind 与 nfs 相关的软件呢？<br>答：<br>简单的使用『 rpm -qa | grep nfs 』与『 rpm -qa | grep rpcbind 』即可知道啦！如果没有安装的话， 在 CentOS 内可以使用『 yum install nfs-utils 』来安装！</p>
<p>CentOS 4.x<br>NFS: nfs-utils<br>RPC: portmap<br>1.portmap<br>2.nfs-utils<br>rpc.nfsd、rpc.mountd</p>
<p>rpm -qa | grep nfs<br>rpm -qa | grep portmap<br>yum install nfs-utils</p>
<p>14.3.2 NFS的软件结构p352<br>主要配置文件：/etc/exports<br>这个档案就是 NFS 的主要配置文件了！不过，系统并没有默认值，所以这个档案『 不一定会存在』，你可能必须要使用 vim 主动的建立起这个档案喔！我们等一下要谈的设定也仅只是这个档案而已吶！</p>
<p>NFS 文件系统维护指令：/usr/sbin/exportfs<br>这个是维护 NFS 分享资源的指令，我们可以利用这个指令重新分享 /etc/exports 变更的目录资源、将 NFS Server 分享的目录卸除或重新分享等等，这个指令是 NFS 系统里面相当重要的一个喔！至于指令的用法我们在底下会介绍。</p>
<p>分享资源的登录档：/var/lib/nfs/*tab<br>在 NFS 服务器的登录文件都放置到 /var/lib/nfs/ 目录里面，在该目录下有两个比较重要的登录档， 一个是 etab ，主要记录了 NFS 所分享出来的目录的完整权限设定值；另一个 xtab 则记录曾经链接到此 NFS 服务器的相关客户端数据。</p>
<p>客户端查询服务器分享资源的指令：/usr/sbin/showmount<br>这是另一个重要的 NFS 指令。exportfs 是用在 NFS Server 端，而 showmount 则主要用在 Client 端。这个 showmount 可以用来察看 NFS 分享出来的目录资源喔！</p>
<p>1./etc/exports<br>vim /etc/exports<br>2./usr/bin/exportfs</p>
<p>3./usr/sbin/showmount</p>
<p>4./var/lib/nfs/*tab<br>etab xtab</p>
<p>14.3.3 /etc/exports设置文件的语法与参数 p353<br>至于 NFS 服务器的架设实在很简单，你只要编辑好主要配置文件 /etc/exports 之后，先启动 rpcbind (若已经启动了，就不要重新启动)，然后再启动 nfs ，你的 NFS 就成功了！<br>vim /etc/exports<br>/tmp    192.168.245.0/24(ro)    localhost(rw)    *.jinyan.com(ro,sync)<br>你看看，这个配置文件有够简单吧！每一行最前面是要分享出来的目录，注意喔！是以目录为单位啊！ 然后这个目录可以依照不同的权限分享给不同的主机，像鸟哥上面的例子说明是： 要将 /tmp 分别分享给三个不同的主机或网域的意思。记得主机后面以小括号 () 设计权限参数， 若权限参数不止一个时，则以逗号 (,) 分开。且主机名与小括号是连在一起的喔！在这个档案内也可以利用 # 来批注呢。</p>
<p>至于主机名的设定主要有几个方式：</p>
<p>可以使用完整的 IP 或者是网域，例如 192.168.245.6 或 192.168.245.0/24 ，或 192.168.245.0/255.255.255.0 都可以接受！</p>
<p>也可以使用主机名，但这个主机名必须要在 /etc/hosts 内，或可使用 DNS 找到该名称才行啊！反正重点是可找到 IP 就是了。如果是主机名的话，那么他可以支持通配符，例如 * 或 ? 均可接受。</p>
<p>权限方面p354<br>至于权限方面 (就是小括号内的参数) 常见的参数则有：</p>
<p>参数值    内容说明<br>rw<br>ro    该目录分享的权限是可擦写 (read-write) 或只读 (read-only)，但最终能不能读写，还是与文件系统的 rwx 及身份有关。<br>sync<br>async    sync 代表数据会同步写入到内存与硬盘中，async 则代表数据会先暂存于内存当中，而非直接写入硬盘！<br>no_root_squash<br>root_squash    客户端使用 NFS 文件系统的账号若为 root 时，系统该如何判断这个账号的身份？预设的情况下，客户端 root 的身份会由 root_squash 的设定压缩成 nfsnobody， 如此对服务器的系统会较有保障。但如果你想要开放客户端使用 root 身份来操作服务器的文件系统，那么这里就得要开 no_root_squash 才行！<br>all_squash    不论登入 NFS 的使用者身份为何， 他的身份都会被压缩成为匿名用户，通常也就是 nobody(nfsnobody) 啦！<br>anonuid<br>anongid    anon 意指 anonymous (匿名者) 前面关于 *_squash 提到的匿名用户的 UID 设定值，通常为 nobody(nfsnobody)，但是你可以自行设定这个 UID 的值！当然，这个 UID 必需要存在于你的 /etc/passwd 当中！ anonuid 指的是 UID 而 anongid 则是群组的 GID 啰。</p>
<p>例题一：让 root 保有 root 的权限<br>我想将 /tmp 分享出去给大家使用，由于这个目录本来就是大家都可以读写的，因此想让所有的人都可以存取。此外，我要让 root 写入的档案还是具有 root 的权限，那如何设计配置文件？<br>答：<br>eg1<br>vim /etc/exports<br>/tmp    <em>(rw,no_root_squash)<br>主机名可以使用通配符，上头表示无论来自哪里都可以使用我的 /tmp 这个目录。 再次提醒，『 </em>(rw,no_root_squash) 』这一串设定值中间是没有空格符的喔！而 /tmp 与 *(rw,no_root_squash) 则是有空格符来隔开的！特别注意到那个 no_root_squash 的功能！在这个例子中，如果你是客户端，而且你是以 root 的身份登入你的 Linux 主机，那么当你 mount 上我这部主机的 /tmp 之后，你在该 mount 的目录当中，将具有『root 的权限！』</p>
<p>例题二：同一目录针对不同范围开放不同权限<br>我要将一个公共的目录 /home/public 公开出去，但是只有限定我的局域网络 192.168.245.0/24 这个网域且加入 yanjingroup (第一章的例题建立的群组) 的用户才能够读写，其他来源则只能读取。<br>答：<br>[root@yanjin ~]# mkdir /home/public<br>[root@yanjin ~]# setfacl -m g:jinyangroup:rwx /home/public<br>[root@yanjin ~]# vim /etc/exports<br>/tmp          <em>(rw,no_root_squash)<br>/home/public  10.0.0.0/24(rw)    </em>(ro)</p>
<h1 id="继续累加在后面，注意，我有将主机与网域分为两段-用空白隔开-喔！"><a href="#继续累加在后面，注意，我有将主机与网域分为两段-用空白隔开-喔！" class="headerlink" title="继续累加在后面，注意，我有将主机与网域分为两段 (用空白隔开) 喔！"></a>继续累加在后面，注意，我有将主机与网域分为两段 (用空白隔开) 喔！</h1><p>上面的例子说的是，当我的 IP 是在 192.168.245.0/24 这个网段的时候，那么当我在 Client 端挂载了 Server 端的 /home/public 后，针对这个被我挂载的目录我就具有可以读写的权限～ 至于如果我不是在这个网段之内，那么这个目录的数据我就仅能读取而已，亦即为只读的属性啦！</p>
<p>需要注意的是，通配符仅能用在主机名的分辨上面，IP 或网段就只能用 192.168.245.0/24 的状况， 不可以使用 192.168.245.* 喔！</p>
<p>例题三：仅给某个单一主机使用的目录设定<br>我要将一个私人的目录 /home/test 开放给 192.168.245.6 这个 Client 端的机器来使用时，该如何设定？ 假设使用者的身份是 jinyan 才具有完整的权限时。<br>答：<br>[root@yanjin ~]# mkdir /home/test<br>[root@yanjin ~]# setfacl -m u:jinyan:rwx /home/test<br>[root@yanjin ~]# vim /etc/exports<br>/tmp          <em>(rw,no_root_squash)<br>/home/public  10.0.0.0/24(rw)    </em>(ro)<br>/home/test    10.0.0.2(rw)</p>
<h1 id="只要设定-IP-正确即可！"><a href="#只要设定-IP-正确即可！" class="headerlink" title="只要设定 IP 正确即可！"></a>只要设定 IP 正确即可！</h1><p>这样就设定完成了！而且，只有 192.168.245.6 这部机器才能对 /home/test 这个目录进行存取喔！</p>
<p>例题四：开放匿名登录的情况<br>我要让 <em>.jinyan.com 网域的主机，登入我的 NFS 主机时，可以存取 /home/linux ，但是他们存数据的时候，我希望他们的 UID 与 GID 都变成 45 这个身份的使用者，假设我 NFS 服务器上的 UID 45 与 GID 45 的用户/组名为 nfsanon。<br>答：<br>[root@yanjin ~]# groupadd -g 45 nfsanon<br>[root@yanjin ~]# useradd -u 45 -g nfsanon nfsanon<br>[root@yanjin ~]# mkdir /home/linux<br>[root@yanjin ~]# setfacl -m u:nfsanon:rwx /home/linux<br>[root@yanjin ~]# vim /etc/exports<br>/tmp          </em>(rw,no_root_squash)<br>/home/public  10.0.0.0/24(rw)    <em>(ro)<br>/home/test    10.0.0.2(rw)<br>/home/linux   </em>.centos.jinyan(rw,all_squash,anonuid=45,anongid=45)</p>
<h1 id="如果要开放匿名，那么重点是-all-squash，并且要配合-anonuid-喔！"><a href="#如果要开放匿名，那么重点是-all-squash，并且要配合-anonuid-喔！" class="headerlink" title="如果要开放匿名，那么重点是 all_squash，并且要配合 anonuid 喔！"></a>如果要开放匿名，那么重点是 all_squash，并且要配合 anonuid 喔！</h1><p>特别注意到那个 all_squash 与 anonuid, anongid 的功能！如此一来，当 jinyan.com 登入这部 NFS 主机，并且在 /home/linux 写入档案时，该档案的所有人与所有群组，就会变成 /etc/passwd 里面对应的 UID 为 45 的那个身份的使用者了！</p>
<p>eg2<br>vim /etc/exports<br>/tmp        <em>(rw,no_root_squash)<br>/home/public    192.168.245.0/24(rw)    </em>(ro)</p>
<p>eg3<br>vim /etc/exports<br>/tmp        <em>(rw,no_root_squash)<br>/home/public    192.168.245.0/24(rw)    </em>(ro)<br>/home/test    192.168.245.6(rw)</p>
<p>eg4<br>vim /etc/exports<br>/tmp        <em>(rw,no_root_squash)<br>/home/public    192.168.245.0/24(rw)    </em>(ro)<br>/home/test    192.168.245.6(rw)<br>/home/jinyan    *.jinyan.com(rw,all_squash,anonuid=40,anongid=40)</p>
<p>1.客户端与主机端具有相同的UID与账号 p355</p>
<p>2.客户端与主机端的账号不同 p356</p>
<p>3.当客户端的身份为root时</p>
<p>14.3.4 启动NFS p357<br>[root@yanjin ~]# /etc/init.d/rpcbind start</p>
<h1 id="如果-rpcbind-本来就已经在执行了，那就不需要启动啊！"><a href="#如果-rpcbind-本来就已经在执行了，那就不需要启动啊！" class="headerlink" title="如果 rpcbind 本来就已经在执行了，那就不需要启动啊！"></a>如果 rpcbind 本来就已经在执行了，那就不需要启动啊！</h1><p>[root@yanjin ~]# /etc/init.d/nfs start</p>
<h1 id="有时候某些-distributions-可能会出现如下的警告讯息："><a href="#有时候某些-distributions-可能会出现如下的警告讯息：" class="headerlink" title="有时候某些 distributions 可能会出现如下的警告讯息："></a>有时候某些 distributions 可能会出现如下的警告讯息：</h1><p>[root@yanjin ~]# /etc/init.d/nfslock start<br>[root@yanjin ~]# chkconfig rpcbind on<br>[root@yanjin ~]# chkconfig nfs on<br>[root@yanjin ~]# chkconfig nfslock on</p>
<p>[root@yanjin ~]# tail /var/log/messages</p>
<p>[root@yanjin ~]# netstat -tulnp | grep -E ‘(rpc|nfs)’<br>rpcbind 启动的 port 在 111 ，同时启动在 UDP 与 TCP；<br>nfs 本身的服务启动在 port 2049 上头！<br>其他 rpc.* 服务启动的 port 则是随机产生的，因此需向 port 111 注册。</p>
<p>/etc/init.d/portmap start<br>/etc/init.d/nfs start</p>
<p>vim /etc/exports<br>/tmp        <em>(rw,no_root_squash,sync)<br>/home/public    192.168.245.0/24(rw,sync)    </em>(ro)<br>/home/test    192.168.245.6(rw,sync)<br>/home/jinyan    *.jinyan.com(rw,all_squash,anonuid=40,anongid=40,sync)</p>
<p>/etc/init.d/nfs restart</p>
<p>/etc/init.d/nfslock start</p>
<p>less /var/log/messages</p>
<p>netstat -tuln<br>tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN</p>
<p>rpc [-p] [IP|hostname] p358</p>
<p>eg1<br>rpcinfo -p localhost</p>
<p>[root@yanjin ~]# rpcinfo -p [IP|hostname]<br>[root@yanjin ~]# rpcinfo -t|-u  IP|hostname 程序名称<br>选项与参数：<br>-p ：针对某 IP (未写则预设为本机) 显示出所有的 port 与 porgram 的信息；<br>-t ：针对某主机的某支程序检查其 TCP 封包所在的软件版本；<br>-u ：针对某主机的某支程序检查其 UDP 封包所在的软件版本；</p>
<h1 id="1-显示出目前这部主机的-RPC-状态"><a href="#1-显示出目前这部主机的-RPC-状态" class="headerlink" title="1. 显示出目前这部主机的 RPC 状态"></a>1. 显示出目前这部主机的 RPC 状态</h1><p>[root@yanjin ~]# rpcinfo -p localhost<br>   program vers proto   port  service<br>    100000    4   tcp    111  portmapper<br>    100000    3   tcp    111  portmapper<br>    100000    2   tcp    111  portmapper<br>    100000    4   udp    111  portmapper<br>    100000    3   udp    111  portmapper<br>    100000    2   udp    111  portmapper<br>    100024    1   udp  52477  status<br>    100024    1   tcp  39850  status<br>    100011    1   udp    875  rquotad<br>    100011    2   udp    875  rquotad<br>    100011    1   tcp    875  rquotad<br>    100011    2   tcp    875  rquotad<br>    100003    2   tcp   2049  nfs<br>    100003    3   tcp   2049  nfs<br>    100003    4   tcp   2049  nfs<br>    100227    2   tcp   2049  nfs_acl<br>    100227    3   tcp   2049  nfs_acl<br>    100003    2   udp   2049  nfs<br>    100003    3   udp   2049  nfs<br>    100003    4   udp   2049  nfs<br>    100227    2   udp   2049  nfs_acl<br>    100227    3   udp   2049  nfs_acl<br>    100021    1   udp  42530  nlockmgr<br>    100021    3   udp  42530  nlockmgr<br>    100021    4   udp  42530  nlockmgr<br>    100021    1   tcp  44092  nlockmgr<br>    100021    3   tcp  44092  nlockmgr<br>    100021    4   tcp  44092  nlockmgr<br>    100005    1   udp  58024  mountd<br>    100005    1   tcp  38683  mountd<br>    100005    2   udp  36026  mountd<br>    100005    2   tcp  45361  mountd<br>    100005    3   udp  51655  mountd<br>    100005    3   tcp  53627  mountd</p>
<h1 id="程序代号-NFS版本-封包类型-埠口-服务名称"><a href="#程序代号-NFS版本-封包类型-埠口-服务名称" class="headerlink" title="程序代号 NFS版本 封包类型 埠口  服务名称"></a>程序代号 NFS版本 封包类型 埠口  服务名称</h1><h1 id="2-针对-nfs-这个程序检查其相关的软件版本信息-仅察看-TCP-封包"><a href="#2-针对-nfs-这个程序检查其相关的软件版本信息-仅察看-TCP-封包" class="headerlink" title="2. 针对 nfs 这个程序检查其相关的软件版本信息 (仅察看 TCP 封包)"></a>2. 针对 nfs 这个程序检查其相关的软件版本信息 (仅察看 TCP 封包)</h1><p>[root@yanjin ~]# rpcinfo -t localhost nfs<br>program 100003 version 2 ready and waiting<br>program 100003 version 3 ready and waiting<br>program 100003 version 4 ready and waiting</p>
<h1 id="可发现提供-nfs-的版本共有三种，分别是-2-3-4-版呦！"><a href="#可发现提供-nfs-的版本共有三种，分别是-2-3-4-版呦！" class="headerlink" title="可发现提供 nfs 的版本共有三种，分别是 2, 3, 4 版呦！"></a>可发现提供 nfs 的版本共有三种，分别是 2, 3, 4 版呦！</h1><p>仔细瞧瞧，上面出现的信息当中除了程序名称与埠口的对应可以与 netstat -tlunp 输出的结果作比对之外，还需要注意到 NFS 的版本支持！新的 NFS 版本传输速度较快，由上表看起来，我们的 NFS 至少支持到第 4 版，应该还算合理啦！ ^_^！ 如果你的 rpcinfo 无法输出，那就表示注册的数据有问题啦！可能需要重新启动 rpcbind 与 nfs 喔！</p>
<p>14.3.5 NFS的联机观察 p359<br>showmount [-ae] [hostname|IP]<br>选项与参数：<br>-a ：显示目前主机与客户端的 NFS 联机分享的状态；<br>-e ：显示某部主机的 /etc/exports 所分享的目录数据。</p>
<p>eg1<br>showmount -e localhost<br>Export list for localhost:<br>/home/linux  *.jinyan.com<br>/home/test   192.168.245.6<br>/home/public (everyone)<br>/tmp         (everyone)</p>
<p>tail /var/lib/nfs/etab<br>/home/public    192.168.245.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</p>
<h1 id="上面是同一行，可以看出除了-rw-sync-root-squash-等等，"><a href="#上面是同一行，可以看出除了-rw-sync-root-squash-等等，" class="headerlink" title="上面是同一行，可以看出除了 rw, sync, root_squash 等等，"></a>上面是同一行，可以看出除了 rw, sync, root_squash 等等，</h1><h1 id="其实还有-anonuid-及-anongid-等等的设定！"><a href="#其实还有-anonuid-及-anongid-等等的设定！" class="headerlink" title="其实还有 anonuid 及 anongid 等等的设定！"></a>其实还有 anonuid 及 anongid 等等的设定！</h1><p>tail /var/lib/nfs/xtab</p>
<p>exportfs [-aruv]<br>选项与参数：<br>-a ：全部挂载(或卸除) /etc/exports 档案内的设定<br>-r ：重新挂载 /etc/exports 里面的设定，此外，亦同步更新 /etc/exports<br>     及 /var/lib/nfs/xtab 的内容！<br>-u ：卸除某一目录<br>-v ：在 export 的时候，将分享的目录显示到屏幕上！</p>
<p>eg1重新挂载一次 /etc/exports 的设定<br>exportfs -arv</p>
<p>eg2 将已经分享的 NFS 目录资源，通通都卸除<br>exportfs -auv</p>
<p>14.3.6 NFS的安全性 p360<br>[root@yanjin ~]# vim /etc/sysconfig/nfs<br>RQUOTAD_PORT=1001   &lt;==约在 12 行左右<br>LOCKD_TCPPORT=30001 &lt;==约在 20 行左右<br>LOCKD_UDPPORT=30001 &lt;==约在 22 行左右<br>MOUNTD_PORT=1002    &lt;==约在 43 行左右</p>
<h1 id="记得设定值最左边的批注服务要拿掉之外，埠口的值你也可以自行决定。"><a href="#记得设定值最左边的批注服务要拿掉之外，埠口的值你也可以自行决定。" class="headerlink" title="记得设定值最左边的批注服务要拿掉之外，埠口的值你也可以自行决定。"></a>记得设定值最左边的批注服务要拿掉之外，埠口的值你也可以自行决定。</h1><p>[root@yanjin ~]# /etc/init.d/nfs restart<br>[root@yanjin ~]# rpcinfo -p | grep -E ‘(rquota|mount|nlock)’<br>    100011    1   udp   1001  rquotad<br>    100011    2   udp   1001  rquotad<br>    100011    1   tcp   1001  rquotad<br>    100011    2   tcp   1001  rquotad<br>    100021    1   udp  30001  nlockmgr<br>    100021    3   udp  30001  nlockmgr<br>    100021    4   udp  30001  nlockmgr<br>    100021    1   tcp  30001  nlockmgr<br>    100021    3   tcp  30001  nlockmgr<br>    100021    4   tcp  30001  nlockmgr<br>    100005    1   udp   1002  mountd<br>    100005    1   tcp   1002  mountd<br>    100005    2   udp   1002  mountd<br>    100005    2   tcp   1002  mountd<br>    100005    3   udp   1002  mountd<br>    100005    3   tcp   1002  mountd</p>
<h1 id="上述的输出数据已经被鸟哥汇整过了，没用到的埠口先挪掉了啦！"><a href="#上述的输出数据已经被鸟哥汇整过了，没用到的埠口先挪掉了啦！" class="headerlink" title="上述的输出数据已经被鸟哥汇整过了，没用到的埠口先挪掉了啦！"></a>上述的输出数据已经被鸟哥汇整过了，没用到的埠口先挪掉了啦！</h1><p>[root@yanjin ~]# vim /usr/local/virus/iptables/iptables.allow<br>  iptables -A INPUT -i $EXTIF -p tcp -s 10.0.0.0/24 -m multiport \<br>           –dport 111,2049,1001,1002,30001 -j ACCEPT<br>  iptables -A INPUT -i $EXTIF -p udp -s 10.0.0.0/24 -m multiport \<br>           –dport 111,2049,1001,1002,30001 -j ACCEPT</p>
<p>[root@yanjin ~]# /usr/local/virus/iptables/iptables.rule</p>
<h1 id="总是要重新执行这样防火墙规则才会顺利的生效啊！别忘记！别忘记！"><a href="#总是要重新执行这样防火墙规则才会顺利的生效啊！别忘记！别忘记！" class="headerlink" title="总是要重新执行这样防火墙规则才会顺利的生效啊！别忘记！别忘记！"></a>总是要重新执行这样防火墙规则才会顺利的生效啊！别忘记！别忘记！</h1><p>1.利用iptables做大范围联机的限制<br>vim /usr/local/virus/iptables/iptables.allow<br>iptables -A INPUT -i $EXTIF -p TCP -s 192.168.245.0/24 –dport 111 -j ACCEPT<br>iptables -A INPUT -i $EXTIF -p UCP -s 192.168.245.0/24 –dport 111 -j ACCEPT<br>iptables -A INPUT -i $EXTIF -p TCP -s 58.216.209.0/16 –dport 111 -j ACCEPT<br>iptables -A INPUT -i $EXTIF -p UCP -s 58.216.209.0/16 –dport 111 -j ACCEPT</p>
<p>2.利用TCP Wrappers限制<br>vim /etc/hosts.allow<br>mountd:192.168.245.0/24<br>mountd:58.216.209.0/24</p>
<p>vim /etc/hosts.deny<br>mountd: ALL</p>
<p>3.使用/etc/exports设置更安全的权限p361</p>
<p>4.更安全的partition规划<br>/etc/fstab</p>
<p>5.NFS服务器关机前的注意事项<br>需要注意的是，由于 NFS 使用的这个 RPC 服务，当客户端连上服务器时，那么你的服务器想要关机， 那可就会成为『不可能的任务』！如果你的服务器上面还有客户端在联机，那么你要关机， 可能得要等到数个钟头才能够正常的关机成功！嗄！真的假的！不相信吗？不然你自个儿试试看！^_^！</p>
<p>所以啰，建议你的 NFS Server 想要关机之前，能先『关掉 rpcbind 与 nfs 』这两个东西！ 如果无法正确的将这两个 daemons 关掉，那么先以 netstat -utlp 找出 PID ，然后以 kill 将他关掉先！这样才有办法正常的关机成功喔！这个请特别特别的注意呢！</p>
<p>当然啦，你也可以利用 showmount -a localhost 来查出来那个客户端还在联机？ 或者是查阅 /var/lib/nfs/rmtab 或 xtab 等档案来检查亦可。找到这些客户端后， 可以直接 call 他们啊！让他们能够帮帮忙先！ ^_^</p>
<p>事实上，客户端以 NFS 联机到服务器端时，如果他们可以下达一些比较不那么『硬』的挂载参数时， 就能够减少这方面的问题喔！相关的安全性可以参考下一小节的 客户端可处理的挂载参数与开机挂载。</p>
<p>/etc/init.d/portmap start<br>/etc/init.d/portmap stop<br>/etc/init.d/nfs start<br>/etc/init.d/nfs stop</p>
<p>showmount -a localhost<br>[root@jinyan ~]# cat /var/lib/nfs/rmtab<br>[root@jinyan ~]# cat /var/lib/nfs/xtab</p>
<p>netstat -utlp<br>kill -9 pid</p>
<p>14.4 NFS客户端的设置 p362<br>14.4.1 远程NFS服务器的挂载 p362<br>确认本地端已经启动了 rpcbind 服务！<br>扫瞄 NFS 服务器分享的目录有哪些，并了解我们是否可以使用 (showmount)；<br>在本地端建立预计要挂载的挂载点目录 (mkdir)；<br>利用 mount 将远程主机直接挂载到相关目录。</p>
<h1 id="1-启动必备的服务：若没有启动才启动，有启动则保持原样不动。"><a href="#1-启动必备的服务：若没有启动才启动，有启动则保持原样不动。" class="headerlink" title="1. 启动必备的服务：若没有启动才启动，有启动则保持原样不动。"></a>1. 启动必备的服务：若没有启动才启动，有启动则保持原样不动。</h1><p>[root@clientlinux ~]# /etc/init.d/rpcbind start<br>[root@clientlinux ~]# /etc/init.d/nfslock start<br>/etc/init.d/portmap start<br>/etc/init.d/nfslock start</p>
<h1 id="一般来说，系统默认会启动-rpcbind-，不过鸟哥之前关闭过，所以要启动。"><a href="#一般来说，系统默认会启动-rpcbind-，不过鸟哥之前关闭过，所以要启动。" class="headerlink" title="一般来说，系统默认会启动 rpcbind ，不过鸟哥之前关闭过，所以要启动。"></a>一般来说，系统默认会启动 rpcbind ，不过鸟哥之前关闭过，所以要启动。</h1><h1 id="另外，如果服务器端有启动-nfslock-的话，客户端也要启动才能生效！"><a href="#另外，如果服务器端有启动-nfslock-的话，客户端也要启动才能生效！" class="headerlink" title="另外，如果服务器端有启动 nfslock 的话，客户端也要启动才能生效！"></a>另外，如果服务器端有启动 nfslock 的话，客户端也要启动才能生效！</h1><h1 id="2-查询服务器提供哪些资源给我们使用呢？"><a href="#2-查询服务器提供哪些资源给我们使用呢？" class="headerlink" title="2. 查询服务器提供哪些资源给我们使用呢？"></a>2. 查询服务器提供哪些资源给我们使用呢？</h1><p>[root@clientlinux ~]# showmount -e 192.168.245.9</p>
<h1 id="3-建立挂载点，并且实际挂载看看啰！"><a href="#3-建立挂载点，并且实际挂载看看啰！" class="headerlink" title="3. 建立挂载点，并且实际挂载看看啰！"></a>3. 建立挂载点，并且实际挂载看看啰！</h1><p>[root@clientlinux ~]# mkdir -p /home/nfs/public<br>[root@clientlinux ~]# mount -t nfs 192.168.245.3:/home/public /home/nfs/public</p>
<h1 id="注意一下挂载的语法！『-t-nfs-』指定文件系统类型，"><a href="#注意一下挂载的语法！『-t-nfs-』指定文件系统类型，" class="headerlink" title="注意一下挂载的语法！『 -t nfs 』指定文件系统类型，"></a>注意一下挂载的语法！『 -t nfs 』指定文件系统类型，</h1><ol>
<li>总是得要看看挂载之后的情况如何，可以使用 df 或 mount 啦！<br>[root@clientlinux ~]# df</li>
</ol>
<p>portmap<br>showmount<br>mkdir<br>mount</p>
<p>showmount -e 192.168.245.9</p>
<p>mkdir -p /home/nfs/public</p>
<p>mount -t nfs 192.168.245.9:/home/public /home/nfs/public</p>
<p>df</p>
<p>umount /home/nfs/public</p>
<p>14.4.2 客户端可处理的挂载参数与开机挂载 p363<br>所以说，除了 NFS 服务器需要保护之外，我们取用人家的 NFS 文件系统也需要自我保护才行啊！ 那要如何自我保护啊？可以透过 mount 的指令参数喔！包括底下这些主要的参数可以尝试加入：</p>
<p>参数    参数代表意义    系统默认值<br>suid<br>nosuid    晓得啥是 SUID 吧？如果挂载的 partition 上面有任何 SUID 的 binary 程序时， 你只要使用 nosuid 就能够取消 SUID 的功能了！嗄？不知道什么是 SUID ？那就不要学人家架站嘛！@_@！ 赶紧回去基础学习篇第三版复习一下第十七章、程序与资源管理啦！    suid<br>rw<br>ro    你可以指定该文件系统是只读 (ro) 或可擦写喔！服务器可以提供给你可擦写， 但是客户端可以仅允许只读的参数设定值！    rw<br>dev<br>nodev    是否可以保留装置档案的特殊功能？一般来说只有 /dev 这个目录才会有特殊的装置，因此你可以选择 nodev 喔！    dev<br>exec<br>noexec    是否具有执行 binary file 的权限？ 如果你想要挂载的仅是数据区 (例如 /home)，那么可以选择 noexec 啊！    exec<br>user<br>nouser    是否允许使用者进行档案的挂载与卸除功能？ 如果要保护文件系统，最好不要提供使用者进行挂载与卸除吧！    nouser<br>auto<br>noauto    这个 auto 指的是『mount -a』时，会不会被挂载的项目。 如果你不需要这个 partition 随时被挂载，可以设定为 noauto。    auto</p>
<p>umount /home/nfs/public<br>mount -t nfs -o nosuid,noexec,nodev,rw 192.168.245.3:/home/public /home/nfs/public<br>[root@jinyan ~]# mount | grep addr<br>192.168.245.3:/home/public on /home/nfs/public type nfs (rw,noexec,nosuid,nodev,addr=192.168.245.3)<br>mount</p>
<ol>
<li>关于NFS特殊的挂载参数<br>参数    参数功能    预设参数<br>fg<br>bg    当执行挂载时，该挂载的行为会在前景 (fg) 还是在背景 (bg) 执行？ 若在前景执行时，则 mount 会持续尝试挂载，直到成功或 time out 为止，若为背景执行， 则 mount 会在背景持续多次进行 mount ，而不会影响到前景的程序操作。 如果你的网络联机有点不稳定，或是服务器常常需要开关机，那建议使用 bg 比较妥当。    fg<br>soft<br>hard    如果是 hard 的情况，则当两者之间有任何一部主机脱机，则 RPC 会持续的呼叫，直到对方恢复联机为止。如果是 soft 的话，那 RPC 会在 time out 后『重复』呼叫，而非『持续』呼叫， 因此系统的延迟会比较不这么明显。同上，如果你的服务器可能开开关关，建议用 soft 喔！    hard<br>intr    当你使用上头提到的 hard 方式挂载时，若加上 intr 这个参数， 则当 RPC 持续呼叫中，该次的呼叫是可以被中断的 (interrupted)。    没有<br>rsize<br>wsize    读出(rsize)与写入(wsize)的区块大小 (block size)。 这个设定值可以影响客户端与服务器端传输数据的缓冲记忆容量。一般来说， 如果在局域网络内 (LAN) ，并且客户端与服务器端都具有足够的内存，那这个值可以设定大一点， 比如说 32768 (bytes) 等，提升缓冲记忆区块将可提升 NFS 文件系统的传输能力！ 但要注意设定的值也不要太大，最好是达到网络能够传输的最大值为限。    rsize=1024<br>wsize=1024</li>
</ol>
<p>umount /home/nfs/public<br>mount -t nfs -o nosuid,noexec,nodev,rw \<br>-o bg,soft,rsize=32768,wsize=32768 192.168.245.9:/home/public /home/nfs/public</p>
<p>2.使得NFS开机即挂载p365</p>
<p>[root@clientlinux ~]# vim /etc/rc.d/rc.local<br>mount -t nfs -o nosuid,noexec,nodev,rw,bg,soft,rsize=32768,wsize=32768 \<br>192.168.245.9:/home/public /home/nfs/public</p>
<p>vim /etc/fstab<br>192.168.245.3:/home/public /home/nfs/public     nfs     nosuid,noexec,nodev,rw bg,soft,rsize=32768,wsize=32768 0 0</p>
<p>14.4.3 无法挂载的原因分析 p365<br>1.用户或客户端身份权限不符<br>[root@yanjin ~]#  mount -t nfs localhost:/home/test /mnt<br>mount.nfs: access denied by server while mounting localhost:/home/test<br>2.服务器或客户端某些服务未启动<br>[root@clientlinux ~]# mount -t nfs 192.168.100.254:/home/test /mnt<br>mount: mount to NFS server ‘192.168.100.254’ failed: System Error: Connection refused.</p>
<h1 id="如果你使用-ping-却发现网络与服务器都是好的，那么这个问题就是-rpcbind-没有开啦！"><a href="#如果你使用-ping-却发现网络与服务器都是好的，那么这个问题就是-rpcbind-没有开啦！" class="headerlink" title="如果你使用 ping 却发现网络与服务器都是好的，那么这个问题就是 rpcbind 没有开啦！"></a>如果你使用 ping 却发现网络与服务器都是好的，那么这个问题就是 rpcbind 没有开啦！</h1><p>[root@clientlinux ~]# mount -t nfs 192.168.100.254:/home/test /home/nfs<br>mount: mount to NFS server ‘192.168.100.254’ failed: RPC Error: Program not registered.</p>
<h1 id="注意看最后面的数据，确实有连上-RPC-，但是服务器的-RPC-告知我们，该程序无注册"><a href="#注意看最后面的数据，确实有连上-RPC-，但是服务器的-RPC-告知我们，该程序无注册" class="headerlink" title="注意看最后面的数据，确实有连上 RPC ，但是服务器的 RPC 告知我们，该程序无注册"></a>注意看最后面的数据，确实有连上 RPC ，但是服务器的 RPC 告知我们，该程序无注册</h1><p>3.被防火墙挡住了</p>
<p>14.4.4 自动挂载autofs的使用<br>1.建立主要配置文件/etc/auto.Master<br>[root@jinyan ~]# vim /etc/auto.master<br>/home/nfsfile    /etc/auto.nfs</p>
<p>2.建立数据对应文件内的挂载信息<br>[本地端次目录]  [-挂载参数]  [服务器所提供的目录]<br>选项与参数：<br>[本地端次目录] ：指的就是在 /etc/auto.master 内指定的目录之次目录<br>[-挂载参数]    ：就是前一小节提到的 rw,bg,soft 等等的参数啦！可有可无；<br>[服务器所提供的目录] ：例如 192.168.100.254:/home/public 等<br>[root@jinyan ~]# vim /etc/auto.nfs<br>public    -rw,bg,soft,rsize=32768,wsize=32768 192.168.245.9:/home/public<br>testing    -rw,bg,soft,rsize=32768,wsize=32768 192.168.245.9:/home/test<br>temp    -rw,bg,soft,rsize=32768,wsize=32768 192.168.245.9:/tmp</p>
<h1 id="参数部分，只要最前面加个-符号即可！"><a href="#参数部分，只要最前面加个-符号即可！" class="headerlink" title="参数部分，只要最前面加个 - 符号即可！"></a>参数部分，只要最前面加个 - 符号即可！</h1><p>3.实际操作与观察<br>[root@jinyan ~]# /etc/init.d/autofs stop<br>[root@jinyan ~]# /etc/init.d/autofs restart</p>
<p>mount; df</p>
<p>cd /home/nfs/public<br>mount; df</p>
<p>pwd</p>
<p>14.5 实例演练 p368<br>14.5.1 假设环境</p>
<p>14.5.2 实地演练<br>1.首先建立/etc/exports这个文件的内容<br>vim /etc/exports<br>/tmp        192.168.245.<em>(rw,no_root_squash)<br>/home/nfs    192.168.245.</em>(ro) <em>(ro,all_squash)<br>/home/upload    192.168.245.</em>(rw,all_squash,anonuid=210,anongid=210)<br>/home/andy    192.168.245.3(rw)</p>
<p>2.建立每个对应目录的实际Linux权限<br>1./tmp</p>
<p>2./home/nfs<br>mkdir -p /home/nfs<br>chmod 755 -R /home/nfs</p>
<p>3./home/upload<br>groupadd -g 210 nfs-upload<br>useradd -g 210 -u 210 -M nfs-upload<br>mkdir -p /home/upload<br>chown -R nfs-upload:nfs-upload /home/upload</p>
<p>[root@localhost ~]# useradd andy<br>[root@localhost ~]# ll -d /home/andy<br>drwx——. 5 andy andy 4096 7月  27 11:35 /home/andy</p>
<p>3.启动portmap与nfs服务p369<br>/etc/init.d/nfs restart<br>/etc/init.d/nfslock restart</p>
<p>4.在192.168.245.3这台机器上演练一下<br>/etc/init.d/nfs restart<br>/etc/init.d/nfslock restart<br>showmount -e 192.168.245.9</p>
<p>mount -t nfs 192.168.245.9:/tmp /mnt/tmp<br>mount -t nfs 192.168.245.9:/home/nfs /mnt/nfs<br>mount -t nfs 192.168.245.9:/home/upload /mnt/upload<br>mount -t nfs 192.168.245.9:/home/andy /mnt/andy</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/NFS/" data-id="ciwvctjzc001iu1cy1815h9ju" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SAMBA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/SAMBA/" class="article-date">
  <time datetime="2016-12-15T03:39:41.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/SAMBA/">SAMBA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div></pre></td><td class="code"><pre><div class="line">cupsd.conf</div><div class="line">MaxLogSize 0</div><div class="line">#</div><div class="line"># &quot;$Id: cupsd.conf.in 8805 2009-08-31 16:34:06Z mike $&quot;</div><div class="line">#</div><div class="line"># Sample configuration file for the CUPS scheduler.  See &quot;man cupsd.conf&quot; for a</div><div class="line"># complete description of this file.</div><div class="line">#</div><div class="line"> </div><div class="line"># Log general information in error_log - change &quot;warn&quot; to &quot;debug&quot;</div><div class="line"># for troubleshooting...</div><div class="line">LogLevel warn</div><div class="line"> </div><div class="line"># Administrator user group...</div><div class="line">SystemGroup sys root</div><div class="line"> </div><div class="line"> </div><div class="line"># Only listen for connections from the local machine.</div><div class="line">Listen 0.0.0.0:631</div><div class="line">Listen /var/run/cups/cups.sock</div><div class="line"> </div><div class="line"># Show shared printers on the local network.</div><div class="line">Browsing On</div><div class="line">BrowseOrder allow,deny</div><div class="line">BrowseAllow all</div><div class="line">BrowseLocalProtocols CUPS dnssd</div><div class="line"> </div><div class="line"># Default authentication type, when authentication is required...</div><div class="line">DefaultAuthType Basic</div><div class="line"> </div><div class="line"># Restrict access to the server...</div><div class="line">&lt;Location /&gt;</div><div class="line">  Order allow,deny</div><div class="line">  Allow From 127.0.0.0/8</div><div class="line">  Allow From 10.0.0.0/24</div><div class="line">  Allow From 192.168.0.0/24</div><div class="line">&lt;/Location&gt;</div><div class="line"> </div><div class="line"># Restrict access to the admin pages...</div><div class="line">&lt;Location /admin&gt;</div><div class="line">  Encryption Required</div><div class="line">  Order allow,deny</div><div class="line">  Allow From 127.0.0.0/8</div><div class="line">  Allow From 10.0.0.0/24</div><div class="line">  Allow From 192.168.0.0/24</div><div class="line">&lt;/Location&gt;</div><div class="line"> </div><div class="line"># Restrict access to configuration files...</div><div class="line">&lt;Location /admin/conf&gt;</div><div class="line">  AuthType Default</div><div class="line">  Require user @SYSTEM</div><div class="line">  Order allow,deny</div><div class="line">&lt;/Location&gt;</div><div class="line"> </div><div class="line"># Set the default printer/job policies...</div><div class="line">&lt;Policy default&gt;</div><div class="line">  # Job-related operations must be done by the owner or an administrator...</div><div class="line">  &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job CUPS-Move-Job CUPS-Get-Document&gt;</div><div class="line">    Require user @OWNER @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # All administration operations require an administrator to authenticate...</div><div class="line">  &lt;Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default CUPS-Get-Devices&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # All printer operations require a printer operator to authenticate...</div><div class="line">  &lt;Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After CUPS-Accept-Jobs CUPS-Reject-Jobs&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # Only the owner or an administrator can cancel or authenticate a job...</div><div class="line">  &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt;</div><div class="line">    Require user @OWNER @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  &lt;Limit All&gt;</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line">&lt;/Policy&gt;</div><div class="line"> </div><div class="line"># Set the authenticated printer/job policies...</div><div class="line">&lt;Policy authenticated&gt;</div><div class="line">  # Job-related operations must be done by the owner or an administrator...</div><div class="line">  &lt;Limit Create-Job Print-Job Print-URI&gt;</div><div class="line">    AuthType Default</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job CUPS-Move-Job CUPS-Get-Document&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @OWNER @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # All administration operations require an administrator to authenticate...</div><div class="line">  &lt;Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # All printer operations require a printer operator to authenticate...</div><div class="line">  &lt;Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After CUPS-Accept-Jobs CUPS-Reject-Jobs&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  # Only the owner or an administrator can cancel or authenticate a job...</div><div class="line">  &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt;</div><div class="line">    AuthType Default</div><div class="line">    Require user @OWNER @SYSTEM</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line"> </div><div class="line">  &lt;Limit All&gt;</div><div class="line">    Order deny,allow</div><div class="line">  &lt;/Limit&gt;</div><div class="line">&lt;/Policy&gt;</div><div class="line"> </div><div class="line">#</div><div class="line"># End of &quot;$Id: cupsd.conf.in 8805 2009-08-31 16:34:06Z mike $&quot;.</div><div class="line">#</div><div class="line"> </div><div class="line">smb.conf</div><div class="line"># This is the main Samba configuration file. You should read the</div><div class="line"># smb.conf(5) manual page in order to understand the options listed</div><div class="line"># here. Samba has a huge number of configurable options (perhaps too</div><div class="line"># many!) most of which are not shown in this example</div><div class="line">#</div><div class="line"># For a step to step guide on installing, configuring and using samba,</div><div class="line"># read the Samba-HOWTO-Collection. This may be obtained from:</div><div class="line">#  http://www.samba.org/samba/docs/Samba-HOWTO-Collection.pdf</div><div class="line">#</div><div class="line"># Many working examples of smb.conf files can be found in the</div><div class="line"># Samba-Guide which is generated daily and can be downloaded from:</div><div class="line">#  http://www.samba.org/samba/docs/Samba-Guide.pdf</div><div class="line">#</div><div class="line"># Any line which starts with a ; (semi-colon) or a # (hash)</div><div class="line"># is a comment and is ignored. In this example we will use a #</div><div class="line"># for commentry and a ; for parts of the config file that you</div><div class="line"># may wish to enable</div><div class="line">#</div><div class="line"># NOTE: Whenever you modify this file you should run the command &quot;testparm&quot;</div><div class="line"># to check that you have not made any basic syntactic errors.</div><div class="line">#</div><div class="line">#---------------</div><div class="line"># SELINUX NOTES:</div><div class="line">#</div><div class="line"># If you want to use the useradd/groupadd family of binaries please run:</div><div class="line"># setsebool -P samba_domain_controller on</div><div class="line">#</div><div class="line"># If you want to share home directories via samba please run:</div><div class="line"># setsebool -P samba_enable_home_dirs on</div><div class="line">#</div><div class="line"># If you create a new directory you want to share you should mark it as</div><div class="line"># &quot;samba_share_t&quot; so that selinux will let you write into it.</div><div class="line"># Make sure not to do that on system directories as they may already have</div><div class="line"># been marked with othe SELinux labels.</div><div class="line">#</div><div class="line"># Use ls -ldZ /path to see which context a directory has</div><div class="line">#</div><div class="line"># Set labels only on directories you created!</div><div class="line"># To set a label use the following: chcon -t samba_share_t /path</div><div class="line">#</div><div class="line"># If you need to share a system created directory you can use one of the</div><div class="line"># following (read-only/read-write):</div><div class="line"># setsebool -P samba_export_all_ro on</div><div class="line"># or</div><div class="line"># setsebool -P samba_export_all_rw on</div><div class="line">#</div><div class="line"># If you want to run scripts (preexec/root prexec/print command/...) please</div><div class="line"># put them into the /var/lib/samba/scripts directory so that smbd will be</div><div class="line"># allowed to run them.</div><div class="line"># Make sure you COPY them and not MOVE them so that the right SELinux context</div><div class="line"># is applied, to check all is ok use restorecon -R -v /var/lib/samba/scripts</div><div class="line">#</div><div class="line">#--------------</div><div class="line">#</div><div class="line">#======================= Global Settings =====================================</div><div class="line"> </div><div class="line">[global]</div><div class="line"> </div><div class="line">    unix password sync  = yes</div><div class="line">    passwd program      = /usr/bin/passwd %u</div><div class="line">    pam password change = yes</div><div class="line"> </div><div class="line">    unix charset = utf8</div><div class="line">    display charset = utf8</div><div class="line">    dos charset = gb2312</div><div class="line"># ----------------------- Network Related Options -------------------------</div><div class="line">#</div><div class="line"># workgroup = NT-Domain-Name or Workgroup-Name, eg: MIDEARTH</div><div class="line">#</div><div class="line"># server string is the equivalent of the NT Description field</div><div class="line">#</div><div class="line"># netbios name can be used to specify a server name not tied to the hostname</div><div class="line">#</div><div class="line"># Interfaces lets you configure Samba to use multiple interfaces</div><div class="line"># If you have multiple network interfaces then you can list the ones</div><div class="line"># you want to listen on (never omit localhost)</div><div class="line">#</div><div class="line"># Hosts Allow/Hosts Deny lets you restrict who can connect, and you can</div><div class="line"># specifiy it as a per share option as well</div><div class="line">#</div><div class="line">#    workgroup = MYGROUP</div><div class="line">        workgroup = WORKGROUP</div><div class="line">    server string = Samba Server Version %v</div><div class="line"> </div><div class="line">        netbios name = JinYanSERVER</div><div class="line">;    netbios name = MYSERVER</div><div class="line"> </div><div class="line">;    interfaces = lo eth0 192.168.12.2/24 192.168.13.2/24</div><div class="line">;    hosts allow = 127. 192.168.12. 192.168.13.</div><div class="line">        hosts allow = 127. 10.0.0.</div><div class="line"> </div><div class="line"># --------------------------- Logging Options -----------------------------</div><div class="line">#</div><div class="line"># Log File let you specify where to put logs and how to split them up.</div><div class="line">#</div><div class="line"># Max Log Size let you specify the max size log files should reach</div><div class="line"> </div><div class="line">    # logs split per machine</div><div class="line">    log file = /var/log/samba/log.%m</div><div class="line">    # max 50KB per log file, then rotate</div><div class="line">    max log size = 50</div><div class="line"> </div><div class="line"># ----------------------- Standalone Server Options ------------------------</div><div class="line">#</div><div class="line"># Scurity can be set to user, share(deprecated) or server(deprecated)</div><div class="line">#</div><div class="line"># Backend to store user information in. New installations should</div><div class="line"># use either tdbsam or ldapsam. smbpasswd is available for backwards</div><div class="line"># compatibility. tdbsam requires no further configuration.</div><div class="line"> </div><div class="line">    security = user</div><div class="line">#       security = share</div><div class="line">    passdb backend = tdbsam</div><div class="line"> </div><div class="line"> </div><div class="line"># ----------------------- Domain Members Options ------------------------</div><div class="line">#</div><div class="line"># Security must be set to domain or ads</div><div class="line">#</div><div class="line"># Use the realm option only with security = ads</div><div class="line"># Specifies the Active Directory realm the host is part of</div><div class="line">#</div><div class="line"># Backend to store user information in. New installations should</div><div class="line"># use either tdbsam or ldapsam. smbpasswd is available for backwards</div><div class="line"># compatibility. tdbsam requires no further configuration.</div><div class="line">#</div><div class="line"># Use password server option only with security = server or if you can&apos;t</div><div class="line"># use the DNS to locate Domain Controllers</div><div class="line"># The argument list may include:</div><div class="line">#   password server = My_PDC_Name [My_BDC_Name] [My_Next_BDC_Name]</div><div class="line"># or to auto-locate the domain controller/s</div><div class="line">#   password server = *</div><div class="line"> </div><div class="line"> </div><div class="line">;    security = domain</div><div class="line">;    passdb backend = tdbsam</div><div class="line">;    realm = MY_REALM</div><div class="line"> </div><div class="line">;    password server = &lt;NT-Server-Name&gt;</div><div class="line"> </div><div class="line"># ----------------------- Domain Controller Options ------------------------</div><div class="line">#</div><div class="line"># Security must be set to user for domain controllers</div><div class="line">#</div><div class="line"># Backend to store user information in. New installations should</div><div class="line"># use either tdbsam or ldapsam. smbpasswd is available for backwards</div><div class="line"># compatibility. tdbsam requires no further configuration.</div><div class="line">#</div><div class="line"># Domain Master specifies Samba to be the Domain Master Browser. This</div><div class="line"># allows Samba to collate browse lists between subnets. Don&apos;t use this</div><div class="line"># if you already have a Windows NT domain controller doing this job</div><div class="line">#</div><div class="line"># Domain Logons let Samba be a domain logon server for Windows workstations.</div><div class="line">#</div><div class="line"># Logon Scrpit let yuou specify a script to be run at login time on the client</div><div class="line"># You need to provide it in a share called NETLOGON</div><div class="line">#</div><div class="line"># Logon Path let you specify where user profiles are stored (UNC path)</div><div class="line">#</div><div class="line"># Various scripts can be used on a domain controller or stand-alone</div><div class="line"># machine to add or delete corresponding unix accounts</div><div class="line">#</div><div class="line">;    security = user</div><div class="line">;    passdb backend = tdbsam</div><div class="line"> </div><div class="line">;    domain master = yes</div><div class="line">;    domain logons = yes</div><div class="line">        domain master = yes</div><div class="line">        domain logons = yes</div><div class="line">    logon drive   = K:</div><div class="line">        logon script = startup.bat</div><div class="line">    time server   = yes</div><div class="line">    admin users   = root</div><div class="line">        logon path    = \\%N\%U\profile</div><div class="line">        logon home    = \\%N\%U</div><div class="line"> </div><div class="line">    # the login script name depends on the machine name</div><div class="line">;    logon script = %m.bat</div><div class="line">    # the login script name depends on the unix user used</div><div class="line">;    logon script = %u.bat</div><div class="line">;    logon path = \\%L\Profiles\%u</div><div class="line">    # disables profiles support by specifing an empty path</div><div class="line">;    logon path =         </div><div class="line"> </div><div class="line">;    add user script = /usr/sbin/useradd &quot;%u&quot; -n -g users</div><div class="line">;    add group script = /usr/sbin/groupadd &quot;%g&quot;</div><div class="line">;    add machine script = /usr/sbin/useradd -n -c &quot;Workstation (%u)&quot; -M -d /nohome -s /bin/false &quot;%u&quot;</div><div class="line">;    delete user script = /usr/sbin/userdel &quot;%u&quot;</div><div class="line">;    delete user from group script = /usr/sbin/userdel &quot;%u&quot; &quot;%g&quot;</div><div class="line">;    delete group script = /usr/sbin/groupdel &quot;%g&quot;</div><div class="line"> </div><div class="line"> </div><div class="line"># ----------------------- Browser Control Options ----------------------------</div><div class="line">#</div><div class="line"># set local master to no if you don&apos;t want Samba to become a master</div><div class="line"># browser on your network. Otherwise the normal election rules apply</div><div class="line">#</div><div class="line"># OS Level determines the precedence of this server in master browser</div><div class="line"># elections. The default value should be reasonable</div><div class="line">#</div><div class="line"># Preferred Master causes Samba to force a local browser election on startup</div><div class="line"># and gives it a slightly higher chance of winning the election</div><div class="line">;    local master = no</div><div class="line">;    os level = 33</div><div class="line">;    preferred master = yes</div><div class="line">        local master = yes</div><div class="line">        os level = 100</div><div class="line">        preferred master = yes</div><div class="line"> </div><div class="line">#----------------------------- Name Resolution -------------------------------</div><div class="line"># Windows Internet Name Serving Support Section:</div><div class="line"># Note: Samba can be either a WINS Server, or a WINS Client, but NOT both</div><div class="line">#</div><div class="line"># - WINS Support: Tells the NMBD component of Samba to enable it&apos;s WINS Server</div><div class="line">#</div><div class="line"># - WINS Server: Tells the NMBD components of Samba to be a WINS Client</div><div class="line">#</div><div class="line"># - WINS Proxy: Tells Samba to answer name resolution queries on</div><div class="line">#   behalf of a non WINS capable client, for this to work there must be</div><div class="line">#   at least one    WINS Server on the network. The default is NO.</div><div class="line">#</div><div class="line"># DNS Proxy - tells Samba whether or not to try to resolve NetBIOS names</div><div class="line"># via DNS nslookups.</div><div class="line"> </div><div class="line">;    wins support = yes</div><div class="line">        wins support = yes</div><div class="line">;    wins server = w.x.y.z</div><div class="line">;    wins proxy = yes</div><div class="line"> </div><div class="line">;    dns proxy = yes</div><div class="line"> </div><div class="line"># --------------------------- Printing Options -----------------------------</div><div class="line">#</div><div class="line"># Load Printers let you load automatically the list of printers rather</div><div class="line"># than setting them up individually</div><div class="line">#</div><div class="line"># Cups Options let you pass the cups libs custom options, setting it to raw</div><div class="line"># for example will let you use drivers on your Windows clients</div><div class="line">#</div><div class="line"># Printcap Name let you specify an alternative printcap file</div><div class="line">#</div><div class="line"># You can choose a non default printing system using the Printing option</div><div class="line"> </div><div class="line">    load printers = yes</div><div class="line">#       load printers = no</div><div class="line">    cups options = raw</div><div class="line"> </div><div class="line">;    printcap name = /etc/printcap</div><div class="line">    #obtain list of printers automatically on SystemV</div><div class="line">;    printcap name = lpstat</div><div class="line">        printcap name = cups</div><div class="line">        printing      = cups</div><div class="line">;    printing = cups</div><div class="line"> </div><div class="line"># --------------------------- Filesystem Options ---------------------------</div><div class="line">#</div><div class="line"># The following options can be uncommented if the filesystem supports</div><div class="line"># Extended Attributes and they are enabled (usually by the mount option</div><div class="line"># user_xattr). Thess options will let the admin store the DOS attributes</div><div class="line"># in an EA and make samba not mess with the permission bits.</div><div class="line">#</div><div class="line"># Note: these options can also be set just per share, setting them in global</div><div class="line"># makes them the default for all shares</div><div class="line"> </div><div class="line">;    map archive = no</div><div class="line">;    map hidden = no</div><div class="line">;    map read only = no</div><div class="line">;    map system = no</div><div class="line">;    store dos attributes = yes</div><div class="line"> </div><div class="line"> </div><div class="line">#============================ Share Definitions ==============================</div><div class="line"> </div><div class="line">[homes]</div><div class="line">    comment = Home Directories</div><div class="line">    browseable = no</div><div class="line">    writable = yes</div><div class="line">;    valid users = %S</div><div class="line">;    valid users = MYDOMAIN\%S</div><div class="line"> </div><div class="line">[printers]</div><div class="line">    comment = All Printers</div><div class="line">    path = /var/spool/samba</div><div class="line">    browseable = no</div><div class="line">    guest ok = no</div><div class="line">    writable = no</div><div class="line">    printable = yes</div><div class="line"> </div><div class="line"># Un-comment the following and create the netlogon directory for Domain Logons</div><div class="line">;    [netlogon]</div><div class="line">;    comment = Network Logon Service</div><div class="line">;    path = /var/lib/samba/netlogon</div><div class="line">;    guest ok = yes</div><div class="line">;    writable = no</div><div class="line">;    share modes = no</div><div class="line"> </div><div class="line"> </div><div class="line"># Un-comment the following to provide a specific roving profile share</div><div class="line"># the default is to use the user&apos;s home directory</div><div class="line">;    [Profiles]</div><div class="line">;    path = /var/lib/samba/profiles</div><div class="line">;    browseable = no</div><div class="line">;    guest ok = yes</div><div class="line"> </div><div class="line"> </div><div class="line"># A publicly accessible directory, but read only, except for people in</div><div class="line"># the &quot;staff&quot; group</div><div class="line">;    [public]</div><div class="line">;    comment = Public Stuff</div><div class="line">;    path = /home/samba</div><div class="line">;    public = yes</div><div class="line">;    writable = yes</div><div class="line">;    printable = no</div><div class="line">;    write list = +staff</div><div class="line">;    [temp]</div><div class="line">;       comment    = Temporary file space</div><div class="line">;    path       = /tmp</div><div class="line">;    writable   = yes</div><div class="line">;    browseable = yes</div><div class="line">;    guest ok   = yes</div><div class="line">    [homes]</div><div class="line">    comment        = Home Directories</div><div class="line">    browseable     = no</div><div class="line">    writable       = yes</div><div class="line">    create mode    = 0664</div><div class="line">    directory mode = 0775</div><div class="line">    [project]</div><div class="line">    comment    = smbuser&apos;s project</div><div class="line">    path       = /home/project</div><div class="line">    browseable = yes</div><div class="line">    writable   = yes</div><div class="line">    write list = @users</div><div class="line">    [printers]</div><div class="line">    comment = All Printers</div><div class="line">    path    = /var/spool/samba</div><div class="line">    browseable = no</div><div class="line">    guest ok   = no</div><div class="line">    writable   = no</div><div class="line">    printable  = yes</div><div class="line">    [print$]</div><div class="line">        comment    = Printer drivers</div><div class="line">        path       = /etc/samba/drivers</div><div class="line">        browseable = yes</div><div class="line">        guest ok   = no</div><div class="line">        read only  = yes</div><div class="line">        write list = root</div><div class="line">       [netlogon]</div><div class="line">        comment         = Network Logon Service</div><div class="line">        path            = /winhome/netlogon </div><div class="line">        writable        = no</div><div class="line">        write list      = root</div><div class="line">        follow symlinks = yes</div><div class="line">        guest ok        = yes</div><div class="line"> </div><div class="line">[root@jinyan ~]# rpm -qa samba*</div><div class="line">samba-client-3.5.10-125.el6.x86_64</div><div class="line">samba-common-3.5.10-125.el6.x86_64</div><div class="line">samba-3.5.10-125.el6.x86_64</div><div class="line">samba-winbind-clients-3.5.10-125.el6.x86_64</div><div class="line">[root@jinyan ~]# yum -y install samba</div><div class="line"> </div><div class="line">[root@jinyan ~]# cat /etc/sysconfig/i18n</div><div class="line">LANG=&quot;zh_CN.UTF-8&quot;</div><div class="line">[root@jinyan ~]# cd /etc/samba</div><div class="line">[root@jinyan samba]# cp smb.conf smb.conf.raw</div><div class="line">[root@jinyan ]# vim /etc/samba/smb.conf</div><div class="line">[global]</div><div class="line"> </div><div class="line">        unix charset = utf8</div><div class="line">        display charset = utf8</div><div class="line">        dos charset = gb2312</div><div class="line"> </div><div class="line">        workgroup = WORKGROUP</div><div class="line">        server string = Samba Server Version %v</div><div class="line"> </div><div class="line">        netbios name = JinYanSERVER</div><div class="line"> </div><div class="line">        log file = /var/log/samba/log.%m</div><div class="line"> </div><div class="line">        max log size = 50</div><div class="line"> </div><div class="line">        security = share</div><div class="line"> </div><div class="line">        load printers = no</div><div class="line"> </div><div class="line">    [temp]</div><div class="line">        comment    = Temporary file space</div><div class="line">    path       = /tmp</div><div class="line">    writable   = yes</div><div class="line">    browseable = yes</div><div class="line">    guest ok   = yes</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line">Load smb config files from /etc/samba/smb.conf</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">启动 SMB 服务：[确定]</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line">启动 NMB 服务：[确定]</div><div class="line">[root@jinyan ~]# chkconfig smb on</div><div class="line">[root@jinyan ~]# chkconfig nmb on</div><div class="line">[root@jinyan ~]# netstat -tunlp | grep mbd</div><div class="line">tcp        0      0 :::139                      :::*                        LISTEN      1818/smbd          </div><div class="line">tcp        0      0 :::445                      :::*                        LISTEN      1818/smbd          </div><div class="line">udp        0      0 192.168.245.255:137         0.0.0.0:*                               1827/nmbd          </div><div class="line">udp        0      0 192.168.245.6:137           0.0.0.0:*                               1827/nmbd          </div><div class="line">udp        0      0 0.0.0.0:137                 0.0.0.0:*                               1827/nmbd          </div><div class="line">udp        0      0 192.168.245.255:138         0.0.0.0:*                               1827/nmbd          </div><div class="line">udp        0      0 192.168.245.6:138           0.0.0.0:*                               1827/nmbd          </div><div class="line">udp        0      0 0.0.0.0:138                 0.0.0.0:*                               1827/nmbd  </div><div class="line"> </div><div class="line">[root@jinyan ~]# smbclient -L //127.0.0.1</div><div class="line">Enter root&apos;s password: 无密码</div><div class="line"> </div><div class="line">[root@jinyan ~]# mount -t cifs //127.0.0.1/temp /mnt</div><div class="line">Password: 无密码</div><div class="line">[root@jinyan ~]# df</div><div class="line">//127.0.0.1/temp       1007896     17652    939044   2% /mnt</div><div class="line"> </div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">        security = user</div><div class="line"> </div><div class="line">    [homes]</div><div class="line">    comment        = Home Directories</div><div class="line">    browseable     = no</div><div class="line">    writable       = yes</div><div class="line">    create mode    = 0664</div><div class="line">    directory mode = 0775</div><div class="line">    [project]</div><div class="line">    comment    = smbuser&apos;s project</div><div class="line">    path       = /home/project</div><div class="line">    browseable = yes</div><div class="line">    writable   = yes</div><div class="line">    write list = @users</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line">Load smb config files from /etc/samba/smb.conf</div><div class="line"> </div><div class="line">[root@jinyan ~]# mkdir /home/project</div><div class="line">[root@jinyan ~]# chgrp users /home/project</div><div class="line">[root@jinyan ~]# chmod 2770 /home/project</div><div class="line">[root@jinyan ~]# ll -d /home/project</div><div class="line">drwxrws---. 2 root users 4096  8月  3 08:39 /home/project</div><div class="line"> </div><div class="line">[root@jinyan ~]# useradd -G users xp1</div><div class="line">[root@jinyan ~]# useradd -G users xp2</div><div class="line">[root@jinyan ~]# useradd -G users xp3</div><div class="line">[root@jinyan ~]# useradd -G users jinyan</div><div class="line">[root@jinyan ~]# echo renjia | passwd --stdin xp1</div><div class="line">更改用户 xp1 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line">[root@jinyan ~]# echo renjia | passwd --stdin xp2</div><div class="line">更改用户 xp2 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line">[root@jinyan ~]# echo renjia | passwd --stdin xp3</div><div class="line">更改用户 xp3 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line">[root@jinyan ~]# echo renjia | passwd --stdin jinyan</div><div class="line">更改用户 jinyan 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div><div class="line"> </div><div class="line">[root@jinyan ~]# pdbedit -a -u xp1</div><div class="line">new password:</div><div class="line">retype new password:</div><div class="line">[root@jinyan ~]# pdbedit -a -u xp2</div><div class="line">new password:</div><div class="line">retype new password:</div><div class="line">[root@jinyan ~]# pdbedit -a -u xp3</div><div class="line">new password:</div><div class="line">retype new password:</div><div class="line">[root@jinyan ~]# pdbedit -a -u jinyan</div><div class="line">new password:</div><div class="line">retype new password:</div><div class="line"> </div><div class="line">[root@jinyan ~]# pdbedit -L</div><div class="line">xp1:500:</div><div class="line">xp3:502:</div><div class="line">xp2:501:</div><div class="line">jinyan:503:</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbpasswd xp3</div><div class="line">New SMB password:</div><div class="line">Retype new SMB password:</div><div class="line"> </div><div class="line">[root@jinyan ~]# pdbedit -x -u xp3</div><div class="line">[root@jinyan ~]# pdbedit -Lw</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">关闭 SMB 服务：[确定]</div><div class="line">启动 SMB 服务：[确定]</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line">关闭 NMB 服务：[确定]</div><div class="line">启动 NMB 服务：[确定]</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbclient -L //127.0.0.1</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbclient -L //127.0.0.1 -U xp1</div><div class="line">Enter xp1&apos;s password:</div><div class="line"> </div><div class="line">[root@jinyan ~]# mount -t cifs //127.0.0.1/xp1 /mnt -o username=xp1</div><div class="line">Password:</div><div class="line">[root@jinyan ~]# df</div><div class="line">//127.0.0.1/xp1        5035520    141164   4638564   3% /mnt</div><div class="line"> </div><div class="line">[root@jinyan ~]# ll -a /mnt</div><div class="line">ls: 正在读取目录/mnt: 权限不够</div><div class="line">[root@jinyan ~]# tail -n 60 /var/log/messages</div><div class="line">[root@jinyan ~]# setsebool -P samba_enable_home_dirs=1</div><div class="line">[root@jinyan ~]# ll -a /mnt</div><div class="line"> </div><div class="line">[root@jinyan ~]# lsusb</div><div class="line">Bus 002 Device 004: ID 04f9:01e0 Brother Industries, Ltd MFC-265C</div><div class="line">[root@jinyan ~]# ll /dev/usb/lp0</div><div class="line">crw-rw----. 1 root lp 180, 0  8月  3 08:59 /dev/usb/lp0</div><div class="line">[root@jinyan ~]# echo &quot;Hello printer&quot; &gt; /dev/usb/lp0</div><div class="line"> </div><div class="line">[root@jinyan ~]# yum -y groupinstall &quot;Print Server&quot;</div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/cups/cupsd.conf</div><div class="line"># Listen localhost:631</div><div class="line">Listen 0.0.0.0:631</div><div class="line"> </div><div class="line">&lt;Location /&gt;</div><div class="line">  Order allow,deny</div><div class="line">  Allow From 127.0.0.0/8</div><div class="line">  Allow From 10.0.0.0/24</div><div class="line">  Allow From 192.168.0.0/24</div><div class="line">&lt;/Location&gt;</div><div class="line"> </div><div class="line">&lt;Location /admin&gt;</div><div class="line">  Encryption Required</div><div class="line">  Order allow,deny</div><div class="line">  Allow From 127.0.0.0/8</div><div class="line">  Allow From 10.0.0.0/24</div><div class="line">  Allow From 192.168.0.0/24</div><div class="line">&lt;/Location&gt;</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/cups start</div><div class="line">正在启动 cups：</div><div class="line">[root@jinyan ~]# chkconfig cups on</div><div class="line">[root@jinyan ~]# netstat -tunlp | grep &apos;cups&apos;</div><div class="line">tcp        0      0 127.0.0.1:631               0.0.0.0:*                   LISTEN      2533/cupsd         </div><div class="line">tcp        0      0 ::1:631                     :::*                        LISTEN      2533/cupsd         </div><div class="line">udp        0      0 0.0.0.0:631                 0.0.0.0:*                               2533/cupsd </div><div class="line"> </div><div class="line">[root@www ~]# vim /usr/local/virus/iptables/iptables.allow</div><div class="line">    # 加入底下这几行！</div><div class="line">  iptables -A INPUT -i $EXTIF -p tcp -s 10.0.0.0/24 -m multiport \</div><div class="line">           --dport 139,445 -j ACCEPT</div><div class="line">  iptables -A INPUT -i $EXTIF -p tcp -s 192.168.0.0/24 -m multiport \</div><div class="line">           --dport 139,445 -j ACCEPT</div><div class="line">  iptables -A INPUT -i $EXTIF -p udp -s 10.0.0.0/24 -m multiport \</div><div class="line">           --dport 137,138 -j ACCEPT</div><div class="line">  iptables -A INPUT -i $EXTIF -p udp -s 192.168.0.0/24 -m multiport \</div><div class="line">           --dport 137,138 -j ACCEPT</div><div class="line">  iptables -A INPUT -i $EXTIF -p tcp -s 10.0.0.0/24 --dport 631 -j ACCEPT</div><div class="line">  iptables -A INPUT -i $EXTIF -p udp -s 10.0.0.0/24 --dport 631 -j ACCEPT</div><div class="line"> </div><div class="line">[root@www ~]# /usr/local/virus/iptables/iptables.rule</div><div class="line"> </div><div class="line">https://10.0.0.254:631/</div><div class="line">https://192.168.0.99:631/</div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">    load printers = yes</div><div class="line">    cups options  = raw   </div><div class="line"> </div><div class="line">        printcap name = cups</div><div class="line">        printing      = cups  </div><div class="line"> </div><div class="line">    [printers]</div><div class="line">    comment = All Printers</div><div class="line">    path    = /var/spool/samba</div><div class="line">    browseable = no</div><div class="line">    guest ok   = no</div><div class="line">    writable   = no</div><div class="line">    printable  = yes</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line"> </div><div class="line">http://www.cups.org/software.php?VERSION=Windows+Driver</div><div class="line"> </div><div class="line">[root@jinyan ~]# rpm -ivh cups-windows-6.0-1.i386.rpm</div><div class="line"> </div><div class="line">[root@jinyan ~]# ll /usr/share/cups/drivers/</div><div class="line">-rw-r--r--. 1 root root     803  4月 20 2006 cups6.inf</div><div class="line">-rw-r--r--. 1 root root      72  4月 20 2006 cups6.ini</div><div class="line">-rw-r--r--. 1 root root   12568  4月 20 2006 cupsps6.dll</div><div class="line">-rw-r--r--. 1 root root   13672  4月 20 2006 cupsui6.dll</div><div class="line">-rw-r--r--. 1 root root  728576  4月 13 2008 PS5UI.DLL</div><div class="line">-rw-r--r--. 1 root root  543232  4月 13 2008 PSCRIPT5.DLL</div><div class="line">-rw-r--r--. 1 root root   14787  9月 18 2007 PSCRIPT.HLP</div><div class="line">-rw-r--r--. 1 root root 1060548  5月 14 2007 PSCRIPT.NTF</div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">    [print$]</div><div class="line">        comment    = Printer drivers</div><div class="line">        path       = /etc/samba/drivers</div><div class="line">        browseable = yes</div><div class="line">        guest ok   = no</div><div class="line">        read only  = yes</div><div class="line">        write list = root</div><div class="line"> </div><div class="line">[root@jinyan ~]# mkdir /etc/samba/drivers</div><div class="line">[root@jinyan ~]# chcon -t samba_share_t /etc/samba/drivers</div><div class="line">[root@jinyan ~]# pdbedit -a -u root</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbclient -L //127.0.0.1 -U root</div><div class="line"> </div><div class="line">[root@jinyan ~]# cupsaddsmb -H localhost -U root -a -v</div><div class="line"> </div><div class="line">[root@jinyan ~]# ll /etc/samba/drivers</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/cups restart</div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line"> </div><div class="line">lpstat -a</div><div class="line">lpq</div><div class="line">lprm -</div><div class="line"> </div><div class="line">[root@jinyan ~]# getsebool -a | grep samba</div><div class="line">samba_create_home_dirs --&gt; off</div><div class="line">samba_domain_controller --&gt; off</div><div class="line">samba_enable_home_dirs --&gt; on</div><div class="line">samba_export_all_ro --&gt; off</div><div class="line">samba_export_all_rw --&gt; off</div><div class="line">samba_run_unconfined --&gt; off</div><div class="line">samba_share_fusefs --&gt; off</div><div class="line">samba_share_nfs --&gt; off</div><div class="line">use_samba_home_dirs --&gt; off</div><div class="line">virt_use_samba --&gt; off</div><div class="line">[root@jinyan ~]# setsebool -P samba_enable_home_dirs=1</div><div class="line"> </div><div class="line">[root@jinyan ~]# getsebool -a | grep samba_enable_home</div><div class="line"> </div><div class="line">[root@jinyan ~]# ll -Zd /home/project</div><div class="line">drwxrws---. root users unconfined_u:object_r:home_root_t:s0 /home/project</div><div class="line">[root@jinyan ~]# chcon -t samba_share_t /home/project</div><div class="line">[root@jinyan ~]# ll -Zd /home/project</div><div class="line">drwxrws---. root users unconfined_u:object_r:samba_share_t:s0 /home/project</div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">        hosts allow = 127. 10.0.0.</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line"> </div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/fstab</div><div class="line">/dev/mapper/server-myhome /home                   ext4    defaults,usrquota,grpquota        1 2</div><div class="line">[root@jinyan ~]# umount /home</div><div class="line">[root@jinyan ~]# mount -a</div><div class="line"> </div><div class="line">[root@jinyan ~]# mount | grep home</div><div class="line">/dev/mapper/server-myhome on /home type ext4 (rw,usrquota,grpquota)</div><div class="line"> </div><div class="line">[root@jinyan ~]# quotacheck -avug</div><div class="line">quotacheck: Scanning /dev/mapper/server-myhome [/home] done</div><div class="line"> </div><div class="line">[root@jinyan ~]# quotaon -avug</div><div class="line">/dev/mapper/server-myhome [/home]: group quotas turned on</div><div class="line">/dev/mapper/server-myhome [/home]: user quotas turned on</div><div class="line"> </div><div class="line">[root@jinyan ~]# quotaoff -a</div><div class="line"> </div><div class="line">[root@jinyan ~]# edquota -u xp1</div><div class="line"> </div><div class="line">Disk quotas for user xp1 (uid 500):</div><div class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</div><div class="line">  /dev/mapper/server-myhome         20      300000     400000          5        0        0</div><div class="line"> </div><div class="line">[root@jinyan ~]# edquota -p xp1 xp2</div><div class="line">[root@jinyan ~]# edquota -p xp1 xp3</div><div class="line">[root@jinyan ~]# repquota -ua</div><div class="line">*** Report for user quotas on device /dev/mapper/server-myhome</div><div class="line">Block grace time: 7days; Inode grace time: 7days</div><div class="line">                        Block limits                File limits</div><div class="line">User            used    soft    hard  grace    used  soft  hard  grace</div><div class="line">----------------------------------------------------------------------</div><div class="line">root      --      24       0       0              3     0     0      </div><div class="line">xp1       --      20  300000  400000              5     0     0      </div><div class="line">xp2       --      20  300000  400000              5     0     0      </div><div class="line">xp3       --      20  300000  400000              5     0     0      </div><div class="line">jinyan    --   29644       0       0            195     0     0</div><div class="line"> </div><div class="line">Windows系统使用</div><div class="line">网上邻居</div><div class="line">运行：\\192.168.245.6</div><div class="line"> </div><div class="line"> </div><div class="line">Linux 系统的使用</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# smbclient -L //10.0.0.254 -U xp1</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# smbclient &apos;//10.0.0.254/xp1&apos; -U xp1</div><div class="line">Enter xp1&apos;s password:</div><div class="line">Domain=[WORKGROUP] OS=[Unix] Server=[Samba 3.5.10-125.el6]</div><div class="line">smb: \&gt;</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# mkdir /mnt/samba</div><div class="line">[root@sanyuanempire ~]# mount -t cifs //10.0.0.254/xp1 /mnt/samba</div><div class="line">Password:</div><div class="line">[root@sanyuanempire ~]# df</div><div class="line">//192.168.245.6/xp1    5035520    170804   4608924   4% /mnt/samba</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# nmblookup -U 10.0.0.254 JinYanserver</div><div class="line">querying JinYanserver on 192.168.245.6</div><div class="line">192.168.245.6 JinYanserver&lt;00&gt;</div><div class="line"> </div><div class="line">192.168.245.6 JinYanserver&lt;00&gt;</div><div class="line">[root@sanyuanempire ~]# nmblookup -S JinYanserver</div><div class="line">querying JinYanserver on 192.168.122.255</div><div class="line">querying JinYanserver on 192.168.245.255</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# smbtree</div><div class="line">Enter root&apos;s password:</div><div class="line"> </div><div class="line">[root@sanyuanempire ~]# smbtree -S</div><div class="line">WORKGROUP</div><div class="line">        \\JINYANXP</div><div class="line">        \\JINYANSERVER                  Samba Server Version 3.5.10-125.el6</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbstatus</div><div class="line"> </div><div class="line"> </div><div class="line">PDC</div><div class="line">[root@jinyan ~]# vim /etc/samba/lmhosts</div><div class="line">127.0.0.1 localhost</div><div class="line">10.0.0.254 www.centos.jinyan</div><div class="line">10.0.0.1 jinyanxp</div><div class="line">10.0.0.2 client.centos.jinyan</div><div class="line">10.0.0.3 server.centos.jinyan</div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/hosts</div><div class="line"> </div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">10.0.0.254      www.centos.jinyan</div><div class="line">10.0.0.1        jinyanxp</div><div class="line">10.0.0.2        client.centos.jinyan</div><div class="line">10.0.0.3        client.fedora.jinyan</div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">[global]</div><div class="line">        workgroup = WORKGROUP</div><div class="line">        server string = Samba Server Version %v</div><div class="line"> </div><div class="line">        netbios name = JinYanSERVER</div><div class="line"> </div><div class="line">        log file = /var/log/samba/log.%m</div><div class="line"> </div><div class="line">        max log size = 50</div><div class="line"> </div><div class="line">        security = user</div><div class="line">        passdb backend = tdbsam</div><div class="line"> </div><div class="line">        load printers = yes</div><div class="line">        cups options = raw</div><div class="line"> </div><div class="line">        printcap name = cups</div><div class="line">        printing = cups</div><div class="line"> </div><div class="line">        local master = yes</div><div class="line">        os level = 100</div><div class="line">        preferred master = yes</div><div class="line"> </div><div class="line">        domain master = yes</div><div class="line">        domain logons = yes</div><div class="line">    logon drive   = K:</div><div class="line">        logon script = startup.bat</div><div class="line">    time server   = yes</div><div class="line">    admin users   = root</div><div class="line">        logon path    = \\%N\%U\profile</div><div class="line">        logon home    = \\%N\%U</div><div class="line"> </div><div class="line">        wins support = yes</div><div class="line"> </div><div class="line">       [netlogon]</div><div class="line">        comment         = Network Logon Service</div><div class="line">        path            = /winhome/netlogon </div><div class="line">        writable        = no</div><div class="line">        write list      = root</div><div class="line">        follow symlinks = yes</div><div class="line">        guest ok        = yes</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line">关闭 SMB 服务：[确定]</div><div class="line">启动 SMB 服务：[确定]</div><div class="line">[root@jinyan ~]# /etc/init.d/nmb restart</div><div class="line">关闭 NMB 服务：[确定]</div><div class="line">启动 NMB 服务：[确定]</div><div class="line"> </div><div class="line">[root@jinyan ~]# mkdir -p /winhome/netlogon</div><div class="line">[root@jinyan ~]# vim /winhome/netlogon/startup.bat</div><div class="line"> </div><div class="line">net time \\JinYanserver /set /yes</div><div class="line">net use K: /home</div><div class="line"> </div><div class="line">[root@jinyan ~]# yum -y install unix2dos</div><div class="line">[root@jinyan ~]# unix2dos /winhome/netlogon/startup.bat</div><div class="line">unix2dos: converting file /winhome/netlogon/startup.bat to DOS format ...</div><div class="line">[root@jinyan ~]# cat -A /winhome/netlogon/startup.bat</div><div class="line">net time \\JinYanserver /set /yes ^M$</div><div class="line">net use K: /home ^M$</div><div class="line"> </div><div class="line">[root@jinyan ~]# mkdir /etc/skel/profile</div><div class="line">[root@jinyan ~]# useradd -d /winhome/jingyi jingyi</div><div class="line">[root@jinyan ~]# useradd -d /winhome/empire empire</div><div class="line">[root@jinyan ~]# smbpasswd -a root</div><div class="line">New SMB password:</div><div class="line">Retype new SMB password:</div><div class="line">[root@jinyan ~]# smbpasswd -a jingyi</div><div class="line">New SMB password:</div><div class="line">Retype new SMB password:</div><div class="line">Added user yuanmu.</div><div class="line">[root@jinyan ~]# smbpasswd -a empire</div><div class="line">New SMB password:</div><div class="line">Retype new SMB password:</div><div class="line">Added user sanyuan.</div><div class="line">[root@jinyan ~]# pdbedit -L</div><div class="line">xp1:500:</div><div class="line">root:0:root</div><div class="line">xp2:501:</div><div class="line">jinyan:503:</div><div class="line">xp3:502:</div><div class="line">yuanmu:504:</div><div class="line"> </div><div class="line">[root@jinyan ~]#  ll /winhome</div><div class="line">总用量 12</div><div class="line">drwxr-xr-x. 2 root    root    4096  8月  3 11:23 netlogon</div><div class="line">drwx------. 5 sanyuan sanyuan 4096  8月  3 11:25 sanyuan</div><div class="line">drwx------. 5 yuanmu  yuanmu  4096  8月  3 11:24 yuanmu</div><div class="line"> </div><div class="line">[root@jinyan ~]# useradd -M -s /sbin/nologin -d /dev/null jinyanxp$</div><div class="line"> </div><div class="line">[root@jinyan ~]# smbpasswd -a -m jinyanxp$</div><div class="line">Added user jinyanxp$.</div><div class="line"> </div><div class="line">[root@jinyan ~]# chcon -R -t samba_share_t /winhome</div><div class="line"> </div><div class="line">[root@jinyan ~]# vim /etc/samba/smb.conf</div><div class="line">    unix password sync  = yes</div><div class="line">    passwd program      = /usr/bin/passwd %u</div><div class="line">    pam password change = yes</div><div class="line"> </div><div class="line">[root@jinyan ~]# testparm</div><div class="line"> </div><div class="line">[root@jinyan ~]# /etc/init.d/smb restart</div><div class="line"> </div><div class="line">[jinyan@jinyan ~]$ smbpasswd</div><div class="line">Old SMB password:</div><div class="line">New SMB password:</div><div class="line">Retype new SMB password:</div><div class="line">Password changed for user jinyan</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/SAMBA/" data-id="ciwvctjzk001pu1cyyn37jrzm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-5-KickStart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-5-KickStart/" class="article-date">
  <time datetime="2016-12-15T03:38:11.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-5-KickStart/">CentOS 6.5 KickStart</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vim /etc/dhcp/dhcpd.conf<br>subnet 192.168.3.0 netmask 255.255.255.0 {<br>        range 192.168.3.100 192.168.3.200;<br>        option subnet-mask 255.255.255.0;<br>    option domain-name-servers 114.114.114.114;<br>    option domain-name-servers 223.5.5.5;<br>        default-lease-time 21600;<br>        max-lease-time 43200;<br>        next-server 192.168.3.3;<br>        filename “/pxelinux.0”;<br>}</p>
<p>[root@localhost ~]# vim /etc/sysconfig/dhcpd</p>
<h1 id="Command-line-options-here"><a href="#Command-line-options-here" class="headerlink" title="Command line options here"></a>Command line options here</h1><p>DHCPDARGS=eth1</p>
<p>/etc/init.d/dhcpd restart<br>netstat -tunlp|grep dhcp<br>[root@localhost ~]# chkconfig dhcpd on<br>[root@localhost ~]# chkconfig –list | grep dhcpd<br>dhcpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off</p>
<p>yum -y install tftp-server<br>[root@localhost ~]# vim /etc/xinetd.d/tftp</p>
<p>  1 # default: off<br>  2 # description: The tftp server serves files using the trivial file transfer     \<br>  3 #       protocol.  The tftp protocol is often used to boot diskless \<br>  4 #       workstations, download configuration files to network-aware printers    , \<br>  5 #       and to start the installation process for some operating systems.<br>  6 service tftp<br>  7 {<br>  8         socket_type             = dgram<br>  9         protocol                = udp<br> 10         wait                    = yes<br> 11         user                    = root<br> 12         server                  = /usr/sbin/in.tftpd<br> 13         server_args             = -s /var/lib/tftpboot<br> 14         disable                 = no<br> 15         per_source              = 11<br> 16         cps                     = 100 2<br> 17         flags                   = IPv4<br> 18 }<br>~<br>~<br>~<br>“/etc/xinetd.d/tftp” 18L, 517C written<br>[root@localhost ~]#<br>[root@localhost ~]# /etc/init.d/xinetd start<br>Starting xinetd: [  OK  ]<br>[root@localhost ~]# netstat -tunlp|grep 69<br>udp        0      0 0.0.0.0:67                  0.0.0.0:<em>                               1691/dhcpd<br>udp        0      0 0.0.0.0:69                  0.0.0.0:</em>                               2108/xinetd<br>[root@localhost ~]# </p>
<p>Complete!</p>
<p>[root@localhost ~]# yum -y install httpd<br>[root@localhost ~]# sed -i “277i ServerName 127.0.0.1:80” /etc/httpd/conf/httpd.conf<br>[root@localhost ~]# /etc/init.d/httpd start<br>Starting httpd: [  OK  ]<br>[root@localhost ~]#<br>[root@server ~]# chkconfig httpd on<br>[root@server ~]# chkconfig –list |grep httpd<br>httpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off<br>[root@localhost ~]# mkdir /var/www/html/CentOS-6.5</p>
<p>[root@localhost ~]# mount /dev/cdrom /var/www/html/CentOS-6.5<br>mount: block device /dev/sr0 is write-protected, mounting read-only<br>[root@localhost ~]# df -h<br>Filesystem                     Size  Used Avail Use% Mounted on<br>/dev/mapper/VolGroup-LogVol00   28G  3.7G   23G  14% /<br>tmpfs                         1004M   84K 1004M   1% /dev/shm<br>/dev/sda1                      194M   35M  150M  19% /boot<br>/dev/sr0                       4.2G  4.2G     0 100% /media/CentOS_6.5_Final<br>/dev/sr0                       4.2G  4.2G     0 100% /var/www/html/CentOS-6.5<br>[root@localhost ~]# ls /var/www/html/CentOS-6.5<br>CentOS_BuildTag  isolinux                  RPM-GPG-KEY-CentOS-Debug-6<br>EFI              Packages                  RPM-GPG-KEY-CentOS-Security-6<br>EULA             RELEASE-NOTES-en-US.html  RPM-GPG-KEY-CentOS-Testing-6<br>GPL              repodata                  TRANS.TBL<br>images           RPM-GPG-KEY-CentOS-6<br>[root@localhost ~]#<br><a href="http://10.6.4.36/CentOS-6.5/" target="_blank" rel="external">http://10.6.4.36/CentOS-6.5/</a></p>
<p>[root@localhost ~]# yum -y install syslinux<br>[root@localhost ~]# cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/<br>[root@localhost ~]# cp -a /var/www/html/CentOS-6.5/isolinux/* /var/lib/tftpboot/<br>[root@localhost ~]# ls /var/lib/tftpboot/<br>boot.cat  grub.conf   isolinux.bin  memtest     splash.jpg  vesamenu.c32<br>boot.msg  initrd.img  isolinux.cfg  pxelinux.0  TRANS.TBL   vmlinuz<br>[root@localhost ~]# mkdir -p /var/lib/tftpboot/pxelinux.cfg<br>[root@localhost ~]# cp /var/www/html/CentOS-6.5/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# </p>
<p>[root@localhost ~]# grub-crypt<br>Password:<br>Retype password:<br>$6$7xeJ5moFJ1sV2KjE$dpQVjz.hxeTFxydJM2yw7d/EXdoaATJ2Tt5wP1lXwwAicp3L4fFY4PWfOAUYkz1rpKV1lSD7g5zDoX0/W1MT1.<br>[root@localhost ~]# </p>
<p>[root@localhost ~]# mkdir /var/www/html/ks_config<br>[root@localhost ~]# vim /var/www/html/ks_config/CentOS-6.5-ks.cfg</p>
<h1 id="Kickstart-Configurator-for-CentOS-6-5-by-jinyan"><a href="#Kickstart-Configurator-for-CentOS-6-5-by-jinyan" class="headerlink" title="Kickstart Configurator for CentOS 6.5 by jinyan"></a>Kickstart Configurator for CentOS 6.5 by jinyan</h1><p>install<br>url –url=”<a href="http://192.168.3.3/CentOS-6.5/" target="_blank" rel="external">http://192.168.3.3/CentOS-6.5/</a>“<br>text<br>lang en_US.UTF-8<br>keyboard us<br>zerombr<br>bootloader –location=mbr –driveorder=sda –append=”crashkernel=auto rhgb quiet”<br>network –onboot yes –device eth0 –bootproto dhcp –noipv6<br>timezone –utc Asia/Shanghai<br>authconfig –enableshadow –passalgo=sha512<br>rootpw  –iscrypted $6$7xeJ5moFJ1sV2KjE$dpQVjz.hxeTFxydJM2yw7d/EXdoaATJ2Tt5wP1lXwwAicp3L4fFY4PWfOAUYkz1rpKV1lSD7g5zDoX0/W1MT1.<br>clearpart –all –initlabel<br>part /boot –fstype=ext4 –asprimary –size=200<br>part swap –size=2048<br>part / –fstype=ext4 –grow –asprimary –size=200<br>firstboot –disable<br>selinux –disabled<br>firewall –disabled<br>logging –level=info<br>reboot<br>%packages<br>@base<br>@core<br>@debugging<br>@basic-desktop<br>@desktop-debugging<br>@desktop-platform<br>@directory-client<br>@fonts<br>@general-desktop<br>@graphical-admin-tools<br>@input-methods<br>@internet-applications<br>@internet-browser<br>@java-platform<br>@legacy-x<br>@network-file-system-client<br>@office-suite<br>@print-client<br>@remote-desktop-clients<br>@server-platform<br>@server-policy<br>@workstation-policy<br>@x11<br>mtools<br>pax<br>oddjob<br>wodim<br>sgpio<br>genisoimage<br>device-mapper-persistent-data<br>abrt-gui<br>samba-winbind<br>certmonger<br>pam_krb5<br>krb5-workstation<br>libXmu<br>%post<br>wget -O /tmp/optimization.sh <a href="http://192.168.3.3/ks_config/optimization.sh" target="_blank" rel="external">http://192.168.3.3/ks_config/optimization.sh</a> &amp;&gt;/dev/null<br>/bin/sh /tmp/optimization.sh<br>%end</p>
<p>[root@localhost ~]# cp /var/lib/tftpboot/pxelinux.cfg/default /var/lib/tftpboot/pxelinux.cfg/defaultbak<br>[root@localhost ~]# &gt;/var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# chmod 644 /var/lib/tftpboot/pxelinux.cfg/default<br>[root@localhost ~]# vim /var/lib/tftpboot/pxelinux.cfg/default<br>default ks<br>prompt 0</p>
<p>label ks<br>  kernel vmlinuz<br>  append initrd=initrd.img ks=<a href="http://192.168.3.3/ks_config/CentOS-6.5-ks.cfg" target="_blank" rel="external">http://192.168.3.3/ks_config/CentOS-6.5-ks.cfg</a></p>
<h1 id="append-initrd-initrd-img-ks-http-192-168-3-3-ks-config-CentOS-6-7-ks-cfg-ksdevice-eth0"><a href="#append-initrd-initrd-img-ks-http-192-168-3-3-ks-config-CentOS-6-7-ks-cfg-ksdevice-eth0" class="headerlink" title="append initrd=initrd.img ks=http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg ksdevice=eth0"></a>append initrd=initrd.img ks=<a href="http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg" target="_blank" rel="external">http://192.168.3.3/ks_config/CentOS-6.7-ks.cfg</a> ksdevice=eth0</h1><h1 id="ksdevice-eth0"><a href="#ksdevice-eth0" class="headerlink" title="ksdevice=eth0"></a>ksdevice=eth0</h1><p>[root@localhost ~]# vim /var/www/html/ks_config/optimization.sh</p>
<p>#!/bin/bash</p>
<p>##############################################################</p>
<h1 id="File-Name-var-www-html-ks-config-optimization-sh"><a href="#File-Name-var-www-html-ks-config-optimization-sh" class="headerlink" title="File Name: /var/www/html/ks_config/optimization.sh"></a>File Name: /var/www/html/ks_config/optimization.sh</h1><h1 id="Version-V1-0"><a href="#Version-V1-0" class="headerlink" title="Version: V1.0"></a>Version: V1.0</h1><h1 id="Author-jinyan"><a href="#Author-jinyan" class="headerlink" title="Author: jinyan"></a>Author: jinyan</h1><h1 id="Organization-sanyuanempire"><a href="#Organization-sanyuanempire" class="headerlink" title="Organization: sanyuanempire"></a>Organization: sanyuanempire</h1><h1 id="Created-Time-2016-04-27-12-02-08"><a href="#Created-Time-2016-04-27-12-02-08" class="headerlink" title="Created Time : 2016-04-27 12:02:08"></a>Created Time : 2016-04-27 12:02:08</h1><h1 id="Description-Linux-system-initialization"><a href="#Description-Linux-system-initialization" class="headerlink" title="Description: Linux system initialization"></a>Description: Linux system initialization</h1><p>##############################################################</p>
<p>. /etc/init.d/functions</p>
<h1 id="Defined-result-function"><a href="#Defined-result-function" class="headerlink" title="Defined result function"></a>Defined result function</h1><p>function Msg(){<br>        if [ $? -eq 0 ];then<br>          action “$1” /bin/true<br>        else<br>          action “$1” /bin/false<br>        fi<br>}</p>
<h1 id="Defined-OPEN-FILES-Functions"><a href="#Defined-OPEN-FILES-Functions" class="headerlink" title="Defined OPEN FILES Functions"></a>Defined OPEN FILES Functions</h1><p>function openfiles(){<br>        [ -f “/etc/security/limits.conf” ] &amp;&amp; {<br>        echo ‘*  -  nofile  65535’ &gt;&gt; /etc/security/limits.conf<br>        Msg “open files”<br>        }<br>}</p>
<h1 id="Defined-System-Startup-Services-Functions"><a href="#Defined-System-Startup-Services-Functions" class="headerlink" title="Defined System Startup Services Functions"></a>Defined System Startup Services Functions</h1><p>function boot(){<br>        for jinyan in <code>chkconfig --list|grep &quot;3:on&quot;|awk &#39;{print $1}&#39;|grep -vE &quot;crond|network|rsyslog|sshd|sysstat&quot;</code><br>          do<br>           chkconfig $jinyan off<br>        done<br>        Msg “BOOT config”<br>}</p>
<h1 id="Defined-Time-Synchronization-Functions"><a href="#Defined-Time-Synchronization-Functions" class="headerlink" title="Defined Time Synchronization Functions"></a>Defined Time Synchronization Functions</h1><p>function Time(){<br>        echo “#time sync by jinyan at $(date +%F)” &gt;&gt;/var/spool/cron/root<br>        echo ‘<em>/5 </em> <em> </em> * /usr/sbin/ntpdate -u 192.168.3.3 &amp;&gt;/dev/null’ &gt;&gt;/var/spool/cron/root<br>        Msg “Time Synchronization”<br>}</p>
<h1 id="Defined-main-Functions"><a href="#Defined-main-Functions" class="headerlink" title="Defined main Functions"></a>Defined main Functions</h1><p>function main(){<br>        openfiles<br>           boot<br>        Time<br>}</p>
<p>main</p>
<p>Ip=192.168.3.3<br>Port=80<br>ConfigDir=ks_config</p>
<h1 id="Judge-Http-server-is-ok"><a href="#Judge-Http-server-is-ok" class="headerlink" title="Judge Http server is ok?"></a>Judge Http server is ok?</h1><p>PortNum=<code>nmap $Ip  -p $Port 2&gt;/dev/null|grep open|wc -l</code><br>[ $PortNum -lt 1 ] &amp;&amp; {<br>        echo “Http server is bad!”<br>        exit 1<br>}</p>
<h1 id="Defined-IP-function"><a href="#Defined-IP-function" class="headerlink" title="Defined IP function"></a>Defined IP function</h1><p>function ConfigIP(){<br>        Suffix=<code>ifconfig eth0|awk -F &quot;[ .]+&quot; &#39;NR==2 {print $6}&#39;</code><br>        cat &gt;/etc/sysconfig/network-scripts/ifcfg-eth0 &lt;&lt;-END<br>        DEVICE=eth0<br>        TYPE=Ethernet<br>        ONBOOT=yes<br>        NM_CONTROLLED=yes<br>        BOOTPROTO=none<br>        IPADDR=10.0.0.$Suffix<br>        PREFIX=24<br>        GATEWAY=10.0.0.2<br>        DNS1=10.0.0.2<br>        DEFROUTE=yes<br>        IPV4_FAILURE_FATAL=yes<br>        IPV6INIT=no<br>        NAME=”System eth0”<br>        END<br>        Msg “config eth0”<br>}</p>
<h1 id="Defined-Yum-source-Functions"><a href="#Defined-Yum-source-Functions" class="headerlink" title="Defined Yum source Functions"></a>Defined Yum source Functions</h1><p>function yum(){<br>        YumDir=/etc/yum.repos.d<br>        [ -f “$YumDir/CentOS-Base.repo” ] &amp;&amp; cp $YumDir/CentOS-Base.repo{,.ori}<br>        wget -O $YumDir/CentOS-Base.repo <a href="http://$Ip:$Port/$ConfigDir/CentOS-Base.repo" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/CentOS-Base.repo</a> &amp;&gt;/dev/null &amp;&amp;\<br>        wget -O $YumDir/epel.repo <a href="http://$Ip:$Port/$ConfigDir/epel.repo" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/epel.repo</a> &amp;&gt;/dev/null &amp;&amp;\<br>        Msg “YUM source”<br>}</p>
<h1 id="Defined-Hide-the-system-version-number-Functions"><a href="#Defined-Hide-the-system-version-number-Functions" class="headerlink" title="Defined Hide the system version number Functions"></a>Defined Hide the system version number Functions</h1><p>function HideVersion(){<br>        [ -f “/etc/issue” ] &amp;&amp; &gt;/etc/issue<br>        Msg “Hide issue”<br>        [ -f “/etc/issue.net” ] &amp;&amp; &gt; /etc/issue.net<br>        Msg “Hide issue.net”<br>}</p>
<h1 id="Defined-Kernel-parameters-Functions"><a href="#Defined-Kernel-parameters-Functions" class="headerlink" title="Defined Kernel parameters Functions"></a>Defined Kernel parameters Functions</h1><p>function kernel(){<br>        KernelDir=/etc<br>        [ -f “$KernelDir/sysctl.conf” ] &amp;&amp; /bin/mv $KernelDir/sysctl.conf{,.ori}<br>        wget -O $KernelDir/sysctl.conf <a href="http://$Ip:$Port/$ConfigDir/sysctl.conf" target="_blank" rel="external">http://$Ip:$Port/$ConfigDir/sysctl.conf</a> &amp;&gt;/dev/null<br>        Msg “Kernel config”<br>}</p>
<h1 id="Defined-main-Functions-1"><a href="#Defined-main-Functions-1" class="headerlink" title="Defined main Functions"></a>Defined main Functions</h1><p>function main(){<br>        ConfigIP<br>        yum<br>        HideVersion<br>        openfiles<br>        kernel<br>        boot<br>        Time<br>}</p>
<p>main</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-5-KickStart/" data-id="ciwvctjxe0003u1cy8lhhh9wi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iSCSI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/iSCSI/" class="article-date">
  <time datetime="2016-12-15T03:37:32.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/iSCSI/">iSCSI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@jinyan ~]# yum -y install scsi-target-utils<br>[root@jinyan ~]# yum -y install iscsi-initiator-utils</p>
<p>[root@jinyan ~]# mkdir /srv/iscsi<br>[root@jinyan ~]# dd if=/dev/zero of=/srv/iscsi/disk1.img bs=1M count=500<br>记录了500+0 的读入<br>记录了500+0 的写出<br>524288000字节(524 MB)已复制，11.7394 秒，44.7 MB/秒<br>[root@jinyan ~]# chcon -Rv -t tgtd_var_lib_t /srv/iscsi/<br>正在更改”/srv/iscsi/disk1.img” 的安全环境<br>正在更改”/srv/iscsi/“ 的安全环境<br>[root@jinyan ~]# ls -lh /srv/iscsi/disk1.img<br>-rw-r–r–. 1 root root 500M 8月 6 10:57 /srv/iscsi/disk1.img</p>
<p>[root@jinyan ~]# fdisk /dev/sda<br>/dev/sda10 2329 2590 2104483+ 83 Linux<br>/dev/sda11 2591 2852 2104483+ 83 Linux</p>
<p>[root@jinyan ~]# swapon -s; mount | grep ‘sda’<br>[root@jinyan ~]# pvcreate /dev/sda11<br>[root@jinyan ~]# vgextend server /dev/sda11<br>[root@jinyan ~]# lvcreate -L 2G -n iscsi01 server<br>[root@jinyan ~]# lvscan</p>
<p>[root@jinyan ~]# vim /etc/tgt/targets.conf</p>
<target iqn.2012-09.jinyan.com:jinyandisk=""><br>  backing-store /srv/iscsi/disk1.img<br>  backing-store /dev/sda10<br>  backing-store /dev/server/iscsi01<br>  initiator-address 10.0.0.0/24<br>  incominguser jinyan renjia<br>  write-cache off<br></target>

<p>[root@jinyan ~]# /etc/init.d/tgtd restart<br>[root@jinyan ~]# chkconfig tgtd on<br>[root@jinyan ~]# netstat -tlunp | grep tgt<br>tcp 0 0 0.0.0.0:3260 0.0.0.0:<em> LISTEN 2750/tgtd<br>tcp 0 0 :::3260 :::</em> LISTEN 2750/tgtd</p>
<p>[root@jinyan ~]# tgt-admin –show</p>
<p>[root@sanyuanempire ~]# vim /etc/iscsi/iscsid.conf<br>node.session.auth.username = jinyan<br>node.session.auth.password = renjia</p>
<p>discovery.sendtargets.auth.username = jinyan<br>discovery.sendtargets.auth.password = renjia</p>
<p>[root@sanyuanempire ~]# chkconfig iscsid on<br>[root@sanyuanempire ~]# chkconfig iscsi on</p>
<p>[root@sanyuanempire ~]# iscsiadm -m discovery -t sendtargets -p 10.0.0.254</p>
<p>[root@sanyuanempire ~]# ll -R /var/lib/iscsi/nodes/</p>
<p>如果要在系统启动时自动登入<br>iscsiadm -m node -T iqn.2012-07.jinyan.com:jinyandisk -p 192.168.245.9:3260 –op update -n node.startup -v automatic</p>
<p>iscsiadm -m node -T iqn.2012-07.jinyan.com:jinyandisk -o update –name node.session.auth.authmethod –value=CHAP</p>
<p>iscsiadm -m node -T iqn.2012-07.jinyan.com:jinyandisk –op update –name node.session.auth.username –value=jinyan</p>
<p>iscsiadm -m node -T iqn.2012-07.jinyan.com:jinyandisk –op update –name node.session.auth.password –value=renjia</p>
<p>[root@sanyuanempire ~]# /etc/init.d/iscsi restart</p>
<p>[root@sanyuanempire ~]# fdisk -l</p>
<p>[root@sanyuanempire ~]# iscsiadm -m node</p>
<p>[root@sanyuanempire ~]# iscsiadm -m node -T iqn.2012-09.jinyan.com:jinyandisk –logout</p>
<p>[root@sanyuanempire ~]# iscsiadm -m node -o delete -T iqn.2012-09.jinyan.com:jinyandisk</p>
<p>[root@sanyuanempire ~]# iscsiadm -m node</p>
<p>[root@sanyuanempire ~]# /etc/init.d/iscsi restart</p>
<p>[root@sanyuanempire ~]# pvcreate /dev/sd{b,c,d}<br>  Writing physical volume data to disk “/dev/sdb”<br>  Physical volume “/dev/sdb” successfully created<br>  Writing physical volume data to disk “/dev/sdc”<br>  Physical volume “/dev/sdc” successfully created<br>  Writing physical volume data to disk “/dev/sdd”<br>  Physical volume “/dev/sdd” successfully created</p>
<p>[root@sanyuanempire ~]# vgcreate iscsi /dev/sd{b,c,d}<br>  Volume group “iscsi” successfully created</p>
<p>[root@sanyuanempire ~]# vgdisplay</p>
<p>[root@sanyuanempire ~]# lvcreate -l 1148 -n disk iscsi<br>  Logical volume “disk” created</p>
<p>[root@sanyuanempire ~]# lvdisplay</p>
<p>[root@sanyuanempire ~]# mkfs -t ext4 /dev/iscsi/disk</p>
<p>[root@sanyuanempire ~]# mkdir -p /data/iscsi</p>
<p>[root@sanyuanempire ~]# mount /dev/iscsi/disk /data/iscsi<br>[root@sanyuanempire ~]# df -Th</p>
<p>[root@sanyuanempire ~]# vim /etc/fstab<br>/dev/iscsi/disk /data/iscsi ext4 defaults,_netdev 1 2</p>
<p>[root@sanyuanempire ~]# df -Th</p>
<p>[root@jinyan ~]# tgt-admin –show</p>
<p>[root@sanyuanempire ~]# vim /etc/iscsi/initiatorname.iscsi<br>InitiatorName=iqn.2012-09.jinyan.com:initiator</p>
<p>[root@sanyuanempire ~]# /etc/init.d/iscsi restart<br>停止 iscsi：[确定]<br>正在启动 iscsi：[确定]</p>
<p>[root@jinyan ~]# tgt-admin –show</p>
<p>[root@sanyuanempire ~]# vim /etc/iscsi/initiatorname.iscsi</p>
<h1 id="InitiatorName-iqn-1994-05-com-redhat-5ee6c70511f"><a href="#InitiatorName-iqn-1994-05-com-redhat-5ee6c70511f" class="headerlink" title="InitiatorName=iqn.1994-05.com.redhat:5ee6c70511f"></a>InitiatorName=iqn.1994-05.com.redhat:5ee6c70511f</h1><p>InitiatorName=iqn.2012-09.jinyan.com:initiator</p>
<p>[root@sanyuanempire ~]# /etc/init.d/iscsi restart</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/iSCSI/" data-id="ciwvctk030026u1cy72ukx6io" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-SVN" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/CentOS-6-x-SVN/" class="article-date">
  <time datetime="2016-12-15T03:36:28.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/CentOS-6-x-SVN/">CentOS 6.x SVN</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>yum -y install subversion<br>svn –version<br>svn，版本 1.6.11 (r934486)<br>[root@rsync ~]# mkdir -p /opt/svn/repo<br>[root@rsync ~]# svnadmin create /opt/svn/repo<br>[root@rsync ~]# ll /opt/svn/repo<br>总用量 24<br>drwxr-xr-x 2 root root 4096 6月  20 15:43 conf<br>drwxr-sr-x 6 root root 4096 6月  20 15:43 db<br>-r–r–r– 1 root root    2 6月  20 15:43 format<br>drwxr-xr-x 2 root root 4096 6月  20 15:43 hooks<br>drwxr-xr-x 2 root root 4096 6月  20 15:43 locks<br>-rw-r–r– 1 root root  229 6月  20 15:43 README.txt<br>[root@rsync ~]#<br>[root@rsync ~]# cd /opt/svn/repo/conf<br>[root@rsync conf]# vim passwd </p>
<h3 id="This-file-is-an-example-password-file-for-svnserve"><a href="#This-file-is-an-example-password-file-for-svnserve" class="headerlink" title="This file is an example password file for svnserve."></a>This file is an example password file for svnserve.</h3><h3 id="Its-format-is-similar-to-that-of-svnserve-conf-As-shown-in-the"><a href="#Its-format-is-similar-to-that-of-svnserve-conf-As-shown-in-the" class="headerlink" title="Its format is similar to that of svnserve.conf. As shown in the"></a>Its format is similar to that of svnserve.conf. As shown in the</h3><h3 id="example-below-it-contains-one-section-labelled-users"><a href="#example-below-it-contains-one-section-labelled-users" class="headerlink" title="example below it contains one section labelled [users]."></a>example below it contains one section labelled [users].</h3><h3 id="The-name-and-password-for-each-user-follow-one-account-per-line"><a href="#The-name-and-password-for-each-user-follow-one-account-per-line" class="headerlink" title="The name and password for each user follow, one account per line."></a>The name and password for each user follow, one account per line.</h3><p>[users]</p>
<h1 id="harry-harryssecret"><a href="#harry-harryssecret" class="headerlink" title="harry = harryssecret"></a>harry = harryssecret</h1><h1 id="sally-sallyssecret"><a href="#sally-sallyssecret" class="headerlink" title="sally = sallyssecret"></a>sally = sallyssecret</h1><p>jinyan = yanjin</p>
<p>[root@rsync conf]# vim authz<br>[/]<br>jinyan = rw</p>
<ul>
<li>= rw</li>
</ul>
<p>[root@rsync conf]# vim svnserve.conf<br>[general]</p>
<h3 id="These-options-control-access-to-the-repository-for-unauthenticated"><a href="#These-options-control-access-to-the-repository-for-unauthenticated" class="headerlink" title="These options control access to the repository for unauthenticated"></a>These options control access to the repository for unauthenticated</h3><h3 id="and-authenticated-users-Valid-values-are-“write”-“read”"><a href="#and-authenticated-users-Valid-values-are-“write”-“read”" class="headerlink" title="and authenticated users.  Valid values are “write”, “read”,"></a>and authenticated users.  Valid values are “write”, “read”,</h3><h3 id="and-“none”-The-sample-settings-below-are-the-defaults"><a href="#and-“none”-The-sample-settings-below-are-the-defaults" class="headerlink" title="and “none”.  The sample settings below are the defaults."></a>and “none”.  The sample settings below are the defaults.</h3><p>anon-access = none<br>auth-access = write<br>password-db = passwd<br>authz-db = authz<br>realm=/opt/svn/repo</p>
<p>启动SVN</p>
<p>svnserve -d -r /opt/svn/repo<br>[root@rsync conf]# ps -ef|grep svn|grep -v grep<br>root     22954     1  0 15:49 ?        00:00:00 svnserve -d -r /opt/svn/repo<br>[root@rsync conf]# netstat -tunlp | grep 3690<br>tcp        0      0 0.0.0.0:3690                0.0.0.0:*                   LISTEN      22954/svnserve<br>[root@rsync conf]# </p>
<p>停止重启SVN<br>[root@rsync conf]# killall svnserve<br>[root@rsync conf]# killall svnserve<br>svnserve: 没有进程被杀死<br>[root@rsync conf]#<br>[root@rsync conf]# svnserve -d -r /opt/svn/repo<br>[root@rsync conf]# netstat -tunlp | grep 3690<br>tcp        0      0 0.0.0.0:3690                0.0.0.0:*                   LISTEN      22974/svnserve<br>[root@rsync conf]# </p>
<p>测试</p>
<p>SVN服务已经启动，使用客户端测试连接。<br>客户端连接地址：svn://10.6.0.106<br>用户名/密码：<br>测试创建文件夹等操作。</p>
<p>创建版本库：<br>终端输入：svnadmin create [路径]<br>该路径可以是相对路径，例如，当前在home/user/svn/目录下，输入svnadmin create myproject，则该版本库会被创建在home/user/svn/目录下，新建一个文件夹名为myproject，其中便是版本库的文件了。</p>
<p>将文件导入版本库：<br>终端输入：svn import [源路径] [目标版本库路径] -m [日志信息]<br>源路径可以是相对路径，导入时会递归导入源路径下的所有文件和文件夹，目标版本库路径需要绝对目录（反正我试验是这样的），例如版本库的目录是：home/user/svn/myproject/。则应该这样写：file:///home/user/svn/myproject/<br>例如将当前目录导入版本库myproject：<br>svn import . file:///home/user/svn/myproject -m”导入文件”</p>
<p>从版本库导出：<br>导入后原文件并未被纳入版本管理，若想获得受版本控制的文件，就需要从版本库导出<br>终端输入：svn co [版本库路径] [导出目标路径]<br>例如将myproject库中的文件导出到当前目录：svn cofile:///home/user/svn/myproject .</p>
<p>备份<br>[root@rsync ~]# du -h –max-depth=1 /opt/svn/repo/db/revs/0<br>11G     /opt/svn/repo/db/revs/0<br>svnadmin dump方式<br>SVN迁移需要做如下操作：</p>
<ol>
<li>将原来的Repository导出为一个文件dumpfile 。<br>#svnadmin dump 原先的repos的目录路径（/repository/directory） &gt; dumpfile<br>#svnadmin dump /opt/svn/iitshare/ &gt; /var/tmp/iitshare_20130626<br>[root@rsync ~]# svnadmin dump /opt/svn/repo/ &gt; /home/repo20160818<br>[root@rsync ~]# ll -h /home/repo20160623<br>-rw-r–r– 1 root root 11G 6月  23 13:02 /home/repo20160623</li>
<li>在另外一台机器上配置同样的SVN服务器。</li>
<li>将dumpfile导入到新的repository 目录中。<br>#svnadmin load 新建的repos的目录路径（/repository/directory） &lt; dumpfile<br>#svnadmin load /opt/svn/iitshare/ &lt; /var/tmp/iitshare_20130626<br>[root@rsync ~]# svnadmin dump /opt/svn/repo/ &lt; /home/repo20160623</li>
<li>将原先服务器的配置文件备份后复制到新服务器中<br>#/opt/svn/iitshare/conf目录下<br>authz、passwd、svnserve.conf文件</li>
</ol>
<p>svnadmin hotcopy方法</p>
<ol>
<li>备份<br>#svnadmin hotcopy /opt/svn/iitshare/ /var/tmp/iitshare_20130626 –clean-logs<br>[root@rsync ~]# svnadmin hotcopy /opt/svn/repo/ /home/repohost20160623 –clean-logs<br>[root@rsync ~]# ll -h /home/repohost20160623<br>总用量 24K<br>drwxr-xr-x 2 root root 4.0K 6月  23 13:11 conf<br>drwxr-sr-x 6 root root 4.0K 6月  23 13:14 db<br>-r–r–r– 1 root root    2 6月  23 13:14 format<br>drwxr-xr-x 2 root root 4.0K 6月  23 13:11 hooks<br>drwxr-xr-x 2 root root 4.0K 6月  23 13:11 locks<br>-rw-r–r– 1 root root  229 6月  23 13:11 README.txt<br>如果你传递–clean-logs选项，svnadmin会执行热拷贝操作，然后删除不用的Berkeley DB日志文件。<br>你可以在任何时候运行这个命令得到一个版本库的安全拷贝，不管其它进程是否使用这个版本库。</li>
<li>还原<br>#svnadmin hotcopy /var/tmp/iitshare_20130626 /opt/svn/iitshare/<br>svnadmin hotcopy /home/repohost20160623 /opt/svn/repo/</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/CentOS-6-x-SVN/" data-id="ciwvctjy9000lu1cyl5ac0bwe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/19/alfresco/">alfresco</a>
          </li>
        
          <li>
            <a href="/2016/12/19/书单/">书单</a>
          </li>
        
          <li>
            <a href="/2016/12/15/NGINX日志切割/">NGINX日志切割</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-6-x-安装SVN/">CentOS 6.x 安装SVN</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-7-x-git/">CentOS 7.x git</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>