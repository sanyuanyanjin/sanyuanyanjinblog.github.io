<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-CentOS-6-5-Postfix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-5-Postfix/" class="article-date">
  <time datetime="2016-12-19T02:25:33.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-5-Postfix/">CentOS 6.5 Postfix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vim /etc/postfix/main.cf<br>myhostname = tzuchi.com.cn<br>myorigin = $myhostname<br>mynetworks = 10.0.0.0/8, 127.0.0.0/8<br>mydestination = $myhostname, localhost.$mydomain, localhost<br>relay_domains = $mydestination<br>alias_maps = hash:/etc/aliases<br>alias_database = hash:/etc/aliases<br>debug_peer_level = 2<br>debugger_command =<br>         PATH=/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin<br>         ddd $daemon_directory/$process_name $process_id &amp; sleep 5<br>smtpd_client_restrictions =<br>smtpd_recipient_restrictions = permit_mynetworks, reject_unauth_destination<br>smtpd_sasl_auth_enable = no</p>
<p>vi /etc/sasl2/smtpd.conf<br>pwcheck_method: saslauthd<br>mech_list: plain login</p>
<p>service postfix check<br>service postfix start<br>chkconfig postfix on</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-5-Postfix/" data-id="cix7b3wma00080ecyx7tsssda" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-6-x-Optimization" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-6-x-Optimization/" class="article-date">
  <time datetime="2016-12-19T02:24:51.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-6-x-Optimization/">CentOS 6.x Optimization</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@renjia ~]# echo “yanjin”|passwd –stdin jinyan<br>visudo<br>root    ALL=(ALL)       ALL<br>renjia  ALL=(ALL)       NOPASSWD: ALL<br>leader    ALL=(ALL)       ALL</p>
<p>server time</p>
<p>1.yum源</p>
<p>2.安装必要的软件包</p>
<p>3.关闭SELINUX<br>[root@renjia ~]# vim /etc/selinux/config<br>SELINUX=disabled<br>[root@renjia ~]# getenforce<br>Enforcing<br>[root@renjia ~]# setenforce 0<br>[root@renjia ~]# getenforce<br>Permissive</p>
<p>/etc/init.d/iptables stop</p>
<p>[root@renjia ~]# mkdir -p /server/scripts<br>[root@renjia ~]# cd /server/scripts/<br>[root@renjia scripts]# vim del.sh<br>[root@renjia scripts]# ll<br>总用量 4<br>-rw-r–r– 1 root root 50 12月 26 13:12 del.sh</p>
<p>4.runlevel init 0~6<br>[root@renjia ~]# runlevel<br>N 3<br>cat /etc/inittab<br>setup<br>ntsysv</p>
<p>刚装完系统时保留服务：<br>crond<br>network<br>sshd<br>syslog<br>脚本管理开机自启动的服务：<br>LANG=en<br>for jinyan in <code>chkconfig --list|grep 3:on|awk &#39;{print $1}&#39;</code>;do chkconfig –level 3 $jinyan off;done<br>for jinyan in crond network syslog sshd ;do chkconfig –level 3 $jinyan on;done<br>chkconfig –list|grep 3:on</p>
<p>内核优化<br>vi /etc/sysctl.conf<br>net.ipv4.tcp_fin_timeout = 2<br>net.ipv4.tcp_tw_reuse = 1<br>net.ipv4.tcp_tw_recycle = 1<br>net.ipv4.tcp_syncookies = 1<br>net.ipv4.tcp_keepalive_time = 600<br>net.ipv4.ip_local_port_range = 4000          65000<br>net.ipv4.tcp_max_syn_backlog = 16384<br>net.ipv4.tcp_max_tw_buckets = 36000<br>net.ipv4.route.gc_timeout = 100<br>net.ipv4.tcp_syn_retries = 1<br>net.ipv4.tcp_synack_retries = 1<br>net.core.somaxconn = 16384<br>net.core.netdev_max_backlog = 16384<br>net.ipv4.tcp_max_orphans = 16384</p>
<p>#iptables<br>net.ipv4.ip_conntrack_max = 25000000<br>net.ipv4.netfilter.ip_conntrack_max=25000000<br>net.ipv4.netfilter.ip_conntrack_tcp_timeout_established=180<br>net.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait=120<br>net.ipv4.netfilter.ip_conntrack_tcp_timeout_close_wait=60<br>net.ipv4.netfilter.ip_conntrack_tcp_timeout_fin_wait=120</p>
<p>sysctl -p</p>
<p>/etc/init.d/iptables start</p>
<p>linux定时任务Crond之服务器同步时间<br>[root@jinyan ~]# /usr/sbin/ntpdate time.windows.com<br>26 Dec 12:42:45 ntpdate[2929]: step time server 64.4.10.33 offset -28179.740945 sec<br>[root@jinyan ~]# date<br>Thu Dec 26 12:43:04 CST 2013<br>[root@jinyan ~]# /sbin/ntpdate time.windows.com<br>26 Dec 12:44:34 ntpdate[2934]: adjust time server 65.55.56.206 offset -0.036207 sec</p>
<p>crontab -e</p>
<p>#del file<br>00 00 <em> </em> 6 /bin/sh /server/scripts/del.sh &gt;/dev/null 2&gt;&amp;1</p>
<p>#sync sys time by jinyan at 2013-12-26<br><em>/5 </em> <em> </em> * /sbin/ntpdate time.windows.com &gt;/dev/null 2&gt;&amp;1<br>crontab -l</p>
<p>#del file<br>00 00 <em> </em> 6 /bin/sh /server/scripts/del.sh &gt;/dev/null 2&gt;&amp;1</p>
<p>#sync sys time by jinyan at 2013-12-26<br><em>/5 </em> <em> </em> * /sbin/ntpdate time.windows.com &gt;/dev/null 2&gt;&amp;1</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-6-x-Optimization/" data-id="cix7b3wmt000o0ecyy2oubslh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-RHEL-6-x" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/RHEL-6-x/" class="article-date">
  <time datetime="2016-12-19T02:24:16.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/RHEL-6-x/">RHEL 6.x</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#关闭iptables<br>/etc/init.d/iptables stop<br>chkconfig iptables off</p>
<p>#关闭selinux<br>setenforce 0<br>sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/‘ /etc/selinux/config  </p>
<p>#NTP同步<br>ntpdate 0.rhel.pool.ntp.org<br>crontab -e<br>0 0 <em> </em> * /usr/sbin/ntpdate 0.rhel.pool.ntp.org;/usr/sbin/hwclock -w</p>
<p>ntpdate 202.120.2.101<br>crontab -e<br>0 0 <em> </em> * /usr/sbin/ntpdate 202.120.2.101;/usr/sbin/hwclock -w</p>
<p>#添加hosts<br>vi /etc/hosts<br>192.168.1.10 master<br>192.168.1.11 client</p>
<p>#puppet<br><a href="http://downloads.puppetlabs.com/puppet/" target="_blank" rel="external">http://downloads.puppetlabs.com/puppet/</a></p>
<p>#facter<br><a href="http://downloads.puppetlabs.com/facter/" target="_blank" rel="external">http://downloads.puppetlabs.com/facter/</a></p>
<p>#ruby<br><a href="https://www.ruby-lang.org/zh_cn/downloads/" target="_blank" rel="external">https://www.ruby-lang.org/zh_cn/downloads/</a></p>
<p>#配置CentOS YUM源</p>
<p>cd /etc/yum.repos.d/<br>cp rhel-source.repo rhel-source.repo.bak<br>vi rhel-source.repo</p>
<p>[base]<br>name=CentOS-$releasever-Base<br>baseurl=<a href="http://centos.ustc.edu.cn/centos/6/os/x86_64/" target="_blank" rel="external">http://centos.ustc.edu.cn/centos/6/os/x86_64/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6" target="_blank" rel="external">http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6</a></p>
<p>[updates]<br>name=CentOS-$releasever-Updates<br>baseurl=<a href="http://centos.ustc.edu.cn/centos/6/os/x86_64/" target="_blank" rel="external">http://centos.ustc.edu.cn/centos/6/os/x86_64/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6" target="_blank" rel="external">http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6</a></p>
<p>[extras]<br>name=CentOS-$releasever-Extras<br>baseurl=<a href="http://centos.ustc.edu.cn/centos/6/os/x86_64/" target="_blank" rel="external">http://centos.ustc.edu.cn/centos/6/os/x86_64/</a><br>gpgcheck=1<br>gpgkey=<a href="http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6" target="_blank" rel="external">http://mirrors.163.com/centos/RPM-GPG-KEY-CentOS-6</a></p>
<p>[centosplus]<br>name=CentOS-$releasever-Plus<br>baseurl=<a href="http://centos.ustc.edu.cn/centos/6/os/x86_64/" target="_blank" rel="external">http://centos.ustc.edu.cn/centos/6/os/x86_64/</a><br>gpgcheck=1</p>
<p>yum clean all<br>yum makecache<br>yum repolist</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/RHEL-6-x/" data-id="cix7b3wom002h0ecyqg79af94" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Server-Template" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Server-Template/" class="article-date">
  <time datetime="2016-12-19T02:23:33.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Server-Template/">Server Template</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@www ~]# vim /etc/hosts<br>192.168.0.99    www.centos.jinyan<br>192.168.0.3    JinYan-PC<br>10.0.0.254    www.centos.jinyan<br>10.0.0.1    jinyanxp<br>10.0.0.2    client.centos.jinyan<br>10.0.0.3    server.centos.jinyan</p>
<p>批量建立账号<br>[root@jinyan ~]# mkdir bin<br>[root@jinyan ~]# cd /root/bin<br>[root@jinyan bin]# vim useradd.sh</p>
<p>#!/bin/bash<br>groupadd jinyangroup<br>for username in jinyan renjia sanyuan yuanmu renyuan<br>do<br>  useradd -G jinyangroup $username<br>  echo “yanjin” | passwd –stdin $username<br>done<br>[root@jinyan bin]# sh useradd.sh<br>[root@jinyan bin]# id jinyan</p>
<p>共享目录的权限<br>[root@jinyan ~]# mkdir /home/jinyangroup<br>[root@www bin]# chgrp jinyangroup /home/jinyangroup/<br>[root@jinyan ~]# chmod 2770 /home/jinyangroup/<br>[root@jinyan ~]# ll -d /home/jinyangroup/</p>
<p>磁盘配额<br>[root@jinyan ~]# vim /etc/fstab<br>/dev/mapper/server-myhome /home                   ext4    defaults,usrquota,grpquota        1 2</p>
<p>[root@jinyan ~]# umount /home; mount -a<br>[root@jinyan ~]# mount | grep home<br>/dev/mapper/server-myhome on /home type ext4 (rw,usrquota,grpquota)</p>
<p>[root@jinyan ~]# quotacheck -avug<br>quotacheck: Your kernel probably supports journaled quota but you are not using it. Consider switching to journaled quota to avoid running quotacheck after an unclean shutdown.<br>quotacheck: Scanning /dev/mapper/server-myhome [/home] done</p>
<p>[root@jinyan ~]# quotaon -avug<br>/dev/mapper/server-myhome [/home]: group quotas turned on<br>/dev/mapper/server-myhome [/home]: user quotas turned on</p>
<p>[root@jinyan ~]# edquota -u jinyan<br>  Filesystem                   blocks       soft       hard     inodes     soft     hard<br>  /dev/mapper/server-myhome         20      1800000    2000000        5        0        0</p>
<p>[root@jinyan ~]# edquota -p jinyan renjia<br>[root@jinyan ~]# edquota -p jinyan sanyuan<br>[root@jinyan ~]# edquota -p jinyan yuanmu<br>[root@jinyan ~]# edquota -p jinyan renyuan</p>
<p>[root@jinyan ~]# repquota -au</p>
<p>LVM<br>[root@jinyan ~]# vgdisplay<br>  VG Size               4.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1249<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       0 / 0 </p>
<p>[root@jinyan ~]# fdisk /dev/sda</p>
<p>WARNING: DOS-compatible mode is deprecated. It’s strongly recommended to<br>         switch off the mode (command ‘c’) and change display units to<br>         sectors (command ‘u’).</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux</p>
<p>Command (m for help): n<br>First cylinder (1173-3917, default 1173): 2067<br>Last cylinder, +cylinders or +size{K,M,G} (2067-3917, default 3917): +2G</p>
<p>Command (m for help): t<br>Partition number (1-9): 9<br>Hex code (type L to list codes): 8e<br>Changed system type of partition 9 to 8e (Linux LVM)</p>
<p>Command (m for help): p</p>
<p>Disk /dev/sda: 32.2 GB, 32212254720 bytes<br>255 heads, 63 sectors/track, 3916 cylinders<br>Units = cylinders of 16065 * 512 = 8225280 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x0002c217</p>
<p>   Device Boot      Start         End      Blocks   Id  System<br>/dev/sda1   *           1          26      204800   83  Linux<br>Partition 1 does not end on cylinder boundary.<br>/dev/sda2              26         664     5120000   8e  Linux LVM<br>Partition 2 does not end on cylinder boundary.<br>/dev/sda3             664        1173     4096000   83  Linux<br>/dev/sda4            1173        3917    22035456    5  Extended<br>/dev/sda5            1174        1429     2048000   82  Linux swap / Solaris<br>/dev/sda6            1429        1684     2048000   83  Linux<br>/dev/sda7            1684        1939     2048000   83  Linux<br>/dev/sda8            1939        2066     1024000   83  Linux<br>/dev/sda9            2067        2328     2104515   8e  Linux LVM</p>
<p>Command (m for help): w<br>The partition table has been altered!</p>
<p>Calling ioctl() to re-read partition table.</p>
<p>WARNING: Re-reading the partition table failed with error 16: 设备或资源忙.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.</p>
<p>[root@jinyan ~]# fdisk -l</p>
<p>[root@jinyan ~]# pvcreate /dev/sda9<br>  Writing physical volume data to disk “/dev/sda9”<br>  Physical volume “/dev/sda9” successfully created<br>[root@jinyan ~]# vgextend server /dev/sda9<br>  Volume group “server” successfully extended</p>
<p>[root@jinyan ~]# vgdisplay<br>  VG Size               6.88 GiB<br>  PE Size               4.00 MiB<br>  Total PE              1762<br>  Alloc PE / Size       1249 / 4.88 GiB<br>  Free  PE / Size       513 / 2.00 GiB</p>
<p>[root@jinyan ~]# lvdisplay<br>  LV Name                /dev/server/myhome<br>  VG Name                server<br>  LV Size                4.88 GiB</p>
<p>[root@jinyan ~]# lvresize -L 6.88G /dev/server/myhome<br>  Rounding up size to full physical extent 6.88 GiB<br>  Extending logical volume myhome to 6.88 GiB<br>  Logical volume myhome successfully resized</p>
<p>[root@jinyan ~]# resize2fs /dev/server/myhome<br>resize2fs 1.41.12 (17-May-2010)<br>Filesystem at /dev/server/myhome is mounted on /home; on-line resizing required<br>old desc_blocks = 1, new_desc_blocks = 1<br>Performing an on-line resize of /dev/server/myhome to 1804288 (4k) blocks.<br>The filesystem on /dev/server/myhome is now 1804288 blocks long.</p>
<p>[root@jinyan ~]# df -h<br>/dev/mapper/server-myhome<br>                      6.8G  140M  6.4G   3% /home</p>
<p>[root@jinyan ~]# LANG=C chkconfig –list | grep ‘3:on’</p>
<p>[root@localhost ~]# chkconfig autofs off<br>[root@localhost ~]# /etc/init.d/autofs stop</p>
<p>[root@jinyan ~]# netstat -tunlp</p>
<p>[root@localhost ~]# /etc/init.d/avahi-daemon stop<br>[root@localhost ~]# chkconfig avahi-daemon off</p>
<p>[root@localhost ~]# yum -y update</p>
<pre><code># 第一次作会进行非常之久！因为系统真的有些数据要更新嘛！还是得等待的！
</code></pre><p>[root@localhost ~]# vim /etc/crontab<br>15 2 <em> </em> * root /usr/bin/yum -y update</p>
<p>[root@localhost ~]# rpm -qa | grep -i samba<br>    samba-common-3.5.4-68.el6_0.2.x86_64<br>    samba-client-3.5.4-68.el6_0.2.x86_64<br>    samba-winbind-clients-3.5.4-68.el6_0.2.x86_64</p>
<pre><code># 看起来 samba 主程序尚未被安装啊！此时就要这样做：

[root@localhost ~]# yum search samba  &lt;==先查一下有没有相关的软件
[root@localhost ~]# yum -y install samba &lt;==找到之后，那就安装吧！

# 那么如何找出配置文件呢？因为我们总是需要修改配置文件啊！这样做吧：
[root@localhost ~]# rpm -qc samba samba-common
</code></pre><h1 id="先查询一下启动的方式为何："><a href="#先查询一下启动的方式为何：" class="headerlink" title="先查询一下启动的方式为何："></a>先查询一下启动的方式为何：</h1><pre><code>[root@localhost ~]# rpm -ql samba | grep &apos;/etc&apos;
/etc/logrotate.d/samba
/etc/openldap/schema
/etc/openldap/schema/samba.schema
/etc/pam.d/samba
/etc/rc.d/init.d/nmb
/etc/rc.d/init.d/smb  &lt;==所以说是 stand alone 且档名为 smb, nmb 两
</code></pre><p>个！<br>    /etc/samba/smbusers</p>
<h1 id="开始启动他！且设定开机就启动喔！："><a href="#开始启动他！且设定开机就启动喔！：" class="headerlink" title="开始启动他！且设定开机就启动喔！："></a>开始启动他！且设定开机就启动喔！：</h1><p>[root@localhost ~]# /etc/init.d/smb start<br>[root@localhost ~]# /etc/init.d/nmb start</p>
<p>[root@localhost ~]# chkconfig smb on<br>[root@localhost ~]# chkconfig nmb on</p>
<h1 id="接下来，让我们观察一下有没有启动相关的埠口吧！"><a href="#接下来，让我们观察一下有没有启动相关的埠口吧！" class="headerlink" title="接下来，让我们观察一下有没有启动相关的埠口吧！"></a>接下来，让我们观察一下有没有启动相关的埠口吧！</h1><pre><code>[root@localhost ~]# netstat -tlunp | grep &apos;[sn]mbd&apos;
</code></pre><p>ACL<br>[root@jinyan ~]# useradd student<br>[root@jinyan ~]# passwd student<br>[root@jinyan ~]# setfacl -m u:student:rx /home/jinyangroup/<br>[root@jinyan ~]# setfacl -m u:renyuan:- /home/jinyangroup/<br>[root@jinyan ~]# getfacl /home/jinyangroup/<br>getfacl: Removing leading ‘/‘ from absolute path names</p>
<h1 id="file-home-jinyangroup"><a href="#file-home-jinyangroup" class="headerlink" title="file: home/jinyangroup/"></a>file: home/jinyangroup/</h1><h1 id="owner-root"><a href="#owner-root" class="headerlink" title="owner: root"></a>owner: root</h1><h1 id="group-2770"><a href="#group-2770" class="headerlink" title="group: 2770"></a>group: 2770</h1><p>user::rwx<br>user:renyuan:—<br>user:student:r-x<br>group::r-x<br>mask::r-x<br>other::r-x</p>
<p>[root@www ~]# vim /etc/login.defs<br>[root@www ~]# vim /etc/security/limits.conf</p>
<p>[root@jinyan ~]# vim /root/bin/backup.sh</p>
<p>#!/bin/bash<br>backdir=”/etc /home /root /var/spool/mail”<br>basedir=/backup<br>[ ! -d “$basedir” ] &amp;&amp; mkdir $basedir<br>backfile=$basedir/backup.tar.gz<br>tar -zcvf $backfile $backdir</p>
<p>[root@localhost ~]# vim /etc/crontab<br>45 2 <em> </em> * root sh /root/bin/backup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Server-Template/" data-id="cix7b3wom002i0ecy0lfa371w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-CentOS-7-x" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/CentOS-7-x/" class="article-date">
  <time datetime="2016-12-19T02:20:11.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/CentOS-7-x/">CentOS 7.x</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话："><a href="#假设你的-USB-装置为-dev-sdc-，而-ISO-档名为-centos7-iso-的话：" class="headerlink" title="假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话："></a>假设你的 USB 装置为 /dev/sdc ，而 ISO 档名为 centos7.iso 的话：</h1><p>[root@study ~]# dd if=centos7.iso of=/dev/sdc</p>
<p>rpm -ivh <a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm" target="_blank" rel="external">http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</a><br>yum repolist</p>
<p>时间设置<br>date后面的数字代表月日时分年<br>date 070415522015<br>时间同步<br>/usr/sbin/ntpdate -u 202.120.2.101<br>ntpdate -u 202.120.2.101</p>
<p>yum install ntp -y<br>systemctl enable ntpd<br>systemctl status ntpd<br>ntpdate -u 202.120.2.101<br>n1<br>vim /etc/ntp.conf<br>server 202.120.2.101 prefer<br>service ntpd start<br>ntpstat</p>
<p>网络设置<br>vim /etc/sysconfig/network-scripts/ifcfg-eth0<br>DEVICE=”eth0”<br>BOOTPROTO=none<br>ONBOOT=”yes”<br>IPADDR=10.6.0.211<br>PREFIX=24<br>GATEWAY=10.6.0.128<br>DNS1=61.177.7.1<br>DOMAIN=223.5.5.5</p>
<p>vim /etc/hostname</p>
<p>vim /etc/hosts</p>
<p>vim /etc/selinux/config</p>
<p>systemctl stop firewalld.service<br>systemctl disable firewalld.service</p>
<p>tar -zxvf VMwareTools-9.9.0-2304977.tar.gz<br>cd vmware-tools-distrib/<br>ls<br>./vmware-install.pl</p>
<p>reboot<br>getenforce</p>
<p>yum install lrzsz -y<br>sz download<br>rz upload</p>
<p>rpm -qa | grep java<br>rpm -e –nodeps javapackages-tools-3.4.1-5.el7.noarch<br>rpm -e –nodeps java-1.7.0-openjdk-headless-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps java-1.7.0-openjdk-1.7.0.51-2.4.5.5.el7.x86_64<br>rpm -e –nodeps python-javapackages-3.4.1-5.el7.noarch<br>rpm -e –nodeps tzdata-java-2014b-1.el7.noarch<br>rpm -qa | grep java</p>
<p>tar -xvf jdk-8u66-linux-x64.tar.gz<br>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.8.0_66/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export PATH=$PATH:${JAVA_HOME}/bin<br>source /etc/profile<br>java -version</p>
<p>快照</p>
<p>wget <a href="https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz" target="_blank" rel="external">https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz</a><br>ll -h<br>tar -Jxvf Python-3.5.0.tar.xz<br>mkdir /usr/local/python3<br>cd Python-3.5.0/<br>./configure –prefix=/usr/local/python3<br>make<br>make install<br>cd /usr/bin/<br>ls<br>mv python python.bak<br>ln -s /usr/local/python3/bin/python3 /usr/bin/python<br>python<br>cd<br>vim /usr/bin/yum</p>
<p>python -V</p>
<p>python</p>
<p>vim /etc/profile<br>source /etc/profile</p>
<p>uname -a<br>su jinyan<br>mv eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz /home/jinyan/<br>cd /home/jinyan/<br>chown jinyan:jinyan eclipse-jee-mars-1-linux-gtk-x86_64.tar.gz</p>
<p>rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>wget <a href="http://nginx.org/keys/nginx_signing.key" target="_blank" rel="external">http://nginx.org/keys/nginx_signing.key</a><br>rpmkeys –import nginx_signing.key<br>vim /etc/yum.repos.d/nginx.repo<br>rpmkeys -K nginx-release-centos-7-0.el7.ngx.noarch.rpm<br>yum -y install nginx<br>systemctl start nginx<br>systemctl enable nginx<br>systemctl status httpd.service<br>systemctl status nginx.service<br>vim /etc/nginx/nginx.conf </p>
<p>nano /etc/nginx/nginx.conf<br>vim /etc/nginx/nginx.conf<br>nginx -s reload<br>mkdir -p /data/www<br>getenforce<br>echo “This a test page.” &gt;/data/www/index.html</p>
<p>chmod -R 777 /data/www/<br>tail -f /var/log/nginx/error.log<br>cd /data/www/<br>touch favicon.ico<br>ls<br>tail -f /var/log/nginx/error.log<br>nginx -s reload</p>
<p>yum install perl-DBI -y<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.6.27-2.el7.x86_64.rpm<br>yum install mysql-community-server -y<br>yum -y install mysql-community-client</p>
<p>systemctl start mysqld<br>systemctl enable mysqld<br>systemctl status mysqld<br>netstat -tunlp | grep :3306<br>mysqladmin -uroot password yanjin<br>mysqladmin -uroot password<br>mysqladmin -u root password<br>mysql -uroot -pyanjin</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/CentOS-7-x/" data-id="cix7b3wnm001c0ecyh6i1wpwn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DHCP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/DHCP/" class="article-date">
  <time datetime="2016-12-19T02:17:25.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/DHCP/">DHCP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@localhost ~]# crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]#</p>
<p>[root@localhost ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/<br>[root@localhost ~]# cat /root/dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>[root@localhost ~]#</p>
<p>dhcp<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>tail -f /var/lib/dhcpd/dhcpd.leases<br>vim /var/lib/dhcpd/dhcpd.leases<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>DHCP<br>vim /etc/dhcp/dhcpd.conf<br>service dhcpd restart<br>cat /var/lib/dhcpd/dhcpd.leases |awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’<br>awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’ /var/lib/dhcpd/dhcpd.leases</p>
<p>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’<br>tail -n +8 /var/lib/dhcpd/dhcpd.leases|less|awk ‘BEGIN{RS=ORS=”}”}{print $2,$21,”\n”}’|sed ‘s/}//g’|sort -n</p>
<p>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}>‘|sort -n  &gt; dhcpip.txt<br>cat /var/lib/dhcpd/dhcpd.leases|grep -o ‘\&lt;[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}:[0-9a-f]{2}>‘|sort -n  &gt; dhcpmac.txt</p>
<p>[root@localhost ~]# vim /etc/dhcp/dhcpd.conf</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro"><a href="#host-WudeMacBook-Pro" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187"><a href="#fixed-address-10-6-4-187" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id=""><a href="#" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>“/etc/dhcp/dhcpd.conf” 138L, 3153C                            85,0-1        63%<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-1"><a href="#host-WudeMacBook-Pro-1" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-1"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-1" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-1"><a href="#fixed-address-10-6-4-187-1" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-1"><a href="#-1" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>[root@localhost ~]# cat /etc/dhcp/dhcpd.conf<br>#</p>
<h1 id="DHCP-Server-Configuration-file"><a href="#DHCP-Server-Configuration-file" class="headerlink" title="DHCP Server Configuration file."></a>DHCP Server Configuration file.</h1><h1 id="see-usr-share-doc-dhcp-dhcpd-conf-sample"><a href="#see-usr-share-doc-dhcp-dhcpd-conf-sample" class="headerlink" title="see /usr/share/doc/dhcp*/dhcpd.conf.sample"></a>see /usr/share/doc/dhcp*/dhcpd.conf.sample</h1><h1 id="see-‘man-5-dhcpd-conf’"><a href="#see-‘man-5-dhcpd-conf’" class="headerlink" title="see ‘man 5 dhcpd.conf’"></a>see ‘man 5 dhcpd.conf’</h1><p>#<br>ddns-update-style none;<br>ignore client-updates;<br>authoritative;<br>shared-network network_tag {<br>subnet 10.6.0.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.1.0 netmask 255.255.255.0 {</p>
<pre><code>option routers                  10.6.1.1;
option subnet-mask              255.255.255.0;
option domain-name-servers      61.177.7.1;
option domain-name-servers      114.114.114.114;
range  10.6.1.65 10.6.1.127;
default-lease-time 36000;
max-lease-time 72000;
</code></pre><h1 id="host-WudeMacBook-Pro-2"><a href="#host-WudeMacBook-Pro-2" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-3c-15-c2-df-93-c4"><a href="#hardware-ethernet-3c-15-c2-df-93-c4" class="headerlink" title="hardware ethernet 3c:15:c2:df:93:c4;"></a>hardware ethernet 3c:15:c2:df:93:c4;</h1><h1 id="fixed-address-10-6-1-35"><a href="#fixed-address-10-6-1-35" class="headerlink" title="fixed-address 10.6.1.35;"></a>fixed-address 10.6.1.35;</h1><h1 id="-2"><a href="#-2" class="headerlink" title="}"></a>}</h1><p>host HCP-SZOFFICE{<br>hardware ethernet 24:0a:64:b2:b3:d3;<br>fixed-address 10.6.1.50;<br>}</p>
<p>host c2laboratory03{<br>hardware ethernet 8c:89:a5:cf:90:ce;<br>fixed-address 10.6.1.54;<br>}</p>
<p>host zhuang-3{<br>hardware ethernet 54:ee:75:33:8b:fe;<br>fixed-address 10.6.1.56;<br>}</p>
<p>host zhuang-2{<br>hardware ethernet e8:b1:fc:de:20:e7;<br>fixed-address 10.6.1.60;<br>}</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.2.0 netmask 255.255.255.0 {</p>
<p>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.3.0 netmask 255.255.255.0 {<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 10.6.4.0 netmask 255.255.255.0 {<br>        option routers                  10.6.4.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  10.6.4.50 10.6.4.200;<br>        default-lease-time 360;<br>        max-lease-time 720;<br>}<br>}</p>
<h1 id="host-WudeMacBook-Pro-3"><a href="#host-WudeMacBook-Pro-3" class="headerlink" title="host WudeMacBook-Pro{"></a>host WudeMacBook-Pro{</h1><h1 id="hardware-ethernet-0c-4d-e9-a6-11-e3-2"><a href="#hardware-ethernet-0c-4d-e9-a6-11-e3-2" class="headerlink" title="hardware ethernet 0c:4d:e9:a6:11:e3;"></a>hardware ethernet 0c:4d:e9:a6:11:e3;</h1><h1 id="fixed-address-10-6-4-187-2"><a href="#fixed-address-10-6-4-187-2" class="headerlink" title="fixed-address 10.6.4.187;"></a>fixed-address 10.6.4.187;</h1><h1 id="-3"><a href="#-3" class="headerlink" title="}"></a>}</h1><p>shared-network network_tag {<br>subnet 192.168.12.0 netmask 255.255.255.0 {<br>        option routers                  192.168.12.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      223.5.5.5;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.12.50 192.168.12.87;<br>        range  192.168.12.89 192.168.12.250;<br>        default-lease-time 3600;<br>        max-lease-time 7200;</p>
<p>}</p>
<p>}</p>
<p>shared-network network_tag {<br>subnet 192.168.11.0 netmask 255.255.255.0 {<br>        option routers                  192.168.11.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      114.114.114.114;<br>        option domain-name-servers      211.103.55.51;</p>
<p>#option domain-name-servers      61.177.7.1;</p>
<p>#option domain-name-servers      114.114.114.114;<br>        range  192.168.11.50 192.168.11.119;<br>        range  192.168.11.121 192.168.11.250;<br>        default-lease-time 1800;<br>        max-lease-time 3600;<br>}<br>}</p>
<p>shared-network network_tag {<br>subnet 192.168.10.0 netmask 255.255.255.0 {<br>        option routers                  192.168.10.1;<br>        option subnet-mask              255.255.255.0;<br>        option domain-name-servers      61.177.7.1;<br>        option domain-name-servers      114.114.114.114;<br>        range  192.168.10.50 192.168.10.250;<br>        default-lease-time 36000;<br>        max-lease-time 72000;<br>}<br>}</p>
<p>[root@localhost ~]# </p>
<p>[root@localhost ~]# vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /etc/dhcp/ /home/backup/</p>
<p>vim dhcpbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_dhcp”<br>tar -cjPf $basedir/dhcp.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=dhcp.$(date +%Y-%m-%d).tar.bz2<br>rmfile=dhcp.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/dhcpbackup.sh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/DHCP/" data-id="cix7b3wnz001r0ecywl9s1bof" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-E-learning" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/E-learning/" class="article-date">
  <time datetime="2016-12-19T02:16:05.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/E-learning/">E-learning</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@tzuchi ~]# crontab -e</p>
<p><em>/5 </em> <em> </em> <em> /opt/lampp/bin/php /opt/lampp/htdocs/moodle/admin/cli/cron.php &gt;/dev/null<br>00 03 </em> <em> </em> sh /root/copy.sh<br>00 06 <em> </em> * sh /root/elearningbackup.sh<br>~<br>[root@tzuchi ~]# cat /root/copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /home/backup<br>cp -r /opt/lampp/moodledata/ /home/backup<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/home/backup/moodle.sql 2&gt;/dev/null<br>[root@tzuchi ~]#</p>
<p>[root@tzuchi ~]# cat /root/elearningbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_Elearning”<br>tar -cjPf $basedir/elearning.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=elearning.$(date +%Y-%m-%d).tar.bz2<br>rmfile=elearning.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>[root@tzuchi ~]#</p>
<p>E-learning<br>备份<br>vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /home/backup<br>cp -r /opt/lampp/moodledata/ /home/backup<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/home/backup/moodle.sql 2&gt;/dev/null</p>
<p>vim elearningbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_Elearning”<br>tar -cjPf $basedir/elearning.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=elearning.$(date +%Y-%m-%d).tar.bz2<br>rmfile=elearning.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile</p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/elearningbackup.sh<br><em>/5 </em> <em> </em> * /opt/lampp/bin/php /opt/lampp/htdocs/moodle/admin/cli/cron.php &gt;/dev/null</p>
<p>还原<br>将备份文件解压，放到/opt/lampp/htdocs/moodle/目录下。<br>使用如下命令还原MySQL<br>/opt/lampp/bin/mysql -uroot -p moodle &lt; /opt/moodle.sql</p>
<p>10.6.0.76<br>[root@sztzuchi opt]# tar -zxvf moodle-latest-28.tgz<br>[root@sztzuchi opt]# mv moodle /opt/lampp/htdocs/<br>[root@tzuchi opt]# chmod -R 777 /opt/lampp/<br>sz^215Tzuchi</p>
<p>[root@tzuchi ~]# vim /opt/lampp/htdocs/moodle/config.php<br>// $CFG-&gt;wwwroot   = ‘<a href="http://tzuchi.elearning/moodle" target="_blank" rel="external">http://tzuchi.elearning/moodle</a>‘;<br>$CFG-&gt;wwwroot   = ‘<a href="http://10.6.0.20/moodle" target="_blank" rel="external">http://10.6.0.20/moodle</a>‘;<br>$CFG-&gt;dataroot  = ‘/opt/lampp/moodledata’;<br>$CFG-&gt;admin     = ‘admin’;</p>
<p>$CFG-&gt;directorypermissions = 0777;</p>
<p>scp -r  root@10.6.0.75:/backup/backup/moodle /opt<br>scp -r  root@10.6.0.75:/backup/backup/moodledata /opt<br>scp -r  root@10.6.0.75:/backup/backup/moodle.sql /opt</p>
<p>[root@sztzuchi opt]# cd /opt/lampp/htdocs/<br>[root@sztzuchi htdocs]# ls<br>applications.html  dashboard    img        moodle     xampp<br>bitnami.css        favicon.ico  index.php  webalizer<br>[root@sztzuchi htdocs]# mkdir /backup<br>[root@sztzuchi htdocs]# mv moodle/ /backup/<br>[root@sztzuchi htdocs]# ls /backup/<br>moodle<br>[root@sztzuchi htdocs]# cd ..<br>[root@sztzuchi lampp]# ls<br>apache2       etc      lib                    modules     properties.ini  var<br>bin           htdocs   libexec                moodledata  RELEASENOTES    xampp<br>build         icons    licenses               mysql       sbin<br>cgi-bin       img      logs                   pear        share<br>ctlscript.sh  include  man                    php         temp<br>docs          info     manager-linux-x64.run  phpmyadmin  uninstall<br>error         lampp    manual                 proftpd     uninstall.dat<br>[root@sztzuchi lampp]# mv moodledata/ /backup/<br>[root@sztzuchi lampp]# cd htdocs/<br>[root@sztzuchi htdocs]# mv /opt/moodle .<br>[root@sztzuchi htdocs]# cd ..<br>[root@sztzuchi lampp]# mv /opt/moodledata/ .<br>[root@sztzuchi lampp]# vim /opt/lampp/htdocs/moodle/config.php<br>$CFG-&gt;dbuser    = ‘root’;<br>$CFG-&gt;dbpass    = ‘sztzuchi’;<br>$CFG-&gt;wwwroot   = ‘<a href="http://10.6.0.20/moodle" target="_blank" rel="external">http://10.6.0.20/moodle</a>‘;</p>
<p>[root@sztzuchi opt]# vim moodle.sql<br>:1,$s/10.6.0.76/10.6.0.20/g</p>
<p>/opt/lampp/bin/mysql -uroot -psztzuchi<br>drop database moodle;:<br>create  database  moodle;<br>SHOW DATABASES;    /<em>这可以查看到所有的数据库名称</em>/<br>exit</p>
<p>/opt/lampp/bin/mysql -uroot -p moodle &lt; /opt/moodle.sql</p>
<p>[root@sztzuchi opt]# chmod 777 -R /opt/lampp/<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/backup/moodle.sql 2&gt;/dev/null</p>
<p>10.6.0.75<br>[root@tzuchi ~]# /opt/lampp/bin/mysqladmin -u root password yanjin</p>
<p>[root@tzuchi ~]# vim /opt/lampp/htdocs/moodle/config.php<br>$CFG-&gt;dbuser    = ‘root’;<br>$CFG-&gt;dbpass    = ‘yanjin’;<br>$CFG-&gt;prefix    = ‘mdl_’;</p>
<p>crontab -e<br><em>/5 </em> <em> </em> * /opt/lampp/bin/php /opt/lampp/htdocs/moodle/admin/cli/cron.php &gt;/dev/null</p>
<p>[root@tzuchi backup]# cat copy.sh </p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /backup/backup<br>cp -r /opt/lampp/moodledata /backup/backup<br>/opt/lampp/bin/mysqldump -uroot -p’yanjin’ moodle&gt;/backup/backup/moodle.sql 2&gt;/dev/null</p>
<p>vim copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /home/backup<br>cp -r /opt/lampp/moodledata/ /home/backup<br>/opt/lampp/bin/mysqldump -uroot -p’sztzuchi’ moodle&gt;/home/backup/moodle.sql 2&gt;/dev/null</p>
<p>[root@tzuchi backup]# vim elearningbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/home/“<br>remotedir=”/backup_Elearning”<br>tar -cjPf $basedir/elearning.$(date +%Y-%m-%d).tar.bz2 /home/backup/<br>backupfile=elearning.$(date +%Y-%m-%d).tar.bz2<br>rmfile=elearning.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>[root@tzuchi backup]# </p>
<p>crontab -e<br>00 03 <em> </em> <em> sh /root/copy.sh<br>00 06 </em> <em> </em> sh /root/elearningbackup.sh</p>
<p>[root@sztzuchi ~]# vim /opt/lampp/phpmyadmin/config.inc.php<br>$cfg[‘Servers’][$i][‘auth_type’] = ‘cookie’;<br>$cfg[‘Servers’][$i][‘user’] = ‘root’;<br>$cfg[‘Servers’][$i][‘password’] = ‘yanjin’;</p>
<p>[root@sztzuchi ~]# vim /opt/lampp/phpmyadmin/libraries/config.default.php<br>$cfg[‘CheckConfigurationPermissions’] = true;<br>$cfg[‘CheckConfigurationPermissions’] = false;</p>
<p>Mysql 账户root,密码为空<br>Admin<br>密码：Sz_tzuchi215<br>1234@Abcd<br>crontab -e<br><em>/5 </em> <em> </em> <em> /bin/sh /backup/cronphp.sh<br>00 00 </em> <em> </em> /usr/sbin/ntpdate 202.120.2.101<br>00 23 <em> </em> <em> /bin/sh /backup/copy.sh<br>00 04 </em> <em> </em> /bin/sh /backup/Elearningbackup.sh &gt;/dev/null</p>
<p>备份<br>第一步：备份moodle源程序<br>1.进入moodle源程序所在目录，将源程序备份至其他目录中。<br>举例：将/opt/lampp/htdocs/moodle/中的moodle源程序备份至/backup/中，命令行如下：<br>cp -r /opt/lampp/htdocs/moodle/ /backup/<br>2.检查是否备份成功<br>命令：ls -al /backup/moodle<br>查看是否列出了moodle文件夹中的所有文件及目录，如果其中有文件和目录表示备份成功。<br>第二步：备份moodledata目录<br>1.进入moodledata所在目录，将其中的所有文件备份至其他目录中。<br>举例：将/opt/lampp/moodledata中的所有数据备份至/backup中，命令行如下：<br>cp -r /opt/lampp/moodledata /backup/<br>2.监测是否备份成功<br>命令：ls–al /backup/moodledata/<br>查看是否列出了moodledate文件夹中的所有文件及目录，如果其中有文件和目录表示备份成功。</p>
<p>第三步：备份数据库（首先需要知道访问数据库的超级用户名和密码）<br>/opt/lampp/bin/mysql -uroot -p<br>1.备份moodle数据库<br>/opt/lampp/bin/mysqldump -uroot -pmoodle&gt;/backup/moodle.sql<br>输入root密码后就开始备份<br>2.检查是否备份成功<br>命令：ls -al /backup/moodle.sql<br>查看是否有moodle.sql的文件，如果有表示该文件数据库备份成功。<br>第四步：压缩备份的文件夹<br>压缩备份的文件夹，减少容量以便拷贝到其他地方。<br>1.撰写本机备份脚本<br>/backup/copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /backup/backup<br>cp -r /opt/lampp/moodledata /backup/backup<br>/opt/lampp/bin/mysqldump -uroot -pmoodle&gt;/backup/backup/moodle.sql 2&gt;/dev/null<br>2.撰写备份到FTP服务器脚本<br>/backup/Elearningbackup.sh</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/backup”<br>remotedir=”/backup_Elearning”<br>tar -cjPf $basedir/Elearning.$(date +%Y-%m-%d).tar.bz2 /backup/backup<br>backupfile=Elearning.$(date +%Y-%m-%d).tar.bz2<br>rmfile=Elearning.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>[root@tzuchi ~]# cat /backup/copy.sh</p>
<p>#!/bin/bash<br>cp -r /opt/lampp/htdocs/moodle/ /backup/backup<br>cp -r /opt/lampp/moodledata /backup/backup<br>/opt/lampp/bin/mysqldump -uroot -pmoodle&gt;/backup/backup/moodle.sql 2&gt;/dev/null<br>优化<br>撰写运行cron.php脚本</p>
<p>#!/bin/bash<br>/opt/lampp/bin/php /opt/lampp/htdocs/moodle/admin/cli/cron.php &gt;/dev/null<br>校对时间<br>/usr/sbin/ntpdate 202.120.2.101</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/E-learning/" data-id="cix7b3wo6001u0ecymppyewh6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Windows-route" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Windows-route/" class="article-date">
  <time datetime="2016-12-19T01:51:06.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Windows-route/">Windows route</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>net user administrator /active:yes<br>net user administrator /active:no</p>
<pre><code>例子1：要显示IP路由表的完整内容，执行以下命令：
route print
例子2：要显示IP路由表中以10.开始的路由，执行以下命令：
route print 10.*
例子3：要添加默认网关地址为192.168.12.1的默认路由，执行以下命令：
route add 0.0.0.0 mask 0.0.0.0 192.168.12.1
例子4：要添加目标为10.41.0.0，子网掩码为255.255.0.0，下一个跃点地址为10.27.0.1的路由，执行以下命令：
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1
例子5：要添加目标为10.41.0.0，子网掩码为255.255.0.0，下一个跃点地址为10.27.0.1的永久路由，执行以下命令：
route -p add 10.41.0.0 mask 255.255.0.0 10.27.0.1
例子6：要添加目标为10.41.0.0，子网掩码为255.255.0.0，下一个跃点地址为10.27.0.1，跃点数为7的路由，执行以下命令：
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 metric 7
例子7：要添加目标为10.41.0.0，子网掩码为255.255.0.0，下一个跃点地址为10.27.0.1，接口索引为0x3的路由，执行以下命令：
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 if 0x3
例子8：要删除目标为10.41.0.0，子网掩码为255.255.0.0的路由，执行以下命令：
route delete 10.41.0.0 mask 255.255.0.0
例子9：要删除IP路由表中以10.开始的所有路由，执行以下命令：
route delete 10.*
例子10：要将目标为10.41.0.0，子网掩码为255.255.0.0的路由的下一个跃点地址由10.27.0.1更改为10.27.0.25，执行以下命令：
route change 10.41.0.0 mask 255.255.0.0 10.27.0.25
</code></pre><p>Windows下查看网卡“接口索引”<br>C:\Users\YanJin&gt;arp -a</p>
<p>接口: 192.168.174.1 — 0x9<br>  Internet 地址         物理地址              类型<br>  192.168.174.254       00-50-56-f9-0d-c2     动态<br>  192.168.174.255       ff-ff-ff-ff-ff-ff     静态<br>  224.0.0.2             01-00-5e-00-00-02     静态<br>  224.0.0.22            01-00-5e-00-00-16     静态<br>  224.0.0.252           01-00-5e-00-00-fc     静态<br>  239.255.255.250       01-00-5e-7f-ff-fa     静态<br>  255.255.255.255       ff-ff-ff-ff-ff-ff     静态</p>
<p>接口: 192.168.120.1 — 0x12<br>  Internet 地址         物理地址              类型<br>  192.168.120.254       00-50-56-f6-1d-0e     动态<br>  192.168.120.255       ff-ff-ff-ff-ff-ff     静态<br>  224.0.0.2             01-00-5e-00-00-02     静态<br>  224.0.0.22            01-00-5e-00-00-16     静态<br>  224.0.0.252           01-00-5e-00-00-fc     静态<br>  239.255.255.250       01-00-5e-7f-ff-fa     静态<br>  255.255.255.255       ff-ff-ff-ff-ff-ff     静态</p>
<p>接口: 10.6.3.48 — 0x1a<br>  Internet 地址         物理地址              类型<br>  10.6.3.1              e8-e7-32-12-06-d4     动态<br>  10.6.3.42             e2-37-37-a3-ae-2b     动态<br>  10.6.3.44             f0-7b-cb-a0-e9-19     动态<br>  10.6.3.45             60-eb-69-5c-6f-3f     动态<br>  10.6.3.77             00-0e-e8-b3-c7-a7     动态<br>  10.6.3.84             6c-e8-73-6b-cf-b6     动态<br>  10.6.3.86             bc-d1-77-19-58-54     动态<br>  10.6.3.94             78-44-76-0a-36-c9     动态<br>  10.6.3.211            de-a9-01-8a-18-34     动态<br>  10.6.3.255            ff-ff-ff-ff-ff-ff     静态<br>  224.0.0.2             01-00-5e-00-00-02     静态<br>  224.0.0.22            01-00-5e-00-00-16     静态<br>  224.0.0.251           01-00-5e-00-00-fb     静态<br>  224.0.0.252           01-00-5e-00-00-fc     静态<br>  239.255.255.250       01-00-5e-7f-ff-fa     静态<br>255.255.255.255       ff-ff-ff-ff-ff-ff     静态</p>
<p>艾迪康主机配置 102 网段连接外网，100网段连接内网</p>
<h1 id="IPv4-路由表"><a href="#IPv4-路由表" class="headerlink" title="IPv4 路由表"></a>IPv4 路由表</h1><p>活动路由:<br>网络目标        网络掩码          网关       接口   跃点数<br>          0.0.0.0          0.0.0.0       10.6.102.1      10.6.102.52     20<br>         10.6.0.0      255.255.0.0       10.6.100.1      10.6.100.43     11<br>       10.6.100.0    255.255.255.0            在链路上       10.6.100.43    266<br>      10.6.100.43  255.255.255.255            在链路上       10.6.100.43    266<br>     10.6.100.255  255.255.255.255            在链路上       10.6.100.43    266<br>       10.6.102.0    255.255.255.0            在链路上       10.6.102.52    276<br>      10.6.102.52  255.255.255.255            在链路上       10.6.102.52    276<br>     10.6.102.255  255.255.255.255            在链路上       10.6.102.52    276<br>        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    306<br>        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    306<br>  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    306<br>        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    306<br>        224.0.0.0        240.0.0.0            在链路上       10.6.102.52    276<br>        224.0.0.0        240.0.0.0            在链路上       10.6.100.43    266<br>  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    306<br>  255.255.255.255  255.255.255.255            在链路上       10.6.102.52    276</p>
<h1 id="255-255-255-255-255-255-255-255-在链路上-10-6-100-43-266"><a href="#255-255-255-255-255-255-255-255-在链路上-10-6-100-43-266" class="headerlink" title="  255.255.255.255  255.255.255.255            在链路上       10.6.100.43    266"></a>  255.255.255.255  255.255.255.255            在链路上       10.6.100.43    266</h1><p>永久路由:<br>  网络地址          网络掩码  网关地址  跃点数</p>
<pre><code>10.6.0.0      255.255.0.0       10.6.100.1       1
</code></pre><p>===========================================================================<br> route -p add 10.6.0.0 mask 255.255.0.0 10.6.100.1</p>
<p>以太网适配器 本地连接 2:</p>
<p>   连接特定的 DNS 后缀 . . . . . . . : dhcpserver<br>   描述. . . . . . . . . . . . . . . : Intel(R) Ethernet Connection I217-LM<br>   物理地址. . . . . . . . . . . . . : 6C-0B-84-45-E7-9B<br>   DHCP 已启用 . . . . . . . . . . . : 是<br>   自动配置已启用. . . . . . . . . . : 是<br>   本地链接 IPv6 地址. . . . . . . . : fe80::60dc:23c7:d20:5788%13(首选)<br>   IPv4 地址 . . . . . . . . . . . . : 10.6.102.52(首选)<br>   子网掩码  . . . . . . . . . . . . : 255.255.255.0<br>   获得租约的时间  . . . . . . . . . : 2016年5月17日 9:28:04<br>   租约过期的时间  . . . . . . . . . : 2016年6月8日 9:28:06<br>   默认网关. . . . . . . . . . . . . : 10.6.102.1 配置网关<br>   DHCP 服务器 . . . . . . . . . . . : 10.6.0.84<br>   DHCPv6 IAID . . . . . . . . . . . : 309070724<br>   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-1D-D1-FC-30-08-57-00-E6-8C-92</p>
<p>   DNS 服务器  . . . . . . . . . . . : 61.177.7.1<br>                                       114.114.114.114<br>   主 WINS 服务器  . . . . . . . . . : 10.6.100.32<br>   TCPIP 上的 NetBIOS  . . . . . . . : 已启用</p>
<p>以太网适配器 本地连接:</p>
<p>   连接特定的 DNS 后缀 . . . . . . . :<br>   描述. . . . . . . . . . . . . . . : Realtek PCI GBE Family Controller<br>   物理地址. . . . . . . . . . . . . : 08-57-00-E6-8C-92<br>   DHCP 已启用 . . . . . . . . . . . : 否<br>   自动配置已启用. . . . . . . . . . : 是<br>   本地链接 IPv6 地址. . . . . . . . : fe80::d93b:43c0:af1e:bc8e%11(首选)<br>   IPv4 地址 . . . . . . . . . . . . : 10.6.100.43(首选)<br>   子网掩码  . . . . . . . . . . . . : 255.255.255.0<br>   默认网关. . . . . . . . . . . . . :没有配置网关<br>   DHCPv6 IAID . . . . . . . . . . . : 235427584<br>   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-1D-D1-FC-30-08-57-00-E6-8C-92</p>
<p>   DNS 服务器  . . . . . . . . . . . : 61.177.7.1<br>   TCPIP 上的 NetBIOS  . . . . . . . : 已启用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Windows-route/" data-id="cix7b3wow002x0ecy4bb9i0qm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cacti-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Cacti-1/" class="article-date">
  <time datetime="2016-12-19T01:49:53.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Cacti-1/">Cacti</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[root@localhost ~]# php /var/www/html/poller.php<br>[root@localhost ~]# crontab -e</p>
<p><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br><em>/5 </em> <em> </em> * /usr/sbin/ntpdate -u 10.6.0.220 &gt; /dev/null 2&gt;&amp;1</p>
<p>[root@localhost ~]# vi /etc/sysconfig/clock</p>
<h1 id="ZONE-”America-North-Dakota-Center”"><a href="#ZONE-”America-North-Dakota-Center”" class="headerlink" title="ZONE=”America/North_Dakota/Center”"></a>ZONE=”America/North_Dakota/Center”</h1><h1 id="UTC-false"><a href="#UTC-false" class="headerlink" title="UTC=false"></a>UTC=false</h1><h1 id="ARC-false"><a href="#ARC-false" class="headerlink" title="ARC=false"></a>ARC=false</h1><p>ZONE=”Asia/Shanghai”<br>UTC=false<br>ARC=false<br>[root@localhost ~]# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br>cp: overwrite `/etc/localtime’? y<br>[root@localhost ~]# date<br>[root@localhost ~]# /usr/sbin/ntpdate -u 10.6.0.220<br>26 Mar 13:21:52 ntpdate[5851]: step time server 10.6.0.220 offset -2774.426741 sec</p>
<p>cacti backup 10.6.0.77<br>默认设置说明：<br>root密码: CactiEZ<br>登录系统后，请尽快修改root密码。</p>
<p>Cacti登录用户名: admin<br>Cacti登录密码: sz215tzuchi<br>第一次登录Cacti需要修改密码。<br>mysqldump -ucactiuser -p’CactiMadeEZ’ cacti&gt;/root/cacti.sql<br>mysqldump -ucactiuser -p’CactiMadeEZ’ syslog&gt;syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option; </p>
<p>snmp station 10.6.0.77 162 “public” v1 enable</p>
<p>vim backup.sh</p>
<p>#/bin/bash<br>cd /var/www/</p>
<h1 id="Remove-old-backups"><a href="#Remove-old-backups" class="headerlink" title="Remove old backups"></a>Remove old backups</h1><p>find /var/www/backups/* -mtime +5 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Remove-old-RRAs-usually-means-the-datasource-is-deleted"><a href="#Remove-old-RRAs-usually-means-the-datasource-is-deleted" class="headerlink" title="Remove old RRAs (usually means the datasource is deleted)"></a>Remove old RRAs (usually means the datasource is deleted)</h1><p>find /var/www/html/rra/* -mtime +2 -exec rm -fr {} \; &gt; /dev/null 2&gt;&amp;1</p>
<h1 id="Create-the-filename-for-the-backup"><a href="#Create-the-filename-for-the-backup" class="headerlink" title="Create the filename for the backup"></a>Create the filename for the backup</h1><p>eval <code>date &quot;+day=%d; month=%m; year=%Y&quot;</code><br>INSTFIL=”cacti-backup-$year-$month-$day.tar.gz”</p>
<h1 id="Dump-the-MySQL-Database"><a href="#Dump-the-MySQL-Database" class="headerlink" title="Dump the MySQL Database"></a>Dump the MySQL Database</h1><p>mysqldump -uroot –opt cacti&gt; /var/www/html/cacti-backup.sql<br>mysqldump -uroot –opt syslog&gt; /var/www/html/syslog.sql</p>
<h1 id="Gzip-the-whole-folder"><a href="#Gzip-the-whole-folder" class="headerlink" title="Gzip the whole folder"></a>Gzip the whole folder</h1><p>tar -Pcpzf /var/www/backups/$INSTFIL /var/www/html/*</p>
<h1 id="Remove-the-SQL-Dump"><a href="#Remove-the-SQL-Dump" class="headerlink" title="Remove the SQL Dump"></a>Remove the SQL Dump</h1><p>rm -f /var/www/html/cacti-backup.sql<br>rm -f /var/www/html/syslog.sql</p>
<p>crontab -e<br><em>/1 </em> <em> </em> <em> php /var/www/html/poller.php &gt; /dev/null 2&gt;&amp;1<br>0 1 </em> <em> </em> nice -n 15 /var/www/backup.sh<br>还原<br>将备份文件置于/var/www/html目录下<br>使用如下命令进行MySQL还原<br>source /root/cacti.sql<br>source /root/syslog.sql<br>grant all privileges on cacti.<em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;<br>grant all privileges on syslog.</em> to cactiuser@localhost identified by ‘CactiMadeEZ’ with grant option;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Cacti-1/" data-id="cix7b3wlu00020ecy4i7b6z6t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Proxy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/19/Proxy/" class="article-date">
  <time datetime="2016-12-19T01:48:52.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/19/Proxy/">Proxy</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>localhost:~ # crontab -e<br><em>:1 </em> <em> </em> <em> sh /root/rotate.sh &gt;/dev/null 2&gt;&amp;1<br>00 05 </em> <em> </em> /etc/init.d/squid restart<br>00 06 <em> </em> * sh /root/autoftp.sh</p>
<ul>
<li>8,10,12,14,16<em> </em> <em> sh /root/resid.sh<br>00 04 </em> <em> </em>  sh /backup/backupopt/squid_backup.sh</li>
</ul>
<p><em>:1 </em> <em> </em> <em> 每一秒
</em>/5 <em> </em> <em> </em> sh /root/mvlog.sh &gt;/dev/null 2&gt;&amp;1</p>
<p>localhost:~ # cat /root/autoftp.sh</p>
<p>#auto ftp to another server</p>
<p>#!/bin/bash<br>#</p>
<p>#setting ftp var</p>
<p>#ftpurl=210.71.242.204<br>ftpurl=10.6.0.15<br>ftpid=admin<br>ftppwd=htw001c9<br>ftpmode=binary<br>#</p>
<p>#setting date var<br>Y=<code>date &quot;+%Y&quot;</code><br>m=<code>date &quot;+%m&quot;</code><br>d=<code>date -d &quot;-1 day&quot; &quot;+%d&quot;</code><br>#</p>
<p>#setting log var<br>logday=$m$d</p>
<p>#fname=access.log.0<br>fname=access.log<br>logfiledir=/var/log/squid<br>logfile=$logday”.txt”<br>gziplog=$logfile”.gz”<br>#<br>cp $logfiledir/$fname $logfiledir/$logfile<br>gzip $logfiledir/$logfile<br>#</p>
<p>#setting backup var<br>backupdir=/backup/log<br>Ymdir=$Y$m<br>#<br>if [ -d /$backupdir/$Ymdir ]<br>then<br>cp $logfiledir/$gziplog $backupdir/$Ymdir<br>else<br>mkdir $backupdir/$Ymdir<br>cp $logfiledir/$gziplog $backupdir/$Ymdir<br>fi<br>#<br>ftp -n $ftpurl&lt;&lt;command<br>user $ftpid $ftppwd $ftpid@ftpurl<br>$ftpmode<br>lcd $backupdir/$Ymdir<br>put $gziplog<br>bye<br>command<br>#</p>
<p>#remove oldfile<br>rm $logfiledir/$gziplog<br>localhost:~ #</p>
<p>localhost:~ # cat /root/resid.sh</p>
<p>#!/bin/sh<br>kill -9 <code>ps aux | grep -i squid | grep -v grep|awk &#39;{print $2}&#39;</code> &gt; /dev/null</p>
<h1 id="kill-9-cat-var-run-squid-pid-gt-dev-null"><a href="#kill-9-cat-var-run-squid-pid-gt-dev-null" class="headerlink" title="kill -9 cat /var/run/squid.pid &gt; /dev/null"></a>kill -9 <code>cat /var/run/squid.pid</code> &gt; /dev/null</h1><p>/etc/init.d/squid start &gt; /dev/null<br>/etc/init.d/mysql start &gt; /dev/null<br>localhost:~ #</p>
<p>localhost:~ # cat /backup/backupopt/squid_backup.sh</p>
<p>#!/bin/bash<br>host=”10.6.100.39”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/backup/backupopt”<br>remotedir=”/backup_proxy”<br>tar -cjPf $basedir/squid.$(date +%Y-%m-%d).tar.bz2 /root /usr/local /etc /boot /home<br>backupfile=squid.$(date +%Y-%m-%d).tar.bz2<br>rmfile=squid.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>localhost:~ #</p>
<p>Proxy</p>
<p>#!/bin/bash<br>host=”10.6.0.73”<br>id=”ctzapc”<br>pw=”htw001c9”<br>basedir=”/backup/backupopt”<br>remotedir=”/backup_proxy”<br>tar -cjPf $basedir/squid.$(date +%Y-%m-%d).tar.bz2 /root /usr/local /etc /boot /home<br>backupfile=squid.$(date +%Y-%m-%d).tar.bz2<br>rmfile=squid.$(date +%Y-%m-%d –date -7day).tar.bz2<br>ftp -n “$host” &lt;&lt;EOF<br>user $id $pw<br>binary<br>cd $remotedir<br>lcd $basedir<br>put $backupfile<br>bye<br>EOF<br>rm -f $basedir/$rmfile<br>crontab -e<br>00 05 <em> </em> <em> /etc/init.d/squid restart<br>00 06 </em> <em> </em> sh /root/autoftp.sh</p>
<ul>
<li>8,10,12,14,16  <em> </em> <em> sh /root/resid.sh<br>00 04 </em> <em> </em>  sh /backup/backupopt/squid_backup.sh</li>
</ul>
<p>查看文件夹容量<br>localhost:/var/log/squid # du -h –max-depth=1 /var/log/squid</p>
<p>linux ls 按文件大小排序<br>ls -Slrh /var/log/squid/<br>localhost:/var/log/squid # ls -Slrh</p>
<p>日志过大，手工删除<br>localhost:/var/log/squid # rm store.log-201504*</p>
<p>查看系统日志<br>localhost:~ # tail -f /var/log/messages</p>
<p>vim sys.txt<br>ps aux | grep -i squid<br>ll -h /var/log/squid/access.log &amp;&amp; ll -h /var/log/squid/store.log<br>/usr/sbin/squid -k rotate</p>
<p>滚动日志记录<br>/usr/sbin/squid -k rotate<br>localhost:~ # ll -h /var/log/squid/access.log<br>-rw-r—– 1 squid nogroup 42K Jun  2 16:41 /var/log/squid/access.log<br>localhost:~ # ll -h /var/log/squid/store.log<br>-rw-r—– 1 squid nogroup 103K Jun  2 16:41 /var/log/squid/store.log</p>
<p>正常运行：<br>ps aux | grep -i squid<br>root     15813  0.0  0.0   7240  1160 ?        Ss   16:59   0:00 /usr/sbin/squid -sYD<br>squid    15815 38.3  0.3  30932 25488 ?        S    16:59   2:58 (squid) -sYD<br>squid    15819  0.0  0.0   3924  1000 ?        Ss   16:59   0:00 (mysql_auth)<br>squid    15820  0.0  0.0   3924   696 ?        Ss   16:59   0:00 (mysql_auth)<br>squid    15821  0.0  0.0   3924   696 ?        Ss   16:59   0:00 (mysql_auth)<br>squid    15822  0.0  0.0   3924   696 ?        Ss   16:59   0:00 (mysql_auth)<br>squid    15825  0.0  0.0   3924   700 ?        Ss   16:59   0:00 (mysql_auth)<br>squid    15837  0.0  0.0   1732   244 ?        Ss   16:59   0:00 (unlinkd)<br>root     15921  0.0  0.0   2404   472 pts/0    S+   17:06   0:00 grep -i squid<br>localhost:~ # </p>
<p>vim mv.sh </p>
<p>for file in /root/*; do</p>
<p>  var=<code>stat -c %s $file</code></p>
<p>  echo $var</p>
<p>  [ $var -gt 100000 ] &amp;&amp; mv “$file” “${file}bak”</p>
<p>done<br>~</p>
<p>vim mvlog.sh<br>for file in /var/log/squid/*; do</p>
<p>  var=<code>stat -c %s $file</code></p>
<p>  echo $var</p>
<p>  [ $var -gt 1999666333 ] &amp;&amp; mv “$file” “${file}bak”</p>
<p>done</p>
<p>vim /root/rotate.sh<br>for file in /var/log/squid/*; do</p>
<p>  var=<code>stat -c %s $file</code></p>
<p>  echo $var</p>
<p>  [ $var -gt 1899666333 ] &amp;&amp; /usr/sbin/squid -k rotate</p>
<p>done</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/19/Proxy/" data-id="cix7b3woj002c0ecy2k02f2k6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/27/搭建nginx反向代理用做内网域名转发/">搭建nginx反向代理用做内网域名转发</a>
          </li>
        
          <li>
            <a href="/2016/12/27/Docker的Swarm模式/">Docker的Swarm模式</a>
          </li>
        
          <li>
            <a href="/2016/12/19/zebra/">zebra</a>
          </li>
        
          <li>
            <a href="/2016/12/19/moodle在CentOS下的迁移/">moodle在CentOS下的迁移</a>
          </li>
        
          <li>
            <a href="/2016/12/19/TzuChi-技术/">TzuChi 技术</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>