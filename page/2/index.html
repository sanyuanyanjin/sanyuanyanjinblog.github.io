<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SanYuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="SanYuan">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="SanYuan">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SanYuan">
  
    <link rel="alternate" href="/atom.xml" title="SanYuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SanYuan</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-seafile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/seafile/" class="article-date">
  <time datetime="2016-12-15T05:55:25.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/seafile/">seafile</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://manual-cn.seafile.com/deploy/using_mysql.html" target="_blank" rel="external">http://manual-cn.seafile.com/deploy/using_mysql.html</a></p>
<p>root@master:~# apt-get install mysql-server<br>root@master:~# mysql -uroot -pyanjin</p>
<p>root@master:~# mkdir tzuchi<br>root@master:~# df -h<br>文件系统        容量  已用  可用 已用% 挂载点<br>/dev/xvda1       28G  4.9G   21G   19% /<br>udev            988M  4.0K  988M    1% /dev<br>tmpfs           200M  904K  199M    1% /run<br>none            5.0M     0  5.0M    0% /run/lock<br>none            999M  180K  998M    1% /run/shm<br>root@master:~# mv seafile-server_5.1.1_x86-64.tar.gz tzuchi/<br>root@master:~# cd tzuchi/<br>root@master:~/tzuchi# tar -xf seafile-server_5.1.1_x86-64.tar.gz<br>root@master:~/tzuchi# mkdir installed<br>root@master:~/tzuchi# ls<br>installed  seafile-server-5.1.1  seafile-server_5.1.1_x86-64.tar.gz<br>root@master:~/tzuchi# mv seafile-server-5.1.1/ installed/<br>root@master:~/tzuchi# ls<br>installed  seafile-server_5.1.1_x86-64.tar.gz<br>root@master:~/tzuchi# cd ..<br>root@master:~# tree tzuchi -L 2<br>tzuchi<br>├── installed<br>│   └── seafile-server_5.1.1_x86-64.tar.gz<br>└── seafile-server-5.1.1<br>    ├── check_init_admin.py<br>    ├── reset-admin.sh<br>    ├── runtime<br>    ├── seaf-fsck.sh<br>    ├── seaf-fuse.sh<br>    ├── seaf-gc.sh<br>    ├── seafile<br>    ├── seafile.sh<br>    ├── seahub<br>    ├── seahub.sh<br>    ├── setup-seafile-mysql.py<br>    ├── setup-seafile-mysql.sh<br>    ├── setup-seafile.sh<br>    └── upgrade</p>
<p>6 directories, 11 files<br>root@master:~# apt-get update</p>
<p>root@master:~# apt-get install python2.7 python-setuptools python-imaging python-ldap python-mysqldb python-memcache<br>root@master:~#<br>root@master:~# cd tzuchi/seafile-server-5.1.1/<br>root@master:~/tzuchi/seafile-server-5.1.1# ls<br>check_init_admin.py  seaf-fuse.sh  seahub                  setup-seafile.sh<br>reset-admin.sh       seaf-gc.sh    seahub.sh               upgrade<br>runtime              seafile       setup-seafile-mysql.py<br>seaf-fsck.sh         seafile.sh    setup-seafile-mysql.sh<br>root@master:~/tzuchi/seafile-server-5.1.1# ./setup-seafile-mysql.sh<br>Checking python on this machine …<br>  Checking python module: setuptools … Done.<br>  Checking python module: python-imaging … Done.<br>  Checking python module: python-mysqldb … Done.</p>
<h2 id="This-is-your-configuration"><a href="#This-is-your-configuration" class="headerlink" title="This is your configuration"></a>This is your configuration</h2><pre><code>server name:            tzuchi
server ip/domain:       10.6.6.9

seafile data dir:       /root/tzuchi/seafile-data
fileserver port:        8082

database:               create new
ccnet database:         ccnet-db
seafile database:       seafile-db
seahub database:        seahub-db
database user:          root
</code></pre><hr>
<h2 id="Press-ENTER-to-continue-or-Ctrl-C-to-abort"><a href="#Press-ENTER-to-continue-or-Ctrl-C-to-abort" class="headerlink" title="Press ENTER to continue, or Ctrl-C to abort"></a>Press ENTER to continue, or Ctrl-C to abort</h2><p>Generating ccnet configuration …</p>
<p>done<br>Successly create configuration dir /root/tzuchi/ccnet.<br>Generating seafile configuration …</p>
<p>Done.<br>done<br>Generating seahub configuration …</p>
<hr>
<p>Now creating seahub database tables …</p>
<hr>
<p>creating seafile-server-latest symbolic link …  done</p>
<hr>
<h2 id="Your-seafile-server-configuration-has-been-finished-successfully"><a href="#Your-seafile-server-configuration-has-been-finished-successfully" class="headerlink" title="Your seafile server configuration has been finished successfully."></a>Your seafile server configuration has been finished successfully.</h2><p>run seafile server:     ./seafile.sh { start | stop | restart }<br>run seahub  server:     ./seahub.sh  { start <port> | stop | restart <port> }</port></port></p>
<hr>
<h2 id="If-you-are-behind-a-firewall-remember-to-allow-input-output-of-these-tcp-ports"><a href="#If-you-are-behind-a-firewall-remember-to-allow-input-output-of-these-tcp-ports" class="headerlink" title="If you are behind a firewall, remember to allow input/output of these tcp ports:"></a>If you are behind a firewall, remember to allow input/output of these tcp ports:</h2><p>port of seafile fileserver:   8082<br>port of seahub:               8000</p>
<p>When problems occur, Refer to</p>
<pre><code>https://github.com/haiwen/seafile/wiki
</code></pre><p>for information.</p>
<p>root@master:~/tzuchi/seafile-server-5.1.1# ./seafile.sh start</p>
<p>[05/04/16 11:07:09] ../common/session.c(132): using config file /root/tzuchi/conf/ccnet.conf<br>Starting seafile server, please wait …<br>Seafile server started</p>
<p>Done.<br>root@master:~/tzuchi/seafile-server-5.1.1#<br>root@master:~/tzuchi/seafile-server-5.1.1# ./seahub.sh start</p>
<p>LC_ALL is not set in ENV, set to en_US.UTF-8<br>Starting seahub at port 8000 …</p>
<hr>
<h2 id="It’s-the-first-time-you-start-the-seafile-server-Now-let’s-create-the-admin-account"><a href="#It’s-the-first-time-you-start-the-seafile-server-Now-let’s-create-the-admin-account" class="headerlink" title="It’s the first time you start the seafile server. Now let’s create the admin account"></a>It’s the first time you start the seafile server. Now let’s create the admin account</h2><p>What is the email for the admin account?<br>[ admin email ] 455177385@qq.com</p>
<p>What is the password for the admin account?<br>[ admin password ] </p>
<p>Enter the password again:<br>[ admin password again ] </p>
<hr>
<h2 id="Successfully-created-seafile-admin"><a href="#Successfully-created-seafile-admin" class="headerlink" title="Successfully created seafile admin"></a>Successfully created seafile admin</h2><p>Seahub is started</p>
<p>Done.</p>
<p><a href="http://10.6.6.9:8000" target="_blank" rel="external">http://10.6.6.9:8000</a><br><a href="http://10.6.6.9:8000/accounts/login/" target="_blank" rel="external">http://10.6.6.9:8000/accounts/login/</a><br>455177385@qq.com<br>test@tzuchi.com.cn<br>test123<br>[ admin email ]<br>yanjin@tzuchi.com.cn</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/seafile/" data-id="ciwrk0lpp002dtlcyuo6d4x8o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu-12-04-ssh登录很慢" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/ubuntu-12-04-ssh登录很慢/" class="article-date">
  <time datetime="2016-12-15T05:34:58.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/ubuntu-12-04-ssh登录很慢/">ubuntu 12.04  ssh登录很慢</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>解决方法：</p>
<ol>
<li><p>增加或更改ssh的配置参数：</p>
<pre><code>在 /etc/ssh/ssh_config 文件中修改GSSAPIAuthentication yes(在倒数第二行) 为 GSSAPIAuthentication no ，保存。

命令：sudo gedit /etc/ssh/ssh_config
</code></pre></li>
<li><p>重启ssh服务：</p>
<pre><code>命令：sudo /etc/init.d/ssh restart
</code></pre></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/ubuntu-12-04-ssh登录很慢/" data-id="ciwrk0lpt002jtlcycux87uic" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu-12-04-不显示用户名和路径" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/ubuntu-12-04-不显示用户名和路径/" class="article-date">
  <time datetime="2016-12-15T05:33:45.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/ubuntu-12-04-不显示用户名和路径/">ubuntu 12.04 不显示用户名和路径</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ubuntu 12.04 命令行不显示用户名和路径了<br>现象<br>[plain] view plaincopy </p>
<ol>
<li>Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.5.0-23-generic x86_64) </li>
<li></li>
<li><ul>
<li>Documentation:  <a href="https://help.ubuntu.com/" target="_blank" rel="external">https://help.ubuntu.com/</a> </li>
</ul>
</li>
<li></li>
<li>System information as of Wed Feb 26 16:31:31 CST 2014 </li>
<li></li>
<li>Graph this data and manage this system at <a href="https://landscape.canonical.com/" target="_blank" rel="external">https://landscape.canonical.com/</a> </li>
<li></li>
<li></li>
<li>Last login: Wed Feb 26 16:29:08 2014 from 10.0.17.139 </li>
<li>$  </li>
<li>$  </li>
<li>$  </li>
<li>$<br>分析和解决方案<br>一般的情况都认为是环境变量PS1的问题，可以手动设置下PS1环境变量。如：<br>[plain] view plaincopy </li>
<li>export PS1=[<code>hostname</code>/<code>whoami</code>]$<br>如果情况未改变，请检查/etc/passwd的权限。<br>/etc/passwd的权限应该为644。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/ubuntu-12-04-不显示用户名和路径/" data-id="ciwrk0lpt002ktlcy6zew1x1q" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu-12-04网络设置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/ubuntu-12-04网络设置/" class="article-date">
  <time datetime="2016-12-15T05:28:59.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/ubuntu-12-04网络设置/">ubuntu 12.04网络设置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ubuntu 12.04网络设置，自定义IP地址<br>1、服务器版本<br>设置IP地址<br>ubuntu 12.04的网络设置文件是/etc/network/interfaces，打开文件，会看到</p>
<p>auto lo</p>
<p>iface lo inet loopback</p>
<p>这边的设置是本地回路。在后面加上</p>
<p>auto eth0</p>
<p>iface eth0 inet static</p>
<p>address 192.168.1.230（ip地址）</p>
<p>netmask 255.255.255.0（子网掩码）</p>
<p>gateway 192.168.1.1（网关）</p>
<p>其中eth0就是电脑的网卡，如果电脑有多块网卡，比如还会有eth1，都可以在这里进行设置。iface eth0 inet 设置为dhcp是动态获取IP，设置为static则用自定义的IP。这边要自定义IP地址，所以选择static选项。</p>
<p>重新启动网络服务<br>sudo /etc/init.d/networking restart</p>
<p>重启好后，用ifconfig看下eth0，是不是改成自己需要的IP地址了。</p>
<p>设置dns<br>ip设置好后，如果直接ping www.baidu.com会发现ping不通，因为dns还没设置，编辑/etc/resolv.conf，加上dns服务器地址。</p>
<p>nameserver 8.8.8.8</p>
<p>nameserver 8.8.4.4</p>
<p>这两个是Google提供的免费DNS服务器的IP地址。</p>
<p>2、桌面版本<br>桌面版提供了network-manage管理工具，可以通过界面直接管理。</p>
<p>点击右上角网络图标，编辑连接，增加新的连接。我的设置截图如下，可以根据自己的需要进行修改。</p>
<p>ubuntu 12.04桌面版网络设置-选择网卡<br>ubuntu 12.04桌面版网络设置-选择网卡</p>
<p>ubuntu 12.04桌面版网络设置-设置IP<br>ubuntu 12.04桌面版网络设置-设置IP</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/ubuntu-12-04网络设置/" data-id="ciwrk0lpu002ltlcyr9oehd2b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Ubuntu-用vsftpd-配置FTP服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Ubuntu-用vsftpd-配置FTP服务器/" class="article-date">
  <time datetime="2016-12-15T05:28:14.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Ubuntu-用vsftpd-配置FTP服务器/">Ubuntu 用vsftpd 配置FTP服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>网上的文章好难懂啊。。只想要简单粗暴，弄好能用就行啊，复杂的以后研究不行吗。。。折腾好久，其实弄出来能用不就这么点内容吗。。。<br>本文在Ubuntu Server 14.04 amd64系统测试。<br>Made By：CSGrandeur<br>安装ftp<br>sudo apt-get install vsftpd<br>配置vsftpd.conf<br>sudo nano /etc/vsftpd.conf<br>复制代码</p>
<p>#禁止匿名访问<br>anonymous_enable=NO</p>
<p>#接受本地用户<br>local_enable=YES</p>
<p>#允许上传<br>write_enable=YES</p>
<p>#用户只能访问限制的目录<br>chroot_local_user=YES</p>
<p>#设置固定目录，在结尾添加。如果不添加这一行，各用户对应自己的目录，当然这个文件夹自己建<br>local_root=/home/ftp<br>复制代码<br>看网上说加一行“pam_service_name=vsftpd”，我看我这个配置文件本来就有，就不管了。<br>添加ftp用户<br>sudo useradd -d /home/ftp -M ftpuser<br>sudo passwd ftpuser<br>调整文件夹权限<br>这个是避免“500 OOPS: vsftpd: refusing to run with writable root inside chroot()”<br>sudo chmod a-w /home/ftp<br>sudo mkdir /home/ftp/data<br>这样登录之后会看到data文件夹，虽然稍麻烦，原因不表了。。查资料这么辛酸已经不易。。<br>改pam.d/vsftpd<br>这时候直接用useradd的帐号登录ftp会530 login incorrect<br>sudo nano /etc/pam.d/vsftpd<br>注释掉 </p>
<p>#auth    required pam_shells.so<br>重启vsftpd<br>sudo service vsftpd restart<br>这时就可以用刚才建的ftpuser这个用户登录ftp了，看到的是local_root设置的/home/ftp，并且限制在该目录。</p>
<p>可以在浏览器用ftp://xxx.xxx.xxx.xxx访问，也可以用ftp软件比如flashFXP，密码就是ftpuser的密码。<br>关于用户访问文件夹限制<br>由chroot_local_user、chroot_list_enable、chroot_list_file这三个文件控制，转别人的一段话：<br>首先，chroot_list_enable好理解，就是：是否启用chroot_list_file配置的文件，如果为YES表示chroot_list_file配置的文件生效，否则不生效；<br>第二，chroot_list_file也简单，配置了一个文件路径，默认是/etc/vsftpd.chroot_list，该文件中会填入一些账户名称。但是这些账户的意义不是固定的，是跟配置项chroot_local_user有关的。后一条中说明；<br>第三，chroot_local_user为YES表示所有用户都<em>不能</em>切换到主目录之外其他目录，但是！除了chroot_list_file配置的文件列出的用户。chroot_local_user为NO表示所有用户都<em>能</em>切换到主目录之外其他目录，但是！除了chroot_list_file配置的文件列出的用户。也可以理解为，chroot_list_file列出的“例外情况”的用户。<br> 如果客户端登录时候提示“以pasv模式连接失败”<br>编辑/etc/vsftpd.conf<br>最后添加<br>pasv_promiscuous=YES<br>然后再重启vsftpd服务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Ubuntu-用vsftpd-配置FTP服务器/" data-id="ciwrk0lp7001xtlcyqrueegtc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu下允许root用户ssh远程登录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/ubuntu下允许root用户ssh远程登录/" class="article-date">
  <time datetime="2016-12-15T05:27:18.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/ubuntu下允许root用户ssh远程登录/">ubuntu下允许root用户ssh远程登录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>SSH服务器，可以通过SSH协议来访问远程服务器，代替telnet和ftp。但是ubuntu默认是不启用root用户也不允许root远程登录的。所以需要先启用root用户</p>
<p>启用root用户：sudo passwd root      //修改密码后就启用了。</p>
<p>安装OpenSSH server：</p>
<ol>
<li>使用apt命令安装openssh server</li>
</ol>
<p>$ sudo apt-get install openssh-server</p>
<ol>
<li>可以对 openssh server进行配置</li>
</ol>
<p>$ sudo vi /etc/ssh/sshd_config</p>
<p>找到PermitRootLogin no一行，改为PermitRootLogin yes</p>
<ol>
<li>重启 openssh server</li>
</ol>
<p>$ sudo service ssh restart</p>
<ol>
<li>客户端如果是ubuntu的话，则已经安装好ssh client,可以用下面的命令连接远程服务器。</li>
</ol>
<p>$ ssh xxx.xxx.xxx.xxx</p>
<p>如果是windows系统的话，可以使用SSH Secure Shell等ssh软件进行远程连接。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/ubuntu下允许root用户ssh远程登录/" data-id="ciwrk0lpv002mtlcyh14odowc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu用root登录后没法使用chromium" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/ubuntu用root登录后没法使用chromium/" class="article-date">
  <time datetime="2016-12-15T05:26:45.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/ubuntu用root登录后没法使用chromium/">ubuntu用root登录后没法使用chromium</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用root登录后启动chromium会出现错误：<br>Google Chrome can not be run as root.<br>Please start Google Chrome as a normal user. To run as root, you must specify an alternate –user-data-dir for storage of profile information.<br>在网上有方法是用每次用终端启动时添加新的参数，但比较麻烦，后来研究了一下，只要新建一个chormium的桌面快捷方式，选择properties-》basic-&gt;command, 改为如下：<br>/usr/bin/chromium-browser %U - -user-data-dir=/root/.config/chromium<br>这样每次双击这个快捷方式，就能在root下使用chromium。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/ubuntu用root登录后没法使用chromium/" data-id="ciwrk0lpv002ntlcyyyitkyrz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-vsftpd安装以及配置FTP虚拟用户实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/vsftpd安装以及配置FTP虚拟用户实践/" class="article-date">
  <time datetime="2016-12-15T05:26:06.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/vsftpd安装以及配置FTP虚拟用户实践/">vsftpd安装以及配置FTP虚拟用户实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>vsftpd安装以及配置FTP虚拟用户实践<br>By wsgzao<br>发表于 2015-08-24<br>文章目录</p>
<ol>
<li><ol>
<li>前言</li>
</ol>
</li>
<li><ol>
<li>更新历史</li>
</ol>
</li>
<li><ol>
<li>安装vsftpd</li>
</ol>
</li>
<li><ol>
<li>基于虚拟用户的配置</li>
</ol>
</li>
<li>4.1. 修改配置文件</li>
<li>4.2. 进行认证</li>
<li>4.3. 设置FTP根目录权限</li>
<li>4.4. 配置PASV模式（可选）</li>
<li>4.5. Selinux和防火墙</li>
<li><ol>
<li>常见问题<br>前言<br>正如vsftpd官方宣传中所说Probably the most secure and fastest FTP server for UNIX-like systems.我相信这是大多数人选择vsftpd来搭建Linux的FTP服务器的原因，当然ProFTPD用的人应该也不在少数。文章将以清晰直观的方式介绍安装vsftpd以及配置FTP虚拟用户的过程，希望对大家有帮助。<br>首选的FTP服务器搭建方式</li>
</ol>
</li>
</ol>
<hr>
<p>更新历史<br>2015年08月24日 - 初稿<br>阅读原文 - <a href="http://wsgzao.github.io/post/vsftpd/" target="_blank" rel="external">http://wsgzao.github.io/post/vsftpd/</a><br>扩展阅读<br>CentOS 6.4 下安装vsftpd - <a href="http://www.cnblogs.com/xiongpq/p/3384759.html" target="_blank" rel="external">http://www.cnblogs.com/xiongpq/p/3384759.html</a><br>ProFTPD - <a href="http://www.proftpd.org/" target="_blank" rel="external">http://www.proftpd.org/</a><br>vsftpd - <a href="http://vsftpd.beasts.org" target="_blank" rel="external">http://vsftpd.beasts.org</a></p>
<hr>
<p>安装vsftpd</p>
<p>#查看当前系统版本<br>cat /etc/redhat-release<br>CentOS release 6.6 (Final)</p>
<p>#查看是否已经安装vsftpd<br>rpm -qa | grep vsftpd</p>
<p>#如果没有，就安装，并设置开机启动<br>yum -y install vsftpd<br>chkconfig vsftpd on<br>基于虚拟用户的配置<br>所谓虚拟用户就是没有使用真实的帐户，只是通过映射到真实帐户和设置权限的目的。虚拟用户不能登录CentOS系统。<br>修改配置文件<br>vi /etc/vsftpd/vsftpd.conf</p>
<p>#服务器独立运行<br>listen=YES</p>
<p>#设定不允许匿名访问<br>anonymous_enable=NO</p>
<p>#设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问<br>local_enable=YES</p>
<p>#使用户不能离开主目录<br>chroot_list_enable=YES</p>
<p>#设定支持ASCII模式的上传和下载功能<br>ascii_upload_enable=YES<br>ascii_download_enable=YES</p>
<p>#PAM认证文件名。PAM将根据/etc/pam.d/vsftpd进行认证<br>pam_service_name=vsftpd</p>
<p>#设定启用虚拟用户功能<br>guest_enable=YES</p>
<p>#指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了<br>guest_username=ftp</p>
<p>#设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)<br>user_config_dir=/etc/vsftpd/vuser_conf</p>
<p>#配置vsftpd日志（可选）<br>xferlog_enable=YES<br>xferlog_std_format=YES<br>xferlog_file=/var/log/xferlog<br>dual_log_enable=YES<br>vsftpd_log_file=/var/log/vsftpd.log<br>进行认证</p>
<p>#安装Berkeley DB工具，很多人找不到db_load的问题就是没有安装这个包<br>yum install db4 db4-utils</p>
<p>#创建用户密码文本，注意奇行是用户名，偶行是密码<br>vi /etc/vsftpd/vuser_passwd.txt</p>
<p>test<br>123456</p>
<p>#生成虚拟用户认证的db文件<br>db_load -T -t hash -f /etc/vsftpd/vuser_passwd.txt /etc/vsftpd/vuser_passwd.db</p>
<p>#编辑认证文件，全部注释掉原来语句，再增加以下两句<br>vi /etc/pam.d/vsftpd</p>
<p>auth required pam_userdb.so db=/etc/vsftpd/vuser_passwd<br>account required pam_userdb.so db=/etc/vsftpd/vuser_passwd</p>
<p>#创建虚拟用户配置文件<br>mkdir /etc/vsftpd/vuser_conf/</p>
<p>#文件名等于vuser_passwd.txt里面的账户名，否则下面设置无效<br>vi /etc/vsftpd/vuser_conf/test</p>
<p>#虚拟用户根目录,根据实际情况修改<br>local_root=/data/ftp<br>write_enable=YES<br>anon_umask=022<br>anon_world_readable_only=NO<br>anon_upload_enable=YES<br>anon_mkdir_write_enable=YES<br>anon_other_write_enable=YES<br>设置FTP根目录权限</p>
<p>#最新的vsftpd要求对主目录不能有写的权限所以ftp为755，主目录下面的子目录再设置777权限<br>mkdir /data/ftp<br>chmod -R 755 /data<br>chmod -R 777 /data/ftp</p>
<p>#建立限制用户访问目录的空文件<br>touch /etc/vsftpd/chroot_list</p>
<p>#如果启用vsftpd日志需手动建立日志文件<br>touch /var/log/xferlog<br>touch /var/log/vsftpd.log<br>配置PASV模式（可选）<br>vsftpd默认没有开启PASV模式，现在FTP只能通过PORT模式连接，要开启PASV默认需要通过下面的配置</p>
<p>打开/etc/vsftpd/vsftpd.conf，在末尾添加</p>
<p>#开启PASV模式<br>pasv_enable=YES</p>
<p>#最小端口号<br>pasv_min_port=40000</p>
<p>#最大端口号<br>pasv_max_port=40080<br>pasv_promiscuous=YES</p>
<p>#在防火墙配置内开启40000到40080端口<br>-A INPUT -m state –state NEW -m tcp -p -dport 40000:40080 -j ACCEPT</p>
<p>#重启iptabls和vsftpd<br>service iptables restart<br>service vsftpd restart</p>
<p>现在可以使用PASV模式连接你的FTP服务器了~<br>Selinux和防火墙<br>该关闭的关闭，该放行的放行<br>service vsftpd start<br>常见问题<br>如果登录时出现<br>500 OOPS: priv_sock_get_result. Connection closed by remote host.<br>这样的错误，需要升级pam<br>yum update pam</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/vsftpd安装以及配置FTP虚拟用户实践/" data-id="ciwrk0lq0002stlcyvx3c40t0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Ubuntu-64-位预配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Ubuntu-64-位预配/" class="article-date">
  <time datetime="2016-12-15T05:22:07.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Ubuntu-64-位预配/">Ubuntu 64 位预配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>java<br>vm tools<br>sudo passwd root<br>Ubuntu软件中心——编辑——更换软件源</p>
<p>root用户登录桌面<br>vim /usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf<br>[SeatDefaults]<br>user-session=ubuntu<br>greeter-show-manual-login=true<br>Ubuntu启用root账户后，登录root账户时报错：读取/root/.profile时发现错误：mesg:ttyname failed:对设备不适当的ioctl操作 作为结果，会话不会被正确配置<br>root@ubuntu:~# cp /home/jinyan/.profile /root/<br>root@ubuntu:~# reboot</p>
<p>cp /etc/apt/sources.list /etc/apt/sources.listbak<br>vim /etc/apt/sources.list<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-security main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-updates main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-proposed main restricted universe multiverse<br>  deb-src <a href="http://mirrors.aliyun.com/ubuntu/" target="_blank" rel="external">http://mirrors.aliyun.com/ubuntu/</a> precise-backports main restricted universe multiverse<br>apt-get update</p>
<p>用vim打开 /etc/default/locale 文件</p>
<p>原来的配置文件应该是这样的：<br>LANG=”zh_CN.UTF-8”<br>LANGUAGE=”zh_CN:zh:en_US:en”<br>LC_NUMERIC=”zh_CN.UTF-8”<br>LC_TIME=”zh_CN.UTF-8”<br>LC_MONETARY=”zh_CN.UTF-8”<br>LC_PAPER=”zh_CN.UTF-8”<br>LC_IDENTIFICATION=”zh_CN.UTF-8”<br>LC_NAME=”zh_CN.UTF-8”<br>LC_ADDRESS=”zh_CN.UTF-8”<br>LC_TELEPHONE=”zh_CN.UTF-8”<br>LC_MEASUREMENT=”zh_CN.UTF-8”</p>
<p>将原来的配置内容修改为<br>LANG=”en_US.UTF-8″<br>LANGUAGE=”en_US:en”</p>
<p>再在终端下运行：<br>locale-gen -en_US:en<br>注销或重启后，即可恢复为英文的语言环境。</p>
<p>查看防火墙状态<br>root@jinyan-virtual-machine:~# ufw status<br>状态：不活动<br>root@jinyan-virtual-machine:~# getenforce<br>程序“getenforce”尚未安装。 您可以使用以下命令安装：<br>apt-get install selinux-utils</p>
<p>apt-get install vim<br>apt-get install openssh-server<br>vim /etc/ssh/sshd_config<br>找到PermitRootLogin no一行，改为PermitRootLogin yes<br>PermitRootLogin yes</p>
<h1 id="PermitRootLogin-without-password"><a href="#PermitRootLogin-without-password" class="headerlink" title="PermitRootLogin without-password"></a>PermitRootLogin without-password</h1><p>重启系统<br>重启 openssh server<br>/etc/init.d/ssh restart<br>service ssh restart</p>
<p>apt-get install ntp<br>查看ntp同步过程<br>ntpq -p<br>ntpdate -u 202.120.2.101</p>
<p>apt-get install x-window-system-core<br>apt-get install gdm<br>apt-get install ubuntu-desktop<br>apt-get install gnome-core</p>
<p>apt-get install vnc4server<br>vncserver<br>cp ~/.vnc/xstartup  ~/.vnc/xstartup.bak<br>vim ~/.vnc/xstartup</p>
<h1 id="x-window-manager-amp"><a href="#x-window-manager-amp" class="headerlink" title="x-window-manager &amp;"></a>x-window-manager &amp;</h1><h1 id="gnome-session-amp"><a href="#gnome-session-amp" class="headerlink" title="gnome-session &amp;"></a>gnome-session &amp;</h1><p>gnome-panel &amp;<br>gnome-settings-daemon &amp;<br>metacity &amp;<br>nautilus &amp;<br>gnome-terminal &amp;</p>
<p>root@jinyan-virtual-machine:~# vncserver -kill :1<br>Killing Xvnc4 process ID 3767<br>root@jinyan-virtual-machine:~# vncserver :1<br>192.168.50.6:1</p>
<p>apt-get install vsftpd<br>apt-get remove vsftpd</p>
<p>vim /etc/vsftpd.conf<br>local_enable=YES<br>write_enable=YES<br>chroot_local_user=YES<br>chroot_list_enable=YES<br>chroot_list_file=/etc/vsftpd.chroot_list</p>
<p>anonymous_enable=YES</p>
<h1 id="anonymous-enable-NO"><a href="#anonymous-enable-NO" class="headerlink" title="anonymous_enable=NO"></a>anonymous_enable=NO</h1><p>useradd -d /home/ftp -M ftpuser<br>passwd ftpuser</p>
<p>vim /etc/vsftpd.chroot_list<br>ftpuser</p>
<p>vim /etc/ftpusers<br>打开这个文件后，看一看有没有uftp这个用户名，如果没有，就直接退出。如果有就删除uftp,因为这个文件中记录的是不能访问FTP服务器的用户清单。</p>
<p>vim /etc/pam.d/vsftpd</p>
<p>#auth   required        pam_shells.so</p>
<p>mkdir /home/ftp<br>chmod a-w /home/ftp<br>mkdir /home/ftp/data<br>chown -R ftpuser:ftpuser /home/ftp/</p>
<p>service vsftpd restart</p>
<p>mkdir /usr/lib/java<br>tar -zxvf jdk-7u79-linux-x64.tar.gz -C /usr/lib/java/<br>cd /usr/lib/java/jdk1.7.0_79/</p>
<p>vim ~/.bashrc</p>
<p>vim /etc/profile<br>export JAVA_HOME=/usr/lib/java/jdk1.7.0_79/<br>export JRE_HOME=${JAVA_HOME}/jre<br>export CLASS_PATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib<br>export PATH=${JAVA_HOME}/bin:$PATH</p>
<p>root@jinyan-virtual-machine:~# source /etc/profile<br>root@jinyan-virtual-machine:~# java -version<br>java version “1.7.0_79”<br>Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</p>
<p>apt-get install samba<br>apt-get install smbfs</p>
<p>apt-get install samba samba-common system-config-samba python-glade2 gksu<br>在 Unity Dash 中搜索并打开 Samba 配置工具</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Ubuntu-64-位预配/" data-id="ciwrk0lp7001wtlcykr795err" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Postfix-Amavisd-new-Spamassassin-ClamAV整合安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/" class="article-date">
  <time datetime="2016-12-15T05:21:30.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/">Postfix+Amavisd-new+Spamassassin+ClamAV整合安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>安装软件和依赖包<br>apt-get install postfix amavisd-new spamassassin clamav-daemon mysql-client mysql-server<br>apt-get install libnet-dns-perl pyzor razor<br>apt-get install arj bzip2 cabextract cpio file gzip lha nomarch pax rar unrar unzip zip</p>
</li>
<li><p>修改用户权限<br>usermod -a -G clamav amavis<br>usermod -a -G amavis clamav</p>
</li>
<li><p>修改spamassassin配置文件/etc/default/spamassassin<br>ENABLED=0 ====&gt; ENABLED=1<br>CRON=0    ====&gt; CRON=1</p>
</li>
</ol>
<p>4.启动spamassassin<br>/etc/init.d/spamassassin start</p>
<ol>
<li><p>修改amavis配置文件/etc/amavis/conf.d/15-content_filter_mode<br> 1) 去掉里面的注释（目的：check病毒和垃圾邮件）<br> 2) 重启amavis<br>/etc/init.d/amavis restart</p>
</li>
<li><p>修改postfix配置文件/etc/postfix/main.cf,添加如下内容<br> 注释掉mydestination<br>添加：<br>relay_domains = test.com<br>transport_maps = hash:/etc/postfix/transport<br>relay_recipient_maps = hash:/etc/postfix/relay_recipients<br>content_filter = smtp-amavis:[127.0.0.1]:10024</p>
</li>
<li><p>编辑文件/etc/postfix/master.cf,在文件最后添加如下内容<br>smtp-amavis     unix    -       -       -       -       2       smtp</p>
<pre><code>-o smtp_data_done_timeout=1200
-o smtp_send_xforward_command=yes
-o disable_dns_lookups=yes
-o max_use=20
</code></pre></li>
</ol>
<p>127.0.0.1:10025 inet    n       -       -       -       -       smtpd<br>        -o content_filter=<br>        -o local_recipient_maps=<br>        -o relay_recipient_maps=<br>        -o smtpd_restriction_classes=<br>        -o smtpd_delay_reject=no<br>        -o smtpd_client_restrictions=permit_mynetworks,reject<br>        -o smtpd_helo_restrictions=<br>        -o smtpd_sender_restrictions=<br>        -o smtpd_recipient_restrictions=permit_mynetworks,reject<br>        -o smtpd_data_restrictions=reject_unauth_pipelining<br>        -o smtpd_end_of_data_restrictions=<br>        -o mynetworks=127.0.0.0/8<br>        -o smtpd_error_sleep_time=0<br>        -o smtpd_soft_error_limit=1001<br>        -o smtpd_hard_error_limit=1000<br>        -o smtpd_client_connection_count_limit=0<br>        -o smtpd_client_connection_rate_limit=0<br>        -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks</p>
<ol>
<li><p>在文件/etc/postfix/master.cf中的pickup行添加如下内容<br>   -o content_filter=<br>   -o receive_override_options=no_header_body_checks</p>
</li>
<li><p>重启postfix<br>/etc/init.d/postfix reload</p>
</li>
<li><p>修改/etc/amavis/conf.d/20-debian_defaults<br>$final_spam_destiny = D_BOUNCE  ===&gt; $final_spam_destiny = D_DISCARD</p>
</li>
</ol>
<p>$QUARANTINEDIR = “/data/virusmails”;</p>
<ol>
<li><p>修改/etc/amavis/conf.d/05-node_id<br>$myhostname = “mail.example.com”;</p>
</li>
<li><p>修改/etc/amavis/conf.d/50-user,添加如下内容：<br>$spam_quarantine_to = “spam-quarantine”;<br>$virus_quarantine_to = “spam-quarantine”;</p>
</li>
</ol>
<p>@whitelist_sender_maps = read_hash(“/etc/amavis/whitelist”);<br>@blacklist_sender_maps = read_hash(“/etc/amavis/blacklist”);</p>
<ol>
<li><p>在目录/etc/amavis下创建文件blacklist和whitelist<br>touch /etc/amavis/whitelist<br>touch /etc/amavis/blacklist</p>
</li>
<li><p>垃圾及病毒邮件的保存目录<br>/data/virusmails</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/15/Postfix-Amavisd-new-Spamassassin-ClamAV整合安装/" data-id="ciwrk0los001ktlcyviwm7ofo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/15/NGINX日志切割/">NGINX日志切割</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-6-x-安装SVN/">CentOS 6.x 安装SVN</a>
          </li>
        
          <li>
            <a href="/2016/12/15/CentOS-7-x-git/">CentOS 7.x git</a>
          </li>
        
          <li>
            <a href="/2016/12/15/开源资源/">开源资源</a>
          </li>
        
          <li>
            <a href="/2016/12/15/开源软件/">开源软件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 JinYan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>